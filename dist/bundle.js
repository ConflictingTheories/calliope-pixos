/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={3583:(t,e,r)=>{var n=r(7066);t.exports=function(t,e,r){e="number"==typeof e?e:1,r=r||": ";var i=t.split(/\r?\n/),o=String(i.length+e-1).length;return i.map((function(t,i){var a=i+e,s=String(a).length;return n(a,o-s)+r+t})).join("\n")}},3668:t=>{t.exports=function(t){return atob(t)}},5061:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>n});const n={init:function(t,e,r){this.length=t,this.untilFrame=e,this.finish=r},tick:function(t){if(this.loaded){this.facing&&this.facing!=this.sprite.facing&&this.sprite.setFacing(this.facing);var e=this.startTime+this.length,r=(t-this.startTime)/this.length;t>=e&&(r=1,this.finish&&this.finish(!0));var n=Math.floor(r*this.untilFrame);return n!=this.sprite.animFrame&&this.sprite.setFrame(n),t>=e}}}},1183:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>f});var n=r(8348),i=r(4180);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(){a=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,o=Object.create(i.prototype),a=new k(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=h(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function p(){}function d(){}function y(){}var g={};u(g,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(S([])));v&&v!==e&&r.call(v,i)&&(g=v);var b=y.prototype=p.prototype=Object.create(g);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(i,a,s,c){var u=h(t[i],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==o(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,c)}))}c(u.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function _(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=h(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=y,u(b,"constructor",y),u(y,"constructor",d),d.displayName=u(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(x.prototype),u(x.prototype,s,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function s(t,e,r){return s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&c(i,r.prototype),i},s.apply(null,arguments)}function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}function u(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function h(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}const f={init:(p=a().mark((function t(e,r,o,c,l){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sprite.zone.world.loadZone(e);case 2:return this.fromZone=t.sent,t.next=5,this.sprite.zone.world.loadZone(o);case 5:this.toZone=t.sent,this.from=s(n.OW,u(r)),this.to=s(n.OW,u(c)),this.facing=i.Nm.fromOffset([Math.round(c.x-r.x),Math.round(c.y-r.y)]),this.length=l;case 10:case"end":return t.stop()}}),t,this)})),d=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=p.apply(t,e);function o(t){h(i,r,n,o,a,"next",t)}function a(t){h(i,r,n,o,a,"throw",t)}o(void 0)}))},function(t,e,r,n,i){return d.apply(this,arguments)}),tick:function(t){if(this.toZone.loaded&&this.fromZone.loaded){this.facing&&this.facing!=this.sprite.facing&&(this.sprite.facing=this.facing,this.sprite.setFrame(0));var e=this.startTime+this.length,r=(t-this.startTime)/this.length;t>=e?((0,n.t8)(this.to,this.sprite.pos),r=1):(0,n.t7)(this.from,this.to,r,this.sprite.pos);var i=Math.floor(4*r);i!=this.sprite.animFrame&&this.sprite.setFrame(i),this.sprite.zone.isInZone(this.sprite.pos.x,this.sprite.pos.y)||(this.fromZone.removeSprite(this.sprite.id),this.sprite.zone.world.runAfterTick(function(){this.toZone.addSprite(this.sprite)}.bind(this)));var o=this.sprite.pos.x+this.sprite.hotspotOffset.x,a=this.sprite.pos.y+this.sprite.hotspotOffset.y;return this.switchRenderZone||this.fromZone.isInZone(o,a)||(this.switchRenderZone=!0),this.sprite.pos.z=(this.switchRenderZone?this.toZone:this.fromZone).getHeight(o,a),t>=e}}};var p,d},5317:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>n});const n={init:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.engine=this.sprite.engine,this.text="",this.prompt=t,this.scrolling=e,this.line=0,this.options=r,this.completed=!1,this.lastKey=(new Date).getTime()},tick:function(t){var e;if(this.loaded)return this.options&&this.options.autoclose&&(this.endTime=this.endTime?this.endTime:null!==(e=this.options.endTime)&&void 0!==e?e:(new Date).getTime()+1e4,t>this.endTime&&(this.completed=!0)),this.checkInput(t),this.textbox=this.engine.hud.scrollText(this.prompt+this.text,this.scrolling,this.options),this.completed},checkInput:function(t){if(t>this.lastKey+100){var e=!1;switch(this.engine.keyboard.lastPressedCode()){case"Escape":this.completed=!0,e=!0;break;case"Backspace":var r=this.text.split("");r.pop(),this.text=r.join(""),this.lastKey=t,e=!0;break;case"Enter":this.engine.setGreeting(this.text),this.sprite.speech.clearHud&&this.sprite.speech.clearHud(),this.speechbox=this.sprite.speech.scrollText(this.text),this.sprite.speech.loadImage(),this.completed=!0,e=!0}if(!e){var n=this.engine.keyboard.lastPressedKey();n&&(this.lastKey=t,this.text+=""+n)}}}}},8304:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>s});var n=r(4180);function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(){o=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,o=Object.create(i.prototype),a=new k(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=h(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function p(){}function d(){}function y(){}var g={};u(g,a,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(S([])));v&&v!==e&&r.call(v,a)&&(g=v);var b=y.prototype=p.prototype=Object.create(g);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(o,a,s,c){var u=h(t[o],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==i(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,c)}))}c(u.arg)}var o;this._invoke=function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}}function _(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=h(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=y,u(b,"constructor",y),u(y,"constructor",d),d.displayName=u(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(x.prototype),u(x.prototype,s,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),u(b,c,"Generator"),u(b,a,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function a(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}const s={init:(c=o().mark((function t(e,r){var n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.zone=r,this.moveLength=e,this.startTime=(new Date).getTime(),this.lastKey=(new Date).getTime(),this.completed=!1,t.next=7,this.zone.engine.resourceManager.audioLoader.loadFromZip(this.sprite.zip,null!==(n=this.sprite.danceSound)&&void 0!==n?n:"/pixos/audio/sewer-beat.mp3",!0);case 7:this.audio=t.sent,this.zone.audio&&this.zone.audio.pauseAudio(),this.audio&&this.audio.playAudio();case 10:case"end":return t.stop()}}),t,this)})),u=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=c.apply(t,e);function o(t){a(i,r,n,o,s,"next",t)}function s(t){a(i,r,n,o,s,"throw",t)}o(void 0)}))},function(t,e){return u.apply(this,arguments)}),tick:function(t){if(this.loaded){var e=new Uint8Array(this.audio.analyser.frequencyBinCount);if(this.audio.analyser.getByteFrequencyData(e),this.checkInput(t),t>this.startTime+this.moveLength){for(var r=this.sprite.facing==n.Nm.Right?n.Nm.Left:n.Nm.Right,i=null,o=0;o<16;o++)i=-e[o]/2;r=i>80?this.sprite.facing==n.Nm.Right?n.Nm.Down:n.Nm.Left:this.sprite.facing==n.Nm.Up?n.Nm.Left:n.Nm.Down,this.sprite.addAction(this.sprite.faceDir(r)).then((function(){})),this.startTime=t}return this.completed}},checkInput:function(t){if(t>this.lastKey+this.moveLength)return"q"===this.sprite.engine.keyboard.lastPressed("q")&&(this.audio&&this.audio.pauseAudio(),this.completed=!0),this.lastKey=(new Date).getTime(),null}};var c,u},2282:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>n});const n={init:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.engine=this.sprite.engine,this.text=t,this.displayText="string"==typeof t?t:this.text.shift(),this.scrolling=e,this.options=r,this.completed=!1,this.lastText=!1,this.speechOutput=!0,this.lastKey=(new Date).getTime(),this.loaded=!0},tick:function(t){var e,r;if(this.loaded)return this.options&&this.options.autoclose&&(this.endTime=this.endTime?this.endTime:null!==(e=this.options.endTime)&&void 0!==e?e:(new Date).getTime()+(null!==(r=1e3*this.options.duration)&&void 0!==r?r:1e4),t>this.endTime&&(this.completed=!0)),this.checkInput(t),this.sprite.speak(this.displayText,!1,this),this.completed&&this.options.onClose&&(this.sprite.speech.clearHud&&this.sprite.speech.clearHud(),this.options.onClose()),this.completed},checkInput:function(t){if(t>this.lastKey+100){switch(this.engine.keyboard.lastPressedCode()){case"Escape":this.sprite.speak(!1),this.completed=!0;break;case"Enter":"string"==typeof this.text||0===this.text.length?(this.sprite.speak(!1),this.completed=!0):(this.completed=!1,this.displayText=this.text.shift(),window.speechSynthesis.cancel(),this.speechOutput=!0,this.sprite.speak(this.displayText,!1,this))}if(this.engine.gamepad.keyPressed("a"))return void("string"==typeof this.text||0===this.text.length?(this.sprite.speak(!1),this.completed=!0):(this.completed=!1,this.displayText=this.text.shift(),window.speechSynthesis.cancel(),this.speechOutput=!0,this.sprite.speak(this.displayText,!1,this)))}}}},2813:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>n});const n={init:function(t){this.facing=t},tick:function(t){return this.facing&&this.facing!=this.sprite.facing&&this.sprite.setFacing(this.facing),!0}}},1162:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>n});const n={init:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.engine=this.sprite.engine,this.greeting=t,this.options=e,this.completed=!1},tick:function(t){if(this.loaded)return this.engine.setGreeting(this.text),!0}}},5544:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>p});var n=r(8348),i=r(4180);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(){a=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,o=Object.create(i.prototype),a=new k(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=h(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function p(){}function d(){}function y(){}var g={};u(g,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(S([])));v&&v!==e&&r.call(v,i)&&(g=v);var b=y.prototype=p.prototype=Object.create(g);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(i,a,s,c){var u=h(t[i],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==o(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,c)}))}c(u.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function _(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=h(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=y,u(b,"constructor",y),u(y,"constructor",d),d.displayName=u(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(x.prototype),u(x.prototype,s,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function s(t,e,r){return s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&c(i,r.prototype),i},s.apply(null,arguments)}function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}function u(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function h(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function f(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){h(o,n,i,a,s,"next",t)}function s(t){h(o,n,i,a,s,"throw",t)}a(void 0)}))}}const p={init:(y=f(a().mark((function t(e,r,o){var c=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.world=o,this.from=s(n.OW,u(e)),this.facing=r,this.offset=i.Nm.toOffset(r),this.lastKey=(new Date).getTime(),this.completed=!1,this.to=[e[0]+this.offset[0],e[1]+this.offset[1]],this.zone=o.zoneContaining.apply(o,u(this.to)),this.spriteList=this.zone.spriteList.filter((function(t){return t.pos.x===c.to[0]&&t.pos.y===c.to[1]})),this.objectList=this.zone.objectList.filter((function(t){return t.pos.x===c.to[0]&&t.pos.y===c.to[1]})),this.finish=this.finish.bind(this),this.interact();case 12:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return y.apply(this,arguments)}),interact:(d=f(a().mark((function t(){var e=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return 0===this.spriteList.length&&0===this.objectList.length&&(this.completed=!0),t.next=3,Promise.all(this.objectList.map(function(){var t=f(a().mark((function t(r){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=r.faceDir(i.Nm.reverse(e.facing)))&&r.addAction(n),!r.interact){t.next=8;break}return t.next=5,e.zone.objectDict[r.id].interact(e.sprite,e.finish);case 5:t.t0=t.sent,t.next=9;break;case 8:t.t0=null;case 9:return t.abrupt("return",t.t0);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:return t.next=5,Promise.all(this.spriteList.map(function(){var t=f(a().mark((function t(r){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=r.faceDir(i.Nm.reverse(e.facing)))&&r.addAction(n),!r.interact){t.next=8;break}return t.next=5,e.zone.spriteDict[r.id].interact(e.sprite,e.finish);case 5:t.t0=t.sent,t.next=9;break;case 8:t.t0=null;case 9:return t.abrupt("return",t.t0);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 5:case"end":return t.stop()}}),t,this)}))),function(){return d.apply(this,arguments)}),finish:function(t){t&&(this.completed=!0)},tick:function(t){if(this.loaded)return this.checkInput(t),this.completed},checkInput:function(t){if(t>this.lastKey+this.length){if("q"!==this.sprite.engine.keyboard.lastPressed("q"))return this.lastKey=(new Date).getTime(),null;this.completed=!0}this.sprite.engine.gamepad.keyPressed("a")&&(this.completed=!0)}};var d,y},2897:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>p});var n=r(8348),i=r(4180);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(){a=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,o=Object.create(i.prototype),a=new k(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=h(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function p(){}function d(){}function y(){}var g={};u(g,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(S([])));v&&v!==e&&r.call(v,i)&&(g=v);var b=y.prototype=p.prototype=Object.create(g);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(i,a,s,c){var u=h(t[i],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==o(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,c)}))}c(u.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function _(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=h(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=y,u(b,"constructor",y),u(y,"constructor",d),d.displayName=u(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(x.prototype),u(x.prototype,s,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function s(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function c(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){s(o,n,i,a,c,"next",t)}function c(t){s(o,n,i,a,c,"throw",t)}a(void 0)}))}}function u(t,e,r){return u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&l(i,r.prototype),i},u.apply(null,arguments)}function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}function h(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}const p={init:function(t,e,r,o){var a=this;this.zone=o,this.from=u(n.OW,h(t)),this.to=u(n.OW,h(e)),this.facing=i.Nm.fromOffset([Math.round(e.x-t.x),Math.round(e.y-t.y)]),this.length=r,this.spriteList=this.zone.spriteList.filter((function(t){return t.pos.x===a.to.x&&t.pos.y===a.to.y}))},tick:function(t){if(this.loaded){this.facing&&this.facing!=this.sprite.facing&&this.sprite.setFacing(this.facing);var e=this.startTime+this.length,r=(t-this.startTime)/this.length;t>=e?((0,n.t8)(this.to,this.sprite.pos),r=1,this.onStep()):(0,n.t7)(this.from,this.to,r,this.sprite.pos);var i=Math.floor(4*r);i!=this.sprite.animFrame&&this.sprite.setFrame(i);var o=this.sprite.pos.x+this.sprite.hotspotOffset.x,a=this.sprite.pos.y+this.sprite.hotspotOffset.y;return this.sprite.pos.z=this.sprite.zone.getHeight(o,a),t>=e}},onStep:(d=c(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return 0===this.spriteList.length&&(this.completed=!0),t.next=3,Promise.all(this.spriteList.map(function(){var t=c(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.onStep){t.next=6;break}return t.next=3,e.onStep(e,e);case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0=null;case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}}),t,this)}))),function(){return d.apply(this,arguments)})};var d},2704:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>d});var n=r(8348),i=r(4180),o=r(1937);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function s(){s=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,o=Object.create(i.prototype),a=new k(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=h(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function p(){}function d(){}function y(){}var g={};u(g,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(S([])));v&&v!==e&&r.call(v,i)&&(g=v);var b=y.prototype=p.prototype=Object.create(g);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(i,o,s,c){var u=h(t[i],t,o);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==a(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,c)}))}c(u.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function _(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=h(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=y,u(b,"constructor",y),u(y,"constructor",d),d.displayName=u(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(x.prototype),u(x.prototype,o,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function c(t,e,r){return c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&u(i,r.prototype),i},c.apply(null,arguments)}function u(t,e){return u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},u(t,e)}function l(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||h(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){if(t){if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(t,e):void 0}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function p(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}const d={init:(y=s().mark((function t(e,r,i,o){var a,u,f;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.zone=o,this.from=c(n.OW,l(e)),this.to=c(n.OW,l(r)),this.lastKey=(new Date).getTime(),this.completed=!1,this.direction=1,t.next=8,this.zone.engine.resourceManager.audioLoader.loadFromZip(this.sprite.zip,null!==(a=this.sprite.patrolSound)&&void 0!==a?a:"sewer-beat.mp3",!0);case 8:this.audio=t.sent,u=this.sprite.zone.world.pathFind(e,r),p=2,f=function(t){if(Array.isArray(t))return t}(s=u)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o=[],a=!0,s=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}}(s,p)||h(s,p)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),this.hasMoves=f[0],this.moveList=f[1],this.hasMoves||(this.completed=!0),this.moveIndex=1,this.moveLength=i,this.zone.audio&&this.zone.audio.pauseAudio(),this.audio&&this.audio.playAudio();case 18:case"end":return t.stop()}var s,p}),t,this)})),g=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=y.apply(t,e);function o(t){p(i,r,n,o,a,"next",t)}function a(t){p(i,r,n,o,a,"throw",t)}o(void 0)}))},function(t,e,r,n){return g.apply(this,arguments)}),tick:function(t){if(this.loaded){if(this.checkInput(t),t>this.startTime+this.moveLength){var e=this.moveList[this.moveIndex];if(this.moveList.length>2){var r=0==this.moveIndex?this.moveList[this.moveIndex+1]:this.moveIndex+1>=this.moveList.length?this.moveList[this.moveList.length-1]:this.moveList[this.moveIndex-1],n=i.Nm.fromOffset([Math.round(e[0]-r[0]),Math.round(e[1]-r[1])]);if(this.sprite.zone.isInZone(e[0],e[1]))this.currentAction=new o.aW(this.sprite.engine,"move",[r,e,this.moveLength,this.zone],this.sprite);else{var a=this.sprite.zone.world.zoneContaining(e[0],e[1]);a&&a.loaded&&a.isWalkable(e[0],e[1],i.Nm.reverse(n))?this.currentAction=new o.aW(this.sprite.engine,"changezone",[this.sprite.zone.id,this.sprite.pos.toArray(),a.id,e,this.moveLength],this.sprite):this.currentAction=this.sprite.faceDir(n)}this.sprite.facing!==n&&(this.currentAction=this.sprite.faceDir(n)),this.currentAction&&(this.currentAction.facing=n,this.sprite.addAction(Promise.resolve(this.currentAction)).then((function(){})))}this.moveIndex+this.direction>=this.moveList.length&&(this.direction*=-1,this.completed=!0,this.zone.audio&&this.zone.audio.playAudio(),this.audio&&this.audio.pauseAudio()),this.moveIndex+=this.direction,this.startTime=t}return this.completed}},checkInput:function(t){if(t>this.lastKey+this.moveLength)return"q"===this.sprite.engine.keyboard.lastPressed("q")&&(this.zone.audio&&this.zone.audio.playAudio(),this.audio&&this.audio.pauseAudio(),this.completed=!0),this.lastKey=(new Date).getTime(),null}};var y,g},3382:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>n});const n={init:function(t,e){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.engine=this.sprite.engine,this.text="",this.scrolling=r,this.line=0,this.options=n,this.completed=!1,this.lastKey=(new Date).getTime(),this.listenerId=this.engine.gamepad.attachListener(this.hookListener()),this.touches=[],this.menuDict=null!=t?t:{},this.activeMenus=null!=e?e:[],this.selectedMenu={},this.selectedMenuId=null,this.isTouched=!1},tick:function(t){var e,r=this;if(this.loaded)return this.options&&this.options.autoclose&&(this.endTime=this.endTime?this.endTime:null!==(e=this.options.endTime)&&void 0!==e?e:(new Date).getTime()+1e4,t>this.endTime&&(this.completed=!0)),this.checkInput(t),Object.keys(this.menuDict).filter((function(t){return r.activeMenus.includes(t)})).map((function(t){var e=r.menuDict[t],n=e.colours;e.active&&(n.background="#555"),r.engine.hud.drawButton(e.text,e.x,e.y,e.w,e.h,e.colours)})),this.textbox=this.engine.hud.scrollText(this.prompt+this.text,this.scrolling,this.options),this.completed&&this.unhookListener(),this.completed},unhookListener:function(){this.engine.gamepad.removeListener(this.listenerId),this.listenerId=null},hookListener:function(){var t=this,e=function(e){var r=e.touches;if(t.isTouched=!0,t.touches=r,t.isTouched&&t.touches.length>0&&t.lastKey+100<(new Date).getTime()){var n=t.touches[0].x,i=t.touches[0].y,o=t;o.activeMenus.filter((function(t){var e=o.menuDict[t];return n<e.x+e.w&&n>e.x&&i<e.y+e.h&&i>e.y})).map((function(e){var r=o.menuDict[e];r.trigger&&r.trigger(t),r.children&&(o.activeMenus=r.children)}))}},r=function(e){t.touches=e},n=function(e){t.isTouched=!1,t.touches=e};return{touchstart:e,touchmove:r,touchend:n,mousedown:e,mousemove:r,mouseup:n}},checkInput:function(t){if(t>this.lastKey+100){var e=!1;switch(this.engine.keyboard.lastPressedCode()){case"Escape":this.completed=!0,e=!0;break;case"Backspace":var r=this.text.split("");r.pop(),this.text=r.join(""),this.lastKey=t,e=!0;break;case"Enter":this.engine.setGreeting(this.text),this.sprite.speech.clearHud&&this.sprite.speech.clearHud(),this.speechbox=this.sprite.speech.scrollText(this.text),this.sprite.speech.loadImage(),this.completed=!0,e=!0}if(!e){var n=this.engine.keyboard.lastPressedKey();n&&(this.lastKey=t,this.text+=""+n)}}}}},5744:(t,e,r)=>{"use strict";function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(){i=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,o=Object.create(i.prototype),a=new k(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=h(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function p(){}function d(){}function y(){}var g={};u(g,a,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(S([])));v&&v!==e&&r.call(v,a)&&(g=v);var b=y.prototype=p.prototype=Object.create(g);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function i(o,a,s,c){var u=h(t[o],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==n(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){i("next",t,s,c)}),(function(t){i("throw",t,s,c)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return i("throw",t,s,c)}))}c(u.arg)}var o;this._invoke=function(t,r){function n(){return new e((function(e,n){i(t,r,e,n)}))}return o=o?o.then(n,n):n()}}function _(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=h(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=y,u(b,"constructor",y),u(y,"constructor",d),d.displayName=u(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(x.prototype),u(x.prototype,s,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),u(b,c,"Generator"),u(b,a,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function o(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}r.r(e),r.d(e,{default:()=>a});const a={init:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.zone=e,this.world=e.world,this.lastKey=(new Date).getTime(),this.completed=!1,this.onCompleted=function(){return console.log("script finished")},r&&(this.onCompleted=r),this.triggerId=t,this.triggerScript()},triggerScript:function(){var t=this;this.triggerId||(this.completed=!0),Promise.all(this.zone.scripts.filter((function(e){return e.id===t.triggerId})).map(function(){var e,r=(e=i().mark((function e(r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.trigger.call(t.zone);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(t){o(a,n,i,s,c,"next",t)}function c(t){o(a,n,i,s,c,"throw",t)}s(void 0)}))});return function(t){return r.apply(this,arguments)}}())).then((function(){t.completed=!0}))},tick:function(t){if(this.loaded)return this.completed&&this.onCompleted(),this.completed}}},7720:(t,e,r)=>{"use strict";function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}r.d(e,{Z:()=>i});var i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.actions=[]}var e,r;return e=t,r=[{key:"add",value:function(t){this.actions.push(t)}},{key:"run",value:function(){var t=arguments;this.actions=this.actions.filter((function(e){return e(t)}))}}],r&&n(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}()},5875:(t,e,r)=>{"use strict";function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}r.d(e,{Z:()=>i});var i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,(r=[{key:"runWhenLoaded",value:function(t){this.loaded?t():this.onLoadActions.add(t)}},{key:"update",value:function(t){Object.assign(this,t)}}])&&n(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}()},9469:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>o});var n=r(8348),i=r(4180);const o={init:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.engine=this.world.engine,this.cameraAction=t,this.options=e,this.completed=!1,this.startTime=(new Date).getTime()},tick:function(t){if(this.loaded){if("pan"===this.cameraAction){var e=(t-this.startTime)/(1e3*this.options.duration),r=this.options.from,o=this.options.to;o.z=Math.round(o.z),(0,n.t7)(r,o,e,this.engine.renderManager.camera.cameraVector),this.engine.renderManager.camera.cameraDir=i.Nm.adjustCameraDirection(o)}var a;return this.options&&this.options.duration&&(this.endTime=this.endTime?this.endTime:null!==(a=this.options.endTime)&&void 0!==a?a:(new Date).getTime()+1e3*this.options.duration,t>this.endTime&&(this.completed=!0)),this.completed}}}},5830:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>n});const n={init:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.engine=this.world.engine,this.text="",this.prompt=t,this.scrolling=e,this.line=0,this.options=r,this.completed=!1,this.lastKey=(new Date).getTime()},tick:function(t){var e;if(this.loaded)return this.options&&this.options.autoclose&&(this.endTime=this.endTime?this.endTime:null!==(e=this.options.endTime)&&void 0!==e?e:(new Date).getTime()+1e4,t>this.endTime&&(this.completed=!0)),this.checkInput(t),this.textbox=this.engine.hud.scrollText(this.prompt+this.text,this.scrolling,this.options),this.completed},checkInput:function(t){if(t>this.lastKey+100){var e=!1;switch(this.engine.keyboard.lastPressedCode()){case"Escape":this.completed=!0,e=!0;break;case"Backspace":var r=this.text.split("");r.pop(),this.text=r.join(""),this.lastKey=t,e=!0;break;case"Enter":this.engine.hud.scrollText(this.text),this.completed=!0,e=!0}if(!e){var n=this.engine.keyboard.lastPressedKey();n&&(this.lastKey=t,this.text+=""+n)}}}}},4726:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>n});const n={init:function(t,e){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{autoclose:!1,closeOnEnter:!1};this.engine=this.world.engine,this.text="",this.prompt="",this.scrolling=r,this.line=0,this.options=n,this.completed=!1,this.onOpen=t.start.onOpen,this.lastKey=(new Date).getTime(),this.touches=[],this.menuDict=null!=t?t:{},this.activeMenus=null!=e?e:[],this.selectedMenu={},this.selectedMenuId=null,this.isTouched=!1,this.speechOutput=!1,this.quittable=!0,this.listenerId=this.engine.gamepad.attachListener(this.hookListener()),this.speechOutput=!0,window.speechSynthesis.onvoiceschanged=function(){}},tick:function(t){var e,r=this;if(this.loaded)return this.options&&this.options.autoclose&&(this.endTime=this.endTime?this.endTime:null!==(e=this.options.endTime)&&void 0!==e?e:(new Date).getTime()+1e4,t>this.endTime&&(this.completed=!0)),this.checkInput(t),Object.keys(this.menuDict).filter((function(t){return r.activeMenus.includes(t)})).map((function(t){var e=r.menuDict[t],n=e.colours;e.active&&(n.background="#555"),r.engine.hud.drawButton(e.text,e.x,e.y,e.w,e.h,e.colours),e.prompt&&(r.speechOutput&&r.engine.speechSynthesis(e.prompt),r.textbox=r.engine.hud.scrollText(e.prompt,r.scrolling,r.options))})),this.speechOutput=!1,this.completed&&(this.unhookListener(),window.speechSynthesis.cancel()),this.completed},unhookListener:function(){this.engine.gamepad.removeListener(this.listenerId),this.listenerId=null},hookListener:function(){var t=this;this.onOpen&&this.onOpen(this);var e=function(e){var r=e.touches;if(t.isTouched=!0,t.touches=r,t.isTouched&&t.touches.length>0&&t.lastKey+100<(new Date).getTime()){var n=t.touches[0].x,i=t.touches[0].y,o=t;o.activeMenus.filter((function(t){var e=o.menuDict[t];return n<e.x+e.w&&n>e.x&&i<e.y+e.h&&i>e.y})).map((function(e){var r=o.menuDict[e];r.trigger&&r.trigger(t),r.children&&(o.activeMenus=r.children)}))}},r=function(e){t.touches=e},n=function(e){t.isTouched=!1,t.touches=e};return{touchstart:e,touchmove:r,touchend:n,mousedown:e,mousemove:r,mouseup:n}},checkInput:function(t){var e=this;if(t>this.lastKey+100)switch(this.engine.keyboard.lastPressedCode()){case"Escape":this.quittable&&(this.completed=!0);break;case"Enter":Object.keys(this.menuDict).filter((function(t){return e.activeMenus.includes(t)})).map((function(t){var r=e.menuDict[t];r.onEnter&&r.trigger(e)})),(this.quittable||this.options.closeOnEnter)&&(this.completed=!0)}}}},4180:(t,e,r)=>{"use strict";r.d(e,{Ee:()=>u,Nm:()=>s});var n=r(8348);function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(t){return t*Math.PI/180}var s={None:0,Right:1,Up:2,Left:4,Down:8,All:15,fromOffset:function(t){return t[0]>0?s.Right:t[0]<0?s.Left:t[1]>0?s.Down:t[1]<0?s.Up:0},toOffset:function(t){switch(t){case s.Right:return[1,0];case s.Up:return[0,-1];case s.Left:return[-1,0];case s.Down:return[0,1]}return[0,0]},reverse:function(t){switch(t){case s.Right:return s.Left;case s.Up:return s.Down;case s.Left:return s.Right;case s.Down:return s.Up}return s.None},rotate:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(t){case s.Right:return e?s.Top:s.Down;case s.Up:return e?s.Left:s.Right;case s.Left:return e?s.Down:s.Top;case s.Down:return e?s.Right:s.Left}return s.None},adjustCameraDirection:function(t){switch(t.z%8){case 0:return"N";case 1:case-7:return"NW";case 2:case-6:return"W";case 3:case-5:return"SW";case 4:case-4:return"S";case 5:case-3:return"SE";case 6:case-2:return"E";case 7:case-1:return"NE"}},spriteSequence:function(t){switch(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"N"){case"N":switch(t){case s.Up:return"N";case s.Right:return"E";case s.Down:return"S";case s.Left:return"W"}case"E":switch(t){case s.Up:return"W";case s.Right:return"N";case s.Down:return"E";case s.Left:return"S"}case"S":switch(t){case s.Up:return"S";case s.Right:return"W";case s.Down:return"N";case s.Left:return"E"}case"W":switch(t){case s.Up:return"E";case s.Right:return"S";case s.Down:return"W";case s.Left:return"N"}case"NE":switch(t){case s.Up:return"NW";case s.Right:return"SE";case s.Down:return"NE";case s.Left:return"SW"}case"SE":switch(t){case s.Up:return"SW";case s.Right:return"NW";case s.Down:return"SE";case s.Left:return"NE"}case"SW":switch(t){case s.Up:return"NE";case s.Right:return"SW";case s.Down:return"NW";case s.Left:return"SE"}case"NW":switch(t){case s.Up:return"SE";case s.Right:return"NE";case s.Down:return"SW";case s.Left:return"NW"}}return"S"},drawOffset:function(t){switch(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"N"){case"NE":return t.cross(new n.OW(Math.sin(a(315)),2*Math.cos(a(315)),0));case"NW":return t.cross(new n.OW(-2*Math.sin(a(315)),-Math.cos(a(315)),0));case"SE":return t.cross(new n.OW(Math.sin(a(225)),Math.cos(a(225)),0));case"SW":return t.cross(new n.OW(Math.sin(a(135)),Math.cos(a(135)),0));case"E":return t.cross(new n.OW(Math.sin(a(270)),Math.cos(a(270)),0));case"W":return t.cross(new n.OW(Math.sin(a(90)),Math.cos(a(90)),0));case"S":return t.cross(new n.OW(Math.sin(a(180)),Math.cos(a(180)),0));case"N":return t.cross(new n.OW(Math.sin(a(0)),Math.cos(a(0)),0));default:return t}},objectSequence:function(t){switch(t){case s.Right:return[0,90,0];case s.Up:return[0,0,0];case s.Left:return[0,-90,0];case s.Down:return[0,180,0]}return[0,0,0]}},c=function(t){return t&&"object"===o(t)&&!Array.isArray(t)},u=function t(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];if(!n.length)return e;var a=n.shift();if(c(e)&&c(a))for(var s in a){var u;c(a[s])?(e[s]||Object.assign(e,i({},s,{})),t(e[s],a[s])):Object.assign(e,i({},s,a[s]&&Array.isArray(a[s])?[].concat(null!==(u=e[s])&&void 0!==u?u:[],a[s]):a[s]))}return t.apply(void 0,[e].concat(n))}},2846:(t,e,r)=>{"use strict";r.d(e,{m:()=>f});const n=new class{loopOnThresolds(t,e,r){let n=.95;"function"!=typeof e&&"boolean"!=typeof e||(r=e||r,e=.3),void 0===e&&(e=.3),"function"!=typeof r&&(r=this.noop);const i=e,o={};do{let e=!1;if(n-=.05,t(o,n,(t=>{e=t})),e)break}while(n>i);return r(o)}generateObjectModel(t,e){return this.loopOnThresolds(((e,r)=>{e[r.toString()]=JSON.parse(JSON.stringify(t))}),(t=>e?e(JSON.parse(JSON.stringify(t))):t))}noop(){}},i=new class{getLowPassSource(t,e){const{numberOfChannels:r,length:n,sampleRate:i}=t,o=new e(r,n,i),a=o.createBufferSource();a.buffer=t;const s=o.createBiquadFilter();return s.type="lowpass",a.connect(s),s.connect(o.destination),a}findPeaksAtThresold(t,e,r){let n=[];const{length:i}=t;for(let o=r;o<i;o+=1)t[o]>e&&(n.push(o),o+=1e4);return 0===n.length&&(n=void 0),{peaks:n,thresold:e}}computeBPM(t,e,r){let i=!1;n.loopOnThresolds(((n,o,a)=>i?a(!0):t[o].length>15?(i=!0,r(null,[this.identifyIntervals,this.groupByTempo(e),this.getTopCandidates].reduce(((t,e)=>e(t)),t[o]),o)):void 0),(()=>(i||r(new Error("Could not find enough samples for a reliable detection.")),!1)))}getTopCandidates(t){return t.sort(((t,e)=>e.count-t.count)).splice(0,5)}identifyIntervals(t){const e=[];for(const[r,n]of t.entries())for(let i=0;i<10;i+=1){const o=t[r+i]-n;e.some((t=>t.interval===o&&(t.count+=1,t.count)))||e.push({interval:o,count:1})}return e}groupByTempo(t){return e=>{const r=[];for(const n of e)if(0!==n.interval){n.interval=Math.abs(n.interval);let e=60/(n.interval/t);for(;e<90;)e*=2;for(;e>180;)e/=2;e=Math.round(e),r.some((t=>t.tempo===e&&(t.count+=n.count,t.count)))||r.push({tempo:e,count:n.count})}return r}}};class o{constructor(t={}){this.options={debug:!1,scriptNode:{bufferSize:4096},continuousAnalysis:!1,stabilizedBpmCount:2e3,computeBPMDelay:1e4,stabilizationTime:2e4,pushTime:2e3,pushCallback:(t,e)=>{if(t)throw new Error(t)},onBpmStabilized:t=>{this.clearValidPeaks(t)},OfflineAudioContext:"object"==typeof window&&(window.OfflineAudioContext||window.webkitOfflineAudioContext)},this.logger=(...t)=>{this.options.debug&&console.log(...t)},Object.assign(this.options,t),this.minValidThresold=.3,this.cumulatedPushTime=0,this.timeoutPushTime=null,this.timeoutStabilization=null,this.validPeaks=n.generateObjectModel([]),this.nextIndexPeaks=n.generateObjectModel(0),this.chunkCoeff=1}reset(){this.minValidThresold=.3,this.cumulatedPushTime=0,this.timeoutPushTime=null,this.timeoutStabilization=null,this.validPeaks=n.generateObjectModel([]),this.nextIndexPeaks=n.generateObjectModel(0),this.chunkCoeff=1}clearValidPeaks(t){this.logger(`[clearValidPeaks] function: under ${t}`),this.minValidThresold=t.toFixed(2),n.loopOnThresolds(((e,r)=>{r<t&&(delete this.validPeaks[r],delete this.nextIndexPeaks[r])}))}analyze(t){const e=this.options.scriptNode.bufferSize*this.chunkCoeff,r=e-this.options.scriptNode.bufferSize,o=i.getLowPassSource(t.inputBuffer,this.options.OfflineAudioContext);o.start(0),n.loopOnThresolds(((t,n)=>{if(this.nextIndexPeaks[n]>=e)return;const a=this.nextIndexPeaks[n]%this.options.scriptNode.bufferSize,{peaks:s,thresold:c}=i.findPeaksAtThresold(o.buffer.getChannelData(0),n,a);if(void 0!==s)for(const t of Object.keys(s)){const e=s[t];void 0!==e&&(this.nextIndexPeaks[c]=r+e+1e4,this.validPeaks[c].push(r+e))}}),this.minValidThresold,(()=>{this.chunkCoeff++,null===this.timeoutPushTime&&(this.timeoutPushTime=setTimeout((()=>{this.cumulatedPushTime+=this.options.pushTime,this.timeoutPushTime=null,i.computeBPM(this.validPeaks,t.inputBuffer.sampleRate,((t,e,r)=>{this.options.pushCallback(t,e,r),!t&&e&&e[0].count>=this.options.stabilizedBpmCount&&(this.logger("[freezePushBack]"),this.timeoutPushTime="never",this.minValidThresold=1),this.cumulatedPushTime>=this.options.computeBPMDelay&&this.minValidThresold<r&&(this.logger("[onBpmStabilized] function: Fired !"),this.options.onBpmStabilized(r),this.options.continuousAnalysis&&(clearTimeout(this.timeoutStabilization),this.timeoutStabilization=setTimeout((()=>{this.logger("[timeoutStabilization] setTimeout: Fired !"),this.options.computeBPMDelay=0,this.reset()}),this.options.stabilizationTime)))}))}),this.options.pushTime))}))}}function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function s(){s=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,o=Object.create(i.prototype),a=new k(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=h(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function p(){}function d(){}function y(){}var g={};u(g,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(S([])));v&&v!==e&&r.call(v,i)&&(g=v);var b=y.prototype=p.prototype=Object.create(g);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(i,o,s,c){var u=h(t[i],t,o);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==a(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,c)}))}c(u.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function _(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=h(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=y,u(b,"constructor",y),u(y,"constructor",d),d.displayName=u(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(x.prototype),u(x.prototype,o,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function c(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,r){return e&&l(t.prototype,e),r&&l(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}"undefined"!=typeof window&&(window.RealTimeBPMAnalyzer=o);var f=function(){function t(e){u(this,t),this.engine=e,this.definitions=[],this.instances={}}var e,r;return h(t,[{key:"load",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.instances[t])return this.instances[t];var r=new p(t,e);this.instances[t]=r;var n=this;return e&&Object.keys(n.instances).filter((function(e){return t!==e})).forEach((function(t){n.instances[t]&&n.instances[t].pauseAudio()})),r.loaded=!0,r}},{key:"loadFromZip",value:(e=s().mark((function t(e,r){var n,i,o,a,c,u=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=u.length>2&&void 0!==u[2]&&u[2],!this.instances[r]){t.next=3;break}return t.abrupt("return",this.instances[r]);case 3:return console.log({msg:"let the beat roll in!"}),t.next=6,e.file("audio/".concat(r)).async("arrayBuffer").then((function(t){var e=new Uint8Array(t);return new Blob([e.buffer])}));case 6:return i=t.sent,o=URL.createObjectURL(i),console.log({msg:"loading audio track...",url:o}),a=new p(o,n),this.instances[r]=a,c=this,n&&Object.keys(c.instances).filter((function(t){return r!==t})).forEach((function(t){c.instances[t]&&c.instances[t].pauseAudio()})),a.loaded=!0,t.abrupt("return",a);case 15:case"end":return t.stop()}}),t,this)})),r=function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(t){c(o,n,i,a,s,"next",t)}function s(t){c(o,n,i,a,s,"throw",t)}a(void 0)}))},function(t,e){return r.apply(this,arguments)})}]),t}(),p=function(){function t(e){var r=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u(this,t),this.src=e,this.playing=!1,this.audio=new Audio(e),this.audioContext=new AudioContext,this.bpm=0,this.analyser=this.audioContext.createAnalyser(),this.audioSource=this.audioContext.createMediaElementSource(this.audio),this.audioSource.connect(this.analyser),this.audioNode=this.audioContext.createScriptProcessor(4096,1,1),this.audioNode.connect(this.audioContext.destination),this.audioSource.connect(this.audioNode),this.audioSource.connect(this.audioContext.destination);var i=new o({scriptNode:{bufferSize:4096},pushTime:2e3,pushCallback:function(t,e){r.bpm=e}});this.audioNode.onaudioprocess=function(t){i.analyze(t)},n&&this.audio.addEventListener("ended",(function(){this.currentTime=0,this.play()}),!1),this.audio.load()}return h(t,[{key:"isPlaying",value:function(){return this.playing}},{key:"playAudio",value:function(){var t=this.audio.play();this.playing=!0,void 0!==t&&t.then((function(t){})).catch((function(t){console.info(t)}))}},{key:"pauseAudio",value:function(){var t=this.audio.pause();this.playing=!1,void 0!==t&&t.then((function(t){})).catch((function(t){console.info(t)}))}}]),t}()},1937:(t,e,r)=>{"use strict";r.d(e,{aW:()=>cn,q1:()=>yn,Gq:()=>Xr,jf:()=>Mr,e5:()=>w});var n={};r.r(n),r.d(n,{LuaError:()=>lt,Table:()=>ht,createEnv:()=>qe,utils:()=>Lt});var i=r(7720),o=r(5875);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function s(){s=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",c=n.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,o=Object.create(i.prototype),a=new k(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=h(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function p(){}function d(){}function y(){}var g={};u(g,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(S([])));v&&v!==e&&r.call(v,i)&&(g=v);var b=y.prototype=p.prototype=Object.create(g);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(i,o,s,c){var u=h(t[i],t,o);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==a(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,c)}))}c(u.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function _(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=h(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=y,u(b,"constructor",y),u(y,"constructor",d),d.displayName=u(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(x.prototype),u(x.prototype,o,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function c(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},f(t)}var p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}(g,t);var e,r,n,o,p,d,y=(p=g,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=f(p);if(d){var r=f(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}(this,t)});function g(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,g),(e=y.call(this)).engine=t,e.src=null,e.sheetSize=[0,0],e.tileSize=0,e.tiles={},e.loaded=!1,e.onLoadActions=new i.Z,e.onDefinitionLoadActions=new i.Z,e.onTextureLoaded=e.onTextureLoaded.bind(h(e)),e}return e=g,r=[{key:"onJsonLoaded",value:function(t){var e=this;Object.keys(t).map((function(r){e[r]=t[r]})),this.definitionLoaded=!0,this.onDefinitionLoadActions.run(),this.texture=this.engine.resourceManager.loadTexture(this.src),this.texture.runWhenLoaded(this.onTextureLoaded),this.bgColor&&this.engine.gl.clearColor(this.bgColor[0]/255,this.bgColor[1]/255,this.bgColor[2]/255,1)}},{key:"onJsonLoadedFromZip",value:(n=s().mark((function t(e,r){var n=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Object.keys(e).map((function(t){n[t]=e[t]})),this.definitionLoaded=!0,this.onDefinitionLoadActions.run(),t.next=5,this.engine.resourceManager.loadTextureFromZip(this.src,r);case 5:this.texture=t.sent,this.texture.runWhenLoaded(this.onTextureLoaded),this.bgColor&&this.engine.gl.clearColor(this.bgColor[0]/255,this.bgColor[1]/255,this.bgColor[2]/255,1);case 8:case"end":return t.stop()}}),t,this)})),o=function(){var t=this,e=arguments;return new Promise((function(r,i){var o=n.apply(t,e);function a(t){c(o,r,i,a,s,"next",t)}function s(t){c(o,r,i,a,s,"throw",t)}a(void 0)}))},function(t,e){return o.apply(this,arguments)})},{key:"onTextureLoaded",value:function(){this.loaded=!0,this.onLoadActions.run()}},{key:"runWhenDefinitionLoaded",value:function(t){this.definitionLoaded?t():this.onDefinitionLoadActions.add(t)}},{key:"getTileVertices",value:function(t,e){return this.geometry[t].vertices.map((function(t){return t.map((function(t){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]}))})).flat(3)}},{key:"getTileTexCoords",value:function(t,e){var r=this.textures[e],n=[this.tileSize/this.sheetSize[0],this.tileSize/this.sheetSize[1]];return this.geometry[t].surfaces.map((function(t){return t.map((function(t){return[(t[0]+r[0])*n[0],(t[1]+r[1])*n[1]]}))})).flat(3)}},{key:"getWalkability",value:function(t){return this.geometry[t].type}},{key:"getTileWalkPoly",value:function(t){return this.geometry[t].walkPoly}}],r&&u(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),g}(o.Z),d=r(4180);function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function g(){g=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new k(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(S([])));v&&v!==e&&r.call(v,i)&&(d=v);var b=p.prototype=h.prototype=Object.create(d);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==y(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function _(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=p,s(b,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(x.prototype),s(x.prototype,o,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new x(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),s(b,a,"Generator"),s(b,i,(function(){return this})),s(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function m(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function v(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){m(o,n,i,a,s,"next",t)}function s(t){m(o,n,i,a,s,"throw",t)}a(void 0)}))}}function b(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var w=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.engine=e,this.tilesets={}}var e,r,n,i;return e=t,r=[{key:"loadFromZip",value:(i=v(g().mark((function t(e,r,n){var i,o,a,s,c,u;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("loading tileset from zip: "+r+" for "+n),!(i=this.tilesets[r])){t.next=4;break}return t.abrupt("return",i);case 4:return o=new p(this.engine),this.tilesets[r]=o,o.name=r,t.t0=JSON,t.next=10,e.file("tilesets/".concat(r,"/tileset.json")).async("string");case 10:return t.t1=t.sent,a=t.t0.parse.call(t.t0,t.t1),t.t2=JSON,t.next=15,e.file("tilesets/".concat(r,"/geometry.json")).async("string");case 15:return t.t3=t.sent,s=t.t2.parse.call(t.t2,t.t3),t.t4=JSON,t.next=20,e.file("tilesets/".concat(r,"/tiles.json")).async("string");case 20:return t.t5=t.sent,c=t.t4.parse.call(t.t4,t.t5),t.next=24,this.loadTilesetData(a,c,s,e);case 24:return u=t.sent,t.next=27,o.onJsonLoadedFromZip(u,e);case 27:return t.abrupt("return",o);case 28:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return i.apply(this,arguments)})},{key:"loadTilesetData",value:(n=v(g().mark((function t(e,r,n,i){var o;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.extends){t.next=4;break}return t.next=3,Promise.all(e.extends.map(function(){var t=v(g().mark((function t(r){var n;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=JSON,t.next=3,i.file("tilesets/"+r+"/tileset.json").async("string");case 3:t.t1=t.sent,n=t.t0.parse.call(t.t0,t.t1),e=(0,d.Ee)(e,n);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:e.extends=null;case 4:if(console.log({tilesetJson:e}),!r.extends){t.next=9;break}return t.next=8,Promise.all(r.extends.map(function(){var t=v(g().mark((function t(e){var n;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=JSON,t.next=3,i.file("tilesets/"+e+"/tiles.json").async("string");case 3:t.t1=t.sent,n=t.t0.parse.call(t.t0,t.t1),r=(0,d.Ee)(r,n);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 8:r.extends=null;case 9:if(console.log({Tiles:r}),!n.extends){t.next=14;break}return t.next=13,Promise.all(n.extends.map(function(){var t=v(g().mark((function t(e){var r;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=JSON,t.next=3,i.file("tilesets/"+e+"/geometry.json").async("string");case 3:t.t1=t.sent,r=t.t0.parse.call(t.t0,t.t1),n=(0,d.Ee)(n,r);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 13:n.extends=null;case 14:return console.log({TilesetGeometry:n}),o={},Object.keys(e.geometry).forEach((function(t){o[t]=n[e.geometry[t]]})),t.abrupt("return",{name:e.name,src:e.src,sheetSize:e.sheetSize,sheetOffsetX:e.sheetOffsetX,sheetOffsetY:e.sheetOffsetY,tileSize:e.tileSize,bgColor:e.bgColor,textures:e.textures,geometry:o,tiles:r});case 18:case"end":return t.stop()}}),t)}))),function(t,e,r,i){return n.apply(this,arguments)})}],r&&b(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),x=r(8348),_=r(9175);function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function A(t,e,r){return A=P()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&O(i,r.prototype),i},A.apply(null,arguments)}function k(){k=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new A(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(S([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==E(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function S(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function T(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){S(o,n,i,a,s,"next",t)}function s(t){S(o,n,i,a,s,"throw",t)}a(void 0)}))}}function L(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function O(t,e){return O=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},O(t,e)}function C(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function P(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function M(t){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},M(t)}var I=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&O(t,e)}(h,t);var e,r,n,o,a,s,c,u,l=(c=h,u=P(),function(){var t,e=M(c);if(u){var r=M(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===E(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return C(t)}(this,t)});function h(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),(e=l.call(this)).engine=t,e.templateLoaded=!1,e.drawOffset=new x.OW(0,0,0),e.hotspotOffset=new x.OW(0,0,0),e.animFrame=0,e.fixed=!1,e.pos=new x.OW(0,0,0),e.scale=new x.OW(1,1,1),e.facing=d.Nm.Right,e.actionDict={},e.actionList=[],e.gender=null,e.speech={},e.portrait=null,e.onLoadActions=new i.Z,e.getTexCoords=e.getTexCoords.bind(C(e)),e.inventory=[],e.onTilesetOrTextureLoaded=e.onTilesetOrTextureLoaded.bind(C(e)),e.blocking=!0,e.override=!1,e.isLit=!0,e.lightIndex=null,e.lightColor=[.1,1,.1],e.density=1,e.voice=new SpeechSynthesisUtterance,e}return e=h,r=[{key:"onLoad",value:function(t){var e=this;if(!this.loaded)if(this.src&&this.sheetSize&&this.tileSize&&this.frames){if(console.log({msg:"sprite load",instanceData:t}),this.zone=t.zone,t.id&&(this.id=t.id),t.id&&(this.id=t.id),t.pos&&(this.pos=t.pos),t.isLit&&(this.isLit=t.isLit),t.attenuation&&(this.attenuation=t.attenuation),t.direction&&(this.direction=t.direction),t.lightColor&&(this.lightColor=t.lightColor),t.density&&(this.density=t.density),t.scatteringCoefficients&&(this.scatteringCoefficients=t.scatteringCoefficients),t.rotation&&(this.rotation=t.rotation),t.facing&&0!==t.facing&&(this.facing=t.facing),t.zones&&null!==t.zones&&(this.zones=t.zones),t.onStep&&"function"==typeof t.onStep){var r=this.onStep.bind(this);this.onStep=T(k().mark((function n(){return k().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.onStep(e,e);case 2:return console.log("made it to here"),n.next=5,r(e,e);case 5:case"end":return n.stop()}}),n)})))}var n;this.texture=this.engine.resourceManager.loadTexture(this.src),this.texture.runWhenLoaded(this.onTilesetOrTextureLoaded.bind(this)),this.vertexTexBuf=this.engine.renderManager.createBuffer(this.getTexCoords(),this.engine.gl.DYNAMIC_DRAW,2),this.enableSpeech&&(this.speech=this.engine.resourceManager.loadSpeech(this.id,this.engine.mipmap),this.speech.runWhenLoaded(this.onTilesetOrTextureLoaded.bind(this)),this.speechTexBuf=this.engine.renderManager.createBuffer(this.getSpeechBubbleTexture(),this.engine.gl.DYNAMIC_DRAW,2)),this.portraitSrc&&(this.portrait=this.engine.resourceManager.loadTexture(this.portraitSrc),this.portrait.runWhenLoaded(this.onTilesetOrTextureLoaded.bind(this))),this.isLit&&(console.log({msg:"Adding Light Loaded",id:this.id,pos:this.pos.toArray()}),this.lightIndex=this.engine.renderManager.lightManager.addLight(this.id,this.pos.toArray(),this.lightColor,null!==(n=this.attenuation)&&void 0!==n?n:[.01,.01,.01],this.direction,this.density,this.scatteringCoefficients,!0)),this.zone.tileset.runWhenDefinitionLoaded(this.onTilesetDefinitionLoaded.bind(this))}else console.error("Invalid sprite definition")}},{key:"onLoadFromZip",value:(s=T(k().mark((function t(e,r){var n,i,o=this;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.loaded){t.next=2;break}return t.abrupt("return");case 2:if(this.src&&this.sheetSize&&this.tileSize&&this.frames){t.next=5;break}return console.error("Invalid sprite definition"),t.abrupt("return");case 5:return console.log({msg:"sprite load from zip",instanceData:e}),this.update(e),this.zone=e.zone,e.id&&(this.id=e.id),e.isLit&&(this.isLit=e.isLit),e.lightColor&&(this.lightColor=e.lightColor),e.density&&(this.density=e.density),e.attenuation&&(this.attenuation=e.attenuation),e.direction&&(this.direction=e.direction),e.scatteringCoefficients&&(this.scatteringCoefficients=e.scatteringCoefficients),e.fixed&&(this.fixed=e.fixed),e.pos&&(this.pos=e.pos),e.facing&&0!==e.facing&&(this.facing=e.facing),e.zones&&null!==e.zones&&(this.zones=e.zones),e.onStep&&"function"==typeof e.onStep&&(n=this.onStep.bind(this),this.onStep=T(k().mark((function t(){return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.onStep(o,o);case 2:return t.next=4,n(o,o);case 4:case"end":return t.stop()}}),t)})))),t.next=22,this.engine.resourceManager.loadTextureFromZip(this.src,r);case 22:if(this.texture=t.sent,this.texture.runWhenLoaded(this.onTilesetOrTextureLoaded.bind(this)),this.vertexTexBuf=this.engine.renderManager.createBuffer(this.getTexCoords(),this.engine.gl.DYNAMIC_DRAW,2),this.enableSpeech&&(this.speech=this.engine.resourceManager.loadSpeech(this.id,this.engine.mipmap),this.speech.runWhenLoaded(this.onTilesetOrTextureLoaded.bind(this)),this.speechTexBuf=this.engine.renderManager.createBuffer(this.getSpeechBubbleTexture(),this.engine.gl.DYNAMIC_DRAW,2)),!this.portraitSrc){t.next=31;break}return t.next=29,this.engine.resourceManager.loadTextureFromZip(this.portraitSrc,r);case 29:this.portrait=t.sent,this.portrait.runWhenLoaded(this.onTilesetOrTextureLoaded.bind(this));case 31:this.isLit&&(console.log({msg:"Adding Light",id:this.id,pos:this.pos.toArray()}),this.lightIndex=this.engine.renderManager.lightManager.addLight(this.id,this.pos.toArray(),this.lightColor,null!==(i=this.attenuation)&&void 0!==i?i:[.01,.01,.01],this.direction,this.density,this.scatteringCoefficients,!0)),this.zone.tileset.runWhenDefinitionLoaded(this.onTilesetDefinitionLoaded.bind(this));case 33:case"end":return t.stop()}}),t,this)}))),function(t,e){return s.apply(this,arguments)})},{key:"onTilesetDefinitionLoaded",value:function(){var t=this.zone.tileset.tileSize,e=[this.tileSize[0]/t,this.tileSize[1]/t],r=[[0,0,0],[e[0],0,0],[e[0],0,e[1]],[0,0,e[1]]],n=[[r[2],r[3],r[0]],[r[2],r[0],r[1]]].flat(3);this.vertexPosBuf=this.engine.renderManager.createBuffer(n,this.engine.gl.STATIC_DRAW,3),this.enableSpeech&&(this.speechVerBuf=this.engine.renderManager.createBuffer(this.getSpeechBubbleVertices(),this.engine.gl.STATIC_DRAW,3)),this.zone.tileset.runWhenLoaded(this.onTilesetOrTextureLoaded.bind(this))}},{key:"onTilesetOrTextureLoaded",value:function(){!this||this.loaded||!this.zone.tileset.loaded||!this.texture.loaded||this.enableSpeech&&this.speech&&!this.speech.loaded||this.portrait&&!this.portrait.loaded||(this.init(),this.enableSpeech&&this.speech&&this.speech.clearHud&&(this.speech.clearHud(),this.speech.writeText(this.id),this.speech.loadImage()),this.loaded=!0,this.onLoadActions.run())}},{key:"getTexCoords",value:function(){var t,e=d.Nm.spriteSequence(this.facing,this.engine.renderManager.camera.cameraDir),r=null!==(t=this.frames[e])&&void 0!==t?t:this.frames.N,n=r.length,i=r[this.animFrame%n],o=this.sheetSize,a=this.tileSize,s=[(i[0]+a[0])/o[0],i[1]/o[1]],c=[i[0]/o[0],(i[1]+a[1])/o[1]],u=[s,[c[0],s[1]],c,[s[0],c[1]]];return[[u[0],u[1],u[2]],[u[0],u[2],u[3]]].flat(3)}},{key:"getSpeechBubbleTexture",value:function(){return[[1,1],[0,1],[0,0],[1,1],[0,0],[1,0]].flat(3)}},{key:"getSpeechBubbleVertices",value:function(){return[A(x.OW,[2,0,4]).toArray(),A(x.OW,[0,0,4]).toArray(),A(x.OW,[0,0,2]).toArray(),A(x.OW,[2,0,4]).toArray(),A(x.OW,[0,0,2]).toArray(),A(x.OW,[2,0,2]).toArray()].flat(3)}},{key:"draw",value:function(){var t;if(this.loaded){if(this.isLit){var e=this.pos.toArray();this.engine.renderManager.lightManager.updateLight(this.lightIndex,e)}var r;this.engine.renderManager.mvPushMatrix(),(0,_.Iu)(this.engine.renderManager.uModelMat,this.engine.renderManager.uModelMat,(null!==(t=this.drawOffset[this.engine.renderManager.camera.cameraDir])&&void 0!==t?t:this.drawOffset.N).toArray()),(0,_.Iu)(this.engine.renderManager.uModelMat,this.engine.renderManager.uModelMat,this.pos.toArray()),this.fixed||(this.engine.renderManager.shaderProgram.setMatrixUniforms(new x.OW(1,Math.cos(this.engine.renderManager.camera.cameraAngle/180),1)),(0,_.Iu)(this.engine.renderManager.uModelMat,this.engine.renderManager.uModelMat,[.5*this.engine.renderManager.camera.cameraVector.x,.5*this.engine.renderManager.camera.cameraVector.y,0]),(0,_.U1)(this.engine.renderManager.uModelMat,this.engine.renderManager.uModelMat,(0,x.Id)(this.engine.renderManager.camera.cameraAngle*this.engine.renderManager.camera.cameraVector.z),[0,0,-1]),(0,_.Iu)(this.engine.renderManager.uModelMat,this.engine.renderManager.uModelMat,[-.5*this.engine.renderManager.camera.cameraVector.x,-.5*this.engine.renderManager.camera.cameraVector.y,0])),this.engine.renderManager.bindBuffer(this.vertexPosBuf,this.engine.renderManager.shaderProgram.aVertexPosition),this.engine.renderManager.bindBuffer(this.vertexTexBuf,this.engine.renderManager.shaderProgram.aTextureCoord),this.texture.attach(),this.engine.renderManager.shaderProgram.setMatrixUniforms(),this.engine.gl.depthFunc(this.engine.gl.ALWAYS),this.engine.gl.drawArrays(this.engine.gl.TRIANGLES,0,this.vertexPosBuf.numItems),this.engine.gl.depthFunc(this.engine.gl.LESS),this.engine.renderManager.mvPopMatrix(),this.enableSpeech&&(this.engine.renderManager.mvPushMatrix(),(0,_.Iu)(this.engine.renderManager.uModelMat,this.engine.renderManager.uModelMat,(null!==(r=this.drawOffset[this.engine.renderManager.camera.cameraDir])&&void 0!==r?r:this.drawOffset.N).toArray()),(0,_.Iu)(this.engine.renderManager.uModelMat,this.engine.renderManager.uModelMat,this.pos.toArray()),(0,_.U1)(this.engine.renderManager.uModelMat,this.engine.renderManager.uModelMat,(0,x.Id)(this.engine.renderManager.camera.cameraAngle*this.engine.renderManager.camera.cameraVector.z),[0,0,-1]),this.engine.renderManager.bindBuffer(this.speechVerBuf,this.engine.renderManager.shaderProgram.aVertexPosition),this.engine.renderManager.bindBuffer(this.speechTexBuf,this.engine.renderManager.shaderProgram.aTextureCoord),this.speech.attach(),this.engine.renderManager.shaderProgram.setMatrixUniforms(),this.engine.gl.depthFunc(this.engine.gl.ALWAYS),this.engine.gl.drawArrays(this.engine.gl.TRIANGLES,0,this.speechVerBuf.numItems),this.engine.gl.depthFunc(this.engine.gl.LESS),this.engine.renderManager.mvPopMatrix())}}},{key:"setFrame",value:function(t){this.animFrame=t,this.engine.renderManager.updateBuffer(this.vertexTexBuf,this.getTexCoords())}},{key:"setFacing",value:function(t){t&&(this.facing=t),this.setFrame(this.animFrame)}},{key:"addAction",value:(a=T(k().mark((function t(e){return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve(e);case 2:e=t.sent,this.actionDict[e.id]&&this.removeAction(e.id),this.actionDict[e.id]=e,this.actionList.push(e);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"removeAction",value:function(t){this.actionList=this.actionList.filter((function(e){return e.id!==t})),delete this.actionDict[t]}},{key:"removeAllActions",value:function(){this.actionList=[],this.actionDict={}}},{key:"tickOuter",value:function(t){var e=this;if(this.loaded){this.actionList.sort((function(t,e){var r=t.startTime-e.startTime;return r?t.id>e.id?1:-1:r}));var r=[];this.actionList.forEach((function(e){if(e.loaded&&!(e.startTime>t))try{e.tick(t)&&(r.push(e),e.onComplete())}catch(t){console.error(t),r.push(e)}})),r.forEach((function(t){return e.removeAction(t.id)})),this.tick&&this.tick(t)}}},{key:"init",value:function(){}},{key:"loadRemote",value:(o=T(k().mark((function t(e){var r;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:if((r=t.sent).ok){t.next=5;break}throw new Error;case 5:this.processJson(r.json());case 6:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"processJson",value:function(t){this.update(t)}},{key:"speak",value:function(t){var e,r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!t&&this.speech.clearHud?this.speech.clearHud():(i.speechOutput&&(this.speechSynthesis(t),i.speechOutput=!1),this.textbox=this.engine.hud.scrollText(this.id+":> "+t,!0,{portrait:null!==(e=this.portrait)&&void 0!==e&&e}),n&&this.speech&&(this.speech.scrollText(t,!1,{portrait:null!==(r=this.portrait)&&void 0!==r&&r}),this.speech.loadImage()))}},{key:"speechSynthesis",value:function(t){var e,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"en",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=this.voice,s=null!==(e=window.speechSynthesis.getVoices())&&void 0!==e?e:[];a.voice=this.gender?"male"==this.gender?s[7]:s[28]:s[0],n&&(a.rate=n),i&&(a.volume=i),o&&(a.pitch=o),a.text=t,a.lang=r,window.speechSynthesis.speak(a)}},{key:"interact",value:(n=T(k().mark((function t(e,r){var n;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=null,t.t0=this.state,t.next=4;break;case 4:return t.abrupt("break",5);case 5:return r&&r(!0),t.abrupt("return",n);case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"faceDir",value:function(t){return(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||this.facing!=t)&&t!==d.Nm.None?new cn(this.engine,"face",[t],this):null}},{key:"setGreeting",value:function(t){return this.speech.clearHud&&this.speech.clearHud(),this.speech.writeText(t),this.speech.loadImage(),new cn(this.engine,"greeting",[t,{autoclose:!0}],this)}}],r&&L(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),h}(o.Z);function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function R(t,e,r){return R=F()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&B(i,r.prototype),i},R.apply(null,arguments)}function N(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function B(t,e){return B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},B(t,e)}function D(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function F(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function U(t){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},U(t)}function z(t){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z(t)}function G(t,e,r){return G=X()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&Z(i,r.prototype),i},G.apply(null,arguments)}function W(t){return function(t){if(Array.isArray(t))return V(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return V(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?V(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function $(){$=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==z(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Y(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function K(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){Y(o,n,i,a,s,"next",t)}function s(t){Y(o,n,i,a,s,"throw",t)}a(void 0)}))}}function H(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Z(t,e){return Z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Z(t,e)}function X(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function q(t){return q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},q(t)}var J=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Z(t,e)}(s,t);var e,r,n,i,o,a=(i=s,o=X(),function(){var t,e=q(i);if(o){var r=q(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===z(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(n=a.call(this,t)).json=e,n.zip=r,n}return e=s,r=[{key:"loadJson",value:(n=K($().mark((function t(){var e,r=this;return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.json.extends){t.next=4;break}return t.next=3,Promise.all(this.json.extends.map(function(){var t=K($().mark((function t(e){var n;return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=JSON,t.next=3,r.zip.file("sprites/"+e+".json").async("string");case 3:t.t1=t.sent,n=t.t0.parse.call(t.t0,t.t1),Object.assign(r.json,n);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:this.json.extends=null;case 4:this.update(this.json),this.src=this.json.src,this.portraitSrc=this.json.portraitSrc,this.sheetSize=this.json.sheetSize,this.tileSize=this.json.tileSize,this.state=null!==(e=this.json.state)&&void 0!==e?e:"intro",this.frames=this.json.frames,this.hotspotOffset=G(x.OW,W(this.json.hotspotOffset)),this.drawOffset={},Object.keys(this.json.drawOffset).forEach((function(t){r.drawOffset[t]=G(x.OW,W(r.json.drawOffset[t]))})),this.bindCamera=this.json.bindCamera,this.enableSpeech=this.json.enableSpeech;case 16:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})}],r&&H(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&B(t,e)}(a,t);var e,r,n,i,o=(n=a,i=F(),function(){var t,e=U(n);if(i){var r=U(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===j(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return D(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this,t)).handleWalk=e.handleWalk.bind(D(e)),e.isLit=!0,e}return e=a,r=[{key:"init",value:function(){console.log({msg:"- avatar hook",id:this.id,pos:this.pos,avatar:this})}},{key:"tick",value:function(t){if(!this.actionList.length){var e=this.checkInput();e&&this.addAction(e).then((function(){}))}this.bindCamera&&(0,x.t8)(this.pos,this.engine.renderManager.camera.cameraPosition)}},{key:"openMenu",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new cn(this.engine,"prompt",[t,e,!1,{autoclose:!1}],this)}},{key:"checkInput",value:function(){var t,e=this.engine.keyboard.lastPressedCode(),r=this.engine.gamepad.checkInput(),n=this.engine.renderManager.camera.cameraVector,i=this.engine.renderManager.camera.cameraVector;switch(e){case"b":this.bindCamera=!0;break;case"c":this.bindCamera=!1;break;case"x":n=this.engine.renderManager.camera.cameraVector,console.log(this.engine.renderManager.camera),(i=this.engine.renderManager.camera.cameraVector.add(R(x.OW,[0,0,1]))).z=null!==(t=i.z%9)&&void 0!==t?t:8,0===i.z&&8===n.z&&(n.z=0),0===i.z&&7===n.z&&(i.z=8),this.zone.world.addEvent(new yn(this.engine,"camera",["pan",{from:n,to:i,duration:1}],this.zone.world,(function(){})));break;case"z":n=this.engine.renderManager.camera.cameraVector,(i=this.engine.renderManager.camera.cameraVector.sub(R(x.OW,[0,0,1]))).z=i.z%9,0===i.z&&8===n.z&&(n.z=0),0===i.z&&7===n.z&&(i.z=8),this.zone.world.addEvent(new yn(this.engine,"camera",["pan",{from:n,to:i,duration:1}],this.zone.world,(function(){})));break;case"m":return this.openMenu({main:{text:"Close Menu",x:100,y:100,w:150,h:75,colours:{top:"#333",bottom:"#777",background:"#999"},trigger:function(t){t.completed=!0}}},["main"]);case"k":case"Enter":return new cn(this.engine,"interact",[this.pos.toArray(),this.facing,this.zone.world],this);case"h":return new cn(this.engine,"dialogue",["Welcome! You pressed help! Press Escape to close",!1,{autoclose:!0}],this);case" ":return new cn(this.engine,"chat",[">:",!0,{autoclose:!1}],this);case"Escape":this.speech.clearHud()}return this.engine.gamepad.keyPressed("a")?new cn(this.engine,"interact",[this.pos.toArray(),this.facing,this.zone.world],this):(1===r.x&&(this.bindCamera=!this.bindCamera),1===r.y?this.openMenu({main:{text:"Close Menu",x:100,y:100,w:150,h:75,colours:{top:"#333",bottom:"#777",background:"#999"},trigger:function(t){t.completed=!0}}},["main"]):this.handleWalk(this.engine.keyboard.lastPressedKey(),r))}},{key:"handleWalk",value:function(t,e){var r,n=d.Nm.None;switch(t){case"w":n=d.Nm.Up;break;case"y":this.pos.z++;break;case"f":this.pos.z--;break;case"s":n=d.Nm.Down;break;case"a":n=d.Nm.Left;break;case"d":n=d.Nm.Right;break;case"u":return new cn(this.engine,"dance",[300,this.zone],this);case"p":return new cn(this.engine,"patrol",[this.pos.toArray(),new x.OW(8,13,this.pos.z).toArray(),600,this.zone],this);case"r":return new cn(this.engine,"patrol",[this.pos.toArray(),new x.OW(8,13,this.pos.z).toArray(),200,this.zone],this);case"t":return void this.engine.renderManager.startTransition({duration:2})}if(1===e["x-dir"]&&(n=d.Nm.Right),-1===e["x-dir"]&&(n=d.Nm.Left),1===e["y-dir"]&&(n=d.Nm.Down),-1===e["y-dir"]&&(n=d.Nm.Up),r=this.engine.keyboard.shift||this.engine.gamepad.keyPressed("y")?200:600,this.facing!==n)return this.faceDir(n);var i=this.pos,o=d.Nm.toOffset(n),a=R(x.OW,[Math.round(i.x+o[0]),Math.round(i.y+o[1]),0]);if(!this.zone.isInZone(a.x,a.y)){var s=this.zone.world.zoneContaining(a.x,a.y);return s&&s.loaded&&s.isWalkable(a.x,a.y,d.Nm.reverse(n))?new cn(this.engine,"changezone",[this.zone.id,this.pos.toArray(),s.id,a.toArray(),r],this):this.faceDir(n)}return this.zone.isWalkable(a.x,a.y,d.Nm.reverse(n))?new cn(this.engine,"move",[this.pos.toArray(),a.toArray(),r,this.zone],this):this.faceDir(n)}}],r&&N(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(I));function Q(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function tt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function rt(t,e,r){return e&&et(t.prototype,e),r&&et(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function nt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var it=rt((function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),nt(this,"getLibrary",(function(t,e){return new r.lua.Table(function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?tt(Object(r),!0).forEach((function(e){nt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({as_obj:function(t){return t.toObject()},as_table:function(t){for(var e=new r.lua.Table,n=0,i=Object.entries(t);n<i.length;n++){var o=(c=i[n],u=2,function(t){if(Array.isArray(t))return t}(c)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o=[],a=!0,s=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}}(c,u)||function(t,e){if(t){if("string"==typeof t)return Q(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Q(t,e):void 0}}(c,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],s=o[1];e.set(a,s)}var c,u;return e},get_caller:function(){return e._this},get_sprite:function(){return e.sprite},get_world:function(){return t.spritz.world},remove_all_zones:function(){return console.log({msg:"removing all zones via lua"}),t.spritz.world.removeAllZones()},load_zone_from_zip:function(e,r){return console.log({msg:"loading zone from zip via lua",world:t.spritz.world,z:e,zip:r}),t.spritz.world.loadZoneFromZip(e,r)},log:function(t){console.log(t)},from:function(t,e){return t[e]},length:function(t){return t.length||0}},e))})),this.lua=e})),ot=r(5233),at=r.n(ot),st={};var ct=JSON.stringify;function ut(){for(var t=new Array(arguments.length-1),e=0;e<t.length;++e)t[e]=arguments[e+1];return function(t,e){for(var r="",n=0,i=0,o=0,a="",s=0;s<t.length;++s){var c=t[s],u=c[0].charCodeAt(0);if(76!==u)if(37!==u){var l="",h=0,f=10,p=4,d=!1,y=c[3],g=y.indexOf("#")>-1;if(c[2])n=parseInt(c[2],10)-1;else if(109===u&&!g){r+="Success";continue}var m=0;c[4].length>0&&(m="*"!==c[4].charAt(0)?parseInt(c[4],10):1===c[4].length?e[i++]:e[parseInt(c[4].substr(1),10)-1]);var v=-1;c[5].length>0&&(v="*"!==c[5].charAt(0)?parseInt(c[5],10):1===c[5].length?e[i++]:e[parseInt(c[5].substr(1),10)-1]),c[2]||(n=i++);var b=e[n],w=c[6];switch(u){case 83:case 115:l=String(b),v>=0&&(l=l.substr(0,v)),(m>l.length||-m>l.length)&&((-1==y.indexOf("-")||m<0)&&-1!=y.indexOf("0")?l=(a=m-l.length>=0?"0".repeat(m-l.length):"")+l:(a=m-l.length>=0?" ".repeat(m-l.length):"",l=y.indexOf("-")>-1?l+a:a+l));break;case 67:case 99:switch(typeof b){case"number":var x=b;67==u||108===w.charCodeAt(0)?(x&=4294967295,l=String.fromCharCode(x)):(x&=255,l=String.fromCharCode(x));break;case"string":l=b.charAt(0);break;default:l=String(b).charAt(0)}(m>l.length||-m>l.length)&&((-1==y.indexOf("-")||m<0)&&-1!=y.indexOf("0")?l=(a=m-l.length>=0?"0".repeat(m-l.length):"")+l:(a=m-l.length>=0?" ".repeat(m-l.length):"",l=y.indexOf("-")>-1?l+a:a+l));break;case 68:p=8;case 100:case 105:h=-1,d=!0;break;case 85:p=8;case 117:h=-1;break;case 79:p=8;case 111:h=-1,f=8;break;case 120:h=-1,f=-16;break;case 88:h=-1,f=16;break;case 66:p=8;case 98:h=-1,f=2;break;case 70:case 102:h=1;break;case 69:case 101:h=2;break;case 71:case 103:h=3;break;case 65:case 97:h=4;break;case 112:o="number"==typeof b?b:b?Number(b.l):-1,isNaN(o)&&(o=-1),l=g?o.toString(10):"0x"+(o=Math.abs(o)).toString(16).toLowerCase();break;case 110:b&&(b.len=r.length);continue;case 109:l=b instanceof Error?b.message?b.message:b.errno?"Error number "+b.errno:"Error "+String(b):"Success";break;case 74:l=(g?ct:JSON.stringify)(b);break;case 86:l=null==b?"null":String(b.valueOf());break;case 84:l=g?(l=Object.prototype.toString.call(b).substr(8)).substr(0,l.length-1):typeof b;break;case 89:case 121:l=b?g?"yes":"true":g?"no":"false",89==u&&(l=l.toUpperCase()),v>=0&&(l=l.substr(0,v)),(m>l.length||-m>l.length)&&((-1==y.indexOf("-")||m<0)&&-1!=y.indexOf("0")?l=(a=m-l.length>=0?"0".repeat(m-l.length):"")+l:(a=m-l.length>=0?" ".repeat(m-l.length):"",l=y.indexOf("-")>-1?l+a:a+l))}if(m<0&&(m=-m,y+="-"),-1==h){switch(o=Number(b),w){case"hh":p=1;break;case"h":p=2;break;case"l":case"L":case"q":case"ll":case"j":case"t":case"z":case"Z":case"I":4==p&&(p=8)}switch(p){case 1:o&=255,d&&o>127&&(o-=256);break;case 2:o&=65535,d&&o>32767&&(o-=65536);break;case 4:o=d?0|o:o>>>0;break;default:o=isNaN(o)?0:Math.round(o)}if(p>4&&o<0&&!d)if(16==f||-16==f)l=(o>>>0).toString(16),l=(16-(l=((o=Math.floor((o-(o>>>0))/Math.pow(2,32)))>>>0).toString(16)+(8-l.length>=0?"0".repeat(8-l.length):"")+l).length>=0?"f".repeat(16-l.length):"")+l,16==f&&(l=l.toUpperCase());else if(8==f)l=(10-(l=(o>>>0).toString(8)).length>=0?"0".repeat(10-l.length):"")+l,l="1"+(21-(l=(l=((o=Math.floor((o-(o>>>0&1073741823))/Math.pow(2,30)))>>>0).toString(8)+l.substr(l.length-10)).substr(l.length-20)).length>=0?"7".repeat(21-l.length):"")+l;else{o=-o%1e16;for(var _=[1,8,4,4,6,7,4,4,0,7,3,7,0,9,5,5,1,6,1,6],E=_.length-1;o>0;)(_[E]-=o%10)<0&&(_[E]+=10,_[E-1]--),--E,o=Math.floor(o/10);l=_.join("")}else l=-16===f?o.toString(16).toLowerCase():16===f?o.toString(16).toUpperCase():o.toString(f);if(0!==v||"0"!=l||8==f&&g){if(l.length<v+("-"==l.substr(0,1)?1:0)&&(l="-"!=l.substr(0,1)?(v-l.length>=0?"0".repeat(v-l.length):"")+l:l.substr(0,1)+(v+1-l.length>=0?"0".repeat(v+1-l.length):"")+l.substr(1)),!d&&g&&0!==o)switch(f){case-16:l="0x"+l;break;case 16:l="0X"+l;break;case 8:"0"!=l.charAt(0)&&(l="0"+l);break;case 2:l="0b"+l}}else l="";d&&"-"!=l.charAt(0)&&(y.indexOf("+")>-1?l="+"+l:y.indexOf(" ")>-1&&(l=" "+l)),m>0&&l.length<m&&(y.indexOf("-")>-1?l+=m-l.length>=0?" ".repeat(m-l.length):"":y.indexOf("0")>-1&&v<0&&l.length>0?(v>l.length&&(l=(v-l.length>=0?"0".repeat(v-l.length):"")+l),a=m-l.length>=0?(v>0?" ":"0").repeat(m-l.length):"",l=l.charCodeAt(0)<48?"x"==l.charAt(2).toLowerCase()?l.substr(0,3)+a+l.substring(3):l.substr(0,1)+a+l.substring(1):"x"==l.charAt(1).toLowerCase()?l.substr(0,2)+a+l.substring(2):a+l):l=(m-l.length>=0?" ".repeat(m-l.length):"")+l)}else if(h>0){o=Number(b),null===b&&(o=NaN),"L"==w&&(p=12);var A=isFinite(o);if(A){var k=0;-1==v&&4!=h&&(v=6),3==h&&(0===v&&(v=1),v>(k=+(l=o.toExponential(1)).substr(l.indexOf("e")+1))&&k>=-4?(h=11,v-=k+1):(h=12,v-=1));var S=o<0||1/o==-1/0?"-":"";switch(o<0&&(o=-o),h){case 1:case 11:if(o<1e21){l=o.toFixed(v),1==h?0===v&&g&&-1==l.indexOf(".")&&(l+="."):g?-1==l.indexOf(".")&&(l+="."):l=l.replace(/(\.\d*[1-9])0*$/,"$1").replace(/\.0*$/,"");break}k=+(l=o.toExponential(20)).substr(l.indexOf("e")+1),l=l.charAt(0)+l.substr(2,l.indexOf("e")-2),l+=k-l.length+1>=0?"0".repeat(k-l.length+1):"",(g||v>0&&11!==h)&&(l=l+"."+(v>=0?"0".repeat(v):""));break;case 2:case 12:k=(l=o.toExponential(v)).indexOf("e"),l.length-k==3&&(l=l.substr(0,k+2)+"0"+l.substr(k+2)),g&&-1==l.indexOf(".")?l=l.substr(0,k)+"."+l.substr(k):g||12!=h||(l=l.replace(/\.0*e/,"e").replace(/\.(\d*[1-9])0*e/,".$1e"));break;case 4:if(0===o){l="0x0"+(g||v>0?"."+(v>=0?"0".repeat(v):""):"")+"p+0";break}var T=(l=o.toString(16)).charCodeAt(0);if(48==T){for(T=2,k=-4,o*=16;48==l.charCodeAt(T++);)k-=4,o*=16;T=(l=o.toString(16)).charCodeAt(0)}var L=l.indexOf(".");if(l.indexOf("(")>-1){var O=l.match(/\(e(.*)\)/),C=O?+O[1]:0;k+=4*C,o/=Math.pow(16,C)}else L>1?(k+=4*(L-1),o/=Math.pow(16,L-1)):-1==L&&(k+=4*(l.length-1),o/=Math.pow(16,l.length-1));if(p>8?T<50?(k-=3,o*=8):T<52?(k-=2,o*=4):T<56&&(k-=1,o*=2):T>=56?(k+=3,o/=8):T>=52?(k+=2,o/=4):T>=50&&(k+=1,o/=2),(l=o.toString(16)).length>1){if(l.length>v+2&&l.charCodeAt(v+2)>=56){var P=102==l.charCodeAt(0);l=(o+8*Math.pow(16,-v-1)).toString(16),P&&49==l.charCodeAt(0)&&(k+=4)}v>0?(l=l.substr(0,v+2)).length<v+2&&(l.charCodeAt(0)<48?l=l.charAt(0)+(v+2-l.length>=0?"0".repeat(v+2-l.length):"")+l.substr(1):l+=v+2-l.length>=0?"0".repeat(v+2-l.length):""):0===v&&(l=l.charAt(0)+(g?".":""))}else v>0?l=l+"."+(v>=0?"0".repeat(v):""):g&&(l+=".");l="0x"+l+"p"+(k>=0?"+"+k:k)}""===S&&(y.indexOf("+")>-1?S="+":y.indexOf(" ")>-1&&(S=" ")),l=S+l}else o<0?l="-":y.indexOf("+")>-1?l="+":y.indexOf(" ")>-1&&(l=" "),l+=isNaN(o)?"nan":"inf";m>l.length&&(y.indexOf("-")>-1?l+=m-l.length>=0?" ".repeat(m-l.length):"":y.indexOf("0")>-1&&l.length>0&&A?(a=m-l.length>=0?"0".repeat(m-l.length):"",l=l.charCodeAt(0)<48?"x"==l.charAt(2).toLowerCase()?l.substr(0,3)+a+l.substring(3):l.substr(0,1)+a+l.substring(1):"x"==l.charAt(1).toLowerCase()?l.substr(0,2)+a+l.substring(2):a+l):l=(m-l.length>=0?" ".repeat(m-l.length):"")+l),u<96&&(l=l.toUpperCase())}r+=l}else r+="%";else r+=c[1]}return r}(function(t){if(st[t])return st[t];for(var e=[],r=0,n=0,i=!1,o="",a="",s="",c="",u="",l=0,h=t.length;n<h;++n)if(l=t.charCodeAt(n),i)if(l>=48&&l<58)c.length?c+=String.fromCharCode(l):48!=l||s.length?s+=String.fromCharCode(l):a+=String.fromCharCode(l);else switch(l){case 36:c.length?c+="$":"*"==s.charAt(0)?s+="$":(o=s+"$",s="");break;case 39:a+="'";break;case 45:a+="-";break;case 43:a+="+";break;case 32:a+=" ";break;case 35:a+="#";break;case 46:c=".";break;case 42:"."==c.charAt(0)?c+="*":s+="*";break;case 104:case 108:if(u.length>1)throw"bad length "+u+String(l);u+=String.fromCharCode(l);break;case 76:case 106:case 122:case 116:case 113:case 90:case 119:if(""!==u)throw"bad length "+u+String.fromCharCode(l);u=String.fromCharCode(l);break;case 73:if(""!==u)throw"bad length "+u+"I";u="I";break;case 100:case 105:case 111:case 117:case 120:case 88:case 102:case 70:case 101:case 69:case 103:case 71:case 97:case 65:case 99:case 67:case 115:case 83:case 112:case 110:case 68:case 85:case 79:case 109:case 98:case 66:case 121:case 89:case 74:case 86:case 84:case 37:i=!1,c.length>1&&(c=c.substr(1)),e.push([String.fromCharCode(l),t.substring(r,n+1),o,a,s,c,u]),r=n+1,u=c=s=a=o="";break;default:throw new Error("Invalid format string starting with |"+t.substring(r,n+1)+"|")}else{if(37!==l)continue;r<n&&e.push(["L",t.substring(r,n)]),r=n,i=!0}return r<t.length&&e.push(["L",t.substring(r)]),st[t]=e}(arguments[0]),t)}class lt extends Error{constructor(t){super(),this.message=t}toString(){return`LuaError: ${this.message}`}}class ht{constructor(t){if(this.numValues=[void 0],this.strValues={},this.keys=[],this.values=[],this.metatable=null,void 0!==t)if("function"!=typeof t){if(Array.isArray(t))this.insert(...t);else for(const e in t)if(Tt(t,e)){let r=t[e];null===r&&(r=void 0),this.set(e,r)}}else t(this)}get(t){const e=this.rawget(t);if(void 0===e&&this.metatable){const e=this.metatable.get("__index");if(e instanceof ht)return e.get(t);if("function"==typeof e){const r=e.call(void 0,this,t);return r instanceof Array?r[0]:r}}return e}rawget(t){switch(typeof t){case"string":if(Tt(this.strValues,t))return this.strValues[t];break;case"number":if(t>0&&t%1==0)return this.numValues[t]}const e=this.keys.indexOf(yt(t));return-1===e?void 0:this.values[e]}getMetaMethod(t){return this.metatable&&this.metatable.rawget(t)}set(t,e){const r=this.metatable&&this.metatable.get("__newindex");if(r&&void 0===this.rawget(t)){if(r instanceof ht)return r.set(t,e);if("function"==typeof r)return r(this,t,e)}this.rawset(t,e)}setFn(t){return e=>this.set(t,e)}rawset(t,e){switch(typeof t){case"string":return void(this.strValues[t]=e);case"number":if(t>0&&t%1==0)return void(this.numValues[t]=e)}const r=yt(t),n=this.keys.indexOf(r);n>-1?this.values[n]=e:(this.values[this.keys.length]=e,this.keys.push(r))}insert(...t){this.numValues.push(...t)}toObject(){const t=0===Object.keys(this.strValues).length&&this.getn()>0,e=t?[]:{};for(let r=1;r<this.numValues.length;r++){const n=this.numValues[r],i=n instanceof ht?n.toObject():n;t?e[r-1]=i:e[String(r-1)]=i}for(const t in this.strValues)if(Tt(this.strValues,t)){const r=this.strValues[t],n=r instanceof ht?r.toObject():r;e[t]=n}return e}getn(){const t=this.numValues,e=[];for(const r in t)Tt(t,r)&&(e[r]=!0);let r=0;for(;e[r+1];)r+=1;if(r>0&&void 0===t[r]){let e=0;for(;r-e>1;){const n=Math.floor((e+r)/2);void 0===t[n]?r=n:e=n}return e}return r}}const ft=/^[-+]?[0-9]*\.?([0-9]+([eE][-+]?[0-9]+)?)?$/,pt=/^(-)?0x([0-9a-fA-F]*)\.?([0-9a-fA-F]*)$/;function dt(t){const e=typeof t;switch(e){case"undefined":return"nil";case"number":case"string":case"boolean":case"function":return e;case"object":if(t instanceof ht)return"table";if(t instanceof Function)return"function"}}function yt(t){if(t instanceof ht){const r=t.getMetaMethod("__tostring");return r?r(t)[0]:e(t,"table: 0x")}return t instanceof Function?e(t,"function: 0x"):wt(t);function e(t,e){const r=t.toString();if(r.indexOf(e)>-1)return r;const n=e+Math.floor(4294967295*Math.random()).toString(16);return t.toString=()=>n,n}}function gt(t,e){return t>=0?t:-t>e?0:e+t+1}function mt(t,e){if(e)throw new lt(`${e}`.replace(/%type/gi,dt(t)))}function vt(t){return!(!1===t||void 0===t)}function bt(t,e){if("number"==typeof t)return t;switch(t){case void 0:return;case"inf":return 1/0;case"-inf":return-1/0;case"nan":return NaN}const r=`${t}`;if(r.match(ft))return parseFloat(r);const n=r.match(pt);if(n){const[,t,e,r]=n;let i=parseInt(e,16)||0;return r&&(i+=parseInt(r,16)/Math.pow(16,r.length)),t&&(i*=-1),i}void 0!==e&&mt(t,e)}function wt(t,e){if("string"==typeof t)return t;switch(t){case void 0:case null:return"nil";case 1/0:return"inf";case-1/0:return"-inf"}return"number"==typeof t?Number.isNaN(t)?"nan":`${t}`:"boolean"==typeof t?`${t}`:void 0===e?"nil":void mt(t,e)}function xt(t,e,r,n,i){return e(t,`bad argument #${i} to '${n}' (${r} expected, got %type)`)}function _t(t,e,r){return xt(t,bt,"number",e,r)}function Et(t,e,r){return xt(t,wt,"string",e,r)}function At(t,e,r){if(t instanceof ht)return t;{const n=dt(t);throw new lt(`bad argument #${r} to '${e}' (table expected, got ${n})`)}}function kt(t,e,r){if(t instanceof Function)return t;{const n=dt(t);throw new lt(`bad argument #${r} to '${e}' (function expected, got ${n})`)}}const St=t=>t instanceof Array?t:[t],Tt=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Lt=Object.freeze({__proto__:null,type:dt,tostring:yt,posrelat:gt,coerceToBoolean:vt,coerceToNumber:bt,coerceToString:wt,coerceArgToNumber:_t,coerceArgToString:Et,coerceArgToTable:At,coerceArgToFunction:kt,ensureArray:St,hasOwnProperty:Tt});class Ot{constructor(t={}){this._variables=t}get(t){return this._variables[t]}set(t,e){Tt(this._variables,t)||!this.parent?this.setLocal(t,e):this.parent.set(t,e)}setLocal(t,e){this._variables[t]=e}setVarargs(t){this._varargs=t}getVarargs(){return this._varargs||this.parent&&this.parent.getVarargs()||[]}extend(){const t=Object.create(this._variables),e=new Ot(t);return e.parent=this,e}}const Ct=t=>"IfClause"===t.type||"ElseifClause"===t.type||"ElseClause"===t.type||"WhileStatement"===t.type||"DoStatement"===t.type||"RepeatStatement"===t.type||"FunctionDeclaration"===t.type||"ForNumericStatement"===t.type||"ForGenericStatement"===t.type||"Chunk"===t.type;class Pt extends String{constructor(t,e){super(),this.base=t,this.property=e}get(){return`__lua.get(${this.base}, ${this.property})`}set(t){return`${this.base}.set(${this.property}, ${t})`}setFn(){return`${this.base}.setFn(${this.property})`}toString(){return this.get()}valueOf(){return this.get()}}const Mt={not:"not","-":"unm","~":"bnot","#":"len"},It={"+":"add","-":"sub","*":"mul","%":"mod","^":"pow","/":"div","//":"idiv","&":"band","|":"bor","~":"bxor","<<":"shl",">>":"shr","..":"concat","~=":"neq","==":"eq","<":"lt","<=":"le",">":"gt",">=":"ge"},jt=t=>{switch(t.type){case"LabelStatement":return`case '${t.label.name}': label = undefined`;case"BreakStatement":return"break";case"GotoStatement":return`label = '${t.label.name}'; continue`;case"ReturnStatement":return`return ${Bt(t.arguments)}`;case"IfStatement":return t.clauses.map((t=>jt(t))).join(" else ");case"IfClause":case"ElseifClause":return`if (__lua.bool(${Nt(t.condition)})) {\n${Rt(t)}\n}`;case"ElseClause":return`{\n${Rt(t)}\n}`;case"WhileStatement":return`while(${Nt(t.condition)}) {\n${Rt(t)}\n}`;case"DoStatement":return`\n${Rt(t)}\n`;case"RepeatStatement":{const e=Nt(t.condition);return`do {\n${Rt(t)}\n} while (!(${e}))`}case"LocalStatement":case"AssignmentStatement":return Ft(t);case"CallStatement":return jt(t.expression);case"FunctionDeclaration":{const e=e=>{const r=e.join(";\n"),n=Rt(t,r);return`(${0===e.length?"":"...args"}) => {\n${n}${-1===t.body.findIndex((t=>"ReturnStatement"===t.type))?"\nreturn []":""}\n}`},r=t.parameters.map((t=>"VarargLiteral"===t.type?`$${Vt.get(t)}.setVarargs(args)`:`$${Vt.get(t)}.setLocal('${t.name}', args.shift())`));if(null===t.identifier)return e(r);if("Identifier"===t.identifier.type)return`$${Vt.get(t.identifier)}.${t.isLocal?"setLocal":"set"}('${t.identifier.name}', ${e(r)})`;const n=jt(t.identifier);return":"===t.identifier.indexer&&r.unshift(`$${Vt.get(t)}.setLocal('self', args.shift())`),n.set(e(r))}case"ForNumericStatement":{const e=t.variable.name,r=`let ${e} = ${Nt(t.start)}, end = ${Nt(t.end)}, step = ${null===t.step?1:Nt(t.step)}`,n=`step > 0 ? ${e} <= end : ${e} >= end`,i=`${e} += step`,o=`$${Vt.get(t.variable)}.setLocal('${e}', ${e});`;return`for (${r}; ${n}; ${i}) {\n${Rt(t,o)}\n}`}case"ForGenericStatement":{const e=Bt(t.iterators),r=t.variables.map(((t,e)=>`$${Vt.get(t)}.setLocal('${t.name}', res[${e}])`)).join(";\n");return`for (let [iterator, table, next] = ${e}, res = __lua.call(iterator, table, next); res[0] !== undefined; res = __lua.call(iterator, table, res[0])) {\n${Rt(t,r)}\n}`}case"Chunk":return`'use strict'\nconst $0 = __lua.globalScope\nlet vars\nlet vals\nlet label\n\n${Rt(t)}`;case"Identifier":return`$${Vt.get(t)}.get('${t.name}')`;case"StringLiteral":return`\`${t.value.replace(/([^\\])?\\(\d{1,3})/g,((t,e,r)=>`${e||""}${String.fromCharCode(r)}`)).replace(/\\/g,"\\\\").replace(/`/g,"\\`")}\``;case"NumericLiteral":return t.value.toString();case"BooleanLiteral":return t.value?"true":"false";case"NilLiteral":return"undefined";case"VarargLiteral":return`$${Vt.get(t)}.getVarargs()`;case"TableConstructorExpression":return 0===t.fields.length?"new __lua.Table()":`new __lua.Table(t => {\n${t.fields.map(((t,e,r)=>"TableKey"===t.type?`t.rawset(${jt(t.key)}, ${Nt(t.value)})`:"TableKeyString"===t.type?`t.rawset('${t.key.name}', ${Nt(t.value)})`:"TableValue"===t.type?e===r.length-1&&zt(t.value)?`t.insert(...${jt(t.value)})`:`t.insert(${Nt(t.value)})`:void 0)).join(";\n")}\n})`;case"UnaryExpression":{const e=Mt[t.operator],r=Nt(t.argument);if(!e)throw new Error(`Unhandled unary operator: ${t.operator}`);return`__lua.${e}(${r})`}case"BinaryExpression":{const e=Nt(t.left),r=Nt(t.right),n=It[t.operator];if(!n)throw new Error(`Unhandled binary operator: ${t.operator}`);return`__lua.${n}(${e}, ${r})`}case"LogicalExpression":{const e=Nt(t.left),r=Nt(t.right),n=t.operator;if("and"===n)return`__lua.and(${e},${r})`;if("or"===n)return`__lua.or(${e},${r})`;throw new Error(`Unhandled logical operator: ${t.operator}`)}case"MemberExpression":{const e=Nt(t.base);return new Pt(e,`'${t.identifier.name}'`)}case"IndexExpression":{const e=Nt(t.base),r=Nt(t.index);return new Pt(e,r)}case"CallExpression":case"TableCallExpression":case"StringCallExpression":{const e=Nt(t.base),r="CallExpression"===t.type?Dt(t.arguments).join(", "):Nt("TableCallExpression"===t.type?t.arguments:t.argument);return e instanceof Pt&&"MemberExpression"===t.base.type&&":"===t.base.indexer?`__lua.call(${e}, ${e.base}, ${r})`:`__lua.call(${e}, ${r})`}default:throw new Error(`No generator found for: ${t.type}`)}},Rt=(t,e="")=>{const r=Vt.get(t),n=void 0===r?"":`const $${r} = $${Wt.get(r)}.extend();`,i=t.body.map((t=>jt(t))).join(";\n"),o=Yt.get(t);if(void 0===o)return`${n}\n${e}\n${i}`;const a=`L${o}: do { switch(label) { case undefined:`,s=$t.get(o);return`${n}\n${a}\n${e}\n${i}\n${(void 0===s?"":`break; default: continue L${s}\n`)+"} } while (label)"}`},Nt=t=>{const e=jt(t);return zt(t)?`${e}[0]`:e},Bt=t=>1===t.length&&zt(t[0])?jt(t[0]):`[${Dt(t).join(", ")}]`,Dt=t=>t.map(((t,e,r)=>{const n=jt(t);return zt(t)?e===r.length-1?`...${n}`:`${n}[0]`:n})),Ft=t=>{const e=[],r=[],n=t.variables.length>1&&t.init.length>0&&!t.init.every(Gt);for(let i=0;i<t.variables.length;i++){const o=t.variables[i],a=t.init[i],s=n?`vars[${i}]`:void 0===a?"undefined":Nt(a);if("Identifier"===o.type){const r="LocalStatement"===t.type?"setLocal":"set";e.push(`$${Vt.get(o)}.${r}('${o.name}', ${s})`)}else{const t=jt(o);n?(e.push(`vals[${r.length}](${s})`),r.push(t.setFn())):e.push(t.set(s))}}for(let r=t.variables.length;r<t.init.length;r++){const n=t.init[r];Ut(n)&&e.push(jt(n))}return n&&(e.unshift(`vars = ${Bt(t.init)}`),r.length>0&&e.unshift(`vals = [${r.join(", ")}]`)),e.join(";\n")},Ut=t=>"CallExpression"===t.type||"StringCallExpression"===t.type||"TableCallExpression"===t.type,zt=t=>Ut(t)||"VarargLiteral"===t.type,Gt=t=>"StringLiteral"===t.type||"NumericLiteral"===t.type||"BooleanLiteral"===t.type||"NilLiteral"===t.type||"TableConstructorExpression"===t.type,Wt=new Map,Vt=new Map,$t=new Map,Yt=new Map,Kt=t=>{const e=at().parse(t.replace(/^#.*/,""),{scope:!1,comments:!1,luaVersion:"5.3",encodingMode:"x-user-defined"});return(t=>{const e=[];let r=0;const n=new Map,i=(()=>{let t=0;return()=>(t+=1,t)})(),o=t=>{if(Ct(t)){!function(){const t=r;r=i(),n.set(r,t)}();for(let n=0;n<t.body.length;n++){const i=t.body[n];switch(i.type){case"LocalStatement":e.push({type:"local",name:i.variables[0].name,scope:r});break;case"LabelStatement":if(e.find((t=>"label"===t.type&&t.name===i.label.name&&t.scope===r)))throw new Error(`label '${i.label.name}' already defined`);e.push({type:"label",name:i.label.name,scope:r,last:"RepeatStatement"!==t.type&&t.body.slice(n).every((t=>"LabelStatement"===t.type))});break;case"GotoStatement":e.push({type:"goto",name:i.label.name,scope:r});break;case"IfStatement":i.clauses.forEach((t=>o(t)));break;default:o(i)}}r=n.get(r)}};o(t);for(let t=0;t<e.length;t++){const r=e[t];if("goto"===r.type){const n=e.filter((t=>"label"===t.type&&t.name===r.name&&t.scope<=r.scope)).sort(((t,e)=>Math.abs(r.scope-t.scope)-Math.abs(r.scope-e.scope)))[0];if(!n)throw new Error(`no visible label '${r.name}' for <goto>`);const i=e.findIndex((t=>t===n));if(i>t){const o=e.slice(t,i).filter((t=>"local"===t.type&&t.scope===n.scope));if(!n.last&&o.length>0)throw new Error(`<goto ${r.name}> jumps into the scope of local '${o[0].name}'`)}}}})(e),(t=>{let e=0,r=0;const n=(t,i,o)=>{let a=i,s=o;Ct(t)?((-1!==t.body.findIndex((t=>"LocalStatement"===t.type||"FunctionDeclaration"===t.type&&t.isLocal))||"FunctionDeclaration"===t.type&&(t.parameters.length>0||t.identifier&&"MemberExpression"===t.identifier.type)||"ForNumericStatement"===t.type||"ForGenericStatement"===t.type)&&(e+=1,a=e,Vt.set(t,e),Wt.set(e,i)),-1!==t.body.findIndex((t=>"LabelStatement"===t.type||"GotoStatement"===t.type))&&(s=r,Yt.set(t,r),"Chunk"!==t.type&&"FunctionDeclaration"!==t.type&&$t.set(r,o),r+=1)):"Identifier"!==t.type&&"VarargLiteral"!==t.type||Vt.set(t,i),((t,e,r,n,i)=>{const o=(t,o=!0)=>{if(!t)return;const a=!1===o&&n?Wt.get(r):r;Array.isArray(t)?t.forEach((t=>e(t,a,i))):e(t,a,i)};switch(t.type){case"LocalStatement":case"AssignmentStatement":o(t.variables),o(t.init);break;case"UnaryExpression":o(t.argument);break;case"BinaryExpression":case"LogicalExpression":o(t.left),o(t.right);break;case"FunctionDeclaration":o(t.identifier,!1),o(t.parameters),o(t.body);break;case"ForGenericStatement":o(t.variables),o(t.iterators,!1),o(t.body);break;case"IfClause":case"ElseifClause":case"WhileStatement":case"RepeatStatement":o(t.condition,!1);case"Chunk":case"ElseClause":case"DoStatement":o(t.body);break;case"ForNumericStatement":o(t.variable),o(t.start,!1),o(t.end,!1),o(t.step,!1),o(t.body);break;case"ReturnStatement":o(t.arguments);break;case"IfStatement":o(t.clauses);break;case"MemberExpression":o(t.base),o(t.identifier);break;case"IndexExpression":o(t.base),o(t.index);break;case"LabelStatement":o(t.label);break;case"CallStatement":o(t.expression);break;case"GotoStatement":o(t.label);break;case"TableConstructorExpression":o(t.fields);break;case"TableKey":case"TableKeyString":o(t.key);case"TableValue":o(t.value);break;case"CallExpression":case"TableCallExpression":o(t.base),o(t.arguments);break;case"StringCallExpression":o(t.base),o(t.argument)}})(t,n,a,i!==a,s)};n(t,e,r)})(e),jt(e).toString()},Ht={"([^a-zA-Z0-9%(])-":"$1*?","([^%])-([^a-zA-Z0-9?])":"$1*?$2","([^%])\\.":"$1[\\s\\S]","(.)-$":"$1*?","%a":"[a-zA-Z]","%A":"[^a-zA-Z]","%c":"[\0-]","%C":"[^\0-]","%d":"\\d","%D":"[^d]","%l":"[a-z]","%L":"[^a-z]","%p":"[.,\"'?!;:#$%&()*+-/<>=@\\[\\]\\\\^_{}|~]","%P":"[^.,\"'?!;:#$%&()*+-/<>=@\\[\\]\\\\^_{}|~]","%s":"[ \\t\\n\\f\\v\\r]","%S":"[^ \t\n\f\v\r]","%u":"[A-Z]","%U":"[^A-Z]","%w":"[a-zA-Z0-9]","%W":"[^a-zA-Z0-9]","%x":"[a-fA-F0-9]","%X":"[^a-fA-F0-9]","%([^a-zA-Z])":"\\$1"};function Zt(t){let e=t.replace(/\\/g,"\\\\");for(const t in Ht)Tt(Ht,t)&&(e=e.replace(new RegExp(t,"g"),Ht[t]));let r=0;for(let t=0,n=e.length;t<n;t++){if(t&&"\\"===e.substr(t-1,1))continue;const i=e.substr(t,1);"["!==i&&"]"!==i||("]"===i&&(r-=1),r>0&&(e=e.substr(0,t)+e.substr(t+1),t-=1,n-=1),"["===i&&(r+=1))}return e}const Xt=new ht({byte:function(t,e,r){const n=Et(t,"byte",1),i=void 0===e?1:_t(e,"byte",2),o=void 0===r?i:_t(r,"byte",3);return n.substring(i-1,o).split("").map((t=>t.charCodeAt(0)))},char:function(...t){return t.map(((t,e)=>{const r=_t(t,"char",e);return String.fromCharCode(r)})).join("")},find:function(t,e,r,n){const i=Et(t,"find",1),o=Et(e,"find",2),a=void 0===r?1:_t(r,"find",3);if(void 0===n||!_t(n,"find",4)){const t=new RegExp(Zt(o)),e=i.substr(a-1).search(t);if(e<0)return;const r=i.substr(a-1).match(t),n=[e+a,e+a+r[0].length-1];return r.shift(),[...n,...r]}const s=i.indexOf(o,a-1);return-1===s?void 0:[s+1,s+o.length]},format:function(t,...e){let r=-1;return t.replace(/%%|%([-+ #0]*)?(\d*)?(?:\.(\d*))?(.)/g,((t,n,i,o,a)=>{if("%%"===t)return"%";if(!a.match(/[AEGXacdefgioqsux]/))throw new lt(`invalid option '%${t}' to 'format'`);if(n&&n.length>5)throw new lt("invalid format (repeated flags)");if(i&&i.length>2)throw new lt("invalid format (width too long)");if(o&&o.length>2)throw new lt("invalid format (precision too long)");r+=1;const s=e[r];if(void 0===s)throw new lt(`bad argument #${r} to 'format' (no value)`);return/A|a|E|e|f|G|g/.test(a)||/c|d|i|o|u|X|x/.test(a)?ut(t,_t(s,"format",r)):"q"===a?`"${s.replace(/([\n"])/g,"\\$1")}"`:ut(t,"s"===a?yt(s):s)}))},gmatch:function(t,e){const r=Et(t,"gmatch",1),n=Zt(Et(e,"gmatch",2)),i=new RegExp(n,"g"),o=r.match(i);return()=>{const t=o.shift();if(void 0===t)return[];const e=new RegExp(n).exec(t);return e.shift(),e.length?e:[t]}},gsub:function(t,e,r,n){let i=Et(t,"gsub",1);const o=void 0===n?1/0:_t(n,"gsub",3),a=Zt(Et(e,"gsub",2)),s="function"==typeof r?t=>{const e=r(t[0])[0];return void 0===e?t[0]:e}:r instanceof ht?t=>r.get(t[0]).toString():t=>`${r}`.replace(/%([0-9])/g,((e,r)=>t[r]));let c,u,l="",h=0;for(;h<o&&i&&(c=i.match(a));){const t=c[0].length>0?i.substr(0,c.index):void 0===u?"":i.substr(0,1);u=c[0],l+=`${t}${s(c)}`,i=i.substr(`${t}${u}`.length),h+=1}return`${l}${i}`},len:function(t){return Et(t,"len",1).length},lower:function(t){return Et(t,"lower",1).toLowerCase()},match:function(t,e,r=0){let n=Et(t,"match",1);const i=Et(e,"match",2),o=_t(r,"match",3);n=n.substr(o);const a=n.match(new RegExp(Zt(i)));if(a)return a[1]?(a.shift(),a):a[0]},rep:function(t,e,r){const n=Et(t,"rep",1),i=_t(e,"rep",2),o=void 0===r?"":Et(r,"rep",3);return Array(i).fill(n).join(o)},reverse:function(t){return Et(t,"reverse",1).split("").reverse().join("")},sub:function(t,e=1,r=-1){const n=Et(t,"sub",1);let i=gt(_t(e,"sub",2),n.length),o=gt(_t(r,"sub",3),n.length);return i<1&&(i=1),o>n.length&&(o=n.length),i<=o?n.substr(i-1,o-i+1):""},upper:function(t){return Et(t,"upper",1).toUpperCase()}}),qt=new ht({__index:Xt}),Jt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";function Qt(t,e){if(void 0===e)throw new lt("Bad argument #2 to ipairs() iterator");const r=e+1,n=t.numValues;if(n[r]&&void 0!==n[r])return[r,n[r]]}const te="Lua 5.3";function ee(t,e){if(vt(t))return[t,e];const r=void 0===e?"Assertion failed!":Et(e,"assert",2);throw new lt(r)}function re(){return[]}function ne(t){const e=Et(t,"error",1);throw new lt(e)}function ie(t){if(t instanceof ht&&t.metatable){return t.metatable.rawget("__metatable")||t.metatable}if("string"==typeof t)return qt}function oe(t){const e=At(t,"ipairs",1),r=e.getMetaMethod("__pairs")||e.getMetaMethod("__ipairs");return r?r(e).slice(0,3):[Qt,e,0]}function ae(t,e){const r=At(t,"next",1);let n=void 0===e;if(n||"number"==typeof e&&e>0){const t=r.numValues,i=Object.keys(t);let o=1;if(!n){const t=i.indexOf(`${e}`);t>=0&&(n=!0,o+=t)}if(n)for(;void 0!==i[o];o++){const e=Number(i[o]),r=t[e];if(void 0!==r)return[e,r]}}for(const t in r.strValues)if(Tt(r.strValues,t))if(n){if(void 0!==r.strValues[t])return[t,r.strValues[t]]}else t===e&&(n=!0);for(const t in r.keys)if(Tt(r.keys,t)){const i=r.keys[t];if(n){if(void 0!==r.values[t])return[i,r.values[t]]}else i===e&&(n=!0)}}function se(t){const e=At(t,"pairs",1),r=e.getMetaMethod("__pairs");return r?r(e).slice(0,3):[ae,e,void 0]}function ce(t,...e){if("function"!=typeof t)throw new lt("Attempt to call non-function");try{return[!0,...t(...e)]}catch(t){return[!1,t&&t.toString()]}}function ue(t,e){return t===e}function le(t,e){return At(t,"rawget",1).rawget(e)}function he(t){if(t instanceof ht)return t.getn();if("string"==typeof t)return t.length;throw new lt("attempt to get length of an unsupported value")}function fe(t,e,r){const n=At(t,"rawset",1);if(void 0===e)throw new lt("table index is nil");return n.rawset(e,r),n}function pe(t,...e){if("#"===t)return e.length;if("number"==typeof t){const r=gt(Math.trunc(t),e.length);return e.slice(r-1)}throw new lt(`bad argument #1 to 'select' (number expected, got ${dt(t)})`)}function de(t,e){const r=At(t,"setmetatable",1);if(r.metatable&&r.metatable.rawget("__metatable"))throw new lt("cannot change a protected metatable");return r.metatable=null==e?null:At(e,"setmetatable",2),r}function ye(t,e){const r=wt(t).trim(),n=void 0===e?10:_t(e,"tonumber",2);if(10!==n&&"nil"===r)throw new lt("bad argument #1 to 'tonumber' (string expected, got nil)");if(n<2||n>36)throw new lt("bad argument #2 to 'tonumber' (base out of range)");if(""!==r)return 10===n?bt(r):new RegExp(`^${16===n?"(0x)?":""}[${Jt.substr(0,n)}]*$`,"gi").test(r)?parseInt(r,n):void 0}function ge(t,e,...r){if("function"!=typeof t||"function"!=typeof e)throw new lt("Attempt to call non-function");try{return[!0,...t(...r)]}catch(t){return[!1,e(t)[0]]}}const me=(t,e,r,n)=>{const i=t instanceof ht&&t.getMetaMethod(r)||e instanceof ht&&e.getMetaMethod(r);return i?i(t,e)[0]:n(bt(t,"attempt to perform arithmetic on a %type value"),bt(e,"attempt to perform arithmetic on a %type value"))},ve=(t,e,r,n)=>"string"==typeof t&&"string"==typeof e||"number"==typeof t&&"number"==typeof e?n(t,e):me(t,e,r,n),be=t=>vt(t),we=(t,e)=>{const r=e!==t&&t instanceof ht&&e instanceof ht&&t.metatable===e.metatable&&t.getMetaMethod("__eq");return r?!!r(t,e)[0]:t===e},xe=(t,e)=>ve(t,e,"__lt",((t,e)=>t<e)),_e=(t,e)=>ve(t,e,"__le",((t,e)=>t<=e)),Ee={bool:be,and:(t,e)=>vt(t)?e:t,or:(t,e)=>vt(t)?t:e,not:t=>!be(t),unm:t=>{const e=t instanceof ht&&t.getMetaMethod("__unm");return e?e(t)[0]:-1*bt(t,"attempt to perform arithmetic on a %type value")},bnot:t=>{const e=t instanceof ht&&t.getMetaMethod("__bnot");return e?e(t)[0]:~bt(t,"attempt to perform arithmetic on a %type value")},len:t=>{if(t instanceof ht){const e=t.getMetaMethod("__len");return e?e(t)[0]:t.getn()}if("string"==typeof t)return t.length;throw new lt("attempt to get length of an unsupported value")},add:(t,e)=>me(t,e,"__add",((t,e)=>t+e)),sub:(t,e)=>me(t,e,"__sub",((t,e)=>t-e)),mul:(t,e)=>me(t,e,"__mul",((t,e)=>t*e)),mod:(t,e)=>me(t,e,"__mod",((t,e)=>{if(0===e||e===-1/0||e===1/0||isNaN(t)||isNaN(e))return NaN;const r=Math.abs(e);let n=Math.abs(t)%r;return t*e<0&&(n=r-n),e<0&&(n*=-1),n})),pow:(t,e)=>me(t,e,"__pow",Math.pow),div:(t,e)=>me(t,e,"__div",((t,e)=>{if(void 0===e)throw new lt("attempt to perform arithmetic on a nil value");return t/e})),idiv:(t,e)=>me(t,e,"__idiv",((t,e)=>{if(void 0===e)throw new lt("attempt to perform arithmetic on a nil value");return Math.floor(t/e)})),band:(t,e)=>me(t,e,"__band",((t,e)=>t&e)),bor:(t,e)=>me(t,e,"__bor",((t,e)=>t|e)),bxor:(t,e)=>me(t,e,"__bxor",((t,e)=>t^e)),shl:(t,e)=>me(t,e,"__shl",((t,e)=>t<<e)),shr:(t,e)=>me(t,e,"__shr",((t,e)=>t>>e)),concat:(t,e)=>{const r=t instanceof ht&&t.getMetaMethod("__concat")||e instanceof ht&&e.getMetaMethod("__concat");return r?r(t,e)[0]:`${wt(t,"attempt to concatenate a %type value")}${wt(e,"attempt to concatenate a %type value")}`},neq:(t,e)=>!we(t,e),eq:we,lt:xe,le:_e,gt:(t,e)=>!_e(t,e),ge:(t,e)=>!xe(t,e)},Ae=Number.MAX_SAFE_INTEGER,ke=Number.MIN_SAFE_INTEGER,Se=Math.PI;let Te=1;function Le(){return Te=16807*Te%2147483647,Te/2147483647}function Oe(t,e){const r=_t(t,"atan",1),n=void 0===e?1:_t(e,"atan",2);return Math.atan2(r,n)}function Ce(t){const e=_t(t,"exp",1);return Math.exp(e)}function Pe(t){const e=bt(t);if(void 0!==e)return Math.floor(e)}const Me=new ht({abs:function(t){const e=_t(t,"abs",1);return Math.abs(e)},acos:function(t){const e=_t(t,"acos",1);return Math.acos(e)},asin:function(t){const e=_t(t,"asin",1);return Math.asin(e)},atan:Oe,atan2:function(t,e){return Oe(t,e)},ceil:function(t){const e=_t(t,"ceil",1);return Math.ceil(e)},cos:function(t){const e=_t(t,"cos",1);return Math.cos(e)},cosh:function(t){const e=_t(t,"cosh",1);return(Ce(e)+Ce(-e))/2},deg:function(t){return 180*_t(t,"deg",1)/Math.PI},exp:Ce,floor:function(t){const e=_t(t,"floor",1);return Math.floor(e)},fmod:function(t,e){return _t(t,"fmod",1)%_t(e,"fmod",2)},frexp:function(t){let e=_t(t,"frexp",1);if(0===e)return[0,0];const r=e>0?1:-1;e*=r;const n=Math.floor(Math.log(e)/Math.log(2))+1;return[e/Math.pow(2,n)*r,n]},huge:1/0,ldexp:function(t,e){const r=_t(t,"ldexp",1),n=_t(e,"ldexp",2);return r*Math.pow(2,n)},log:function(t,e){const r=_t(t,"log",1);if(void 0===e)return Math.log(r);{const t=_t(e,"log",2);return Math.log(r)/Math.log(t)}},log10:function(t){const e=_t(t,"log10",1);return Math.log(e)/Math.log(10)},max:function(...t){const e=t.map(((t,e)=>_t(t,"max",e+1)));return Math.max(...e)},min:function(...t){const e=t.map(((t,e)=>_t(t,"min",e+1)));return Math.min(...e)},maxinteger:Ae,mininteger:ke,modf:function(t){const e=_t(t,"modf",1),r=Math.floor(e);return[r,e-r]},pi:Se,pow:function(t,e){const r=_t(t,"pow",1),n=_t(e,"pow",2);return Math.pow(r,n)},rad:function(t){const e=_t(t,"rad",1);return Math.PI/180*e},random:function(t,e){if(void 0===t&&void 0===e)return Le();const r=_t(t,"random",1),n=void 0!==e?r:1,i=void 0!==e?_t(e,"random",2):r;if(n>i)throw new Error("bad argument #2 to 'random' (interval is empty)");return Math.floor(Le()*(i-n+1)+n)},randomseed:function(t){Te=_t(t,"randomseed",1)},sin:function(t){const e=_t(t,"sin",1);return Math.sin(e)},sinh:function(t){const e=_t(t,"sinh",1);return(Ce(e)-Ce(-e))/2},sqrt:function(t){const e=_t(t,"sqrt",1);return Math.sqrt(e)},tan:function(t){const e=_t(t,"tan",1);return Math.tan(e)},tanh:function(t){const e=_t(t,"tanh",1);return(Ce(e)-Ce(-e))/(Ce(e)+Ce(-e))},tointeger:Pe,type:function(t){const e=bt(t);if(void 0!==e)return Pe(e)===e?"integer":"float"},ult:function(t,e){const r=_t(t,"ult",1),n=_t(e,"ult",2),i=t=>t>>>0;return i(r)<i(n)}});function Ie(t){return At(t,"maxn",1).numValues.length-1}const je=new ht({getn:function(t){return At(t,"getn",1).getn()},concat:function(t,e="",r=1,n){const i=At(t,"concat",1),o=Et(e,"concat",2),a=_t(r,"concat",3),s=void 0===n?Ie(i):_t(n,"concat",4);return[].concat(i.numValues).splice(a,s-a+1).join(o)},insert:function(t,e,r){const n=At(t,"insert",1),i=void 0===r?n.numValues.length:_t(e,"insert",2),o=void 0===r?e:r;n.numValues.splice(i,0,void 0),n.set(i,o)},maxn:Ie,move:function(t,e,r,n,i){const o=At(t,"move",1),a=_t(e,"move",2),s=_t(r,"move",3),c=_t(n,"move",4),u=void 0===i?o:At(i,"move",5);if(s>=a){if(a<=0&&s>=Number.MAX_SAFE_INTEGER+a)throw new lt("too many elements to move");const t=s-a+1;if(c>Number.MAX_SAFE_INTEGER-t+1)throw new lt("destination wrap around");if(c>s||c<=a||u!==o)for(let e=0;e<t;e++){const t=o.get(a+e);u.set(c+e,t)}else for(let e=t-1;e>=0;e--){const t=o.get(a+e);u.set(c+e,t)}}return u},pack:function(...t){const e=new ht(t);return e.rawset("n",t.length),e},remove:function(t,e){const r=At(t,"remove",1),n=r.getn(),i=void 0===e?n:_t(e,"remove",2);if(i>n||i<0)return;const o=r.numValues,a=o.splice(i,1)[0];let s=i;for(;s<n&&void 0===o[s];)delete o[s],s+=1;return a},sort:function(t,e){const r=At(t,"sort",1);let n;if(e){const t=kt(e,"sort",2);n=(e,r)=>vt(t(e,r)[0])?-1:1}else n=(t,e)=>t<e?-1:1;const i=r.numValues;i.shift(),i.sort(n).unshift(void 0)},unpack:function(t,e,r){const n=At(t,"unpack",1),i=void 0===e?1:_t(e,"unpack",2),o=void 0===r?n.getn():_t(r,"unpack",3);return n.numValues.slice(i,o+1)}}),Re=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Ne=["January","February","March","April","May","June","July","August","September","October","November","December"],Be=[31,28,31,30,31,30,31,31,30,31,30,31],De={"%":()=>"%",Y:(t,e)=>`${e?t.getUTCFullYear():t.getFullYear()}`,y:(t,e)=>De.Y(t,e).substr(-2),b:(t,e)=>De.B(t,e).substr(0,3),B:(t,e)=>Ne[e?t.getUTCMonth():t.getMonth()],m:(t,e)=>`0${(e?t.getUTCMonth():t.getMonth())+1}`.substr(-2),U:(t,e)=>Ue(t,0,e),W:(t,e)=>Ue(t,1,e),j:(t,e)=>{let r=e?t.getUTCDate():t.getDate();const n=e?t.getUTCMonth():t.getMonth(),i=e?t.getUTCFullYear():t.getFullYear();return r+=Be.slice(0,n).reduce(((t,e)=>t+e),0),n>1&&i%4==0&&(r+=1),`00${r}`.substr(-3)},d:(t,e)=>`0${e?t.getUTCDate():t.getDate()}`.substr(-2),a:(t,e)=>De.A(t,e).substr(0,3),A:(t,e)=>Re[e?t.getUTCDay():t.getDay()],w:(t,e)=>`${e?t.getUTCDay():t.getDay()}`,H:(t,e)=>`0${e?t.getUTCHours():t.getHours()}`.substr(-2),I:(t,e)=>`0${(e?t.getUTCHours():t.getHours())%12||12}`.substr(-2),M:(t,e)=>`0${e?t.getUTCMinutes():t.getMinutes()}`.substr(-2),S:(t,e)=>`0${e?t.getUTCSeconds():t.getSeconds()}`.substr(-2),c:(t,e)=>t.toLocaleString(void 0,e?{timeZone:"UTC"}:void 0),x:(t,e)=>`${De.m(t,e)}/${De.d(t,e)}/${De.y(t,e)}`,X:(t,e)=>`${De.H(t,e)}:${De.M(t,e)}:${De.S(t,e)}`,p:(t,e)=>(e?t.getUTCHours():t.getHours())<12?"AM":"PM",Z:(t,e)=>{if(e)return"UTC";const r=t.toString().match(/[A-Z][A-Z][A-Z]/);return r?r[0]:""}};function Fe(t){const e=t.getFullYear(),r=new Date(e,0);return t.getTimezoneOffset()!==r.getTimezoneOffset()}function Ue(t,e,r){const n=parseInt(De.j(t,r),10),i=new Date(t.getFullYear(),0,1,12),o=(8-(r?i.getUTCDay():i.getDay())+e)%7;return`0${Math.floor((n-o)/7)+1}`.substr(-2)}function ze(t="%c",e){const r="!"===t.substr(0,1),n=r?t.substr(1):t,i=new Date;return e&&i.setTime(1e3*e),"*t"===n?new ht({year:parseInt(De.Y(i,r),10),month:parseInt(De.m(i,r),10),day:parseInt(De.d(i,r),10),hour:parseInt(De.H(i,r),10),min:parseInt(De.M(i,r),10),sec:parseInt(De.S(i,r),10),wday:parseInt(De.w(i,r),10)+1,yday:parseInt(De.j(i,r),10),isdst:Fe(i)}):n.replace(/%[%YybBmUWjdaAwHIMScxXpZ]/g,(t=>De[t[1]](i,r)))}function Ge(t="C"){if("C"===t)return"C"}function We(t){let e=Math.round(Date.now()/1e3);if(!t)return e;const r=t.rawget("year"),n=t.rawget("month"),i=t.rawget("day"),o=t.rawget("hour")||12,a=t.rawget("min"),s=t.rawget("sec");return r&&(e+=31557600*r),n&&(e+=2629800*n),i&&(e+=86400*i),o&&(e+=3600*o),a&&(e+=60*a),s&&(e+=s),e}function Ve(t,e){return _t(t,"difftime",1)-_t(e,"difftime",2)}const $e=t=>new ht({date:ze,exit:function(e){if(!t.osExit)throw new lt("os.exit requires the config.osExit function");let r=0;"boolean"==typeof e&&!1===e?r=1:"number"==typeof e&&(r=e),t.osExit(r)},setlocale:Ge,time:We,difftime:Ve}),Ye=(t,e)=>{const r=e.LUA_PATH,n=["/",";","?","!","-"].join("\n"),i=new ht,o=new ht,a=(t,r,n,i)=>{if(!e.fileExists)throw new lt("package.searchpath requires the config.fileExists function");let o=Et(t,"searchpath",1);const a=Et(r,"searchpath",2),s=void 0===n?".":Et(n,"searchpath",3),c=void 0===i?"/":Et(i,"searchpath",4);o=o.replace(s,c);const u=a.split(";").map((t=>t.replace("?",o)));for(const t of u)if(e.fileExists(t))return t;return[void 0,`The following files don't exist: ${u.join(" ")}`]},s=new ht([t=>{const e=o.rawget(t);return void 0===e?[void 0]:[e]},r=>{const n=a(r,c.rawget("path"));if(Array.isArray(n)&&void 0===n[0])return[n[1]];if(!e.loadFile)throw new lt("package.searchers requires the config.loadFile function");return[(r,n)=>t(e.loadFile(n),r),n]}]),c=new ht({path:r,config:n,loaded:i,preload:o,searchers:s,searchpath:a});return{libPackage:c,_require:function(t){const e=Et(t,"require",1),r=i.rawget(e);if(r)return r;const n=s.numValues.filter((t=>!!t));for(const t of n){const r=t(e);if(void 0!==r[0]&&"string"!=typeof r[0]){const t=(0,r[0])(e,r[1]),n=void 0===t||t;return i.rawset(e,n),n}}throw new lt(`Module '${e}' not found!`)}}},Ke=(t,...e)=>{if(t instanceof Function)return St(t(...e));const r=t instanceof ht&&t.getMetaMethod("__call");if(r)return St(r(t,...e));throw new lt("attempt to call an uncallable type")},He=new ht;He.metatable=qt;const Ze=(t,e)=>{if(t instanceof ht)return t.get(e);if("string"==typeof t)return He.get(e);throw new lt("no table or metatable found for given type")},Xe=(t,e,r)=>{const n=new Function("__lua",e),i=new Ot(t.strValues).extend();r&&i.setVarargs([r]);const o=n(Object.assign(Object.assign({globalScope:i},Ee),{Table:ht,call:Ke,get:Ze}));return void 0===o?[void 0]:o};function qe(t={}){const e=Object.assign({LUA_PATH:"./?.lua",stdin:"",stdout:console.log},t),r=function(t,e){function r(t,r,n,o){let a,s="";if(t instanceof Function){let e=" ";for(;""!==e&&void 0!==e;)s+=e,e=t()[0]}else s=Et(t,"load",1);try{a=Kt(s)}catch(t){return[void 0,t.message]}return()=>e(o||i,a)}function n(e,n,i){const o=void 0===e?t.stdin:Et(e,"loadfile",1);if(!t.fileExists)throw new lt("loadfile requires the config.fileExists function");if(!t.fileExists(o))return[void 0,"file not found"];if(!t.loadFile)throw new lt("loadfile requires the config.loadFile function");return r(t.loadFile(o),0,0,i)}const i=new ht({_VERSION:te,assert:ee,dofile:function(t){const e=n(t);if(Array.isArray(e)&&void 0===e[0])throw new lt(e[1]);return e()},collectgarbage:re,error:ne,getmetatable:ie,ipairs:oe,load:r,loadfile:n,next:ae,pairs:se,pcall:ce,print:function(...e){const r=e.map((t=>yt(t))).join("\t");t.stdout(r)},rawequal:ue,rawget:le,rawlen:he,rawset:fe,select:pe,setmetatable:de,tonumber:ye,tostring:yt,type:dt,xpcall:ge});return i}(e,Xe),{libPackage:n,_require:i}=Ye(((t,e)=>Xe(r,Kt(t),e)[0]),e),o=n.get("loaded"),a=(t,e)=>{r.rawset(t,e),o.rawset(t,e)};a("_G",r),a("package",n),a("math",Me),a("table",je),a("string",Xt),a("os",$e(e)),r.rawset("require",i);const s=t=>{const e=Kt(t);return{exec:()=>Xe(r,e)[0]}};return{parse:s,parseFile:t=>{if(!e.fileExists)throw new lt("parseFile requires the config.fileExists function");if(!e.loadFile)throw new lt("parseFile requires the config.loadFile function");if(!e.fileExists(t))throw new lt("file not found");return s(e.loadFile(t))},loadLib:a}}function Je(t){return Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Je(t)}function Qe(){Qe=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==Je(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function tr(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function er(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function rr(t,e,r){return e&&er(t.prototype,e),r&&er(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function nr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ir=rr((function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),nr(this,"setScope",(function(t){r.scope=t})),nr(this,"getScope",(function(){return r.scope})),nr(this,"createEnv",(function(){return r.env=r.lua.createEnv(),r.env})),nr(this,"initLibrary",(function(){r.env||r.createEnv(),r.library=r.pixosLib.getLibrary(r.engine,r.scope),r.env.loadLib("pixos",r.library)})),nr(this,"run",function(){var t,e=(t=Qe().mark((function t(e){return Qe().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.env||r.createEnv(),r.library||r.initLibrary(),t.abrupt("return",r.env.parse(e).exec());case 3:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){tr(o,n,i,a,s,"next",t)}function s(t){tr(o,n,i,a,s,"throw",t)}a(void 0)}))});return function(t){return e.apply(this,arguments)}}()),this.engine=e,this.lua=n,this.pixosLib=new it(this.lua),this.scope={},this.env=null,this.library=null}));function or(t){return or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},or(t)}function ar(t,e,r){return ar=dr()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&pr(i,r.prototype),i},ar.apply(null,arguments)}function sr(t){return function(t){if(Array.isArray(t))return cr(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return cr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?cr(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ur(){ur=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==or(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function lr(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function hr(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){lr(o,n,i,a,s,"next",t)}function s(t){lr(o,n,i,a,s,"throw",t)}a(void 0)}))}}function fr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function pr(t,e){return pr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},pr(t,e)}function dr(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function yr(t){return yr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},yr(t)}var gr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pr(t,e)}(l,t);var e,r,n,i,o,a,s,c,u=(s=l,c=dr(),function(){var t,e=yr(s);if(c){var r=yr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===or(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function l(t,e,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),(n=u.call(this,t)).engine=t,n.json=e,n.zip=r,n.ActionLoader=cn,n}return e=l,r=[{key:"loadJson",value:(a=hr(ur().mark((function t(){var e,r=this;return ur().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.json.extends){t.next=4;break}return t.next=3,Promise.all(this.json.extends.map(function(){var t=hr(ur().mark((function t(e){var n;return ur().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=JSON,t.next=3,r.zip.file("sprites/"+e+".json").async("string");case 3:t.t1=t.sent,n=t.t0.parse.call(t.t0,t.t1),console.log({old:r.json,new:n}),r.json=(0,d.Ee)(r.json,n);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:this.json.extends=null;case 4:this.update(this.json),this.src=this.json.src,this.portraitSrc=this.json.portraitSrc,this.sheetSize=this.json.sheetSize,this.tileSize=this.json.tileSize,this.isLit=this.json.isLit,this.direction=this.json.direction,this.attenuation=this.json.attenuation,this.density=this.json.density,this.lightColor=this.json.lightColor,this.state=null!==(e=this.json.state)&&void 0!==e?e:"intro",this.frames=this.json.frames,this.drawOffset={},Object.keys(this.json.drawOffset).forEach((function(t){r.drawOffset[t]=ar(x.OW,sr(r.json.drawOffset[t]))})),this.hotspotOffset=ar(x.OW,sr(this.json.hotspotOffset)),this.bindCamera=this.json.bindCamera,this.enableSpeech=this.json.enableSpeech;case 21:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"interact",value:(o=hr(ur().mark((function t(e,r){var n,i,o,a,s=this;return ur().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=null,o=null!==(n=this.json.states)&&void 0!==n?n:[],a=["((_this, sprite, finish)=>{switch (_this.state) {\n "],t.next=5,Promise.all(o.map(function(){var t=hr(ur().mark((function t(r){var n,i;return ur().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.loadActionDynamically(r,e);case 2:n=t.sent,console.log({msg:"loading actionString",actionString:n}),i="case '"+r.name+"':\n\tconsole.log('switching state: "+r.name+"');\n\t_this.state = '"+r.next+"';"+n+"\nbreak;",a.push(i);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 5:return a.push("default:\n\tbreak;\n}});"),console.log({msg:"loading evalStatement",evalstatment:a.join("")}),console.log("TODO :: Add Lua Interpreter"),i=eval.call(this,a.join("")).call(this,this,e,r),r&&r(!1),t.abrupt("return",i);case 11:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"loadActionDynamically",value:(i=hr(ur().mark((function t(e,r){var n=this;return ur().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log({sprite:r,state:e}),t.next=3,Promise.all(e.actions.map(function(){var t=hr(ur().mark((function t(e){var r;return ur().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.callback||""===e.callback){t.next=6;break}return t.next=3,n.zip.file("callbacks/"+e.callback+".js").async("string");case 3:t.t0=t.sent.replace(/[\r\n]+/g,"").replace(/;$/,""),t.next=7;break;case 6:t.t0="";case 7:r=t.t0,t.t1=e.type,t.next="dialogue"===t.t1?11:"animate"===t.t1?12:13;break;case 11:return t.abrupt("return","\n\tconsole.log({_this, finish}); \n\t_this.addAction(new _this.ActionLoader(_this.engine, 'dialogue', ["+JSON.stringify(e.dialogue)+", false, { autoclose: true, onClose: () => finish(true) }], _this,"+r+"));\n");case 12:return t.abrupt("return","\n\tconsole.log({_this, finish}); \n\t_this.addAction(new _this.ActionLoader(_this.engine, 'animate', ["+e.animate.join(",")+", () => finish(true) ], _this,"+r+"));\n");case 13:return t.abrupt("return","");case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:return t.abrupt("return",t.sent.join("\n"));case 4:case"end":return t.stop()}}),t)}))),function(t,e){return i.apply(this,arguments)})},{key:"onStep",value:(n=hr(ur().mark((function t(e,r){var n,i,o,a,s,c,u;return ur().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.stepTrigger){t.next=2;break}return t.abrupt("return");case 2:if(console.log({trigger:this.stepTrigger}),t.prev=3,n=this.zip.file("triggers/".concat(this.stepTrigger,".lua")),console.log({msg:"trigger eval file",file:n}),n){t.next=8;break}throw new Error("No Lua Script Found");case 8:return t.next=10,n.async("string");case 10:return i=t.sent,console.log({msg:"trigger eval statement",luaScript:i}),console.log("TODO :: Add Lua Interpreter"),(o=new ir(this.engine)).setScope({_this:this,sprite:r}),o.initLibrary(),o.run('print("hello world lua")'),t.next=19,o.run(i);case 19:return a=t.sent,console.log({msg:"trigger eval response",ret:a}),t.abrupt("return",null);case 24:return t.prev=24,t.t0=t.catch(3),console.log({msg:"no lua script found",e:t.t0}),t.next=29,this.zip.file("triggers/".concat(this.stepTrigger,".js"));case 29:if(s=t.sent){t.next=32;break}throw new Error("No JS Script Found");case 32:return c=s.async("string"),console.log({msg:"trigger eval statement",evalStatement:c}),u=eval.call(this,c).call(this,this,r),console.log({msg:"trigger eval statement",ret:u}),t.abrupt("return",u);case 37:case"end":return t.stop()}}),t,this,[[3,24]])}))),function(t,e){return n.apply(this,arguments)})}],r&&fr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),l}(I);function mr(t){return mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mr(t)}function vr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function br(t,e){return br=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},br(t,e)}function wr(t){return wr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},wr(t)}var xr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&br(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=wr(n);if(i){var r=wr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===mr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e,r){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this,t,e,r)}return e=a,r=[{key:"init",value:function(){this.json.randomJitter?this.triggerTime=this.json.triggerTime+Math.floor(Math.random()*this.json.randomJitter):this.triggerTime=this.json.triggerTime}},{key:"tick",value:function(t){0!=this.lastTime?(this.accumTime+=t-this.lastTime,this.accumTime<this.frameTime||0==this.animFrame&&this.accumTime<this.triggerTime||(5==this.animFrame?(this.setFrame(0),this.triggerTime=1e3+Math.floor(4e3*Math.random())):(this.setFrame(this.animFrame+1),this.accumTime=0,this.lastTime=t))):this.lastTime=t}}],r&&vr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(gr);function _r(t){return _r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_r(t)}function Er(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ar(t,e){return Ar=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ar(t,e)}function kr(t){return kr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},kr(t)}var Sr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ar(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=kr(n);if(i){var r=kr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===_r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e,r){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this,t,e,r)}return e=a,r=[{key:"init",value:function(){this.json.randomJitter?this.triggerTime=this.json.triggerTime+Math.floor(Math.random()*this.json.randomJitter):this.triggerTime=this.json.triggerTime}},{key:"tick",value:function(t){0!=this.lastTime?(this.accumTime+=t-this.lastTime,this.accumTime<this.frameTime||0==this.animFrame&&this.accumTime<this.triggerTime||(4==this.animFrame?(this.setFrame(0),this.triggerTime=2e3+Math.floor(4e3*Math.random())):(this.setFrame(this.animFrame+1),this.accumTime=0,this.lastTime=t))):this.lastTime=t}},{key:"draw",value:function(t){var e;this.loaded&&(t.renderManager.mvPushMatrix(),(0,_.Iu)(t.renderManager.uModelMat,t.renderManager.uModelMat,this.pos.toArray()),(0,_.Iu)(t.renderManager.uModelMat,t.renderManager.uModelMat,(null!==(e=this.drawOffset[t.renderManager.camera.cameraDir])&&void 0!==e?e:this.drawOffset.N).toArray()),(0,_.U1)(t.renderManager.uModelMat,t.renderManager.uModelMat,(0,x.Id)(90),[1,0,0]),t.renderManager.bindBuffer(this.vertexPosBuf,t.renderManager.shaderProgram.aVertexPosition),t.renderManager.bindBuffer(this.vertexTexBuf,t.renderManager.shaderProgram.aTextureCoord),this.texture.attach(),t.renderManager.shaderProgram.setMatrixUniforms(),t.gl.drawArrays(t.gl.TRIANGLES,0,this.vertexPosBuf.numItems),t.renderManager.mvPopMatrix())}}],r&&Er(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(gr);function Tr(t){return Tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tr(t)}function Lr(){Lr=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==Tr(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Or(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function Cr(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){Or(o,n,i,a,s,"next",t)}function s(t){Or(o,n,i,a,s,"throw",t)}a(void 0)}))}}function Pr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Mr=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.engine=e,this.definitions=[],this.instances={}}var e,r,n;return e=t,r=[{key:"loadFromZip",value:(n=Cr(Lr().mark((function t(e,r,n){var i,o,a,s,c=arguments;return Lr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("loading sprite from zip: "+r+" for "+n),i=c[3],o=c[4],this.instances[r]||(this.instances[r]=[]),a="",t.prev=5,t.t0=JSON,t.next=9,e.file("sprites/".concat(r,".json")).async("string");case 9:t.t1=t.sent,a=t.t0.parse.call(t.t0,t.t1),t.next=16;break;case 13:t.prev=13,t.t2=t.catch(5),console.error(t.t2);case 16:s={},t.t3=a.type,t.next="animated-sprite"===t.t3?20:"animated-tile"===t.t3?24:"avatar"===t.t3?28:32;break;case 20:return s=new xr(this.engine,a,e),t.next=23,s.loadJson();case 23:return t.abrupt("break",36);case 24:return s=new Sr(this.engine,a,e),t.next=27,s.loadJson();case 27:return t.abrupt("break",36);case 28:return s=new J(this.engine,a,e),t.next=31,s.loadJson();case 31:return t.abrupt("break",36);case 32:return s=new gr(this.engine,a,e),t.next=35,s.loadJson();case 35:return t.abrupt("break",36);case 36:if(s.templateLoaded=!0,this.instances[r].forEach(function(){var t=Cr(Lr().mark((function t(e){return Lr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.afterLoad){t.next=3;break}return t.next=3,e.afterLoad(e.instance);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),!o){t.next=41;break}return t.next=41,o(s);case 41:if(!i){t.next=48;break}if(!s.templateLoaded){t.next=47;break}return t.next=45,i(s);case 45:t.next=48;break;case 47:this.instances[r].push({instance:s,afterLoad:i});case 48:return t.abrupt("return",s);case 49:case"end":return t.stop()}}),t,this,[[5,13]])}))),function(t,e,r){return n.apply(this,arguments)})}],r&&Pr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Ir=(r(6185),r(8352));function jr(t){return jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jr(t)}function Rr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Nr(t,e,r){return Nr=Wr()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&zr(i,r.prototype),i},Nr.apply(null,arguments)}function Br(){Br=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==jr(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Dr(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function Fr(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){Dr(o,n,i,a,s,"next",t)}function s(t){Dr(o,n,i,a,s,"throw",t)}a(void 0)}))}}function Ur(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function zr(t,e){return zr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},zr(t,e)}function Gr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Wr(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Vr(t){return Vr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Vr(t)}var $r=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zr(t,e)}(l,t);var e,r,n,o,a,s,c,u=(s=l,c=Wr(),function(){var t,e=Vr(s);if(c){var r=Vr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===jr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Gr(t)}(this,t)});function l(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),(e=u.call(this)).engine=t,e.templateLoaded=!1,e.drawOffset=new x.OW(0,0,0),e.hotspotOffset=new x.OW(0,0,0),e.pos=new x.OW(0,0,0),e.size=new x.OW(1,1,1),e.scale=new x.OW(1,1,1),e.rotation=new x.OW(0,0,0),e.facing=d.Nm.Right,e.actionDict={},e.actionList=[],e.speech={},e.portrait=null,e.isLit=!0,e.lightColor=[1,1,1],e.lightIndex=null,e.onLoadActions=new i.Z,e.inventory=[],e.onTilesetOrTextureLoaded=e.onTilesetOrTextureLoaded.bind(Gr(e)),e.blocking=!0,e.override=!1,e}return e=l,r=[{key:"onLoad",value:function(t){if(!this.loaded){this.zone=t.zone,t.id&&(this.id=t.id),t.pos&&(this.pos=t.pos),t.isLit&&(this.isLit=t.isLit),t.lightColor&&(this.lightColor=t.lightColor),t.attenuation&&(this.attenuation=t.attenuation),t.direction&&(this.direction=t.direction),t.rotation&&(this.rotation=t.rotation),t.facing&&0!==t.facing&&(this.facing=t.facing),t.zones&&null!==t.zones&&(this.zones=t.zones);for(var e,r,n,i=t.mesh,o=null,a=null,s=null,c=0;c<i.vertices.length;c+=3){var u=i.vertices.slice(c,c+3);(null==e||u[0]>e)&&(e=u[0]),(null==o||u[0]<o)&&(o=u[0]),(null==r||u[1]>r)&&(r=u[1]),(null==a||u[1]<a)&&(a=u[1]),(null==n||u[2]>n)&&(n=u[2]),(null==s||u[2]<s)&&(s=u[2])}var l=new x.OW(e-o,n-s,r-a);this.size=l,this.scale=new x.OW(1/Math.max(l.x,l.z),1/Math.max(l.x,l.z),1/Math.max(l.x,l.z)),t.useScale&&(this.scale=t.useScale),this.drawOffset=new x.OW(.5,.5,0),this.mesh=i,this.engine.resourceManager.objLoader.initMeshBuffers(this.engine.gl,this.mesh),this.enableSpeech&&(this.speech=this.engine.resourceManager.loadSpeech(this.id,this.engine.mipmap),this.speech.runWhenLoaded(this.onTilesetOrTextureLoaded.bind(this)),this.speechTexBuf=this.engine.renderManager.createBuffer(this.getSpeechBubbleTexture(),this.engine.gl.DYNAMIC_DRAW,2)),this.portraitSrc&&(this.portrait=this.engine.resourceManager.loadTexture(this.portraitSrc),this.portrait.runWhenLoaded(this.onTilesetOrTextureLoaded.bind(this))),this.isLit&&(this.lightIndex=this.engine.renderManager.lightManager.addLight(this.id,this.pos.toArray(),this.lightColor,[.01,.01,.01])),this.zone.tileset.runWhenDefinitionLoaded(this.onTilesetDefinitionLoaded.bind(this))}}},{key:"onLoadFromZip",value:(a=Fr(Br().mark((function t(e,r){var n,i,o,a,s,c,u,l,h,f;return Br().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.loaded){t.next=2;break}return t.abrupt("return");case 2:for(this.zone=e.zone,e.id&&(this.id=e.id),e.pos&&(this.pos=e.pos),e.isLit&&(this.isLit=e.isLit),e.lightColor&&(this.lightColor=e.lightColor),e.attenuation&&(this.attenuation=e.attenuation),e.density&&(this.density=e.density),e.scatteringCoefficients&&(this.scatteringCoefficients=e.scatteringCoefficients),e.direction&&(this.direction=e.direction),e.rotation&&(this.rotation=e.rotation),e.facing&&0!==e.facing&&(this.facing=e.facing),e.zones&&null!==e.zones&&(this.zones=e.zones),n=e.mesh,o=null,s=null,u=null,l=0;l<n.vertices.length;l+=3)h=n.vertices.slice(l,l+3),(null==i||h[0]>i)&&(i=h[0]),(null==o||h[0]<o)&&(o=h[0]),(null==a||h[1]>a)&&(a=h[1]),(null==s||h[1]<s)&&(s=h[1]),(null==c||h[2]>c)&&(c=h[2]),(null==u||h[2]<u)&&(u=h[2]);if(f=new x.OW(i-o,c-u,a-s),this.size=f,this.scale=new x.OW(1/Math.max(f.x,f.z),1/Math.max(f.x,f.z),1/Math.max(f.x,f.z)),e.useScale&&(this.scale=e.useScale),this.drawOffset=new x.OW(.5,.5,0),this.mesh=n,this.engine.resourceManager.objLoader.initMeshBuffers(this.engine.gl,this.mesh),this.enableSpeech&&(this.speech=this.engine.resourceManager.loadSpeech(this.id,this.engine.mipmap),this.speech.runWhenLoaded(this.onTilesetOrTextureLoaded.bind(this)),this.speechTexBuf=this.engine.renderManager.createBuffer(this.getSpeechBubbleTexture(),this.engine.gl.DYNAMIC_DRAW,2)),!this.portraitSrc){t.next=32;break}return t.next=30,this.engine.resourceManager.loadTextureFromZip(this.portraitSrc,r);case 30:this.portrait=t.sent,this.portrait.runWhenLoaded(this.onTilesetOrTextureLoaded.bind(this));case 32:this.isLit&&(this.lightIndex=this.engine.renderManager.lightManager.addLight(this.id,this.pos.toArray(),this.lightColor,this.attenuation,this.direction,this.density,this.scatteringCoefficients,!0)),this.zone.tileset.runWhenDefinitionLoaded(this.onTilesetDefinitionLoaded.bind(this));case 34:case"end":return t.stop()}}),t,this)}))),function(t,e){return a.apply(this,arguments)})},{key:"onTilesetDefinitionLoaded",value:function(){this.zone.tileset.runWhenLoaded(this.onTilesetOrTextureLoaded.bind(this))}},{key:"onTilesetOrTextureLoaded",value:function(){!this||this.loaded||this.enableSpeech&&this.speech&&!this.speech.loaded||this.portrait&&!this.portrait.loaded||(this.init(),this.enableSpeech&&this.speech&&this.speech.clearHud&&(this.speech.clearHud(),this.speech.writeText(this.id),this.speech.loadImage()),this.loaded=!0,this.onLoadActions.run())}},{key:"getSpeechBubbleTexture",value:function(){return[[1,1],[0,1],[0,0],[1,1],[0,0],[1,0]].flat(3)}},{key:"getSpeechBubbleVertices",value:function(){return[Nr(x.OW,[2,0,4]).toArray(),Nr(x.OW,[0,0,4]).toArray(),Nr(x.OW,[0,0,2]).toArray(),Nr(x.OW,[2,0,4]).toArray(),Nr(x.OW,[0,0,2]).toArray(),Nr(x.OW,[2,0,2]).toArray()].flat(3)}},{key:"attach",value:function(t){var e=this.engine.gl;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(this.engine.renderManager.shaderProgram.diffuseMapUniform,0)}},{key:"drawTexturedObj",value:function(){var t=this,e=this.engine,r=this.mesh;r.indicesPerMaterial.length>=1&&Object.keys(r.materialsByIndex).length>0?r.indicesPerMaterial.forEach((function(n,i){var o,a;e.renderManager.bindBuffer(r.vertexBuffer,e.renderManager.shaderProgram.aVertexPosition),e.renderManager.bindBuffer(r.textureBuffer,e.renderManager.shaderProgram.aTextureCoord),e.renderManager.bindBuffer(r.normalBuffer,e.renderManager.shaderProgram.aVertexNormal),e.gl.uniform3fv(e.renderManager.shaderProgram.uDiffuse,r.materialsByIndex[i].diffuse),e.gl.uniform1f(e.renderManager.shaderProgram.uSpecularExponent,r.materialsByIndex[i].specularExponent),null!==(o=r.materialsByIndex[i])&&void 0!==o&&null!==(a=o.mapDiffuse)&&void 0!==a&&a.glTexture&&t.attach(r.materialsByIndex[i].mapDiffuse.glTexture),e.gl.uniform3fv(e.renderManager.shaderProgram.uSpecular,r.materialsByIndex[i].specular),e.gl.uniform1f(e.renderManager.shaderProgram.uSpecularExponent,r.materialsByIndex[i].specularExponent);var s=(0,Ir._buildBuffer)(e.gl,e.gl.ELEMENT_ARRAY_BUFFER,n,1);e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,s),e.renderManager.shaderProgram.setMatrixUniforms(t.scale,0),e.gl.drawElements(e.gl.TRIANGLES,s.numItems,e.gl.UNSIGNED_SHORT,0)})):(e.renderManager.bindBuffer(r.vertexBuffer,e.renderManager.shaderProgram.aVertexPosition),e.renderManager.bindBuffer(r.normalBuffer,e.renderManager.shaderProgram.aVertexNormal),e.renderManager.bindBuffer(r.textureBuffer,e.renderManager.shaderProgram.aTextureCoord),e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,r.indexBuffer),e.gl.uniform3fv(e.renderManager.shaderProgram.uDiffuse,[.6,.3,.6]),e.gl.uniform3fv(e.renderManager.shaderProgram.uSpecular,[.1,.1,.2]),e.gl.uniform1f(e.renderManager.shaderProgram.uSpecularExponent,2),e.renderManager.shaderProgram.setMatrixUniforms(this.scale,0),e.gl.drawElements(e.gl.TRIANGLES,r.indexBuffer.numItems,e.gl.UNSIGNED_SHORT,0))}},{key:"drawObj",value:function(){var t=this.engine,e=this.mesh;t.gl.disableVertexAttribArray(t.renderManager.shaderProgram.aTextureCoord),t.renderManager.bindBuffer(e.vertexBuffer,t.renderManager.shaderProgram.aVertexPosition),t.renderManager.bindBuffer(e.normalBuffer,t.renderManager.shaderProgram.aVertexNormal),t.gl.bindBuffer(t.gl.ELEMENT_ARRAY_BUFFER,e.indexBuffer),t.renderManager.shaderProgram.setMatrixUniforms(this.scale,1),t.gl.drawElements(t.gl.TRIANGLES,e.indexBuffer.numItems,t.gl.UNSIGNED_SHORT,0)}},{key:"draw",value:function(){if(this.loaded){var t=this.engine,e=this.mesh;if(t.gl.enableVertexAttribArray(t.renderManager.shaderProgram.aVertexNormal),t.gl.enableVertexAttribArray(t.renderManager.shaderProgram.aTextureCoord),t.renderManager.mvPushMatrix(),(0,_.Iu)(this.engine.renderManager.uModelMat,this.engine.renderManager.uModelMat,this.drawOffset.toArray()),(0,_.Iu)(this.engine.renderManager.uModelMat,this.engine.renderManager.uModelMat,this.pos.toArray()),(0,_.U1)(this.engine.renderManager.uModelMat,this.engine.renderManager.uModelMat,(0,x.Id)(90),[1,0,0]),this.rotation&&this.rotation.toArray){var r=Math.max.apply(Math,function(t){if(Array.isArray(t))return Rr(t)}(n=this.rotation.toArray())||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return Rr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Rr(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());r>0&&(0,_.U1)(this.engine.renderManager.uModelMat,this.engine.renderManager.uModelMat,(0,x.Id)(r),[this.rotation.x/r,this.rotation.y/r,this.rotation.z/r])}e.textures.length?this.drawTexturedObj():this.drawObj(),t.renderManager.mvPopMatrix(),t.gl.enableVertexAttribArray(t.renderManager.shaderProgram.aTextureCoord),t.gl.disableVertexAttribArray(t.renderManager.shaderProgram.aVertexNormal)}var n}},{key:"setFacing",value:function(t){t&&(this.facing=t),this.rotation=d.Nm.objectSequence(t)}},{key:"addAction",value:(o=Fr(Br().mark((function t(e){return Br().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve(e);case 2:e=t.sent,this.actionDict[e.id]&&this.removeAction(e.id),this.actionDict[e.id]=e,this.actionList.push(e);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"removeAction",value:function(t){this.actionList=this.actionList.filter((function(e){return e.id!==t})),delete this.actionDict[t]}},{key:"removeAllActions",value:function(){this.actionList=[],this.actionDict={}}},{key:"tickOuter",value:function(t){var e=this;if(this.loaded){this.actionList.sort((function(t,e){var r=t.startTime-e.startTime;return r?t.id>e.id?1:-1:r}));var r=[];this.actionList.forEach((function(e){!e.loaded||e.startTime>t||e.tick(t)&&(r.push(e),e.onComplete())})),r.forEach((function(t){return e.removeAction(t.id)})),this.tick&&this.tick(t)}}},{key:"init",value:function(){console.log("- object hook",this.id,this.pos)}},{key:"speak",value:function(t){var e,r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?(this.textbox=this.engine.hud.scrollText(this.id+":> "+t,!0,{portrait:null!==(e=this.portrait)&&void 0!==e&&e}),n&&this.speech&&(this.speech.scrollText(t,!1,{portrait:null!==(r=this.portrait)&&void 0!==r&&r}),this.speech.loadImage())):this.speech.clearHud()}},{key:"interact",value:(n=Fr(Br().mark((function t(e,r){var n;return Br().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=null,t.t0=this.state,t.next=4;break;case 4:return t.abrupt("break",5);case 5:return r&&r(!0),t.abrupt("return",n);case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"faceDir",value:function(t){return this.facing==t||t===d.Nm.None?null:new cn(this.engine,"face",[t],this)}},{key:"setGreeting",value:function(t){return this.speech.clearHud&&this.speech.clearHud(),this.speech.writeText(t),this.speech.loadImage(),new cn(this.engine,"greeting",[t,{autoclose:!0}],this)}}],r&&Ur(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),l}(o.Z);function Yr(t){return Yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yr(t)}function Kr(){Kr=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==Yr(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Hr(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function Zr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Xr=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.engine=e,this.definitions=[],this.instances={}}var e,r,n,i;return e=t,r=[{key:"loadFromZip",value:(n=Kr().mark((function t(e,r){var n,i,o,a,s,c,u=arguments;return Kr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=u[2],o=u[3],this.instances[r.id]||(this.instances[r.id]=[]),(a=new $r(this.engine)).update(r),s={obj:"".concat(a.type,".obj"),mtl:null!==(n=r.mtl)&&void 0!==n&&n,mtlTextureRoot:"textures",downloadMtlTextures:!0,enableWTextureCoord:!1,name:a.id},t.next=8,this.engine.resourceManager.objLoader.downloadModelsFromZip(this.engine.gl,[s],e);case 8:return c=t.sent,a.mesh=c[r.type],a.templateLoaded=!0,this.instances[a.id].forEach((function(t){t.afterLoad&&t.afterLoad(t.instance)})),o&&o(a),i&&(a.templateLoaded?i(a):this.instances[a.id].push({instance:a,afterLoad:i})),a.loaded=!0,t.abrupt("return",a);case 16:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,e=arguments;return new Promise((function(r,i){var o=n.apply(t,e);function a(t){Hr(o,r,i,a,s,"next",t)}function s(t){Hr(o,r,i,a,s,"throw",t)}a(void 0)}))},function(t,e){return i.apply(this,arguments)})}],r&&Zr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function qr(t){return qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qr(t)}function Jr(){Jr=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==qr(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Qr(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function tn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var en=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=e,this.sprite=r,this.callback=n,this.time=(new Date).getTime(),this.id=r.id+"-"+e+"-"+this.time}var e,r,n,i;return e=t,r=[{key:"configure",value:function(t,e,r,n,i){this.sprite=e,this.id=r,this.type=t,this.startTime=n,this.creationArgs=i}},{key:"onLoad",value:(n=Jr().mark((function t(e){return Jr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.init.apply(this,e);case 2:this.loaded=!0;case 3:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,e=arguments;return new Promise((function(r,i){var o=n.apply(t,e);function a(t){Qr(o,r,i,a,s,"next",t)}function s(t){Qr(o,r,i,a,s,"throw",t)}a(void 0)}))},function(t){return i.apply(this,arguments)})},{key:"serialize",value:function(){return{id:this.id,time:this.startTime,zone:this.sprite.zone.id,sprite:this.sprite.id,type:this.type,args:this.creationArgs}}},{key:"onComplete",value:function(){return this.callback?this.callback():null}}],r&&tn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function rn(t){return rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rn(t)}function nn(){nn=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==rn(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function on(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function an(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){on(o,n,i,a,s,"next",t)}function s(t){on(o,n,i,a,s,"throw",t)}a(void 0)}))}}function sn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var cn=function(){function t(e,r,n,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.engine=e,this.type=r,this.args=n,this.sprite=i,this.callback=o,this.instances={},this.definitions=[],this.assets={};var a=(new Date).getTime(),s=i.id+"-"+r+"-"+a;return this.load(r,function(){var t=an(nn().mark((function t(e){return nn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.onLoad(n);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),(function(t){t.configure(r,i,s,a,n)}))}var e,n,i;return e=t,n=[{key:"load",value:(i=an(nn().mark((function t(e){var n,i,o,a=arguments;return nn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a[1],i=a[2],this.instances[e]||(this.instances[e]=[]),o=new en(this.type,this.sprite,this.callback),Object.assign(o,r(3333)("./"+e+".jsx").default),o.templateLoaded=!0,t.next=8,Promise.all(this.instances[e].map(function(){var t=an(nn().mark((function t(e){return nn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.afterLoad){t.next=3;break}return t.next=3,e.afterLoad(e.instance);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 8:return i&&i(o),n&&(o.templateLoaded?n(o):this.instances[e].push({instance:o,afterLoad:n})),t.abrupt("return",o);case 11:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})}],n&&sn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function un(t){return un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},un(t)}function ln(){ln=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==un(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function hn(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function fn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var pn=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=e,this.world=r,this.callback=n,this.time=(new Date).getTime(),this.id=r.id+"-"+e+"-"+this.time}var e,r,n,i;return e=t,r=[{key:"configure",value:function(t,e,r,n,i){this.world=e,this.id=r,this.type=t,this.startTime=n,this.creationArgs=i}},{key:"onLoad",value:(n=ln().mark((function t(e){return ln().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.init.apply(this,e);case 2:this.loaded=!0;case 3:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,e=arguments;return new Promise((function(r,i){var o=n.apply(t,e);function a(t){hn(o,r,i,a,s,"next",t)}function s(t){hn(o,r,i,a,s,"throw",t)}a(void 0)}))},function(t){return i.apply(this,arguments)})},{key:"serialize",value:function(){return{id:this.id,time:this.startTime,world:this.world.id,type:this.type,args:this.creationArgs}}},{key:"onComplete",value:function(){return this.callback?this.callback():null}}],r&&fn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function dn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var yn=function(){function t(e,r,n,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.engine=e,this.type=r,this.args=n,this.world=i,this.callback=o,this.instances={},this.definitions=[],this.assets={};var a=(new Date).getTime(),s=i.id+"-"+r+"-"+a;return this.load(r,(function(t){t.onLoad(n)}),(function(t){t.configure(r,i,s,a,n)}))}var e,n;return e=t,n=[{key:"load",value:function(t){var e=arguments[1],n=arguments[2];this.instances[t]||(this.instances[t]=[]);var i=new pn(this.type,this.world,this.callback);return Object.assign(i,r(4472)("./"+t+".jsx").default),i.templateLoaded=!0,this.instances[t].forEach((function(t){t.afterLoad&&t.afterLoad(t.instance)})),n&&n(i),e&&(i.templateLoaded?e(i):this.instances[t].push({instance:i,afterLoad:e})),i}}],n&&dn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();r(2846)},9175:(t,e,r)=>{"use strict";function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o=[],a=!0,s=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}}(t,e)||i(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){if(t){if("string"==typeof t)return o(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}r.d(e,{Ez:()=>s,Fv:()=>d,G3:()=>c,Iu:()=>u,U1:()=>h,Ue:()=>a,XL:()=>p,fk:()=>l,t8:()=>f});var a=function(){var t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},s=function(){var t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t},c=function(t,e,r,n){var i=new Float32Array(16),o=1/Math.tan(t/2);if(i[0]=o/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=-1,i[11]=-1,i[12]=0,i[13]=0,i[14]=-2*r,i[15]=0,null!=n&&n!==1/0&&n!==r){var a=1/(r-n);i[10]=(n+r)*a,i[14]=2*n*r*a}return i},u=function(t,e,r){var i=t,o=n(r,3),a=o[0],s=o[1],c=o[2],u=n(e,12),l=u[0],h=u[1],f=u[2],p=u[3],d=u[4],y=u[5],g=u[6],m=u[7],v=u[8],b=u[9],w=u[10],x=u[11];return t!==e&&(i[0]=l,i[1]=h,i[2]=f,i[3]=p,i[4]=d,i[5]=y,i[6]=g,i[7]=m,i[8]=v,i[9]=b,i[10]=w,i[11]=x),i[12]=l*a+d*s+v*c+e[12],i[13]=h*a+y*s+b*c+e[13],i[14]=f*a+g*s+w*c+e[14],i[15]=p*a+m*s+x*c+e[15],i},l=function(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]},h=function(t,e,r,i){var o=t,a=n(i,3),s=a[0],c=a[1],u=a[2],l=Math.hypot(s,c,u);if(l<1e-6)throw new Error("Matrix4*4 rotate has wrong axis");s*=l=1/l,c*=l,u*=l;var h=Math.sin(r),f=Math.cos(r),p=1-f,d=n(e,12),y=d[0],g=d[1],m=d[2],v=d[3],b=d[4],w=d[5],x=d[6],_=d[7],E=d[8],A=d[9],k=d[10],S=d[11],T=s*s*p+f,L=c*s*p+u*h,O=u*s*p-c*h,C=s*c*p-u*h,P=c*c*p+f,M=u*c*p+s*h,I=s*u*p+c*h,j=c*u*p-s*h,R=u*u*p+f;return o[0]=y*T+b*L+E*O,o[1]=g*T+w*L+A*O,o[2]=m*T+x*L+k*O,o[3]=v*T+_*L+S*O,o[4]=y*C+b*P+E*M,o[5]=g*C+w*P+A*M,o[6]=m*C+x*P+k*M,o[7]=v*C+_*P+S*M,o[8]=y*I+b*j+E*R,o[9]=g*I+w*j+A*R,o[10]=m*I+x*j+k*R,o[11]=v*I+_*j+S*R,e!==t&&(o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o};function f(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function p(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],u=e[7],l=e[8],h=e[9],f=e[10],p=e[11],d=e[12],y=e[13],g=e[14],m=e[15],v=r*s-n*a,b=r*c-i*a,w=r*u-o*a,x=n*c-i*s,_=n*u-o*s,E=i*u-o*c,A=l*y-h*d,k=l*g-f*d,S=l*m-p*d,T=h*g-f*y,L=h*m-p*y,O=f*m-p*g,C=v*O-b*L+w*T+x*S-_*k+E*A;return C?(C=1/C,t[0]=(s*O-c*L+u*T)*C,t[1]=(c*S-a*O-u*k)*C,t[2]=(a*L-s*S+u*A)*C,t[3]=(i*L-n*O-o*T)*C,t[4]=(r*O-i*S+o*k)*C,t[5]=(n*S-r*L-o*A)*C,t[6]=(y*E-g*_+m*x)*C,t[7]=(g*w-d*E-m*b)*C,t[8]=(d*_-y*w+m*v)*C,t):null}var d=function(t){var e,r=Math.hypot.apply(Math,function(t){if(Array.isArray(t))return o(t)}(e=t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return[t[0]/r,t[1]/r,t[2]/r]}},8348:(t,e,r)=>{"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}r.d(e,{Id:()=>h,Lt:()=>s,OW:()=>a,t7:()=>l,t8:()=>c,tk:()=>u});var a=function(){function t(e,r,i){n(this,t),this.x=e,this.y=r,this.z=i}return o(t,[{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)}},{key:"sub",value:function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)}},{key:"mul",value:function(e){return new t(this.x*e,this.y*e,this.z*e)}},{key:"mul3",value:function(e){return new t(this.x*e.x,this.y*e.y,this.z*e.z)}},{key:"cross",value:function(e){return new t(this.x*e.x-this.y*e.y,this.y*e.y+this.x*e.x,this.z*e.z)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distance",value:function(t){return this.sub(t).length()}},{key:"normal",value:function(){if(0===this.x&&0===this.y&&0===this.z)return new t(0,0,0);var e=this.length();return new t(this.x/e,this.y/e,this.z/e)}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"toString",value:function(){return"( ".concat(this.x,", ").concat(this.y,", ").concat(this.z," )")}},{key:"negate",value:function(){return new t(-1*this.x,-1*this.y,-1*this.z)}}]),t}(),s=function(){function t(e,r,i,o){n(this,t),this.x=e,this.y=r,this.z=i,this.w=o}return o(t,[{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)}},{key:"sub",value:function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)}},{key:"mul",value:function(e){return new t(this.x*e,this.y*e,this.z*e,this.w*e)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"distance",value:function(t){return this.sub(t).length()}},{key:"normal",value:function(){if(0===this.x&&0===this.y&&0===this.z&&0===this.w)return new t(0,0,0,0);var e=this.length();return new t(this.x/e,this.y/e,this.z/e,this.w/e)}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"toArray",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"toString",value:function(){return"( ".concat(this.x,", ").concat(this.y,", ").concat(this.z,", ").concat(this.w," )")}},{key:"negate",value:function(){return new a(-1*this.x,-1*this.y,-1*this.z,-1*this.w)}}]),t}();function c(t,e){e.x=t.x,e.y=t.y,e.z=t.z}function u(t,e){return e||(e=new a(-t.x,-t.y,-t.z)),e.x=-t.x,e.y=-t.y,e.z=-t.z,e}function l(t,e,r,n){return n||(n=t),n.x=t.x+r*(e.x-t.x),n.y=t.y+r*(e.y-t.y),n.z=t.z+r*(e.z-t.z),n}function h(t){return t*Math.PI/180}},6185:(t,e,r)=>{"use strict";r.d(e,{Z:()=>n});const n={tilesetRequestUrl:function(t){return"/pixos/tilesets/"+t+"/tileset.json"},zoneRequestUrl:function(t){return"/pixos/maps/"+t+"/map.json"},artResourceUrl:function(t){return"/pixos/art/"+t}}},9742:(t,e)=>{"use strict";e.byteLength=function(t){var e=s(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){var e,r,o=s(t),a=o[0],c=o[1],u=new i(function(t,e,r){return 3*(e+r)/4-r}(0,a,c)),l=0,h=c>0?a-4:a;for(r=0;r<h;r+=4)e=n[t.charCodeAt(r)]<<18|n[t.charCodeAt(r+1)]<<12|n[t.charCodeAt(r+2)]<<6|n[t.charCodeAt(r+3)],u[l++]=e>>16&255,u[l++]=e>>8&255,u[l++]=255&e;return 2===c&&(e=n[t.charCodeAt(r)]<<2|n[t.charCodeAt(r+1)]>>4,u[l++]=255&e),1===c&&(e=n[t.charCodeAt(r)]<<10|n[t.charCodeAt(r+1)]<<4|n[t.charCodeAt(r+2)]>>2,u[l++]=e>>8&255,u[l++]=255&e),u},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,o=[],a=16383,s=0,u=n-i;s<u;s+=a)o.push(c(t,s,s+a>u?u:s+a));return 1===i?(e=t[n-1],o.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],o.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),o.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0;a<64;++a)r[a]=o[a],n[o.charCodeAt(a)]=a;function s(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function c(t,e,n){for(var i,o,a=[],s=e;s<n;s+=3)i=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),a.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return a.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},8764:(t,e,r)=>{"use strict";const n=r(9742),i=r(645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=c,e.SlowBuffer=function(t){return+t!=t&&(t=0),c.alloc(+t)},e.INSPECT_MAX_BYTES=50;const a=2147483647;function s(t){if(t>a)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,c.prototype),e}function c(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return h(t)}return u(t,e,r)}function u(t,e,r){if("string"==typeof t)return function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!c.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const r=0|y(t,e);let n=s(r);const i=n.write(t,e);return i!==r&&(n=n.slice(0,i)),n}(t,e);if(ArrayBuffer.isView(t))return function(t){if(Z(t,Uint8Array)){const e=new Uint8Array(t);return p(e.buffer,e.byteOffset,e.byteLength)}return f(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(Z(t,ArrayBuffer)||t&&Z(t.buffer,ArrayBuffer))return p(t,e,r);if("undefined"!=typeof SharedArrayBuffer&&(Z(t,SharedArrayBuffer)||t&&Z(t.buffer,SharedArrayBuffer)))return p(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return c.from(n,e,r);const i=function(t){if(c.isBuffer(t)){const e=0|d(t.length),r=s(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||X(t.length)?s(0):f(t):"Buffer"===t.type&&Array.isArray(t.data)?f(t.data):void 0}(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return c.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function l(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function h(t){return l(t),s(t<0?0:0|d(t))}function f(t){const e=t.length<0?0:0|d(t.length),r=s(e);for(let n=0;n<e;n+=1)r[n]=255&t[n];return r}function p(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),Object.setPrototypeOf(n,c.prototype),n}function d(t){if(t>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|t}function y(t,e){if(c.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||Z(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return Y(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return K(t).length;default:if(i)return n?-1:Y(t).length;e=(""+e).toLowerCase(),i=!0}}function g(t,e,r){let n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return C(this,e,r);case"utf8":case"utf-8":return S(this,e,r);case"ascii":return L(this,e,r);case"latin1":case"binary":return O(this,e,r);case"base64":return k(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function m(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}function v(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),X(r=+r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=c.from(e,n)),c.isBuffer(e))return 0===e.length?-1:b(t,e,r,n,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):b(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function b(t,e,r,n,i){let o,a=1,s=t.length,c=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,s/=2,c/=2,r/=2}function u(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){let n=-1;for(o=r;o<s;o++)if(u(t,o)===u(e,-1===n?0:o-n)){if(-1===n&&(n=o),o-n+1===c)return n*a}else-1!==n&&(o-=o-n),n=-1}else for(r+c>s&&(r=s-c),o=r;o>=0;o--){let r=!0;for(let n=0;n<c;n++)if(u(t,o+n)!==u(e,n)){r=!1;break}if(r)return o}return-1}function w(t,e,r,n){r=Number(r)||0;const i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;const o=e.length;let a;for(n>o/2&&(n=o/2),a=0;a<n;++a){const n=parseInt(e.substr(2*a,2),16);if(X(n))return a;t[r+a]=n}return a}function x(t,e,r,n){return H(Y(e,t.length-r),t,r,n)}function _(t,e,r,n){return H(function(t){const e=[];for(let r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function E(t,e,r,n){return H(K(e),t,r,n)}function A(t,e,r,n){return H(function(t,e){let r,n,i;const o=[];for(let a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function k(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function S(t,e,r){r=Math.min(t.length,r);const n=[];let i=e;for(;i<r;){const e=t[i];let o=null,a=e>239?4:e>223?3:e>191?2:1;if(i+a<=r){let r,n,s,c;switch(a){case 1:e<128&&(o=e);break;case 2:r=t[i+1],128==(192&r)&&(c=(31&e)<<6|63&r,c>127&&(o=c));break;case 3:r=t[i+1],n=t[i+2],128==(192&r)&&128==(192&n)&&(c=(15&e)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:r=t[i+1],n=t[i+2],s=t[i+3],128==(192&r)&&128==(192&n)&&128==(192&s)&&(c=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&s,c>65535&&c<1114112&&(o=c))}}null===o?(o=65533,a=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),i+=a}return function(t){const e=t.length;if(e<=T)return String.fromCharCode.apply(String,t);let r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=T));return r}(n)}e.kMaxLength=a,c.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(t,e,r){return u(t,e,r)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(t,e,r){return function(t,e,r){return l(t),t<=0?s(t):void 0!==e?"string"==typeof r?s(t).fill(e,r):s(t).fill(e):s(t)}(t,e,r)},c.allocUnsafe=function(t){return h(t)},c.allocUnsafeSlow=function(t){return h(t)},c.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==c.prototype},c.compare=function(t,e){if(Z(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),Z(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let r=t.length,n=e.length;for(let i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);let r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;const n=c.allocUnsafe(e);let i=0;for(r=0;r<t.length;++r){let e=t[r];if(Z(e,Uint8Array))i+e.length>n.length?(c.isBuffer(e)||(e=c.from(e)),e.copy(n,i)):Uint8Array.prototype.set.call(n,e,i);else{if(!c.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(n,i)}i+=e.length}return n},c.byteLength=y,c.prototype._isBuffer=!0,c.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)m(this,e,e+1);return this},c.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)m(this,e,e+3),m(this,e+1,e+2);return this},c.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)m(this,e,e+7),m(this,e+1,e+6),m(this,e+2,e+5),m(this,e+3,e+4);return this},c.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?S(this,0,t):g.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){let t="";const r=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},o&&(c.prototype[o]=c.prototype.inspect),c.prototype.compare=function(t,e,r,n,i){if(Z(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;let o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(e>>>=0);const s=Math.min(o,a),u=this.slice(n,i),l=t.slice(e,r);for(let t=0;t<s;++t)if(u[t]!==l[t]){o=u[t],a=l[t];break}return o<a?-1:a<o?1:0},c.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},c.prototype.indexOf=function(t,e,r){return v(this,t,e,r,!0)},c.prototype.lastIndexOf=function(t,e,r){return v(this,t,e,r,!1)},c.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let o=!1;for(;;)switch(n){case"hex":return w(this,t,e,r);case"utf8":case"utf-8":return x(this,t,e,r);case"ascii":case"latin1":case"binary":return _(this,t,e,r);case"base64":return E(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const T=4096;function L(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function O(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function C(t,e,r){const n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=e;n<r;++n)i+=q[t[n]];return i}function P(t,e,r){const n=t.slice(e,r);let i="";for(let t=0;t<n.length-1;t+=2)i+=String.fromCharCode(n[t]+256*n[t+1]);return i}function M(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function I(t,e,r,n,i,o){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function j(t,e,r,n,i){G(e,n,i,t,r,7);let o=Number(e&BigInt(4294967295));t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o;let a=Number(e>>BigInt(32)&BigInt(4294967295));return t[r++]=a,a>>=8,t[r++]=a,a>>=8,t[r++]=a,a>>=8,t[r++]=a,r}function R(t,e,r,n,i){G(e,n,i,t,r,7);let o=Number(e&BigInt(4294967295));t[r+7]=o,o>>=8,t[r+6]=o,o>>=8,t[r+5]=o,o>>=8,t[r+4]=o;let a=Number(e>>BigInt(32)&BigInt(4294967295));return t[r+3]=a,a>>=8,t[r+2]=a,a>>=8,t[r+1]=a,a>>=8,t[r]=a,r+8}function N(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function B(t,e,r,n,o){return e=+e,r>>>=0,o||N(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function D(t,e,r,n,o){return e=+e,r>>>=0,o||N(t,0,r,8),i.write(t,e,r,n,52,8),r+8}c.prototype.slice=function(t,e){const r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);const n=this.subarray(t,e);return Object.setPrototypeOf(n,c.prototype),n},c.prototype.readUintLE=c.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||M(t,e,this.length);let n=this[t],i=1,o=0;for(;++o<e&&(i*=256);)n+=this[t+o]*i;return n},c.prototype.readUintBE=c.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||M(t,e,this.length);let n=this[t+--e],i=1;for(;e>0&&(i*=256);)n+=this[t+--e]*i;return n},c.prototype.readUint8=c.prototype.readUInt8=function(t,e){return t>>>=0,e||M(t,1,this.length),this[t]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(t,e){return t>>>=0,e||M(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(t,e){return t>>>=0,e||M(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(t,e){return t>>>=0,e||M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(t,e){return t>>>=0,e||M(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readBigUInt64LE=J((function(t){W(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||V(t,this.length-8);const n=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,i=this[++t]+256*this[++t]+65536*this[++t]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))})),c.prototype.readBigUInt64BE=J((function(t){W(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||V(t,this.length-8);const n=e*2**24+65536*this[++t]+256*this[++t]+this[++t],i=this[++t]*2**24+65536*this[++t]+256*this[++t]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)})),c.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||M(t,e,this.length);let n=this[t],i=1,o=0;for(;++o<e&&(i*=256);)n+=this[t+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*e)),n},c.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||M(t,e,this.length);let n=e,i=1,o=this[t+--n];for(;n>0&&(i*=256);)o+=this[t+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*e)),o},c.prototype.readInt8=function(t,e){return t>>>=0,e||M(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){t>>>=0,e||M(t,2,this.length);const r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(t,e){t>>>=0,e||M(t,2,this.length);const r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(t,e){return t>>>=0,e||M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return t>>>=0,e||M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readBigInt64LE=J((function(t){W(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||V(t,this.length-8);const n=this[t+4]+256*this[t+5]+65536*this[t+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),c.prototype.readBigInt64BE=J((function(t){W(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||V(t,this.length-8);const n=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(n)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+r)})),c.prototype.readFloatLE=function(t,e){return t>>>=0,e||M(t,4,this.length),i.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return t>>>=0,e||M(t,4,this.length),i.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return t>>>=0,e||M(t,8,this.length),i.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return t>>>=0,e||M(t,8,this.length),i.read(this,t,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||I(this,t,e,r,Math.pow(2,8*r)-1,0);let i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||I(this,t,e,r,Math.pow(2,8*r)-1,0);let i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},c.prototype.writeUint8=c.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||I(this,t,e,1,255,0),this[e]=255&t,e+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||I(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||I(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||I(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||I(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},c.prototype.writeBigUInt64LE=J((function(t,e=0){return j(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeBigUInt64BE=J((function(t,e=0){return R(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){const n=Math.pow(2,8*r-1);I(this,t,e,r,n-1,-n)}let i=0,o=1,a=0;for(this[e]=255&t;++i<r&&(o*=256);)t<0&&0===a&&0!==this[e+i-1]&&(a=1),this[e+i]=(t/o|0)-a&255;return e+r},c.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){const n=Math.pow(2,8*r-1);I(this,t,e,r,n-1,-n)}let i=r-1,o=1,a=0;for(this[e+i]=255&t;--i>=0&&(o*=256);)t<0&&0===a&&0!==this[e+i+1]&&(a=1),this[e+i]=(t/o|0)-a&255;return e+r},c.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||I(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||I(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},c.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||I(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},c.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||I(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},c.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||I(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},c.prototype.writeBigInt64LE=J((function(t,e=0){return j(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeBigInt64BE=J((function(t,e=0){return R(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeFloatLE=function(t,e,r){return B(this,t,e,!0,r)},c.prototype.writeFloatBE=function(t,e,r){return B(this,t,e,!1,r)},c.prototype.writeDoubleLE=function(t,e,r){return D(this,t,e,!0,r)},c.prototype.writeDoubleBE=function(t,e,r){return D(this,t,e,!1,r)},c.prototype.copy=function(t,e,r,n){if(!c.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);const i=n-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),i},c.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){const e=t.charCodeAt(0);("utf8"===n&&e<128||"latin1"===n)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;let i;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(i=e;i<r;++i)this[i]=t;else{const o=c.isBuffer(t)?t:c.from(t,n),a=o.length;if(0===a)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<r-e;++i)this[i+e]=o[i%a]}return this};const F={};function U(t,e,r){F[t]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function z(t){let e="",r=t.length;const n="-"===t[0]?1:0;for(;r>=n+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function G(t,e,r,n,i,o){if(t>r||t<e){const n="bigint"==typeof e?"n":"";let i;throw i=o>3?0===e||e===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(o+1)}${n}`:`>= -(2${n} ** ${8*(o+1)-1}${n}) and < 2 ** ${8*(o+1)-1}${n}`:`>= ${e}${n} and <= ${r}${n}`,new F.ERR_OUT_OF_RANGE("value",i,t)}!function(t,e,r){W(e,"offset"),void 0!==t[e]&&void 0!==t[e+r]||V(e,t.length-(r+1))}(n,i,o)}function W(t,e){if("number"!=typeof t)throw new F.ERR_INVALID_ARG_TYPE(e,"number",t)}function V(t,e,r){if(Math.floor(t)!==t)throw W(t,r),new F.ERR_OUT_OF_RANGE(r||"offset","an integer",t);if(e<0)throw new F.ERR_BUFFER_OUT_OF_BOUNDS;throw new F.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${e}`,t)}U("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),U("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),U("ERR_OUT_OF_RANGE",(function(t,e,r){let n=`The value of "${t}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=z(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=z(i)),i+="n"),n+=` It must be ${e}. Received ${i}`,n}),RangeError);const $=/[^+/0-9A-Za-z-_]/g;function Y(t,e){let r;e=e||1/0;const n=t.length;let i=null;const o=[];for(let a=0;a<n;++a){if(r=t.charCodeAt(a),r>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function K(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace($,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function H(t,e,r,n){let i;for(i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function Z(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function X(t){return t!=t}const q=function(){const t="0123456789abcdef",e=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let i=0;i<16;++i)e[n+i]=t[r]+t[i]}return e}();function J(t){return"undefined"==typeof BigInt?Q:t}function Q(){throw new Error("BigInt not supported")}},480:(t,e,r)=>{"use strict";r.d(e,{Z:()=>s});var n=r(7537),i=r.n(n),o=r(3645),a=r.n(o)()(i());a.push([t.id,"/*                                                 *** ----------------------------------------------- **\n**             Calliope - Site Generator   \t       **\n** ----------------------------------------------- **\n**  Copyright (c) 2020-2023 - Kyle Derby MacInnis  **\n**                                                 **\n**    Any unauthorized distribution or transfer    **\n**       of this work is strictly prohibited.      **\n**                                                 **\n**               All Rights Reserved.              **\n** ----------------------------------------------- **\n\\*                                                 */\n.pixos {\n  font-family: Arial, Helvetica, sans-serif;\n  font-size: 16px;\n  width: 100%;\n  text-shadow: #3f3f3f 2px 2px 0px;\n  position: relative;\n  /* padding: 2.5em; */\n  align-items: center;\n  align-content: center;\n}\n\n.renderSurface {\n  height: 100%;\n  left: 0;\n  position: absolute;\n  top: 0;\n  width: 100%;\n}\n\n.materialSelector {\n  background: rgba(0, 0, 0, 0.6);\n  margin: auto;\n  position: relative;\n}\n.materialSelector tr {\n  height: 70px;\n}\n.materialSelector td {\n  background-position: 0px 0px;\n  cursor: pointer;\n  margin: 0;\n  opacity: 0.3;\n  padding: 0;\n  width: 70px;\n}\n.materialSelector td:hover {\n  opacity: 0.8;\n}\n\n.nickname {\n  color: #ffffff;\n  cursor: default;\n  left: 42%;\n  position: absolute;\n  top: 40%;\n  width: 300px;\n}\n.nickname input {\n  background: none;\n  border-bottom: 1px solid #888888;\n  border: none;\n  color: white;\n  font-family: Arial, Helvetica, sans-serif;\n  font-size: 24px;\n  outline: none;\n  width: 100%;\n}\n\n.joininfo {\n  color: #ffffff;\n  cursor: default;\n  font-size: 24px;\n  position: absolute;\n  text-align: center;\n  top: 42%;\n  width: 99%;\n}\n\n.chatbox {\n  background: rgba(0, 0, 0, 0.6);\n  bottom: 55px;\n  color: white;\n  cursor: default;\n  height: 195px;\n  left: 20px;\n  overflow: hidden;\n  padding-left: 10px;\n  padding-right: 10px;\n  position: absolute;\n  width: 600px;\n}\n\n.chatbox_text {\n  bottom: 8px;\n  position: absolute;\n  text-shadow: none;\n}\n\n.chatbox_entry {\n  background: rgba(0, 0, 0, 0.6);\n  border: none;\n  bottom: 18px;\n  color: white;\n  font-family: Arial, Helvetica, sans-serif;\n  font-size: 16px;\n  height: 30px;\n  left: 20px;\n  outline: none;\n  padding-bottom: 2px;\n  padding-left: 10px;\n  position: absolute;\n  width: 610px;\n}\n\nhtml {\n  height: 100%;\n}\n\n.pixos-body {\n  height: 100%;\n  margin: 0;\n  overflow: hidden;\n  background: linear-gradient(to bottom, #202020, #111119);\n}\n\n.rain {\n  position: absolute;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 2;\n}\n\n.snow {\n  position: absolute;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 2;\n}\n\n.rain.back-row {\n  z-index: 1;\n  bottom: 60px;\n  opacity: 0.5;\n}\n.snow.back-row {\n  z-index: 1;\n  bottom: 60px;\n  opacity: 0.8;\n}\n\nbody.back-row-toggle .rain.back-row .snow.back-row {\n  display: block;\n}\n\n.drop {\n  position: absolute;\n  bottom: 100%;\n  width: 15px;\n  height: 120px;\n  pointer-events: none;\n  animation: drop 0.5s linear infinite;\n}\n\n.flake {\n  position: absolute;\n  bottom: 100%;\n  width: 24px;\n  height: 24px;\n  pointer-events: none;\n  animation: snow 2.5s linear infinite;\n}\n\n@keyframes drop {\n  0% {\n    transform: translateY(0vh);\n  }\n  75% {\n    transform: translateY(90vh);\n  }\n  100% {\n    transform: translateY(90vh);\n  }\n}\n\n@keyframes snow {\n  0% {\n    transform: translateY(0vh);\n  }\n  70% {\n    transform: translateY(50vh);\n  }\n  85% {\n    transform: translateY(85vh);\n  }\n  75% {\n    transform: translateY(75vh);\n  }\n  100% {\n    transform: translateY(95vh);\n    transform: translateX(30vw);\n  }\n}\n\n.stem {\n  width: 1px;\n  height: 60%;\n  margin-left: 7px;\n  background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.25));\n  animation: stem 0.5s linear infinite;\n}\n\n@keyframes stem {\n  0% {\n    opacity: 1;\n  }\n  65% {\n    opacity: 1;\n  }\n  75% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n\n.splat {\n  width: 15px;\n  height: 10px;\n  border-top: 2px dotted rgba(255, 255, 255, 0.5);\n  border-radius: 50%;\n  opacity: 1;\n  transform: scale(0);\n  animation: splat 0.5s linear infinite;\n}\n\nbody.splat-toggle .splat {\n  display: block;\n}\n\n@keyframes splat {\n  0% {\n    opacity: 1;\n    transform: scale(0);\n  }\n  80% {\n    opacity: 1;\n    transform: scale(0);\n  }\n  90% {\n    opacity: 0.5;\n    transform: scale(1);\n  }\n  100% {\n    opacity: 0;\n    transform: scale(1.5);\n  }\n}\n\n.toggles {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 3;\n}\n\n.toggle {\n  position: absolute;\n  left: 20px;\n  width: 50px;\n  height: 50px;\n  line-height: 51px;\n  box-sizing: border-box;\n  text-align: center;\n  font-family: sans-serif;\n  font-size: 10px;\n  font-weight: bold;\n  background-color: rgba(255, 255, 255, 0.2);\n  color: rgba(0, 0, 0, 0.5);\n  border-radius: 50%;\n  cursor: pointer;\n  transition: background-color 0.3s;\n}\n\n.toggle:hover {\n  background-color: rgba(255, 255, 255, 0.25);\n}\n\n.toggle:active {\n  background-color: rgba(255, 255, 255, 0.3);\n}\n\n.toggle.active {\n  background-color: rgba(255, 255, 255, 0.4);\n}\n\n.splat-toggle {\n  top: 20px;\n}\n\n.back-row-toggle {\n  top: 90px;\n  line-height: 12px;\n  padding-top: 14px;\n}\n\n.single-toggle {\n  top: 160px;\n}\n\nbody.single-toggle .drop {\n  display: none;\n}\n\nbody.single-toggle .drop:nth-child(10) {\n  display: block;\n}\n","",{version:3,sources:["webpack://./pixos/css/pixos.css"],names:[],mappings:"AAAA;;;;;;;;;;oDAUoD;AACpD;EACE,yCAAyC;EACzC,eAAe;EACf,WAAW;EACX,gCAAgC;EAChC,kBAAkB;EAClB,oBAAoB;EACpB,mBAAmB;EACnB,qBAAqB;AACvB;;AAEA;EACE,YAAY;EACZ,OAAO;EACP,kBAAkB;EAClB,MAAM;EACN,WAAW;AACb;;AAEA;EACE,8BAA8B;EAC9B,YAAY;EACZ,kBAAkB;AACpB;AACA;EACE,YAAY;AACd;AACA;EACE,4BAA4B;EAC5B,eAAe;EACf,SAAS;EACT,YAAY;EACZ,UAAU;EACV,WAAW;AACb;AACA;EACE,YAAY;AACd;;AAEA;EACE,cAAc;EACd,eAAe;EACf,SAAS;EACT,kBAAkB;EAClB,QAAQ;EACR,YAAY;AACd;AACA;EACE,gBAAgB;EAChB,gCAAgC;EAChC,YAAY;EACZ,YAAY;EACZ,yCAAyC;EACzC,eAAe;EACf,aAAa;EACb,WAAW;AACb;;AAEA;EACE,cAAc;EACd,eAAe;EACf,eAAe;EACf,kBAAkB;EAClB,kBAAkB;EAClB,QAAQ;EACR,UAAU;AACZ;;AAEA;EACE,8BAA8B;EAC9B,YAAY;EACZ,YAAY;EACZ,eAAe;EACf,aAAa;EACb,UAAU;EACV,gBAAgB;EAChB,kBAAkB;EAClB,mBAAmB;EACnB,kBAAkB;EAClB,YAAY;AACd;;AAEA;EACE,WAAW;EACX,kBAAkB;EAClB,iBAAiB;AACnB;;AAEA;EACE,8BAA8B;EAC9B,YAAY;EACZ,YAAY;EACZ,YAAY;EACZ,yCAAyC;EACzC,eAAe;EACf,YAAY;EACZ,UAAU;EACV,aAAa;EACb,mBAAmB;EACnB,kBAAkB;EAClB,kBAAkB;EAClB,YAAY;AACd;;AAEA;EACE,YAAY;AACd;;AAEA;EACE,YAAY;EACZ,SAAS;EACT,gBAAgB;EAChB,wDAAwD;AAC1D;;AAEA;EACE,kBAAkB;EAClB,OAAO;EACP,WAAW;EACX,YAAY;EACZ,UAAU;AACZ;;AAEA;EACE,kBAAkB;EAClB,OAAO;EACP,WAAW;EACX,YAAY;EACZ,UAAU;AACZ;;AAEA;EACE,UAAU;EACV,YAAY;EACZ,YAAY;AACd;AACA;EACE,UAAU;EACV,YAAY;EACZ,YAAY;AACd;;AAEA;EACE,cAAc;AAChB;;AAEA;EACE,kBAAkB;EAClB,YAAY;EACZ,WAAW;EACX,aAAa;EACb,oBAAoB;EACpB,oCAAoC;AACtC;;AAEA;EACE,kBAAkB;EAClB,YAAY;EACZ,WAAW;EACX,YAAY;EACZ,oBAAoB;EACpB,oCAAoC;AACtC;;AAEA;EACE;IACE,0BAA0B;EAC5B;EACA;IACE,2BAA2B;EAC7B;EACA;IACE,2BAA2B;EAC7B;AACF;;AAEA;EACE;IACE,0BAA0B;EAC5B;EACA;IACE,2BAA2B;EAC7B;EACA;IACE,2BAA2B;EAC7B;EACA;IACE,2BAA2B;EAC7B;EACA;IACE,2BAA2B;IAC3B,2BAA2B;EAC7B;AACF;;AAEA;EACE,UAAU;EACV,WAAW;EACX,gBAAgB;EAChB,yFAAyF;EACzF,oCAAoC;AACtC;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA;EACE,WAAW;EACX,YAAY;EACZ,+CAA+C;EAC/C,kBAAkB;EAClB,UAAU;EACV,mBAAmB;EACnB,qCAAqC;AACvC;;AAEA;EACE,cAAc;AAChB;;AAEA;EACE;IACE,UAAU;IACV,mBAAmB;EACrB;EACA;IACE,UAAU;IACV,mBAAmB;EACrB;EACA;IACE,YAAY;IACZ,mBAAmB;EACrB;EACA;IACE,UAAU;IACV,qBAAqB;EACvB;AACF;;AAEA;EACE,kBAAkB;EAClB,MAAM;EACN,OAAO;EACP,UAAU;AACZ;;AAEA;EACE,kBAAkB;EAClB,UAAU;EACV,WAAW;EACX,YAAY;EACZ,iBAAiB;EACjB,sBAAsB;EACtB,kBAAkB;EAClB,uBAAuB;EACvB,eAAe;EACf,iBAAiB;EACjB,0CAA0C;EAC1C,yBAAyB;EACzB,kBAAkB;EAClB,eAAe;EACf,iCAAiC;AACnC;;AAEA;EACE,2CAA2C;AAC7C;;AAEA;EACE,0CAA0C;AAC5C;;AAEA;EACE,0CAA0C;AAC5C;;AAEA;EACE,SAAS;AACX;;AAEA;EACE,SAAS;EACT,iBAAiB;EACjB,iBAAiB;AACnB;;AAEA;EACE,UAAU;AACZ;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,cAAc;AAChB",sourcesContent:["/*                                                 *** ----------------------------------------------- **\n**             Calliope - Site Generator   \t       **\n** ----------------------------------------------- **\n**  Copyright (c) 2020-2023 - Kyle Derby MacInnis  **\n**                                                 **\n**    Any unauthorized distribution or transfer    **\n**       of this work is strictly prohibited.      **\n**                                                 **\n**               All Rights Reserved.              **\n** ----------------------------------------------- **\n\\*                                                 */\n.pixos {\n  font-family: Arial, Helvetica, sans-serif;\n  font-size: 16px;\n  width: 100%;\n  text-shadow: #3f3f3f 2px 2px 0px;\n  position: relative;\n  /* padding: 2.5em; */\n  align-items: center;\n  align-content: center;\n}\n\n.renderSurface {\n  height: 100%;\n  left: 0;\n  position: absolute;\n  top: 0;\n  width: 100%;\n}\n\n.materialSelector {\n  background: rgba(0, 0, 0, 0.6);\n  margin: auto;\n  position: relative;\n}\n.materialSelector tr {\n  height: 70px;\n}\n.materialSelector td {\n  background-position: 0px 0px;\n  cursor: pointer;\n  margin: 0;\n  opacity: 0.3;\n  padding: 0;\n  width: 70px;\n}\n.materialSelector td:hover {\n  opacity: 0.8;\n}\n\n.nickname {\n  color: #ffffff;\n  cursor: default;\n  left: 42%;\n  position: absolute;\n  top: 40%;\n  width: 300px;\n}\n.nickname input {\n  background: none;\n  border-bottom: 1px solid #888888;\n  border: none;\n  color: white;\n  font-family: Arial, Helvetica, sans-serif;\n  font-size: 24px;\n  outline: none;\n  width: 100%;\n}\n\n.joininfo {\n  color: #ffffff;\n  cursor: default;\n  font-size: 24px;\n  position: absolute;\n  text-align: center;\n  top: 42%;\n  width: 99%;\n}\n\n.chatbox {\n  background: rgba(0, 0, 0, 0.6);\n  bottom: 55px;\n  color: white;\n  cursor: default;\n  height: 195px;\n  left: 20px;\n  overflow: hidden;\n  padding-left: 10px;\n  padding-right: 10px;\n  position: absolute;\n  width: 600px;\n}\n\n.chatbox_text {\n  bottom: 8px;\n  position: absolute;\n  text-shadow: none;\n}\n\n.chatbox_entry {\n  background: rgba(0, 0, 0, 0.6);\n  border: none;\n  bottom: 18px;\n  color: white;\n  font-family: Arial, Helvetica, sans-serif;\n  font-size: 16px;\n  height: 30px;\n  left: 20px;\n  outline: none;\n  padding-bottom: 2px;\n  padding-left: 10px;\n  position: absolute;\n  width: 610px;\n}\n\nhtml {\n  height: 100%;\n}\n\n.pixos-body {\n  height: 100%;\n  margin: 0;\n  overflow: hidden;\n  background: linear-gradient(to bottom, #202020, #111119);\n}\n\n.rain {\n  position: absolute;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 2;\n}\n\n.snow {\n  position: absolute;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 2;\n}\n\n.rain.back-row {\n  z-index: 1;\n  bottom: 60px;\n  opacity: 0.5;\n}\n.snow.back-row {\n  z-index: 1;\n  bottom: 60px;\n  opacity: 0.8;\n}\n\nbody.back-row-toggle .rain.back-row .snow.back-row {\n  display: block;\n}\n\n.drop {\n  position: absolute;\n  bottom: 100%;\n  width: 15px;\n  height: 120px;\n  pointer-events: none;\n  animation: drop 0.5s linear infinite;\n}\n\n.flake {\n  position: absolute;\n  bottom: 100%;\n  width: 24px;\n  height: 24px;\n  pointer-events: none;\n  animation: snow 2.5s linear infinite;\n}\n\n@keyframes drop {\n  0% {\n    transform: translateY(0vh);\n  }\n  75% {\n    transform: translateY(90vh);\n  }\n  100% {\n    transform: translateY(90vh);\n  }\n}\n\n@keyframes snow {\n  0% {\n    transform: translateY(0vh);\n  }\n  70% {\n    transform: translateY(50vh);\n  }\n  85% {\n    transform: translateY(85vh);\n  }\n  75% {\n    transform: translateY(75vh);\n  }\n  100% {\n    transform: translateY(95vh);\n    transform: translateX(30vw);\n  }\n}\n\n.stem {\n  width: 1px;\n  height: 60%;\n  margin-left: 7px;\n  background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.25));\n  animation: stem 0.5s linear infinite;\n}\n\n@keyframes stem {\n  0% {\n    opacity: 1;\n  }\n  65% {\n    opacity: 1;\n  }\n  75% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n\n.splat {\n  width: 15px;\n  height: 10px;\n  border-top: 2px dotted rgba(255, 255, 255, 0.5);\n  border-radius: 50%;\n  opacity: 1;\n  transform: scale(0);\n  animation: splat 0.5s linear infinite;\n}\n\nbody.splat-toggle .splat {\n  display: block;\n}\n\n@keyframes splat {\n  0% {\n    opacity: 1;\n    transform: scale(0);\n  }\n  80% {\n    opacity: 1;\n    transform: scale(0);\n  }\n  90% {\n    opacity: 0.5;\n    transform: scale(1);\n  }\n  100% {\n    opacity: 0;\n    transform: scale(1.5);\n  }\n}\n\n.toggles {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 3;\n}\n\n.toggle {\n  position: absolute;\n  left: 20px;\n  width: 50px;\n  height: 50px;\n  line-height: 51px;\n  box-sizing: border-box;\n  text-align: center;\n  font-family: sans-serif;\n  font-size: 10px;\n  font-weight: bold;\n  background-color: rgba(255, 255, 255, 0.2);\n  color: rgba(0, 0, 0, 0.5);\n  border-radius: 50%;\n  cursor: pointer;\n  transition: background-color 0.3s;\n}\n\n.toggle:hover {\n  background-color: rgba(255, 255, 255, 0.25);\n}\n\n.toggle:active {\n  background-color: rgba(255, 255, 255, 0.3);\n}\n\n.toggle.active {\n  background-color: rgba(255, 255, 255, 0.4);\n}\n\n.splat-toggle {\n  top: 20px;\n}\n\n.back-row-toggle {\n  top: 90px;\n  line-height: 12px;\n  padding-top: 14px;\n}\n\n.single-toggle {\n  top: 160px;\n}\n\nbody.single-toggle .drop {\n  display: none;\n}\n\nbody.single-toggle .drop:nth-child(10) {\n  display: block;\n}\n"],sourceRoot:""}]);const s=a},3645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r="",n=void 0!==e[5];return e[4]&&(r+="@supports (".concat(e[4],") {")),e[2]&&(r+="@media ".concat(e[2]," {")),n&&(r+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),r+=t(e),n&&(r+="}"),e[2]&&(r+="}"),e[4]&&(r+="}"),r})).join("")},e.i=function(t,r,n,i,o){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(n)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(a[c]=!0)}for(var u=0;u<t.length;u++){var l=[].concat(t[u]);n&&a[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),r&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=r):l[2]=r),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),e.push(l))}},e}},7537:t=>{"use strict";t.exports=function(t){var e=t[1],r=t[3];if(!r)return e;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),o="/*# ".concat(i," */"),a=r.sources.map((function(t){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(t," */")}));return[e].concat(a).concat([o]).join("\n")}return[e].join("\n")}},3162:function(t,e,r){var n,i;void 0===(i="function"==typeof(n=function(){"use strict";function e(t,e,r){var n=new XMLHttpRequest;n.open("GET",t),n.responseType="blob",n.onload=function(){s(n.response,e,r)},n.onerror=function(){console.error("could not download file")},n.send()}function n(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function i(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(r){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r.g&&r.g.global===r.g?r.g:void 0,a=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(t,r,a){var s=o.URL||o.webkitURL,c=document.createElement("a");r=r||t.name||"download",c.download=r,c.rel="noopener","string"==typeof t?(c.href=t,c.origin===location.origin?i(c):n(c.href)?e(t,r,a):i(c,c.target="_blank")):(c.href=s.createObjectURL(t),setTimeout((function(){s.revokeObjectURL(c.href)}),4e4),setTimeout((function(){i(c)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,r,o){if(r=r||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}(t,o),r);else if(n(t))e(t,r,o);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout((function(){i(a)}))}}:function(t,r,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof t)return e(t,r,n);var s="application/octet-stream"===t.type,c=/constructor/i.test(o.HTMLElement)||o.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||s&&c||a)&&"undefined"!=typeof FileReader){var l=new FileReader;l.onloadend=function(){var t=l.result;t=u?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=t:location=t,i=null},l.readAsDataURL(t)}else{var h=o.URL||o.webkitURL,f=h.createObjectURL(t);i?i.location=f:location.href=f,i=null,setTimeout((function(){h.revokeObjectURL(f)}),4e4)}});o.saveAs=s.saveAs=s,t.exports=s})?n.apply(e,[]):n)||(t.exports=i)},7738:t=>{t.exports={0:"NONE",1:"ONE",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN",256:"DEPTH_BUFFER_BIT",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",768:"SRC_COLOR",769:"ONE_MINUS_SRC_COLOR",770:"SRC_ALPHA",771:"ONE_MINUS_SRC_ALPHA",772:"DST_ALPHA",773:"ONE_MINUS_DST_ALPHA",774:"DST_COLOR",775:"ONE_MINUS_DST_COLOR",776:"SRC_ALPHA_SATURATE",1024:"STENCIL_BUFFER_BIT",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",2304:"CW",2305:"CCW",2849:"LINE_WIDTH",2884:"CULL_FACE",2885:"CULL_FACE_MODE",2886:"FRONT_FACE",2928:"DEPTH_RANGE",2929:"DEPTH_TEST",2930:"DEPTH_WRITEMASK",2931:"DEPTH_CLEAR_VALUE",2932:"DEPTH_FUNC",2960:"STENCIL_TEST",2961:"STENCIL_CLEAR_VALUE",2962:"STENCIL_FUNC",2963:"STENCIL_VALUE_MASK",2964:"STENCIL_FAIL",2965:"STENCIL_PASS_DEPTH_FAIL",2966:"STENCIL_PASS_DEPTH_PASS",2967:"STENCIL_REF",2968:"STENCIL_WRITEMASK",2978:"VIEWPORT",3024:"DITHER",3042:"BLEND",3088:"SCISSOR_BOX",3089:"SCISSOR_TEST",3106:"COLOR_CLEAR_VALUE",3107:"COLOR_WRITEMASK",3317:"UNPACK_ALIGNMENT",3333:"PACK_ALIGNMENT",3379:"MAX_TEXTURE_SIZE",3386:"MAX_VIEWPORT_DIMS",3408:"SUBPIXEL_BITS",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",3414:"DEPTH_BITS",3415:"STENCIL_BITS",3553:"TEXTURE_2D",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT",5386:"INVERT",5890:"TEXTURE",6401:"STENCIL_INDEX",6402:"DEPTH_COMPONENT",6406:"ALPHA",6407:"RGB",6408:"RGBA",6409:"LUMINANCE",6410:"LUMINANCE_ALPHA",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",7936:"VENDOR",7937:"RENDERER",7938:"VERSION",9728:"NEAREST",9729:"LINEAR",9984:"NEAREST_MIPMAP_NEAREST",9985:"LINEAR_MIPMAP_NEAREST",9986:"NEAREST_MIPMAP_LINEAR",9987:"LINEAR_MIPMAP_LINEAR",10240:"TEXTURE_MAG_FILTER",10241:"TEXTURE_MIN_FILTER",10242:"TEXTURE_WRAP_S",10243:"TEXTURE_WRAP_T",10497:"REPEAT",10752:"POLYGON_OFFSET_UNITS",16384:"COLOR_BUFFER_BIT",32769:"CONSTANT_COLOR",32770:"ONE_MINUS_CONSTANT_COLOR",32771:"CONSTANT_ALPHA",32772:"ONE_MINUS_CONSTANT_ALPHA",32773:"BLEND_COLOR",32774:"FUNC_ADD",32777:"BLEND_EQUATION_RGB",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",32819:"UNSIGNED_SHORT_4_4_4_4",32820:"UNSIGNED_SHORT_5_5_5_1",32823:"POLYGON_OFFSET_FILL",32824:"POLYGON_OFFSET_FACTOR",32854:"RGBA4",32855:"RGB5_A1",32873:"TEXTURE_BINDING_2D",32926:"SAMPLE_ALPHA_TO_COVERAGE",32928:"SAMPLE_COVERAGE",32936:"SAMPLE_BUFFERS",32937:"SAMPLES",32938:"SAMPLE_COVERAGE_VALUE",32939:"SAMPLE_COVERAGE_INVERT",32968:"BLEND_DST_RGB",32969:"BLEND_SRC_RGB",32970:"BLEND_DST_ALPHA",32971:"BLEND_SRC_ALPHA",33071:"CLAMP_TO_EDGE",33170:"GENERATE_MIPMAP_HINT",33189:"DEPTH_COMPONENT16",33306:"DEPTH_STENCIL_ATTACHMENT",33635:"UNSIGNED_SHORT_5_6_5",33648:"MIRRORED_REPEAT",33901:"ALIASED_POINT_SIZE_RANGE",33902:"ALIASED_LINE_WIDTH_RANGE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34e3:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",34016:"ACTIVE_TEXTURE",34024:"MAX_RENDERBUFFER_SIZE",34041:"DEPTH_STENCIL",34055:"INCR_WRAP",34056:"DECR_WRAP",34067:"TEXTURE_CUBE_MAP",34068:"TEXTURE_BINDING_CUBE_MAP",34069:"TEXTURE_CUBE_MAP_POSITIVE_X",34070:"TEXTURE_CUBE_MAP_NEGATIVE_X",34071:"TEXTURE_CUBE_MAP_POSITIVE_Y",34072:"TEXTURE_CUBE_MAP_NEGATIVE_Y",34073:"TEXTURE_CUBE_MAP_POSITIVE_Z",34074:"TEXTURE_CUBE_MAP_NEGATIVE_Z",34076:"MAX_CUBE_MAP_TEXTURE_SIZE",34338:"VERTEX_ATTRIB_ARRAY_ENABLED",34339:"VERTEX_ATTRIB_ARRAY_SIZE",34340:"VERTEX_ATTRIB_ARRAY_STRIDE",34341:"VERTEX_ATTRIB_ARRAY_TYPE",34342:"CURRENT_VERTEX_ATTRIB",34373:"VERTEX_ATTRIB_ARRAY_POINTER",34466:"NUM_COMPRESSED_TEXTURE_FORMATS",34467:"COMPRESSED_TEXTURE_FORMATS",34660:"BUFFER_SIZE",34661:"BUFFER_USAGE",34816:"STENCIL_BACK_FUNC",34817:"STENCIL_BACK_FAIL",34818:"STENCIL_BACK_PASS_DEPTH_FAIL",34819:"STENCIL_BACK_PASS_DEPTH_PASS",34877:"BLEND_EQUATION_ALPHA",34921:"MAX_VERTEX_ATTRIBS",34922:"VERTEX_ATTRIB_ARRAY_NORMALIZED",34930:"MAX_TEXTURE_IMAGE_UNITS",34962:"ARRAY_BUFFER",34963:"ELEMENT_ARRAY_BUFFER",34964:"ARRAY_BUFFER_BINDING",34965:"ELEMENT_ARRAY_BUFFER_BINDING",34975:"VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",35040:"STREAM_DRAW",35044:"STATIC_DRAW",35048:"DYNAMIC_DRAW",35632:"FRAGMENT_SHADER",35633:"VERTEX_SHADER",35660:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",35661:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",35663:"SHADER_TYPE",35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",35712:"DELETE_STATUS",35713:"COMPILE_STATUS",35714:"LINK_STATUS",35715:"VALIDATE_STATUS",35716:"INFO_LOG_LENGTH",35717:"ATTACHED_SHADERS",35718:"ACTIVE_UNIFORMS",35719:"ACTIVE_UNIFORM_MAX_LENGTH",35720:"SHADER_SOURCE_LENGTH",35721:"ACTIVE_ATTRIBUTES",35722:"ACTIVE_ATTRIBUTE_MAX_LENGTH",35724:"SHADING_LANGUAGE_VERSION",35725:"CURRENT_PROGRAM",36003:"STENCIL_BACK_REF",36004:"STENCIL_BACK_VALUE_MASK",36005:"STENCIL_BACK_WRITEMASK",36006:"FRAMEBUFFER_BINDING",36007:"RENDERBUFFER_BINDING",36048:"FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",36049:"FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",36050:"FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",36051:"FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED",36064:"COLOR_ATTACHMENT0",36096:"DEPTH_ATTACHMENT",36128:"STENCIL_ATTACHMENT",36160:"FRAMEBUFFER",36161:"RENDERBUFFER",36162:"RENDERBUFFER_WIDTH",36163:"RENDERBUFFER_HEIGHT",36164:"RENDERBUFFER_INTERNAL_FORMAT",36168:"STENCIL_INDEX8",36176:"RENDERBUFFER_RED_SIZE",36177:"RENDERBUFFER_GREEN_SIZE",36178:"RENDERBUFFER_BLUE_SIZE",36179:"RENDERBUFFER_ALPHA_SIZE",36180:"RENDERBUFFER_DEPTH_SIZE",36181:"RENDERBUFFER_STENCIL_SIZE",36194:"RGB565",36336:"LOW_FLOAT",36337:"MEDIUM_FLOAT",36338:"HIGH_FLOAT",36339:"LOW_INT",36340:"MEDIUM_INT",36341:"HIGH_INT",36346:"SHADER_COMPILER",36347:"MAX_VERTEX_UNIFORM_VECTORS",36348:"MAX_VARYING_VECTORS",36349:"MAX_FRAGMENT_UNIFORM_VECTORS",37440:"UNPACK_FLIP_Y_WEBGL",37441:"UNPACK_PREMULTIPLY_ALPHA_WEBGL",37442:"CONTEXT_LOST_WEBGL",37443:"UNPACK_COLORSPACE_CONVERSION_WEBGL",37444:"BROWSER_DEFAULT_WEBGL"}},4488:(t,e,r)=>{var n=r(7738);t.exports=function(t){return n[t]}},4779:(t,e,r)=>{var n=r(8975).sprintf,i=r(4488),o=r(6973),a=r(3583);t.exports=function(t,e,r){"use strict";var s=o(e)||"of unknown name (see npm glsl-shader-name)",c="unknown type";void 0!==r&&(c=r===i.FRAGMENT_SHADER?"fragment":"vertex");for(var u=n("Error compiling %s shader %s:\n",c,s),l=n("%s%s",u,t),h=t.split("\n"),f={},p=0;p<h.length;p++){var d=h[p];if(""!==d&&"\0"!==d){var y=parseInt(d.split(":")[2]);if(isNaN(y))throw new Error(n("Could not parse error: %s",d));f[y]=d}}var g=a(e).split("\n");for(p=0;p<g.length;p++)if((f[p+3]||f[p+2]||f[p+1])&&(u+=g[p]+"\n",f[p+1])){var m=f[p+1];m=m.substr(m.split(":",3).join(":").length+1).trim(),u+=n("^^^ %s\n\n",m)}return{long:u.trim(),short:l.trim()}}},8057:(t,e,r)=>{"use strict";var n=r(2985),i=r(6552),o=r(9397),a=r(8273),s=r(7175),c=r(9306);function u(t){this.gl=t,this.gl.lastAttribCount=0,this._vref=this._fref=this._relink=this.vertShader=this.fragShader=this.program=this.attributes=this.uniforms=this.types=null}var l=u.prototype;function h(t,e){return t.name<e.name?-1:1}l.bind=function(){var t;this.program||this._relink();var e=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES),r=this.gl.lastAttribCount;if(e>r)for(t=r;t<e;t++)this.gl.enableVertexAttribArray(t);else if(r>e)for(t=e;t<r;t++)this.gl.disableVertexAttribArray(t);this.gl.lastAttribCount=e,this.gl.useProgram(this.program)},l.dispose=function(){for(var t=this.gl.lastAttribCount,e=0;e<t;e++)this.gl.disableVertexAttribArray(e);this.gl.lastAttribCount=0,this._fref&&this._fref.dispose(),this._vref&&this._vref.dispose(),this.attributes=this.types=this.vertShader=this.fragShader=this.program=this._relink=this._fref=this._vref=null},l.update=function(t,e,r,u){if(!e||1===arguments.length){var l=t;t=l.vertex,e=l.fragment,r=l.uniforms,u=l.attributes}var f=this,p=f.gl,d=f._vref;f._vref=a.shader(p,p.VERTEX_SHADER,t),d&&d.dispose(),f.vertShader=f._vref.shader;var y=this._fref;if(f._fref=a.shader(p,p.FRAGMENT_SHADER,e),y&&y.dispose(),f.fragShader=f._fref.shader,!r||!u){var g=p.createProgram();if(p.attachShader(g,f.fragShader),p.attachShader(g,f.vertShader),p.linkProgram(g),!p.getProgramParameter(g,p.LINK_STATUS)){var m=p.getProgramInfoLog(g);throw new c(m,"Error linking program:"+m)}r=r||s.uniforms(p,g),u=u||s.attributes(p,g),p.deleteProgram(g)}(u=u.slice()).sort(h);var v,b=[],w=[],x=[];for(v=0;v<u.length;++v){var _=u[v];if(_.type.indexOf("mat")>=0){for(var E=0|_.type.charAt(_.type.length-1),A=new Array(E),k=0;k<E;++k)A[k]=x.length,w.push(_.name+"["+k+"]"),"number"==typeof _.location?x.push(_.location+k):Array.isArray(_.location)&&_.location.length===E&&"number"==typeof _.location[k]?x.push(0|_.location[k]):x.push(-1);b.push({name:_.name,type:_.type,locations:A})}else b.push({name:_.name,type:_.type,locations:[x.length]}),w.push(_.name),"number"==typeof _.location?x.push(0|_.location):x.push(-1)}var S=0;for(v=0;v<x.length;++v)if(x[v]<0){for(;x.indexOf(S)>=0;)S+=1;x[v]=S}var T=new Array(r.length);function L(){f.program=a.program(p,f._vref,f._fref,w,x);for(var t=0;t<r.length;++t)T[t]=p.getUniformLocation(f.program,r[t].name)}L(),f._relink=L,f.types={uniforms:o(r),attributes:o(u)},f.attributes=i(p,f,b,x),Object.defineProperty(f,"uniforms",n(p,f,r,T))},t.exports=function(t,e,r,n,i){var o=new u(t);return o.update(e,r,n,i),o}},9306:t=>{function e(t,e,r){this.shortMessage=e||"",this.longMessage=r||"",this.rawError=t||"",this.message="gl-shader: "+(e||t||"")+(r?"\n"+r:""),this.stack=(new Error).stack}e.prototype=new Error,e.prototype.name="GLError",e.prototype.constructor=e,t.exports=e},6552:(t,e,r)=>{"use strict";t.exports=function(t,e,r,i){for(var o={},a=0,u=r.length;a<u;++a){var l=r[a],h=l.name,f=l.type,p=l.locations;switch(f){case"bool":case"int":case"float":s(t,e,p[0],i,1,o,h);break;default:if(f.indexOf("vec")>=0){if((d=f.charCodeAt(f.length-1)-48)<2||d>4)throw new n("","Invalid data type for attribute "+h+": "+f);s(t,e,p[0],i,d,o,h)}else{if(!(f.indexOf("mat")>=0))throw new n("","Unknown data type for attribute "+h+": "+f);var d;if((d=f.charCodeAt(f.length-1)-48)<2||d>4)throw new n("","Invalid data type for attribute "+h+": "+f);c(t,e,p,i,d,o,h)}}}return o};var n=r(9306);function i(t,e,r,n,i,o){this._gl=t,this._wrapper=e,this._index=r,this._locations=n,this._dimension=i,this._constFunc=o}var o=i.prototype;o.pointer=function(t,e,r,n){var i=this,o=i._gl,a=i._locations[i._index];o.vertexAttribPointer(a,i._dimension,t||o.FLOAT,!!e,r||0,n||0),o.enableVertexAttribArray(a)},o.set=function(t,e,r,n){return this._constFunc(this._locations[this._index],t,e,r,n)},Object.defineProperty(o,"location",{get:function(){return this._locations[this._index]},set:function(t){return t!==this._locations[this._index]&&(this._locations[this._index]=0|t,this._wrapper.program=null),0|t}});var a=[function(t,e,r){return void 0===r.length?t.vertexAttrib1f(e,r):t.vertexAttrib1fv(e,r)},function(t,e,r,n){return void 0===r.length?t.vertexAttrib2f(e,r,n):t.vertexAttrib2fv(e,r)},function(t,e,r,n,i){return void 0===r.length?t.vertexAttrib3f(e,r,n,i):t.vertexAttrib3fv(e,r)},function(t,e,r,n,i,o){return void 0===r.length?t.vertexAttrib4f(e,r,n,i,o):t.vertexAttrib4fv(e,r)}];function s(t,e,r,n,o,s,c){var u=a[o],l=new i(t,e,r,n,o,u);Object.defineProperty(s,c,{set:function(e){return t.disableVertexAttribArray(n[r]),u(t,n[r],e),e},get:function(){return l},enumerable:!0})}function c(t,e,r,n,i,o,a){for(var c=new Array(i),u=new Array(i),l=0;l<i;++l)s(t,e,r[l],n,i,c,l),u[l]=c[l];Object.defineProperty(c,"location",{set:function(t){if(Array.isArray(t))for(var e=0;e<i;++e)u[e].location=t[e];else for(e=0;e<i;++e)u[e].location=t+e;return t},get:function(){for(var t=new Array(i),e=0;e<i;++e)t[e]=n[r[e]];return t},enumerable:!0}),c.pointer=function(e,o,a,s){e=e||t.FLOAT,o=!!o,a=a||i*i,s=s||0;for(var c=0;c<i;++c){var u=n[r[c]];t.vertexAttribPointer(u,i,e,o,a,s+c*i),t.enableVertexAttribArray(u)}};var h=new Array(i),f=t["vertexAttrib"+i+"fv"];Object.defineProperty(o,a,{set:function(e){for(var o=0;o<i;++o){var a=n[r[o]];if(t.disableVertexAttribArray(a),Array.isArray(e[0]))f.call(t,a,e[o]);else{for(var s=0;s<i;++s)h[s]=e[i*o+s];f.call(t,a,h)}}return e},get:function(){return c},enumerable:!0})}},2985:(t,e,r)=>{"use strict";var n=r(9397),i=r(9306);function o(t){return function(){return t}}function a(t,e){for(var r=new Array(t),n=0;n<t;++n)r[n]=e;return r}t.exports=function(t,e,r,s){function c(e){return function(n){for(var o=u("",e),a=0;a<o.length;++a){var c=o[a],l=c[0],h=c[1];if(s[h]){var f=n;if("string"==typeof l&&(0===l.indexOf(".")||0===l.indexOf("["))){var p=l;if(0===l.indexOf(".")&&(p=l.slice(1)),p.indexOf("]")===p.length-1){var d=p.indexOf("["),y=p.slice(0,d),g=p.slice(d+1,p.length-1);f=y?n[y][g]:n[g]}else f=n[p]}var m,v=r[h].type;switch(v){case"bool":case"int":case"sampler2D":case"samplerCube":t.uniform1i(s[h],f);break;case"float":t.uniform1f(s[h],f);break;default:var b=v.indexOf("vec");if(!(0<=b&&b<=1&&v.length===4+b)){if(0===v.indexOf("mat")&&4===v.length){if((m=v.charCodeAt(v.length-1)-48)<2||m>4)throw new i("","Invalid uniform dimension type for matrix "+name+": "+v);t["uniformMatrix"+m+"fv"](s[h],!1,f);break}throw new i("","Unknown uniform data type for "+name+": "+v)}if((m=v.charCodeAt(v.length-1)-48)<2||m>4)throw new i("","Invalid data type");switch(v.charAt(0)){case"b":case"i":t["uniform"+m+"iv"](s[h],f);break;case"v":t["uniform"+m+"fv"](s[h],f);break;default:throw new i("","Unrecognized data type for vector "+name+": "+v)}}}}}}function u(t,e){if("object"!=typeof e)return[[t,e]];var r=[];for(var n in e){var i=e[n],o=t;parseInt(n)+""===n?o+="["+n+"]":o+="."+n,"object"==typeof i?r.push.apply(r,u(o,i)):r.push([o,i])}return r}function l(t,e,n){if("object"==typeof n){var u=h(n);Object.defineProperty(t,e,{get:o(u),set:c(n),enumerable:!0,configurable:!1})}else s[n]?Object.defineProperty(t,e,{get:(l=n,function(t,e,r){return t.getUniform(e.program,r[l])}),set:c(n),enumerable:!0,configurable:!1}):t[e]=function(t){switch(t){case"bool":return!1;case"int":case"sampler2D":case"samplerCube":case"float":return 0;default:var e=t.indexOf("vec");if(0<=e&&e<=1&&t.length===4+e){if((r=t.charCodeAt(t.length-1)-48)<2||r>4)throw new i("","Invalid data type");return"b"===t.charAt(0)?a(r,!1):a(r,0)}if(0===t.indexOf("mat")&&4===t.length){var r;if((r=t.charCodeAt(t.length-1)-48)<2||r>4)throw new i("","Invalid uniform dimension type for matrix "+name+": "+t);return a(r*r,0)}throw new i("","Unknown uniform data type for "+name+": "+t)}}(r[n].type);var l}function h(t){var e;if(Array.isArray(t)){e=new Array(t.length);for(var r=0;r<t.length;++r)l(e,r,t[r])}else for(var n in e={},t)l(e,n,t[n]);return e}var f=n(r,!0);return{get:o(h(f)),set:c(f),enumerable:!0,configurable:!0}}},9397:t=>{"use strict";t.exports=function(t,e){for(var r={},n=0;n<t.length;++n)for(var i=t[n].name.split("."),o=r,a=0;a<i.length;++a){var s=i[a].split("[");if(s.length>1){s[0]in o||(o[s[0]]=[]),o=o[s[0]];for(var c=1;c<s.length;++c){var u=parseInt(s[c]);c<s.length-1||a<i.length-1?(u in o||(c<s.length-1?o[u]=[]:o[u]={}),o=o[u]):o[u]=e?n:t[n].type}}else a<i.length-1?(s[0]in o||(o[s[0]]={}),o=o[s[0]]):o[s[0]]=e?n:t[n].type}return r}},7175:(t,e)=>{"use strict";e.uniforms=function(t,e){for(var r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),n=[],o=0;o<r;++o){var a=t.getActiveUniform(e,o);if(a){var s=i(t,a.type);if(a.size>1)for(var c=0;c<a.size;++c)n.push({name:a.name.replace("[0]","["+c+"]"),type:s});else n.push({name:a.name,type:s})}}return n},e.attributes=function(t,e){for(var r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),n=[],o=0;o<r;++o){var a=t.getActiveAttrib(e,o);a&&n.push({name:a.name,type:i(t,a.type)})}return n};var r={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube"},n=null;function i(t,e){if(!n){var i=Object.keys(r);n={};for(var o=0;o<i.length;++o){var a=i[o];n[t[a]]=r[a]}}return n[e]}},8273:(t,e,r)=>{"use strict";e.shader=function(t,e,r){return l(t).getShaderReference(e,r)},e.program=function(t,e,r,n,i){return l(t).getProgram(e,r,n,i)};var n=r(9306),i=r(4779),o=new("undefined"==typeof WeakMap?r(7501):WeakMap),a=0;function s(t,e,r,n,i,o,a){this.id=t,this.src=e,this.type=r,this.shader=n,this.count=o,this.programs=[],this.cache=a}function c(t){this.gl=t,this.shaders=[{},{}],this.programs={}}s.prototype.dispose=function(){if(0==--this.count){for(var t=this.cache,e=t.gl,r=this.programs,n=0,i=r.length;n<i;++n){var o=t.programs[r[n]];o&&(delete t.programs[n],e.deleteProgram(o))}e.deleteShader(this.shader),delete t.shaders[this.type===e.FRAGMENT_SHADER|0][this.src]}};var u=c.prototype;function l(t){var e=o.get(t);return e||(e=new c(t),o.set(t,e)),e}u.getShaderReference=function(t,e){var r=this.gl,o=this.shaders[t===r.FRAGMENT_SHADER|0],c=o[e];if(c&&r.isShader(c.shader))c.count+=1;else{var u=function(t,e,r){var o=t.createShader(e);if(t.shaderSource(o,r),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS)){var a=t.getShaderInfoLog(o);try{var s=i(a,r,e)}catch(t){throw console.warn("Failed to format compiler error: "+t),new n(a,"Error compiling shader:\n"+a)}throw new n(a,s.short,s.long)}return o}(r,t,e);c=o[e]=new s(a++,e,t,u,[],1,this)}return c},u.getProgram=function(t,e,r,i){var o=[t.id,e.id,r.join(":"),i.join(":")].join("@"),a=this.programs[o];return a&&this.gl.isProgram(a)||(this.programs[o]=a=function(t,e,r,i,o){var a=t.createProgram();t.attachShader(a,e),t.attachShader(a,r);for(var s=0;s<i.length;++s)t.bindAttribLocation(a,o[s],i[s]);if(t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS)){var c=t.getProgramInfoLog(a);throw new n(c,"Error linking program: "+c)}return a}(this.gl,t.shader,e.shader,r,i),t.programs.push(o),e.programs.push(o)),a}},1010:(t,e,r)=>{"use strict";var n;Object.assign,(n=r(8057))&&n.__esModule},6973:(t,e,r)=>{var n=r(9932),i=r(3668);t.exports=function(t){for(var e=Array.isArray(t)?t:n(t),r=0;r<e.length;r++){var o=e[r];if("preprocessor"===o.type){var a=o.data.match(/\#define\s+SHADER_NAME(_B64)?\s+(.+)$/);if(a&&a[2]){var s=a[1],c=a[2];return(s?i(c):c).trim()}}}}},8460:(t,e,r)=>{t.exports=function(t){var e,r,E,A=0,k=0,S=c,T=[],L=[],O=1,C=0,P=0,M=!1,I=!1,j="",R=o,N=n;"300 es"===(t=t||{}).version&&(R=s,N=a);var B={},D={};for(A=0;A<R.length;A++)B[R[A]]=!0;for(A=0;A<N.length;A++)D[N[A]]=!0;return function(t){return L=[],null!==t?function(t){var r;for(A=0,t.toString&&(t=t.toString()),j+=t.replace(/\r\n/g,"\n"),E=j.length;e=j[A],A<E;){switch(r=A,S){case l:A=W();break;case h:case f:A=G();break;case p:A=V();break;case d:A=K();break;case x:A=Y();break;case y:A=H();break;case u:A=Z();break;case b:A=z();break;case c:A=U()}r!==A&&("\n"===j[r]?(C=0,++O):++C)}return k+=A,j=j.slice(A),L}(t):(T.length&&F(T.join("")),S=w,F("(eof)"),L)};function F(t){t.length&&L.push({type:_[S],data:t,position:P,line:O,column:C})}function U(){return T=T.length?[]:T,"/"===r&&"*"===e?(P=k+A-1,S=l,r=e,A+1):"/"===r&&"/"===e?(P=k+A-1,S=h,r=e,A+1):"#"===e?(S=f,P=k+A,A):/\s/.test(e)?(S=b,P=k+A,A):(M=/\d/.test(e),I=/[^\w_]/.test(e),P=k+A,S=M?d:I?p:u,A)}function z(){return/[^\s]/g.test(e)?(F(T.join("")),S=c,A):(T.push(e),r=e,A+1)}function G(){return"\r"!==e&&"\n"!==e||"\\"===r?(T.push(e),r=e,A+1):(F(T.join("")),S=c,A)}function W(){return"/"===e&&"*"===r?(T.push(e),F(T.join("")),S=c,A+1):(T.push(e),r=e,A+1)}function V(){if("."===r&&/\d/.test(e))return S=y,A;if("/"===r&&"*"===e)return S=l,A;if("/"===r&&"/"===e)return S=h,A;if("."===e&&T.length){for(;$(T););return S=y,A}if(";"===e||")"===e||"("===e){if(T.length)for(;$(T););return F(e),S=c,A+1}var t=2===T.length&&"="!==e;if(/[\w_\d\s]/.test(e)||t){for(;$(T););return S=c,A}return T.push(e),r=e,A+1}function $(t){for(var e,r,n=0;;){if(e=i.indexOf(t.slice(0,t.length+n).join("")),r=i[e],-1===e){if(n--+t.length>0)continue;r=t.slice(0,1).join("")}return F(r),P+=r.length,(T=T.slice(r.length)).length}}function Y(){return/[^a-fA-F0-9]/.test(e)?(F(T.join("")),S=c,A):(T.push(e),r=e,A+1)}function K(){return"."===e||/[eE]/.test(e)?(T.push(e),S=y,r=e,A+1):"x"===e&&1===T.length&&"0"===T[0]?(S=x,T.push(e),r=e,A+1):/[^\d]/.test(e)?(F(T.join("")),S=c,A):(T.push(e),r=e,A+1)}function H(){return"f"===e&&(T.push(e),r=e,A+=1),/[eE]/.test(e)?(T.push(e),r=e,A+1):("-"!==e&&"+"!==e||!/[eE]/.test(r))&&/[^\d]/.test(e)?(F(T.join("")),S=c,A):(T.push(e),r=e,A+1)}function Z(){if(/[^\d\w_]/.test(e)){var t=T.join("");return S=D[t]?v:B[t]?m:g,F(T.join("")),S=c,A}return T.push(e),r=e,A+1}};var n=r(7529),i=r(7679),o=r(2222),a=r(2914),s=r(9537),c=999,u=9999,l=0,h=1,f=2,p=3,d=4,y=5,g=6,m=7,v=8,b=9,w=10,x=11,_=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"]},9537:(t,e,r)=>{var n=r(2222);n=n.slice().filter((function(t){return!/^(gl\_|texture)/.test(t)})),t.exports=n.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"])},2222:t=>{t.exports=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]},2914:(t,e,r)=>{var n=r(7529);t.exports=n.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"])},7529:t=>{t.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},7679:t=>{t.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},9932:(t,e,r)=>{var n=r(8460);t.exports=function(t,e){var r=n(e),i=[];return(i=i.concat(r(t))).concat(r(null))}},8679:(t,e,r)=>{"use strict";var n=r(9864),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function c(t){return n.isMemo(t)?a:s[t.$$typeof]||i}s[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[n.Memo]=a;var u=Object.defineProperty,l=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,f=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,d=Object.prototype;t.exports=function t(e,r,n){if("string"!=typeof r){if(d){var i=p(r);i&&i!==d&&t(e,i,n)}var a=l(r);h&&(a=a.concat(h(r)));for(var s=c(e),y=c(r),g=0;g<a.length;++g){var m=a[g];if(!(o[m]||n&&n[m]||y&&y[m]||s&&s[m])){var v=f(r,m);try{u(e,m,v)}catch(t){}}}}return e}},645:(t,e)=>{e.read=function(t,e,r,n,i){var o,a,s=8*i-n-1,c=(1<<s)-1,u=c>>1,l=-7,h=r?i-1:0,f=r?-1:1,p=t[e+h];for(h+=f,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+t[e+h],h+=f,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;l>0;a=256*a+t[e+h],h+=f,l-=8);if(0===o)o=1-u;else{if(o===c)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),o-=u}return(p?-1:1)*a*Math.pow(2,o-n)},e.write=function(t,e,r,n,i,o){var a,s,c,u=8*o-i-1,l=(1<<u)-1,h=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),(e+=a+h>=1?f/c:f*Math.pow(2,1-h))*c>=2&&(a++,c/=2),a+h>=l?(s=0,a=l):a+h>=1?(s=(e*c-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[r+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;t[r+p]=255&a,p+=d,a/=256,u-=8);t[r+p-d]|=128*y}},5733:(t,e,r)=>{var n=r(8764).Buffer;t.exports=function t(e,r,n){function i(a,s){if(!r[a]){if(!e[a]){if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[a]={exports:{}};e[a][0].call(u.exports,(function(t){return i(e[a][1][t]||t)}),u,u.exports,t,e,r,n)}return r[a].exports}for(var o=void 0,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(t,e,r){"use strict";var n=t("./utils"),i=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(t){for(var e,r,i,a,s,c,u,l=[],h=0,f=t.length,p=f,d="string"!==n.getTypeOf(t);h<t.length;)p=f-h,i=d?(e=t[h++],r=h<f?t[h++]:0,h<f?t[h++]:0):(e=t.charCodeAt(h++),r=h<f?t.charCodeAt(h++):0,h<f?t.charCodeAt(h++):0),a=e>>2,s=(3&e)<<4|r>>4,c=1<p?(15&r)<<2|i>>6:64,u=2<p?63&i:64,l.push(o.charAt(a)+o.charAt(s)+o.charAt(c)+o.charAt(u));return l.join("")},r.decode=function(t){var e,r,n,a,s,c,u=0,l=0,h="data:";if(t.substr(0,5)===h)throw new Error("Invalid base64 input, it looks like a data url.");var f,p=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===o.charAt(64)&&p--,t.charAt(t.length-2)===o.charAt(64)&&p--,p%1!=0)throw new Error("Invalid base64 input, bad content length.");for(f=i.uint8array?new Uint8Array(0|p):new Array(0|p);u<t.length;)e=o.indexOf(t.charAt(u++))<<2|(a=o.indexOf(t.charAt(u++)))>>4,r=(15&a)<<4|(s=o.indexOf(t.charAt(u++)))>>2,n=(3&s)<<6|(c=o.indexOf(t.charAt(u++))),f[l++]=e,64!==s&&(f[l++]=r),64!==c&&(f[l++]=n);return f}},{"./support":30,"./utils":32}],2:[function(t,e,r){"use strict";var n=t("./external"),i=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),a=t("./stream/DataLengthProbe");function s(t,e,r,n,i){this.compressedSize=t,this.uncompressedSize=e,this.crc32=r,this.compression=n,this.compressedContent=i}s.prototype={getContentWorker:function(){var t=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),e=this;return t.on("end",(function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),t},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},s.createWorkerFrom=function(t,e,r){return t.pipe(new o).pipe(new a("uncompressedSize")).pipe(e.compressWorker(r)).pipe(new a("compressedSize")).withStreamInfo("compression",e)},e.exports=s},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,r){"use strict";var n=t("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(t){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},r.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,r){"use strict";var n=t("./utils"),i=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==n.getTypeOf(t)?function(t,e,r){var n=i,o=0+r;t^=-1;for(var a=0;a<o;a++)t=t>>>8^n[255&(t^e[a])];return~t}(0|e,t,t.length):function(t,e,r){var n=i,o=0+r;t^=-1;for(var a=0;a<o;a++)t=t>>>8^n[255&(t^e.charCodeAt(a))];return~t}(0|e,t,t.length):0}},{"./utils":32}],5:[function(t,e,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(t,e,r){"use strict";var n;n="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:n}},{lie:37}],7:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=t("pako"),o=t("./utils"),a=t("./stream/GenericWorker"),s=n?"uint8array":"array";function c(t,e){a.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}r.magic="\b\0",o.inherits(c,a),c.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(o.transformTo(s,t.data),!1)},c.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},r.compressWorker=function(t){return new c("Deflate",t)},r.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,r){"use strict";function n(t,e){var r,n="";for(r=0;r<e;r++)n+=String.fromCharCode(255&t),t>>>=8;return n}function i(t,e,r,i,a,l){var h,f,p=t.file,d=t.compression,y=l!==s.utf8encode,g=o.transformTo("string",l(p.name)),m=o.transformTo("string",s.utf8encode(p.name)),v=p.comment,b=o.transformTo("string",l(v)),w=o.transformTo("string",s.utf8encode(v)),x=m.length!==p.name.length,_=w.length!==v.length,E="",A="",k="",S=p.dir,T=p.date,L={crc32:0,compressedSize:0,uncompressedSize:0};e&&!r||(L.crc32=t.crc32,L.compressedSize=t.compressedSize,L.uncompressedSize=t.uncompressedSize);var O=0;e&&(O|=8),y||!x&&!_||(O|=2048);var C=0,P=0;S&&(C|=16),"UNIX"===a?(P=798,C|=function(t,e){var r=t;return t||(r=e?16893:33204),(65535&r)<<16}(p.unixPermissions,S)):(P=20,C|=function(t){return 63&(t||0)}(p.dosPermissions)),h=T.getUTCHours(),h<<=6,h|=T.getUTCMinutes(),h<<=5,h|=T.getUTCSeconds()/2,f=T.getUTCFullYear()-1980,f<<=4,f|=T.getUTCMonth()+1,f<<=5,f|=T.getUTCDate(),x&&(A=n(1,1)+n(c(g),4)+m,E+="up"+n(A.length,2)+A),_&&(k=n(1,1)+n(c(b),4)+w,E+="uc"+n(k.length,2)+k);var M="";return M+="\n\0",M+=n(O,2),M+=d.magic,M+=n(h,2),M+=n(f,2),M+=n(L.crc32,4),M+=n(L.compressedSize,4),M+=n(L.uncompressedSize,4),M+=n(g.length,2),M+=n(E.length,2),{fileRecord:u.LOCAL_FILE_HEADER+M+g+E,dirRecord:u.CENTRAL_FILE_HEADER+n(P,2)+M+n(b.length,2)+"\0\0\0\0"+n(C,4)+n(i,4)+g+E+b}}var o=t("../utils"),a=t("../stream/GenericWorker"),s=t("../utf8"),c=t("../crc32"),u=t("../signature");function l(t,e,r,n){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=r,this.encodeFileName=n,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(l,a),l.prototype.push=function(t){var e=t.meta.percent||0,r=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,a.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:r?(e+100*(r-n-1))/r:100}}))},l.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var r=i(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},l.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,r=i(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),e)this.push({data:function(t){return u.DATA_DESCRIPTOR+n(t.crc32,4)+n(t.compressedSize,4)+n(t.uncompressedSize,4)}(t),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},l.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var r=this.bytesWritten-t,i=function(t,e,r,i,a){var s=o.transformTo("string",a(i));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(t,2)+n(t,2)+n(e,4)+n(r,4)+n(s.length,2)+s}(this.dirRecords.length,r,t,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},l.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},l.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()})),t.on("error",(function(t){e.error(t)})),this},l.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},l.prototype.error=function(t){var e=this._sources;if(!a.prototype.error.call(this,t))return!1;for(var r=0;r<e.length;r++)try{e[r].error(t)}catch(t){}return!0},l.prototype.lock=function(){a.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=l},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,r){"use strict";var n=t("../compressions"),i=t("./ZipFileWorker");r.generateWorker=function(t,e,r){var o=new i(e.streamFiles,r,e.platform,e.encodeFileName),a=0;try{t.forEach((function(t,r){a++;var i=function(t,e){var r=t||e,i=n[r];if(!i)throw new Error(r+" is not a valid compression method !");return i}(r.options.compression,e.compression),s=r.options.compressionOptions||e.compressionOptions||{},c=r.dir,u=r.date;r._compressWorker(i,s).withStreamInfo("file",{name:t,dir:c,date:u,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(o)})),o.entriesCount=a}catch(t){o.error(t)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,r){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var t=new n;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.7.1",n.loadAsync=function(t,e){return(new n).loadAsync(t,e)},n.external=t("./external"),e.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,r){"use strict";var n=t("./utils"),i=t("./external"),o=t("./utf8"),a=t("./zipEntries"),s=t("./stream/Crc32Probe"),c=t("./nodejsUtils");function u(t){return new i.Promise((function(e,r){var n=t.decompressed.getContentWorker().pipe(new s);n.on("error",(function(t){r(t)})).on("end",(function(){n.streamInfo.crc32!==t.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):e()})).resume()}))}e.exports=function(t,e){var r=this;return e=n.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(t)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then((function(t){var r=new a(e);return r.load(t),r})).then((function(t){var r=[i.Promise.resolve(t)],n=t.files;if(e.checkCRC32)for(var o=0;o<n.length;o++)r.push(u(n[o]));return i.Promise.all(r)})).then((function(t){for(var n=t.shift(),i=n.files,o=0;o<i.length;o++){var a=i[o];r.file(a.fileNameStr,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:e.createFolders})}return n.zipComment.length&&(r.comment=n.zipComment),r}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,r){"use strict";var n=t("../utils"),i=t("../stream/GenericWorker");function o(t,e){i.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}n.inherits(o,i),o.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",(function(t){e.push({data:t,meta:{percent:0}})})).on("error",(function(t){e.isPaused?this.generatedError=t:e.error(t)})).on("end",(function(){e.isPaused?e._upstreamEnded=!0:e.end()}))},o.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,r){"use strict";var n=t("readable-stream").Readable;function i(t,e,r){n.call(this,e),this._helper=t;var i=this;t.on("data",(function(t,e){i.push(t)||i._helper.pause(),r&&r(e)})).on("error",(function(t){i.emit("error",t)})).on("end",(function(){i.push(null)}))}t("../utils").inherits(i,n),i.prototype._read=function(){this._helper.resume()},e.exports=i},{"../utils":32,"readable-stream":16}],14:[function(t,e,r){"use strict";e.exports={isNode:void 0!==n,newBufferFrom:function(t,e){if(n.from&&n.from!==Uint8Array.from)return n.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new n(t,e)},allocBuffer:function(t){if(n.alloc)return n.alloc(t);var e=new n(t);return e.fill(0),e},isBuffer:function(t){return n.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,r){"use strict";function n(t,e,r){var n,i=o.getTypeOf(e),s=o.extend(r||{},c);s.date=s.date||new Date,null!==s.compression&&(s.compression=s.compression.toUpperCase()),"string"==typeof s.unixPermissions&&(s.unixPermissions=parseInt(s.unixPermissions,8)),s.unixPermissions&&16384&s.unixPermissions&&(s.dir=!0),s.dosPermissions&&16&s.dosPermissions&&(s.dir=!0),s.dir&&(t=y(t)),s.createFolders&&(n=d(t))&&g.call(this,n,!0);var h="string"===i&&!1===s.binary&&!1===s.base64;r&&void 0!==r.binary||(s.binary=!h),(e instanceof u&&0===e.uncompressedSize||s.dir||!e||0===e.length)&&(s.base64=!1,s.binary=!0,e="",s.compression="STORE",i="string");var m;m=e instanceof u||e instanceof a?e:f.isNode&&f.isStream(e)?new p(t,e):o.prepareContent(t,e,s.binary,s.optimizedBinaryString,s.base64);var v=new l(t,m,s);this.files[t]=v}var i=t("./utf8"),o=t("./utils"),a=t("./stream/GenericWorker"),s=t("./stream/StreamHelper"),c=t("./defaults"),u=t("./compressedObject"),l=t("./zipObject"),h=t("./generate"),f=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),d=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""},y=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},g=function(t,e){return e=void 0!==e?e:c.createFolders,t=y(t),this.files[t]||n.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function m(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,r,n;for(e in this.files)n=this.files[e],(r=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(r,n)},filter:function(t){var e=[];return this.forEach((function(r,n){t(r,n)&&e.push(n)})),e},file:function(t,e,r){if(1!==arguments.length)return t=this.root+t,n.call(this,t,e,r),this;if(m(t)){var i=t;return this.filter((function(t,e){return!e.dir&&i.test(t)}))}var o=this.files[this.root+t];return o&&!o.dir?o:null},folder:function(t){if(!t)return this;if(m(t))return this.filter((function(e,r){return r.dir&&t.test(e)}));var e=this.root+t,r=g.call(this,e),n=this.clone();return n.root=r.name,n},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var r=this.filter((function(e,r){return r.name.slice(0,t.length)===t})),n=0;n<r.length;n++)delete this.files[r[n].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,r={};try{if((r=o.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");o.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var n=r.comment||this.comment||"";e=h.generateWorker(this,r,n)}catch(t){(e=new a("error")).error(t)}return new s(e,r.type||"string",r.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,r){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,r){"use strict";var n=t("./DataReader");function i(t){n.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(i,n),i.prototype.byteAt=function(t){return this.data[this.zero+t]},i.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),r=t.charCodeAt(1),n=t.charCodeAt(2),i=t.charCodeAt(3),o=this.length-4;0<=o;--o)if(this.data[o]===e&&this.data[o+1]===r&&this.data[o+2]===n&&this.data[o+3]===i)return o-this.zero;return-1},i.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),r=t.charCodeAt(1),n=t.charCodeAt(2),i=t.charCodeAt(3),o=this.readData(4);return e===o[0]&&r===o[1]&&n===o[2]&&i===o[3]},i.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=i},{"../utils":32,"./DataReader":18}],18:[function(t,e,r){"use strict";var n=t("../utils");function i(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,r=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)r=(r<<8)+this.byteAt(e);return this.index+=t,r},readString:function(t){return n.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=i},{"../utils":32}],19:[function(t,e,r){"use strict";var n=t("./Uint8ArrayReader");function i(t){n.call(this,t)}t("../utils").inherits(i,n),i.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,r){"use strict";var n=t("./DataReader");function i(t){n.call(this,t)}t("../utils").inherits(i,n),i.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},i.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},i.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},i.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=i},{"../utils":32,"./DataReader":18}],21:[function(t,e,r){"use strict";var n=t("./ArrayReader");function i(t){n.call(this,t)}t("../utils").inherits(i,n),i.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,r){"use strict";var n=t("../utils"),i=t("../support"),o=t("./ArrayReader"),a=t("./StringReader"),s=t("./NodeBufferReader"),c=t("./Uint8ArrayReader");e.exports=function(t){var e=n.getTypeOf(t);return n.checkSupport(e),"string"!==e||i.uint8array?"nodebuffer"===e?new s(t):i.uint8array?new c(n.transformTo("uint8array",t)):new o(n.transformTo("array",t)):new a(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,r){"use strict";var n=t("./GenericWorker"),i=t("../utils");function o(t){n.call(this,"ConvertWorker to "+t),this.destType=t}i.inherits(o,n),o.prototype.processChunk=function(t){this.push({data:i.transformTo(this.destType,t.data),meta:t.meta})},e.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,r){"use strict";var n=t("./GenericWorker"),i=t("../crc32");function o(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,n),o.prototype.processChunk=function(t){this.streamInfo.crc32=i(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,r){"use strict";var n=t("../utils"),i=t("./GenericWorker");function o(t){i.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}n.inherits(o,i),o.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}i.prototype.processChunk.call(this,t)},e.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,r){"use strict";var n=t("../utils"),i=t("./GenericWorker");function o(t){i.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then((function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=n.getTypeOf(t),e.isPaused||e._tickAndRepeat()}),(function(t){e.error(t)}))}n.inherits(o,i),o.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,r){"use strict";function n(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.end()})),t.on("error",(function(t){e.error(t)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=n},{}],29:[function(t,e,r){"use strict";var i=t("../utils"),o=t("./ConvertWorker"),a=t("./GenericWorker"),s=t("../base64"),c=t("../support"),u=t("../external"),l=null;if(c.nodestream)try{l=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function h(t,e,r){var n=e;switch(e){case"blob":case"arraybuffer":n="uint8array";break;case"base64":n="string"}try{this._internalType=n,this._outputType=e,this._mimeType=r,i.checkSupport(n),this._worker=t.pipe(new o(n)),t.lock()}catch(t){this._worker=new a("error"),this._worker.error(t)}}h.prototype={accumulate:function(t){return function(t,e){return new u.Promise((function(r,o){var a=[],c=t._internalType,u=t._outputType,l=t._mimeType;t.on("data",(function(t,r){a.push(t),e&&e(r)})).on("error",(function(t){a=[],o(t)})).on("end",(function(){try{var t=function(t,e,r){switch(t){case"blob":return i.newBlob(i.transformTo("arraybuffer",e),r);case"base64":return s.encode(e);default:return i.transformTo(t,e)}}(u,function(t,e){var r,i=0,o=null,a=0;for(r=0;r<e.length;r++)a+=e[r].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(o=new Uint8Array(a),r=0;r<e.length;r++)o.set(e[r],i),i+=e[r].length;return o;case"nodebuffer":return n.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(c,a),l);r(t)}catch(t){o(t)}a=[]})).resume()}))}(this,t)},on:function(t,e){var r=this;return"data"===t?this._worker.on(t,(function(t){e.call(r,t.data,t.meta)})):this._worker.on(t,(function(){i.delay(e,arguments,r)})),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,r){"use strict";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer=void 0!==n,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=0===new Blob([i],{type:"application/zip"}).size}catch(t){try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(i),r.blob=0===o.getBlob("application/zip").size}catch(t){r.blob=!1}}}try{r.nodestream=!!t("readable-stream").Readable}catch(t){r.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,r){"use strict";for(var n=t("./utils"),i=t("./support"),o=t("./nodejsUtils"),a=t("./stream/GenericWorker"),s=new Array(256),c=0;c<256;c++)s[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function u(){a.call(this,"utf-8 decode"),this.leftOver=null}function l(){a.call(this,"utf-8 encode")}s[254]=s[254]=1,r.utf8encode=function(t){return i.nodebuffer?o.newBufferFrom(t,"utf-8"):function(t){var e,r,n,o,a,s=t.length,c=0;for(o=0;o<s;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),c+=r<128?1:r<2048?2:r<65536?3:4;for(e=i.uint8array?new Uint8Array(c):new Array(c),o=a=0;a<c;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),r<128?e[a++]=r:(r<2048?e[a++]=192|r>>>6:(r<65536?e[a++]=224|r>>>12:(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63),e[a++]=128|r>>>6&63),e[a++]=128|63&r);return e}(t)},r.utf8decode=function(t){return i.nodebuffer?n.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,r,i,o,a=t.length,c=new Array(2*a);for(e=r=0;e<a;)if((i=t[e++])<128)c[r++]=i;else if(4<(o=s[i]))c[r++]=65533,e+=o-1;else{for(i&=2===o?31:3===o?15:7;1<o&&e<a;)i=i<<6|63&t[e++],o--;1<o?c[r++]=65533:i<65536?c[r++]=i:(i-=65536,c[r++]=55296|i>>10&1023,c[r++]=56320|1023&i)}return c.length!==r&&(c.subarray?c=c.subarray(0,r):c.length=r),n.applyFromCharCode(c)}(t=n.transformTo(i.uint8array?"uint8array":"array",t))},n.inherits(u,a),u.prototype.processChunk=function(t){var e=n.transformTo(i.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var o=e;(e=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),e.set(o,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var a=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;0<=r&&128==(192&t[r]);)r--;return r<0||0===r?e:r+s[t[r]]>e?r:e}(e),c=e;a!==e.length&&(i.uint8array?(c=e.subarray(0,a),this.leftOver=e.subarray(a,e.length)):(c=e.slice(0,a),this.leftOver=e.slice(a,e.length))),this.push({data:r.utf8decode(c),meta:t.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=u,n.inherits(l,a),l.prototype.processChunk=function(t){this.push({data:r.utf8encode(t.data),meta:t.meta})},r.Utf8EncodeWorker=l},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,r){"use strict";var n=t("./support"),i=t("./base64"),o=t("./nodejsUtils"),a=t("set-immediate-shim"),s=t("./external");function c(t){return t}function u(t,e){for(var r=0;r<t.length;++r)e[r]=255&t.charCodeAt(r);return e}r.newBlob=function(t,e){r.checkSupport("blob");try{return new Blob([t],{type:e})}catch(r){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(t),n.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var l={stringifyByChunk:function(t,e,r){var n=[],i=0,o=t.length;if(o<=r)return String.fromCharCode.apply(null,t);for(;i<o;)"array"===e||"nodebuffer"===e?n.push(String.fromCharCode.apply(null,t.slice(i,Math.min(i+r,o)))):n.push(String.fromCharCode.apply(null,t.subarray(i,Math.min(i+r,o)))),i+=r;return n.join("")},stringifyByChar:function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&1===String.fromCharCode.apply(null,o.allocBuffer(1)).length}catch(t){return!1}}()}};function h(t){var e=65536,n=r.getTypeOf(t),i=!0;if("uint8array"===n?i=l.applyCanBeUsed.uint8array:"nodebuffer"===n&&(i=l.applyCanBeUsed.nodebuffer),i)for(;1<e;)try{return l.stringifyByChunk(t,n,e)}catch(t){e=Math.floor(e/2)}return l.stringifyByChar(t)}function f(t,e){for(var r=0;r<t.length;r++)e[r]=t[r];return e}r.applyFromCharCode=h;var p={};p.string={string:c,array:function(t){return u(t,new Array(t.length))},arraybuffer:function(t){return p.string.uint8array(t).buffer},uint8array:function(t){return u(t,new Uint8Array(t.length))},nodebuffer:function(t){return u(t,o.allocBuffer(t.length))}},p.array={string:h,array:c,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return o.newBufferFrom(t)}},p.arraybuffer={string:function(t){return h(new Uint8Array(t))},array:function(t){return f(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:c,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return o.newBufferFrom(new Uint8Array(t))}},p.uint8array={string:h,array:function(t){return f(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:c,nodebuffer:function(t){return o.newBufferFrom(t)}},p.nodebuffer={string:h,array:function(t){return f(t,new Array(t.length))},arraybuffer:function(t){return p.nodebuffer.uint8array(t).buffer},uint8array:function(t){return f(t,new Uint8Array(t.length))},nodebuffer:c},r.transformTo=function(t,e){if(e=e||"",!t)return e;r.checkSupport(t);var n=r.getTypeOf(e);return p[n][t](e)},r.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":n.nodebuffer&&o.isBuffer(t)?"nodebuffer":n.uint8array&&t instanceof Uint8Array?"uint8array":n.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(t){if(!n[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(t){var e,r,n="";for(r=0;r<(t||"").length;r++)n+="\\x"+((e=t.charCodeAt(r))<16?"0":"")+e.toString(16).toUpperCase();return n},r.delay=function(t,e,r){a((function(){t.apply(r||null,e||[])}))},r.inherits=function(t,e){function r(){}r.prototype=e.prototype,t.prototype=new r},r.extend=function(){var t,e,r={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===r[e]&&(r[e]=arguments[t][e]);return r},r.prepareContent=function(t,e,o,a,c){return s.Promise.resolve(e).then((function(t){return n.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new s.Promise((function(e,r){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.onerror=function(t){r(t.target.error)},n.readAsArrayBuffer(t)})):t})).then((function(e){var l=r.getTypeOf(e);return l?("arraybuffer"===l?e=r.transformTo("uint8array",e):"string"===l&&(c?e=i.decode(e):o&&!0!==a&&(e=function(t){return u(t,n.uint8array?new Uint8Array(t.length):new Array(t.length))}(e))),e):s.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,r){"use strict";var n=t("./reader/readerFor"),i=t("./utils"),o=t("./signature"),a=t("./zipEntry"),s=(t("./utf8"),t("./support"));function c(t){this.files=[],this.loadOptions=t}c.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(e)+", expected "+i.pretty(t)+")")}},isSignature:function(t,e){var r=this.reader.index;this.reader.setIndex(t);var n=this.reader.readString(4)===e;return this.reader.setIndex(r),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=s.uint8array?"uint8array":"array",r=i.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,r,n=this.zip64EndOfCentralSize-44;0<n;)t=this.reader.readInt(2),e=this.reader.readInt(4),r=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(t=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var n=e-r;if(0<n)this.isSignature(e,o.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(t){this.reader=n(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,r){"use strict";var n=t("./reader/readerFor"),i=t("./utils"),o=t("./compressedObject"),a=t("./crc32"),s=t("./utf8"),c=t("./compressions"),u=t("./support");function l(t,e){this.options=t,this.loadOptions=e}l.prototype={isEncrypted:function(){return!(1&~this.bitFlag)},useUTF8:function(){return!(2048&~this.bitFlag)},readLocalPart:function(t){var e,r;if(t.skip(22),this.fileNameLength=t.readInt(2),r=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in c)if(c.hasOwnProperty(e)&&c[e].magic===t)return c[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,r,n,i=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index+4<i;)e=t.readInt(2),r=t.readInt(2),n=t.readData(r),this.extraFields[e]={id:e,length:r,value:n};t.setIndex(i)},handleUTF8:function(){var t=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var r=i.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var o=i.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(o)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=n(t.value);return 1!==e.readInt(1)||a(this.fileName)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=n(t.value);return 1!==e.readInt(1)||a(this.fileComment)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null}},e.exports=l},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,r){"use strict";function n(t,e,r){this.name=t,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=e,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var i=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),a=t("./utf8"),s=t("./compressedObject"),c=t("./stream/GenericWorker");n.prototype={internalStream:function(t){var e=null,r="string";try{if(!t)throw new Error("No output type specified.");var n="string"===(r=t.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),e=this._decompressWorker();var o=!this._dataBinary;o&&!n&&(e=e.pipe(new a.Utf8EncodeWorker)),!o&&n&&(e=e.pipe(new a.Utf8DecodeWorker))}catch(t){(e=new c("error")).error(t)}return new i(e,r,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof s&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new a.Utf8EncodeWorker)),s.createWorkerFrom(r,t,e)},_decompressWorker:function(){return this._data instanceof s?this._data.getContentWorker():this._data instanceof c?this._data:new o(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],l=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<u.length;h++)n.prototype[u[h]]=l;e.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,n){(function(t){"use strict";var r,n,i=t.MutationObserver||t.WebKitMutationObserver;if(i){var o=0,a=new i(l),s=t.document.createTextNode("");a.observe(s,{characterData:!0}),r=function(){s.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)r="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){l(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(l,0)};else{var c=new t.MessageChannel;c.port1.onmessage=l,r=function(){c.port2.postMessage(0)}}var u=[];function l(){var t,e;n=!0;for(var r=u.length;r;){for(e=u,u=[],t=-1;++t<r;)e[t]();r=u.length}n=!1}e.exports=function(t){1!==u.push(t)||n||r()}}).call(this,void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,r){"use strict";var n=t("immediate");function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function u(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,t!==i&&p(this,t)}function l(t,e,r){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function h(t,e,r){n((function(){var n;try{n=e(r)}catch(n){return o.reject(t,n)}n===t?o.reject(t,new TypeError("Cannot resolve promise with itself")):o.resolve(t,n)}))}function f(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function p(t,e){var r=!1;function n(e){r||(r=!0,o.reject(t,e))}function i(e){r||(r=!0,o.resolve(t,e))}var a=d((function(){e(i,n)}));"error"===a.status&&n(a.value)}function d(t,e){var r={};try{r.value=t(e),r.status="success"}catch(t){r.status="error",r.value=t}return r}(e.exports=u).prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then((function(r){return e.resolve(t()).then((function(){return r}))}),(function(r){return e.resolve(t()).then((function(){throw r}))}))},u.prototype.catch=function(t){return this.then(null,t)},u.prototype.then=function(t,e){if("function"!=typeof t&&this.state===s||"function"!=typeof e&&this.state===a)return this;var r=new this.constructor(i);return this.state!==c?h(r,this.state===s?t:e,this.outcome):this.queue.push(new l(r,t,e)),r},l.prototype.callFulfilled=function(t){o.resolve(this.promise,t)},l.prototype.otherCallFulfilled=function(t){h(this.promise,this.onFulfilled,t)},l.prototype.callRejected=function(t){o.reject(this.promise,t)},l.prototype.otherCallRejected=function(t){h(this.promise,this.onRejected,t)},o.resolve=function(t,e){var r=d(f,e);if("error"===r.status)return o.reject(t,r.value);var n=r.value;if(n)p(t,n);else{t.state=s,t.outcome=e;for(var i=-1,a=t.queue.length;++i<a;)t.queue[i].callFulfilled(e)}return t},o.reject=function(t,e){t.state=a,t.outcome=e;for(var r=-1,n=t.queue.length;++r<n;)t.queue[r].callRejected(e);return t},u.resolve=function(t){return t instanceof this?t:o.resolve(new this(i),t)},u.reject=function(t){var e=new this(i);return o.reject(e,t)},u.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,n=!1;if(!r)return this.resolve([]);for(var a=new Array(r),s=0,c=-1,u=new this(i);++c<r;)l(t[c],c);return u;function l(t,i){e.resolve(t).then((function(t){a[i]=t,++s!==r||n||(n=!0,o.resolve(u,a))}),(function(t){n||(n=!0,o.reject(u,t))}))}},u.race=function(t){if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,r=!1;if(!e)return this.resolve([]);for(var n,a=-1,s=new this(i);++a<e;)n=t[a],this.resolve(n).then((function(t){r||(r=!0,o.resolve(s,t))}),(function(t){r||(r=!0,o.reject(s,t))}));return s}},{immediate:36}],38:[function(t,e,r){"use strict";var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,r){"use strict";var n=t("./zlib/deflate"),i=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/messages"),s=t("./zlib/zstream"),c=Object.prototype.toString;function u(t){if(!(this instanceof u))return new u(t);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==r)throw new Error(a[r]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){var l;if(l="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(r=n.deflateSetDictionary(this.strm,l)))throw new Error(a[r]);this._dict_set=!0}}function l(t,e){var r=new u(e);if(r.push(t,!0),r.err)throw r.msg||a[r.err];return r.result}u.prototype.push=function(t,e){var r,a,s=this.strm,u=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0,"string"==typeof t?s.input=o.string2buf(t):"[object ArrayBuffer]"===c.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(u),s.next_out=0,s.avail_out=u),1!==(r=n.deflate(s,a))&&0!==r)return this.onEnd(r),!(this.ended=!0);0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((0<s.avail_in||0===s.avail_out)&&1!==r);return 4===a?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==a||(this.onEnd(0),!(s.avail_out=0))},u.prototype.onData=function(t){this.chunks.push(t)},u.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Deflate=u,r.deflate=l,r.deflateRaw=function(t,e){return(e=e||{}).raw=!0,l(t,e)},r.gzip=function(t,e){return(e=e||{}).gzip=!0,l(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,r){"use strict";var n=t("./zlib/inflate"),i=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/constants"),s=t("./zlib/messages"),c=t("./zlib/zstream"),u=t("./zlib/gzheader"),l=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&!(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,e.windowBits);if(r!==a.Z_OK)throw new Error(s[r]);this.header=new u,n.inflateGetHeader(this.strm,this.header)}function f(t,e){var r=new h(e);if(r.push(t,!0),r.err)throw r.msg||s[r.err];return r.result}h.prototype.push=function(t,e){var r,s,c,u,h,f,p=this.strm,d=this.options.chunkSize,y=this.options.dictionary,g=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?p.input=o.binstring2buf(t):"[object ArrayBuffer]"===l.call(t)?p.input=new Uint8Array(t):p.input=t,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new i.Buf8(d),p.next_out=0,p.avail_out=d),(r=n.inflate(p,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&y&&(f="string"==typeof y?o.string2buf(y):"[object ArrayBuffer]"===l.call(y)?new Uint8Array(y):y,r=n.inflateSetDictionary(this.strm,f)),r===a.Z_BUF_ERROR&&!0===g&&(r=a.Z_OK,g=!1),r!==a.Z_STREAM_END&&r!==a.Z_OK)return this.onEnd(r),!(this.ended=!0);p.next_out&&(0!==p.avail_out&&r!==a.Z_STREAM_END&&(0!==p.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(c=o.utf8border(p.output,p.next_out),u=p.next_out-c,h=o.buf2string(p.output,c),p.next_out=u,p.avail_out=d-u,u&&i.arraySet(p.output,p.output,c,u,0),this.onData(h)):this.onData(i.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(g=!0)}while((0<p.avail_in||0===p.avail_out)&&r!==a.Z_STREAM_END);return r===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(p.avail_out=0))},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Inflate=h,r.inflate=f,r.inflateRaw=function(t,e){return(e=e||{}).raw=!0,f(t,e)},r.ungzip=f},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}}return t},r.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var i={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){var e,r,n,i,o,a;for(e=n=0,r=t.length;e<r;e++)n+=t[e].length;for(a=new Uint8Array(n),e=i=0,r=t.length;e<r;e++)o=t[e],a.set(o,i),i+=o.length;return a}},o={arraySet:function(t,e,r,n,i){for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){t?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(n)},{}],42:[function(t,e,r){"use strict";var n=t("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var a=new n.Buf8(256),s=0;s<256;s++)a[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;function c(t,e){if(e<65537&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var r="",a=0;a<e;a++)r+=String.fromCharCode(t[a]);return r}a[254]=a[254]=1,r.string2buf=function(t){var e,r,i,o,a,s=t.length,c=0;for(o=0;o<s;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),c+=r<128?1:r<2048?2:r<65536?3:4;for(e=new n.Buf8(c),o=a=0;a<c;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?e[a++]=r:(r<2048?e[a++]=192|r>>>6:(r<65536?e[a++]=224|r>>>12:(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63),e[a++]=128|r>>>6&63),e[a++]=128|63&r);return e},r.buf2binstring=function(t){return c(t,t.length)},r.binstring2buf=function(t){for(var e=new n.Buf8(t.length),r=0,i=e.length;r<i;r++)e[r]=t.charCodeAt(r);return e},r.buf2string=function(t,e){var r,n,i,o,s=e||t.length,u=new Array(2*s);for(r=n=0;r<s;)if((i=t[r++])<128)u[n++]=i;else if(4<(o=a[i]))u[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;1<o&&r<s;)i=i<<6|63&t[r++],o--;1<o?u[n++]=65533:i<65536?u[n++]=i:(i-=65536,u[n++]=55296|i>>10&1023,u[n++]=56320|1023&i)}return c(u,n)},r.utf8border=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;0<=r&&128==(192&t[r]);)r--;return r<0||0===r?e:r+a[t[r]]>e?r:e}},{"./common":41}],43:[function(t,e,r){"use strict";e.exports=function(t,e,r,n){for(var i=65535&t,o=t>>>16&65535,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;o=o+(i=i+e[n++]|0)|0,--a;);i%=65521,o%=65521}return i|o<<16}},{}],44:[function(t,e,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,r){"use strict";var n=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e,r,i){var o=n,a=i+r;t^=-1;for(var s=i;s<a;s++)t=t>>>8^o[255&(t^e[s])];return~t}},{}],46:[function(t,e,r){"use strict";var n,i=t("../utils/common"),o=t("./trees"),a=t("./adler32"),s=t("./crc32"),c=t("./messages"),u=-2,l=258,h=262,f=113;function p(t,e){return t.msg=c[e],e}function d(t){return(t<<1)-(4<t?9:0)}function y(t){for(var e=t.length;0<=--e;)t[e]=0}function g(t){var e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(i.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function m(t,e){o._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,g(t.strm)}function v(t,e){t.pending_buf[t.pending++]=e}function b(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function w(t,e){var r,n,i=t.max_chain_length,o=t.strstart,a=t.prev_length,s=t.nice_match,c=t.strstart>t.w_size-h?t.strstart-(t.w_size-h):0,u=t.window,f=t.w_mask,p=t.prev,d=t.strstart+l,y=u[o+a-1],g=u[o+a];t.prev_length>=t.good_match&&(i>>=2),s>t.lookahead&&(s=t.lookahead);do{if(u[(r=e)+a]===g&&u[r+a-1]===y&&u[r]===u[o]&&u[++r]===u[o+1]){o+=2,r++;do{}while(u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&o<d);if(n=l-(d-o),o=d-l,a<n){if(t.match_start=e,s<=(a=n))break;y=u[o+a-1],g=u[o+a]}}}while((e=p[e&f])>c&&0!=--i);return a<=t.lookahead?a:t.lookahead}function x(t){var e,r,n,o,c,u,l,f,p,d,y=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=y+(y-h)){for(i.arraySet(t.window,t.window,y,y,0),t.match_start-=y,t.strstart-=y,t.block_start-=y,e=r=t.hash_size;n=t.head[--e],t.head[e]=y<=n?n-y:0,--r;);for(e=r=y;n=t.prev[--e],t.prev[e]=y<=n?n-y:0,--r;);o+=y}if(0===t.strm.avail_in)break;if(u=t.strm,l=t.window,f=t.strstart+t.lookahead,d=void 0,(p=o)<(d=u.avail_in)&&(d=p),r=0===d?0:(u.avail_in-=d,i.arraySet(l,u.input,u.next_in,d,f),1===u.state.wrap?u.adler=a(u.adler,l,d,f):2===u.state.wrap&&(u.adler=s(u.adler,l,d,f)),u.next_in+=d,u.total_in+=d,d),t.lookahead+=r,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+3-1])&t.hash_mask,t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<h&&0!==t.strm.avail_in)}function _(t,e){for(var r,n;;){if(t.lookahead<h){if(x(t),t.lookahead<h&&0===e)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-h&&(t.match_length=w(t,r)),t.match_length>=3)if(n=o._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(m(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(m(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(m(t,!1),0===t.strm.avail_out)?1:2}function E(t,e){for(var r,n,i;;){if(t.lookahead<h){if(x(t),t.lookahead<h&&0===e)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-h&&(t.match_length=w(t,r),t.match_length<=5&&(1===t.strategy||3===t.match_length&&4096<t.strstart-t.match_start)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){for(i=t.strstart+t.lookahead-3,n=o._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(m(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((n=o._tr_tally(t,0,t.window[t.strstart-1]))&&m(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=o._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(m(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(m(t,!1),0===t.strm.avail_out)?1:2}function A(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),y(this.dyn_ltree),y(this.dyn_dtree),y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function S(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:f,t.adler=2===e.wrap?0:1,e.last_flush=0,o._tr_init(e),0):p(t,u)}function T(t){var e=S(t);return 0===e&&function(t){t.window_size=2*t.w_size,y(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0}(t.state),e}function L(t,e,r,n,o,a){if(!t)return u;var s=1;if(-1===e&&(e=6),n<0?(s=0,n=-n):15<n&&(s=2,n-=16),o<1||9<o||8!==r||n<8||15<n||e<0||9<e||a<0||4<a)return p(t,u);8===n&&(n=9);var c=new k;return(t.state=c).strm=t,c.wrap=s,c.gzhead=null,c.w_bits=n,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=o+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<o+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=e,c.strategy=a,c.method=r,T(t)}n=[new A(0,0,0,0,(function(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(x(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+r;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,m(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-h&&(m(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(m(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(m(t,!1),t.strm.avail_out),1)})),new A(4,4,8,4,_),new A(4,5,16,8,_),new A(4,6,32,32,_),new A(4,4,16,16,E),new A(8,16,32,32,E),new A(8,16,128,128,E),new A(8,32,128,256,E),new A(32,128,258,1024,E),new A(32,258,258,4096,E)],r.deflateInit=function(t,e){return L(t,e,8,15,8,0)},r.deflateInit2=L,r.deflateReset=T,r.deflateResetKeep=S,r.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?u:(t.state.gzhead=e,0):u},r.deflate=function(t,e){var r,i,a,c;if(!t||!t.state||5<e||e<0)return t?p(t,u):u;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||666===i.status&&4!==e)return p(t,0===t.avail_out?-5:u);if(i.strm=t,r=i.last_flush,i.last_flush=e,42===i.status)if(2===i.wrap)t.adler=0,v(i,31),v(i,139),v(i,8),i.gzhead?(v(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),v(i,255&i.gzhead.time),v(i,i.gzhead.time>>8&255),v(i,i.gzhead.time>>16&255),v(i,i.gzhead.time>>24&255),v(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),v(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(v(i,255&i.gzhead.extra.length),v(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=s(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(v(i,0),v(i,0),v(i,0),v(i,0),v(i,0),v(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),v(i,3),i.status=f);else{var h=8+(i.w_bits-8<<4)<<8;h|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(h|=32),h+=31-h%31,i.status=f,b(i,h),0!==i.strstart&&(b(i,t.adler>>>16),b(i,65535&t.adler)),t.adler=1}if(69===i.status)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),g(t),a=i.pending,i.pending!==i.pending_buf_size));)v(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),g(t),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,v(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),g(t),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,v(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&g(t),i.pending+2<=i.pending_buf_size&&(v(i,255&t.adler),v(i,t.adler>>8&255),t.adler=0,i.status=f)):i.status=f),0!==i.pending){if(g(t),0===t.avail_out)return i.last_flush=-1,0}else if(0===t.avail_in&&d(e)<=d(r)&&4!==e)return p(t,-5);if(666===i.status&&0!==t.avail_in)return p(t,-5);if(0!==t.avail_in||0!==i.lookahead||0!==e&&666!==i.status){var w=2===i.strategy?function(t,e){for(var r;;){if(0===t.lookahead&&(x(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,r=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(m(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(m(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(m(t,!1),0===t.strm.avail_out)?1:2}(i,e):3===i.strategy?function(t,e){for(var r,n,i,a,s=t.window;;){if(t.lookahead<=l){if(x(t),t.lookahead<=l&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&0<t.strstart&&(n=s[i=t.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){a=t.strstart+l;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<a);t.match_length=l-(a-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(r=o._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(m(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(m(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(m(t,!1),0===t.strm.avail_out)?1:2}(i,e):n[i.level].func(i,e);if(3!==w&&4!==w||(i.status=666),1===w||3===w)return 0===t.avail_out&&(i.last_flush=-1),0;if(2===w&&(1===e?o._tr_align(i):5!==e&&(o._tr_stored_block(i,0,0,!1),3===e&&(y(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),g(t),0===t.avail_out))return i.last_flush=-1,0}return 4!==e?0:i.wrap<=0?1:(2===i.wrap?(v(i,255&t.adler),v(i,t.adler>>8&255),v(i,t.adler>>16&255),v(i,t.adler>>24&255),v(i,255&t.total_in),v(i,t.total_in>>8&255),v(i,t.total_in>>16&255),v(i,t.total_in>>24&255)):(b(i,t.adler>>>16),b(i,65535&t.adler)),g(t),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?0:1)},r.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&103!==e&&e!==f&&666!==e?p(t,u):(t.state=null,e===f?p(t,-3):0):u},r.deflateSetDictionary=function(t,e){var r,n,o,s,c,l,h,f,p=e.length;if(!t||!t.state)return u;if(2===(s=(r=t.state).wrap)||1===s&&42!==r.status||r.lookahead)return u;for(1===s&&(t.adler=a(t.adler,e,p,0)),r.wrap=0,p>=r.w_size&&(0===s&&(y(r.head),r.strstart=0,r.block_start=0,r.insert=0),f=new i.Buf8(r.w_size),i.arraySet(f,e,p-r.w_size,r.w_size,0),e=f,p=r.w_size),c=t.avail_in,l=t.next_in,h=t.input,t.avail_in=p,t.next_in=0,t.input=e,x(r);r.lookahead>=3;){for(n=r.strstart,o=r.lookahead-2;r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+3-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++,--o;);r.strstart=n,r.lookahead=2,x(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,t.next_in=l,t.input=h,t.avail_in=c,r.wrap=s,0},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,r){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,r){"use strict";e.exports=function(t,e){var r,n,i,o,a,s,c,u,l,h,f,p,d,y,g,m,v,b,w,x,_,E,A,k,S;r=t.state,n=t.next_in,k=t.input,i=n+(t.avail_in-5),o=t.next_out,S=t.output,a=o-(e-t.avail_out),s=o+(t.avail_out-257),c=r.dmax,u=r.wsize,l=r.whave,h=r.wnext,f=r.window,p=r.hold,d=r.bits,y=r.lencode,g=r.distcode,m=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;t:do{d<15&&(p+=k[n++]<<d,d+=8,p+=k[n++]<<d,d+=8),b=y[p&m];e:for(;;){if(p>>>=w=b>>>24,d-=w,0==(w=b>>>16&255))S[o++]=65535&b;else{if(!(16&w)){if(!(64&w)){b=y[(65535&b)+(p&(1<<w)-1)];continue e}if(32&w){r.mode=12;break t}t.msg="invalid literal/length code",r.mode=30;break t}x=65535&b,(w&=15)&&(d<w&&(p+=k[n++]<<d,d+=8),x+=p&(1<<w)-1,p>>>=w,d-=w),d<15&&(p+=k[n++]<<d,d+=8,p+=k[n++]<<d,d+=8),b=g[p&v];r:for(;;){if(p>>>=w=b>>>24,d-=w,!(16&(w=b>>>16&255))){if(!(64&w)){b=g[(65535&b)+(p&(1<<w)-1)];continue r}t.msg="invalid distance code",r.mode=30;break t}if(_=65535&b,d<(w&=15)&&(p+=k[n++]<<d,(d+=8)<w&&(p+=k[n++]<<d,d+=8)),c<(_+=p&(1<<w)-1)){t.msg="invalid distance too far back",r.mode=30;break t}if(p>>>=w,d-=w,(w=o-a)<_){if(l<(w=_-w)&&r.sane){t.msg="invalid distance too far back",r.mode=30;break t}if(A=f,(E=0)===h){if(E+=u-w,w<x){for(x-=w;S[o++]=f[E++],--w;);E=o-_,A=S}}else if(h<w){if(E+=u+h-w,(w-=h)<x){for(x-=w;S[o++]=f[E++],--w;);if(E=0,h<x){for(x-=w=h;S[o++]=f[E++],--w;);E=o-_,A=S}}}else if(E+=h-w,w<x){for(x-=w;S[o++]=f[E++],--w;);E=o-_,A=S}for(;2<x;)S[o++]=A[E++],S[o++]=A[E++],S[o++]=A[E++],x-=3;x&&(S[o++]=A[E++],1<x&&(S[o++]=A[E++]))}else{for(E=o-_;S[o++]=S[E++],S[o++]=S[E++],S[o++]=S[E++],2<(x-=3););x&&(S[o++]=S[E++],1<x&&(S[o++]=S[E++]))}break}}break}}while(n<i&&o<s);n-=x=d>>3,p&=(1<<(d-=x<<3))-1,t.next_in=n,t.next_out=o,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=o<s?s-o+257:257-(o-s),r.hold=p,r.bits=d}},{}],49:[function(t,e,r){"use strict";var n=t("../utils/common"),i=t("./adler32"),o=t("./crc32"),a=t("./inffast"),s=t("./inftrees"),c=-2;function u(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function h(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(852),e.distcode=e.distdyn=new n.Buf32(592),e.sane=1,e.back=-1,0):c}function f(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,h(t)):c}function p(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?c:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,f(t))):c}function d(t,e){var r,n;return t?(n=new l,(t.state=n).window=null,0!==(r=p(t,e))&&(t.state=null),r):c}var y,g,m=!0;function v(t){if(m){var e;for(y=new n.Buf32(512),g=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(s(1,t.lens,0,288,y,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;s(2,t.lens,0,32,g,0,t.work,{bits:5}),m=!1}t.lencode=y,t.lenbits=9,t.distcode=g,t.distbits=5}function b(t,e,r,i){var o,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),i>=a.wsize?(n.arraySet(a.window,e,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(i<(o=a.wsize-a.wnext)&&(o=i),n.arraySet(a.window,e,r-i,o,a.wnext),(i-=o)?(n.arraySet(a.window,e,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}r.inflateReset=f,r.inflateReset2=p,r.inflateResetKeep=h,r.inflateInit=function(t){return d(t,15)},r.inflateInit2=d,r.inflate=function(t,e){var r,l,h,f,p,d,y,g,m,w,x,_,E,A,k,S,T,L,O,C,P,M,I,j,R=0,N=new n.Buf8(4),B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return c;12===(r=t.state).mode&&(r.mode=13),p=t.next_out,h=t.output,y=t.avail_out,f=t.next_in,l=t.input,d=t.avail_in,g=r.hold,m=r.bits,w=d,x=y,M=0;t:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;m<16;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}if(2&r.wrap&&35615===g){N[r.check=0]=255&g,N[1]=g>>>8&255,r.check=o(r.check,N,2,0),m=g=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&g)<<8)+(g>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&g)){t.msg="unknown compression method",r.mode=30;break}if(m-=4,P=8+(15&(g>>>=4)),0===r.wbits)r.wbits=P;else if(P>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<P,t.adler=r.check=1,r.mode=512&g?10:12,m=g=0;break;case 2:for(;m<16;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}if(r.flags=g,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=g>>8&1),512&r.flags&&(N[0]=255&g,N[1]=g>>>8&255,r.check=o(r.check,N,2,0)),m=g=0,r.mode=3;case 3:for(;m<32;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}r.head&&(r.head.time=g),512&r.flags&&(N[0]=255&g,N[1]=g>>>8&255,N[2]=g>>>16&255,N[3]=g>>>24&255,r.check=o(r.check,N,4,0)),m=g=0,r.mode=4;case 4:for(;m<16;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}r.head&&(r.head.xflags=255&g,r.head.os=g>>8),512&r.flags&&(N[0]=255&g,N[1]=g>>>8&255,r.check=o(r.check,N,2,0)),m=g=0,r.mode=5;case 5:if(1024&r.flags){for(;m<16;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}r.length=g,r.head&&(r.head.extra_len=g),512&r.flags&&(N[0]=255&g,N[1]=g>>>8&255,r.check=o(r.check,N,2,0)),m=g=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(d<(_=r.length)&&(_=d),_&&(r.head&&(P=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,l,f,_,P)),512&r.flags&&(r.check=o(r.check,l,_,f)),d-=_,f+=_,r.length-=_),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===d)break t;for(_=0;P=l[f+_++],r.head&&P&&r.length<65536&&(r.head.name+=String.fromCharCode(P)),P&&_<d;);if(512&r.flags&&(r.check=o(r.check,l,_,f)),d-=_,f+=_,P)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===d)break t;for(_=0;P=l[f+_++],r.head&&P&&r.length<65536&&(r.head.comment+=String.fromCharCode(P)),P&&_<d;);if(512&r.flags&&(r.check=o(r.check,l,_,f)),d-=_,f+=_,P)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;m<16;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}if(g!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}m=g=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;m<32;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}t.adler=r.check=u(g),m=g=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=p,t.avail_out=y,t.next_in=f,t.avail_in=d,r.hold=g,r.bits=m,2;t.adler=r.check=1,r.mode=12;case 12:if(5===e||6===e)break t;case 13:if(r.last){g>>>=7&m,m-=7&m,r.mode=27;break}for(;m<3;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}switch(r.last=1&g,m-=1,3&(g>>>=1)){case 0:r.mode=14;break;case 1:if(v(r),r.mode=20,6!==e)break;g>>>=2,m-=2;break t;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}g>>>=2,m-=2;break;case 14:for(g>>>=7&m,m-=7&m;m<32;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}if((65535&g)!=(g>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&g,m=g=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(_=r.length){if(d<_&&(_=d),y<_&&(_=y),0===_)break t;n.arraySet(h,l,f,_,p),d-=_,f+=_,y-=_,p+=_,r.length-=_;break}r.mode=12;break;case 17:for(;m<14;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}if(r.nlen=257+(31&g),g>>>=5,m-=5,r.ndist=1+(31&g),g>>>=5,m-=5,r.ncode=4+(15&g),g>>>=4,m-=4,286<r.nlen||30<r.ndist){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;m<3;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}r.lens[B[r.have++]]=7&g,g>>>=3,m-=3}for(;r.have<19;)r.lens[B[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,I={bits:r.lenbits},M=s(0,r.lens,0,19,r.lencode,0,r.work,I),r.lenbits=I.bits,M){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;S=(R=r.lencode[g&(1<<r.lenbits)-1])>>>16&255,T=65535&R,!((k=R>>>24)<=m);){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}if(T<16)g>>>=k,m-=k,r.lens[r.have++]=T;else{if(16===T){for(j=k+2;m<j;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}if(g>>>=k,m-=k,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}P=r.lens[r.have-1],_=3+(3&g),g>>>=2,m-=2}else if(17===T){for(j=k+3;m<j;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}m-=k,P=0,_=3+(7&(g>>>=k)),g>>>=3,m-=3}else{for(j=k+7;m<j;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}m-=k,P=0,_=11+(127&(g>>>=k)),g>>>=7,m-=7}if(r.have+_>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;_--;)r.lens[r.have++]=P}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,I={bits:r.lenbits},M=s(1,r.lens,0,r.nlen,r.lencode,0,r.work,I),r.lenbits=I.bits,M){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,I={bits:r.distbits},M=s(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,I),r.distbits=I.bits,M){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(6<=d&&258<=y){t.next_out=p,t.avail_out=y,t.next_in=f,t.avail_in=d,r.hold=g,r.bits=m,a(t,x),p=t.next_out,h=t.output,y=t.avail_out,f=t.next_in,l=t.input,d=t.avail_in,g=r.hold,m=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;S=(R=r.lencode[g&(1<<r.lenbits)-1])>>>16&255,T=65535&R,!((k=R>>>24)<=m);){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}if(S&&!(240&S)){for(L=k,O=S,C=T;S=(R=r.lencode[C+((g&(1<<L+O)-1)>>L)])>>>16&255,T=65535&R,!(L+(k=R>>>24)<=m);){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}g>>>=L,m-=L,r.back+=L}if(g>>>=k,m-=k,r.back+=k,r.length=T,0===S){r.mode=26;break}if(32&S){r.back=-1,r.mode=12;break}if(64&S){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&S,r.mode=22;case 22:if(r.extra){for(j=r.extra;m<j;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}r.length+=g&(1<<r.extra)-1,g>>>=r.extra,m-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;S=(R=r.distcode[g&(1<<r.distbits)-1])>>>16&255,T=65535&R,!((k=R>>>24)<=m);){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}if(!(240&S)){for(L=k,O=S,C=T;S=(R=r.distcode[C+((g&(1<<L+O)-1)>>L)])>>>16&255,T=65535&R,!(L+(k=R>>>24)<=m);){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}g>>>=L,m-=L,r.back+=L}if(g>>>=k,m-=k,r.back+=k,64&S){t.msg="invalid distance code",r.mode=30;break}r.offset=T,r.extra=15&S,r.mode=24;case 24:if(r.extra){for(j=r.extra;m<j;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}r.offset+=g&(1<<r.extra)-1,g>>>=r.extra,m-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===y)break t;if(_=x-y,r.offset>_){if((_=r.offset-_)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}E=_>r.wnext?(_-=r.wnext,r.wsize-_):r.wnext-_,_>r.length&&(_=r.length),A=r.window}else A=h,E=p-r.offset,_=r.length;for(y<_&&(_=y),y-=_,r.length-=_;h[p++]=A[E++],--_;);0===r.length&&(r.mode=21);break;case 26:if(0===y)break t;h[p++]=r.length,y--,r.mode=21;break;case 27:if(r.wrap){for(;m<32;){if(0===d)break t;d--,g|=l[f++]<<m,m+=8}if(x-=y,t.total_out+=x,r.total+=x,x&&(t.adler=r.check=r.flags?o(r.check,h,x,p-x):i(r.check,h,x,p-x)),x=y,(r.flags?g:u(g))!==r.check){t.msg="incorrect data check",r.mode=30;break}m=g=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;m<32;){if(0===d)break t;d--,g+=l[f++]<<m,m+=8}if(g!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}m=g=0}r.mode=29;case 29:M=1;break t;case 30:M=-3;break t;case 31:return-4;default:return c}return t.next_out=p,t.avail_out=y,t.next_in=f,t.avail_in=d,r.hold=g,r.bits=m,(r.wsize||x!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&b(t,t.output,t.next_out,x-t.avail_out)?(r.mode=31,-4):(w-=t.avail_in,x-=t.avail_out,t.total_in+=w,t.total_out+=x,r.total+=x,r.wrap&&x&&(t.adler=r.check=r.flags?o(r.check,h,x,t.next_out-x):i(r.check,h,x,t.next_out-x)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==w&&0===x||4===e)&&0===M&&(M=-5),M)},r.inflateEnd=function(t){if(!t||!t.state)return c;var e=t.state;return e.window&&(e.window=null),t.state=null,0},r.inflateGetHeader=function(t,e){var r;return t&&t.state&&2&(r=t.state).wrap?((r.head=e).done=!1,0):c},r.inflateSetDictionary=function(t,e){var r,n=e.length;return t&&t.state?0!==(r=t.state).wrap&&11!==r.mode?c:11===r.mode&&i(1,e,n,0)!==r.check?-3:b(t,e,n,n)?(r.mode=31,-4):(r.havedict=1,0):c},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,r){"use strict";var n=t("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,r,c,u,l,h,f){var p,d,y,g,m,v,b,w,x,_=f.bits,E=0,A=0,k=0,S=0,T=0,L=0,O=0,C=0,P=0,M=0,I=null,j=0,R=new n.Buf16(16),N=new n.Buf16(16),B=null,D=0;for(E=0;E<=15;E++)R[E]=0;for(A=0;A<c;A++)R[e[r+A]]++;for(T=_,S=15;1<=S&&0===R[S];S--);if(S<T&&(T=S),0===S)return u[l++]=20971520,u[l++]=20971520,f.bits=1,0;for(k=1;k<S&&0===R[k];k++);for(T<k&&(T=k),E=C=1;E<=15;E++)if(C<<=1,(C-=R[E])<0)return-1;if(0<C&&(0===t||1!==S))return-1;for(N[1]=0,E=1;E<15;E++)N[E+1]=N[E]+R[E];for(A=0;A<c;A++)0!==e[r+A]&&(h[N[e[r+A]]++]=A);if(v=0===t?(I=B=h,19):1===t?(I=i,j-=257,B=o,D-=257,256):(I=a,B=s,-1),E=k,m=l,O=A=M=0,y=-1,g=(P=1<<(L=T))-1,1===t&&852<P||2===t&&592<P)return 1;for(;;){for(b=E-O,x=h[A]<v?(w=0,h[A]):h[A]>v?(w=B[D+h[A]],I[j+h[A]]):(w=96,0),p=1<<E-O,k=d=1<<L;u[m+(M>>O)+(d-=p)]=b<<24|w<<16|x,0!==d;);for(p=1<<E-1;M&p;)p>>=1;if(0!==p?(M&=p-1,M+=p):M=0,A++,0==--R[E]){if(E===S)break;E=e[r+h[A]]}if(T<E&&(M&g)!==y){for(0===O&&(O=T),m+=k,C=1<<(L=E-O);L+O<S&&!((C-=R[L+O])<=0);)L++,C<<=1;if(P+=1<<L,1===t&&852<P||2===t&&592<P)return 1;u[y=M&g]=T<<24|L<<16|m-l}}return 0!==M&&(u[m+M]=E-O<<24|64<<16),f.bits=T,0}},{"../utils/common":41}],51:[function(t,e,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,r){"use strict";var n=t("../utils/common");function i(t){for(var e=t.length;0<=--e;)t[e]=0}var o=256,a=286,s=30,c=15,u=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],l=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],f=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],p=new Array(576);i(p);var d=new Array(60);i(d);var y=new Array(512);i(y);var g=new Array(256);i(g);var m=new Array(29);i(m);var v,b,w,x=new Array(s);function _(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}function E(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function A(t){return t<256?y[t]:y[256+(t>>>7)]}function k(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function S(t,e,r){t.bi_valid>16-r?(t.bi_buf|=e<<t.bi_valid&65535,k(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=r-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function T(t,e,r){S(t,r[2*e],r[2*e+1])}function L(t,e){for(var r=0;r|=1&t,t>>>=1,r<<=1,0<--e;);return r>>>1}function O(t,e,r){var n,i,o=new Array(16),a=0;for(n=1;n<=c;n++)o[n]=a=a+r[n-1]<<1;for(i=0;i<=e;i++){var s=t[2*i+1];0!==s&&(t[2*i]=L(o[s]++,s))}}function C(t){var e;for(e=0;e<a;e++)t.dyn_ltree[2*e]=0;for(e=0;e<s;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function P(t){8<t.bi_valid?k(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function M(t,e,r,n){var i=2*e,o=2*r;return t[i]<t[o]||t[i]===t[o]&&n[e]<=n[r]}function I(t,e,r){for(var n=t.heap[r],i=r<<1;i<=t.heap_len&&(i<t.heap_len&&M(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!M(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n}function j(t,e,r){var n,i,a,s,c=0;if(0!==t.last_lit)for(;n=t.pending_buf[t.d_buf+2*c]<<8|t.pending_buf[t.d_buf+2*c+1],i=t.pending_buf[t.l_buf+c],c++,0===n?T(t,i,e):(T(t,(a=g[i])+o+1,e),0!==(s=u[a])&&S(t,i-=m[a],s),T(t,a=A(--n),r),0!==(s=l[a])&&S(t,n-=x[a],s)),c<t.last_lit;);T(t,256,e)}function R(t,e){var r,n,i,o=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,u=e.stat_desc.elems,l=-1;for(t.heap_len=0,t.heap_max=573,r=0;r<u;r++)0!==o[2*r]?(t.heap[++t.heap_len]=l=r,t.depth[r]=0):o[2*r+1]=0;for(;t.heap_len<2;)o[2*(i=t.heap[++t.heap_len]=l<2?++l:0)]=1,t.depth[i]=0,t.opt_len--,s&&(t.static_len-=a[2*i+1]);for(e.max_code=l,r=t.heap_len>>1;1<=r;r--)I(t,o,r);for(i=u;r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],I(t,o,1),n=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=n,o[2*i]=o[2*r]+o[2*n],t.depth[i]=(t.depth[r]>=t.depth[n]?t.depth[r]:t.depth[n])+1,o[2*r+1]=o[2*n+1]=i,t.heap[1]=i++,I(t,o,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var r,n,i,o,a,s,u=e.dyn_tree,l=e.max_code,h=e.stat_desc.static_tree,f=e.stat_desc.has_stree,p=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,y=e.stat_desc.max_length,g=0;for(o=0;o<=c;o++)t.bl_count[o]=0;for(u[2*t.heap[t.heap_max]+1]=0,r=t.heap_max+1;r<573;r++)y<(o=u[2*u[2*(n=t.heap[r])+1]+1]+1)&&(o=y,g++),u[2*n+1]=o,l<n||(t.bl_count[o]++,a=0,d<=n&&(a=p[n-d]),s=u[2*n],t.opt_len+=s*(o+a),f&&(t.static_len+=s*(h[2*n+1]+a)));if(0!==g){do{for(o=y-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[y]--,g-=2}while(0<g);for(o=y;0!==o;o--)for(n=t.bl_count[o];0!==n;)l<(i=t.heap[--r])||(u[2*i+1]!==o&&(t.opt_len+=(o-u[2*i+1])*u[2*i],u[2*i+1]=o),n--)}}(t,e),O(o,l,t.bl_count)}function N(t,e,r){var n,i,o=-1,a=e[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=e[2*(n+1)+1],++s<c&&i===a||(s<u?t.bl_tree[2*i]+=s:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[32]++):s<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=i,u=(s=0)===a?(c=138,3):i===a?(c=6,3):(c=7,4))}function B(t,e,r){var n,i,o=-1,a=e[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),n=0;n<=r;n++)if(i=a,a=e[2*(n+1)+1],!(++s<c&&i===a)){if(s<u)for(;T(t,i,t.bl_tree),0!=--s;);else 0!==i?(i!==o&&(T(t,i,t.bl_tree),s--),T(t,16,t.bl_tree),S(t,s-3,2)):s<=10?(T(t,17,t.bl_tree),S(t,s-3,3)):(T(t,18,t.bl_tree),S(t,s-11,7));o=i,u=(s=0)===a?(c=138,3):i===a?(c=6,3):(c=7,4)}}i(x);var D=!1;function F(t,e,r,i){S(t,0+(i?1:0),3),function(t,e,r){P(t),k(t,r),k(t,~r),n.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}(t,e,r)}r._tr_init=function(t){D||(function(){var t,e,r,n,i,o=new Array(16);for(n=r=0;n<28;n++)for(m[n]=r,t=0;t<1<<u[n];t++)g[r++]=n;for(g[r-1]=n,n=i=0;n<16;n++)for(x[n]=i,t=0;t<1<<l[n];t++)y[i++]=n;for(i>>=7;n<s;n++)for(x[n]=i<<7,t=0;t<1<<l[n]-7;t++)y[256+i++]=n;for(e=0;e<=c;e++)o[e]=0;for(t=0;t<=143;)p[2*t+1]=8,t++,o[8]++;for(;t<=255;)p[2*t+1]=9,t++,o[9]++;for(;t<=279;)p[2*t+1]=7,t++,o[7]++;for(;t<=287;)p[2*t+1]=8,t++,o[8]++;for(O(p,287,o),t=0;t<s;t++)d[2*t+1]=5,d[2*t]=L(t,5);v=new _(p,u,257,a,c),b=new _(d,l,0,s,c),w=new _(new Array(0),h,0,19,7)}(),D=!0),t.l_desc=new E(t.dyn_ltree,v),t.d_desc=new E(t.dyn_dtree,b),t.bl_desc=new E(t.bl_tree,w),t.bi_buf=0,t.bi_valid=0,C(t)},r._tr_stored_block=F,r._tr_flush_block=function(t,e,r,n){var i,a,s=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<o;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),R(t,t.l_desc),R(t,t.d_desc),s=function(t){var e;for(N(t,t.dyn_ltree,t.l_desc.max_code),N(t,t.dyn_dtree,t.d_desc.max_code),R(t,t.bl_desc),e=18;3<=e&&0===t.bl_tree[2*f[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),i=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==e?F(t,e,r,n):4===t.strategy||a===i?(S(t,2+(n?1:0),3),j(t,p,d)):(S(t,4+(n?1:0),3),function(t,e,r,n){var i;for(S(t,e-257,5),S(t,r-1,5),S(t,n-4,4),i=0;i<n;i++)S(t,t.bl_tree[2*f[i]+1],3);B(t,t.dyn_ltree,e-1),B(t,t.dyn_dtree,r-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),j(t,t.dyn_ltree,t.dyn_dtree)),C(t),n&&P(t)},r._tr_tally=function(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(g[r]+o+1)]++,t.dyn_dtree[2*A(e)]++),t.last_lit===t.lit_bufsize-1},r._tr_align=function(t){S(t,2,3),T(t,256,p),function(t){16===t.bi_valid?(k(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":41}],53:[function(t,e,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,r){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}},{}]},{},[10])(10)},5233:function(t,e,r){var n,i,o;t=r.nmd(t),function(a,s,c){"use strict";var u={function:!0,object:!0},l=u[typeof e]&&e&&!e.nodeType&&e,h=u.object&&t&&!t.nodeType&&t,f=l&&h&&"object"==typeof r.g&&r.g,p=h&&h.exports===l&&l;!f||f.global!==f&&f.window!==f&&f.self,i=[e],void 0===(o="function"==typeof(n=c)?n.apply(e,i):n)||(t.exports=o),l&&p&&c(h.exports)}(0,0,(function(t){"use strict";var e,r,n,i,o;t.version="0.3.1";var a=t.defaultOptions={wait:!1,comments:!0,scope:!1,locations:!1,ranges:!1,onCreateNode:null,onCreateScope:null,onDestroyScope:null,onLocalDeclaration:null,luaVersion:"5.1",encodingMode:"none"};function s(t,e){return e=e||0,t<128?String.fromCharCode(t):t<2048?String.fromCharCode(192|e|t>>6,128|e|63&t):t<65536?String.fromCharCode(224|e|t>>12,128|e|t>>6&63,128|e|63&t):t<1114112?String.fromCharCode(240|e|t>>18,128|e|t>>12&63,128|e|t>>6&63,128|e|63&t):null}function c(t){return function(e){var r=t.exec(e);if(!r)return e;M(null,p.invalidCodeUnit,function(t){for(var e=t.toString(16);e.length<4;)e="0"+e;return e}(r[0].charCodeAt(0)).toUpperCase())}}var u={"pseudo-latin1":{fixup:c(/[^\x00-\xff]/),encodeByte:function(t){return null===t?"":String.fromCharCode(t)},encodeUTF8:function(t){return s(t)}},"x-user-defined":{fixup:c(/[^\x00-\x7f\uf780-\uf7ff]/),encodeByte:function(t){return null===t?"":t>=128?String.fromCharCode(63232|t):String.fromCharCode(t)},encodeUTF8:function(t){return s(t,63232)}},none:{discardStrings:!0,fixup:function(t){return t},encodeByte:function(t){return""},encodeUTF8:function(t){return""}}},l=32,h=128,f=256;t.tokenTypes={EOF:1,StringLiteral:2,Keyword:4,Identifier:8,NumericLiteral:16,Punctuator:l,BooleanLiteral:64,NilLiteral:h,VarargLiteral:f};var p=t.errors={unexpected:"unexpected %1 '%2' near '%3'",unexpectedEOF:"unexpected symbol near '<eof>'",expected:"'%1' expected near '%2'",expectedToken:"%1 expected near '%2'",unfinishedString:"unfinished string near '%1'",malformedNumber:"malformed number near '%1'",decimalEscapeTooLarge:"decimal escape too large near '%1'",invalidEscape:"invalid escape sequence near '%1'",hexadecimalDigitExpected:"hexadecimal digit expected near '%1'",braceExpected:"missing '%1' near '%2'",tooLargeCodepoint:"UTF-8 value too large near '%1'",unfinishedLongString:"unfinished long string (starting at line %1) near '%2'",unfinishedLongComment:"unfinished long comment (starting at line %1) near '%2'",ambiguousSyntax:"ambiguous syntax (function call x new statement) near '%1'",noLoopToBreak:"no loop to break near '%1'",labelAlreadyDefined:"label '%1' already defined on line %2",labelNotVisible:"no visible label '%1' for <goto>",gotoJumpInLocalScope:"<goto %1> jumps into the scope of local '%2'",cannotUseVararg:"cannot use '...' outside a vararg function near '%1'",invalidCodeUnit:"code unit U+%1 is not allowed in the current encoding mode"},d=t.ast={labelStatement:function(t){return{type:"LabelStatement",label:t}},breakStatement:function(){return{type:"BreakStatement"}},gotoStatement:function(t){return{type:"GotoStatement",label:t}},returnStatement:function(t){return{type:"ReturnStatement",arguments:t}},ifStatement:function(t){return{type:"IfStatement",clauses:t}},ifClause:function(t,e){return{type:"IfClause",condition:t,body:e}},elseifClause:function(t,e){return{type:"ElseifClause",condition:t,body:e}},elseClause:function(t){return{type:"ElseClause",body:t}},whileStatement:function(t,e){return{type:"WhileStatement",condition:t,body:e}},doStatement:function(t){return{type:"DoStatement",body:t}},repeatStatement:function(t,e){return{type:"RepeatStatement",condition:t,body:e}},localStatement:function(t,e){return{type:"LocalStatement",variables:t,init:e}},assignmentStatement:function(t,e){return{type:"AssignmentStatement",variables:t,init:e}},callStatement:function(t){return{type:"CallStatement",expression:t}},functionStatement:function(t,e,r,n){return{type:"FunctionDeclaration",identifier:t,isLocal:r,parameters:e,body:n}},forNumericStatement:function(t,e,r,n,i){return{type:"ForNumericStatement",variable:t,start:e,end:r,step:n,body:i}},forGenericStatement:function(t,e,r){return{type:"ForGenericStatement",variables:t,iterators:e,body:r}},chunk:function(t){return{type:"Chunk",body:t}},identifier:function(t){return{type:"Identifier",name:t}},literal:function(t,e,r){return{type:t=2===t?"StringLiteral":16===t?"NumericLiteral":64===t?"BooleanLiteral":t===h?"NilLiteral":"VarargLiteral",value:e,raw:r}},tableKey:function(t,e){return{type:"TableKey",key:t,value:e}},tableKeyString:function(t,e){return{type:"TableKeyString",key:t,value:e}},tableValue:function(t){return{type:"TableValue",value:t}},tableConstructorExpression:function(t){return{type:"TableConstructorExpression",fields:t}},binaryExpression:function(t,e,r){return{type:"and"===t||"or"===t?"LogicalExpression":"BinaryExpression",operator:t,left:e,right:r}},unaryExpression:function(t,e){return{type:"UnaryExpression",operator:t,argument:e}},memberExpression:function(t,e,r){return{type:"MemberExpression",indexer:e,identifier:r,base:t}},indexExpression:function(t,e){return{type:"IndexExpression",base:t,index:e}},callExpression:function(t,e){return{type:"CallExpression",base:t,arguments:e}},tableCallExpression:function(t,e){return{type:"TableCallExpression",base:t,arguments:e}},stringCallExpression:function(t,e){return{type:"StringCallExpression",base:t,argument:e}},comment:function(t,e){return{type:"Comment",value:t,raw:e}}};function y(t){if(it){var e=ot.pop();e.complete(),e.bless(t)}return r.onCreateNode&&r.onCreateNode(t),t}var g=Array.prototype.slice,m=(Object.prototype.toString,function(t,e){for(var r=0,n=t.length;r<n;++r)if(t[r]===e)return r;return-1});function v(t){var e=g.call(arguments,1);return t=t.replace(/%(\d)/g,(function(t,r){return""+e[r-1]||""})),t}Array.prototype.indexOf&&(m=function(t,e){return t.indexOf(e)});var b,w,x,_,E,A,k,S,T,L,O,C=function(t){for(var e,r,n=g.call(arguments,1),i=0,o=n.length;i<o;++i)for(r in e=n[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t};function P(t){return Object.create?Object.create(t,{line:{writable:!0,value:t.line},index:{writable:!0,value:t.index},column:{writable:!0,value:t.column}}):t}function M(t){var e,r,n=v.apply(null,g.call(arguments,1));throw null===t||void 0===t.line?(r=b-S+1,(e=P(new SyntaxError(v("[%1:%2] %3",k,r,n)))).index=b,e.line=k,e.column=r):(r=t.range[0]-t.lineStart,(e=P(new SyntaxError(v("[%1:%2] %3",t.line,r,n)))).line=t.line,e.index=t.range[0],e.column=r),e}function I(t){return e.slice(t.range[0],t.range[1])||t.value}function j(t,e){M(e,p.expectedToken,t,I(e))}function R(t){var e=I(_);if(void 0!==t.type){var r;switch(t.type){case 2:r="string";break;case 4:r="keyword";break;case 8:r="identifier";break;case 16:r="number";break;case l:r="symbol";break;case 64:r="boolean";break;case h:return M(t,p.unexpected,"symbol","nil",e);case 1:return M(t,p.unexpectedEOF)}return M(t,p.unexpected,r,I(t),e)}return M(t,p.unexpected,"symbol",t,e)}function N(){for(D();45===e.charCodeAt(b)&&45===e.charCodeAt(b+1);)G(),D();if(b>=n)return{type:1,value:"<eof>",line:k,lineStart:S,range:[b,b]};var t,r,a,s=e.charCodeAt(b),c=e.charCodeAt(b+1);if(A=b,function(t){return t>=65&&t<=90||t>=97&&t<=122||95===t||!!(i.extendedIdentifiers&&t>=128)}(s))return function(){for(var t,r;X(e.charCodeAt(++b)););return!function(t){switch(t.length){case 2:return"do"===t||"if"===t||"in"===t||"or"===t;case 3:return"and"===t||"end"===t||"for"===t||"not"===t;case 4:return"else"===t||"then"===t||!(!i.labels||i.contextualGoto)&&"goto"===t;case 5:return"break"===t||"local"===t||"until"===t||"while"===t;case 6:return"elseif"===t||"repeat"===t||"return"===t;case 8:return"function"===t}return!1}(t=o.fixup(e.slice(A,b)))?"true"===t||"false"===t?(r=64,t="true"===t):"nil"===t?(r=h,t=null):r=8:r=4,{type:r,value:t,line:k,lineStart:S,range:[A,b]}}();switch(s){case 39:case 34:return function(){for(var t,r=e.charCodeAt(b++),i=k,a=S,s=b,c=o.discardStrings?null:"";r!==(t=e.charCodeAt(b++));)if((b>n||K(t))&&(c+=e.slice(s,b-1),M(null,p.unfinishedString,e.slice(A,b-1))),92===t){if(!o.discardStrings){var u=e.slice(s,b-1);c+=o.fixup(u)}var l=z();o.discardStrings||(c+=l),s=b}return o.discardStrings||(c+=o.encodeByte(null),c+=o.fixup(e.slice(s,b-1))),{type:2,value:c,line:i,lineStart:a,lastLine:k,lastLineStart:S,range:[A,b]}}();case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return U();case 46:return H(c)?U():46===c?46===e.charCodeAt(b+2)?{type:f,value:"...",line:k,lineStart:S,range:[A,b+=3]}:F(".."):F(".");case 61:return F(61===c?"==":"=");case 62:return i.bitwiseOperators&&62===c?F(">>"):F(61===c?">=":">");case 60:return i.bitwiseOperators&&60===c?F("<<"):F(61===c?"<=":"<");case 126:if(61===c)return F("~=");if(!i.bitwiseOperators)break;return F("~");case 58:return i.labels&&58===c?F("::"):F(":");case 91:return 91===c||61===c?(t=k,r=S,!1===(a=W(!1))&&M(w,p.expected,"[",I(w)),{type:2,value:o.discardStrings?null:o.fixup(a),line:t,lineStart:r,lastLine:k,lastLineStart:S,range:[A,b]}):F("[");case 47:return i.integerDivision&&47===c?F("//"):F("/");case 38:case 124:if(!i.bitwiseOperators)break;case 42:case 94:case 37:case 44:case 123:case 125:case 93:case 40:case 41:case 59:case 35:case 45:case 43:return F(e.charAt(b))}return R(e.charAt(b))}function B(){var t=e.charCodeAt(b),r=e.charCodeAt(b+1);return!!K(t)&&(10===t&&13===r&&++b,13===t&&10===r&&++b,++k,S=++b,!0)}function D(){for(;b<n;)if(9===(t=e.charCodeAt(b))||32===t||11===t||12===t)++b;else if(!B())break;var t}function F(t){return b+=t.length,{type:l,value:t,line:k,lineStart:S,range:[A,b]}}function U(){var t=e.charAt(b),r=e.charAt(b+1),n="0"===t&&"xX".indexOf(r||null)>=0?function(){var t,r,n,i,o=0,a=1,s=1;for(i=b+=2,Z(e.charCodeAt(b))||M(null,p.malformedNumber,e.slice(A,b));Z(e.charCodeAt(b));)++b;t=parseInt(e.slice(i,b),16);var c=!1;if("."===e.charAt(b)){for(c=!0,r=++b;Z(e.charCodeAt(b));)++b;o=e.slice(r,b),o=r===b?0:parseInt(o,16)/Math.pow(16,b-r)}var u=!1;if("pP".indexOf(e.charAt(b)||null)>=0){for(u=!0,++b,"+-".indexOf(e.charAt(b)||null)>=0&&(s="+"===e.charAt(b++)?1:-1),n=b,H(e.charCodeAt(b))||M(null,p.malformedNumber,e.slice(A,b));H(e.charCodeAt(b));)++b;a=e.slice(n,b),a=Math.pow(2,a*s)}return{value:(t+o)*a,hasFractionPart:c||u}}():function(){for(;H(e.charCodeAt(b));)++b;var t=!1;if("."===e.charAt(b))for(t=!0,++b;H(e.charCodeAt(b));)++b;var r=!1;if("eE".indexOf(e.charAt(b)||null)>=0)for(r=!0,++b,"+-".indexOf(e.charAt(b)||null)>=0&&++b,H(e.charCodeAt(b))||M(null,p.malformedNumber,e.slice(A,b));H(e.charCodeAt(b));)++b;return{value:parseFloat(e.slice(A,b)),hasFractionPart:t||r}}(),o=function(){if(i.imaginaryNumbers)return"iI".indexOf(e.charAt(b)||null)>=0&&(++b,!0)}();return function(){if(i.integerSuffixes)if("uU".indexOf(e.charAt(b)||null)>=0)if(++b,"lL".indexOf(e.charAt(b)||null)>=0){if(++b,"lL".indexOf(e.charAt(b)||null)>=0)return++b,"ULL";M(null,p.malformedNumber,e.slice(A,b))}else M(null,p.malformedNumber,e.slice(A,b));else if("lL".indexOf(e.charAt(b)||null)>=0){if(++b,"lL".indexOf(e.charAt(b)||null)>=0)return++b,"LL";M(null,p.malformedNumber,e.slice(A,b))}}()&&(o||n.hasFractionPart)&&M(null,p.malformedNumber,e.slice(A,b)),{type:16,value:n.value,line:k,lineStart:S,range:[A,b]}}function z(){var t=b;switch(e.charAt(b)){case"a":return++b,"";case"n":return++b,"\n";case"r":return++b,"\r";case"t":return++b,"\t";case"v":return++b,"\v";case"b":return++b,"\b";case"f":return++b,"\f";case"\r":case"\n":return B(),"\n";case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;H(e.charCodeAt(b))&&b-t<3;)++b;var r=e.slice(t,b),n=parseInt(r,10);return n>255&&M(null,p.decimalEscapeTooLarge,"\\"+n),o.encodeByte(n,"\\"+r);case"z":if(i.skipWhitespaceEscape)return++b,D(),"";break;case"x":if(i.hexEscapes){if(Z(e.charCodeAt(b+1))&&Z(e.charCodeAt(b+2)))return b+=3,o.encodeByte(parseInt(e.slice(t+1,b),16),"\\"+e.slice(t,b));M(null,p.hexadecimalDigitExpected,"\\"+e.slice(t,b+2))}break;case"u":if(i.unicodeEscapes)return function(){var t=b++;for("{"!==e.charAt(b++)&&M(null,p.braceExpected,"{","\\"+e.slice(t,b)),Z(e.charCodeAt(b))||M(null,p.hexadecimalDigitExpected,"\\"+e.slice(t,b));48===e.charCodeAt(b);)++b;for(var r=b;Z(e.charCodeAt(b));)++b-r>6&&M(null,p.tooLargeCodepoint,"\\"+e.slice(t,b));var n=e.charAt(b++);"}"!==n&&('"'===n||"'"===n?M(null,p.braceExpected,"}","\\"+e.slice(t,b--)):M(null,p.hexadecimalDigitExpected,"\\"+e.slice(t,b)));var i=parseInt(e.slice(r,b-1)||"0",16),a="\\"+e.slice(t,b);return i>1114111&&M(null,p.tooLargeCodepoint,a),o.encodeUTF8(i,a)}();break;case"\\":case'"':case"'":return e.charAt(b++)}return i.strictEscapes&&M(null,p.invalidEscape,"\\"+e.slice(t,b+1)),e.charAt(b++)}function G(){A=b,b+=2;var t=e.charAt(b),i="",o=!1,a=b,s=S,c=k;if("["===t&&(!1===(i=W(!0))?i=t:o=!0),!o){for(;b<n&&!K(e.charCodeAt(b));)++b;r.comments&&(i=e.slice(a,b))}if(r.comments){var u=d.comment(i,e.slice(A,b));r.locations&&(u.loc={start:{line:c,column:A-s},end:{line:k,column:b-S}}),r.ranges&&(u.range=[A,b]),r.onCreateNode&&r.onCreateNode(u),E.push(u)}}function W(t){var r,i=0,o="",a=!1,s=k;for(++b;"="===e.charAt(b+i);)++i;if("["!==e.charAt(b+i))return!1;for(b+=i+1,K(e.charCodeAt(b))&&B(),r=b;b<n;){for(;K(e.charCodeAt(b));)B();if("]"===e.charAt(b++)){a=!0;for(var c=0;c<i;++c)"="!==e.charAt(b+c)&&(a=!1);"]"!==e.charAt(b+i)&&(a=!1)}if(a)return o+=e.slice(r,b-1),b+=i+1,o}M(null,t?p.unfinishedLongComment:p.unfinishedLongString,s,"<eof>")}function V(){x=w,w=_,_=N()}function $(t){return t===w.value&&(V(),!0)}function Y(t){t===w.value?V():M(w,p.expected,t,I(w))}function K(t){return 10===t||13===t}function H(t){return t>=48&&t<=57}function Z(t){return t>=48&&t<=57||t>=97&&t<=102||t>=65&&t<=70}function X(t){return t>=65&&t<=90||t>=97&&t<=122||95===t||t>=48&&t<=57||!!(i.extendedIdentifiers&&t>=128)}function q(t){if(1===t.type)return!0;if(4!==t.type)return!1;switch(t.value){case"else":case"elseif":case"end":case"until":return!0;default:return!1}}function J(){var t=T[L++].slice();T.push(t),r.onCreateScope&&r.onCreateScope()}function Q(){T.pop(),--L,r.onDestroyScope&&r.onDestroyScope()}function tt(t){r.onLocalDeclaration&&r.onLocalDeclaration(t),-1===m(T[L],t)&&T[L].push(t)}function et(t){tt(t.name),rt(t,!0)}function rt(t,e){e||-1!==function(t,e,r){for(var n=0,i=t.length;n<i;++n)if(t[n].name===r)return n;return-1}(O,0,t.name)||O.push(t),t.isLocal=e}function nt(t){return-1!==m(T[L],t)}Object.assign&&(C=Object.assign),t.SyntaxError=SyntaxError,t.lex=N;var it,ot=[];function at(){return new st(w)}function st(t){r.locations&&(this.loc={start:{line:t.line,column:t.range[0]-t.lineStart},end:{line:0,column:0}}),r.ranges&&(this.range=[t.range[0],0])}function ct(){it&&ot.push(at())}function ut(t){it&&ot.push(t)}function lt(){this.scopes=[],this.pendingGotos=[]}function ht(){this.level=0,this.loopLevels=[]}function ft(){return i.labels?new lt:new ht}function pt(t){for(var e,r=[];!q(w);){if("return"===w.value||!i.relaxedBreak&&"break"===w.value){r.push(dt(t));break}e=dt(t),$(";"),e&&r.push(e)}return r}function dt(t){if(ct(),l===w.type&&$("::"))return function(t){var e=w,n=gt();return r.scope&&(tt("::"+e.value+"::"),rt(n,!0)),Y("::"),t.addLabel(e.value,e),y(d.labelStatement(n))}(t);if(!i.emptyStatement||!$(";")){if(t.raiseDeferredErrors(),4===w.type)switch(w.value){case"local":return V(),function(t){var e,n=x;if(8===w.type){var i=[],o=[];do{e=gt(),i.push(e),t.addLocal(e.name,n)}while($(","));if($("="))do{var a=wt(t);o.push(a)}while($(","));if(r.scope)for(var s=0,c=i.length;s<c;++s)et(i[s]);return y(d.localStatement(i,o))}if($("function"))return e=gt(),t.addLocal(e.name,n),r.scope&&(et(e),J()),mt(e,!0);j("<name>",w)}(t);case"if":return V(),function(t){var e,n,i,o=[];for(it&&(i=ot[ot.length-1],ot.push(i)),e=wt(t),Y("then"),r.scope&&J(),t.pushScope(),n=pt(t),t.popScope(),r.scope&&Q(),o.push(y(d.ifClause(e,n))),it&&(i=at());$("elseif");)ut(i),e=wt(t),Y("then"),r.scope&&J(),t.pushScope(),n=pt(t),t.popScope(),r.scope&&Q(),o.push(y(d.elseifClause(e,n))),it&&(i=at());return $("else")&&(it&&(i=new st(x),ot.push(i)),r.scope&&J(),t.pushScope(),n=pt(t),t.popScope(),r.scope&&Q(),o.push(y(d.elseClause(n)))),Y("end"),y(d.ifStatement(o))}(t);case"return":return V(),function(t){var e=[];if("end"!==w.value){var r=bt(t);for(null!=r&&e.push(r);$(",");)r=wt(t),e.push(r);$(";")}return y(d.returnStatement(e))}(t);case"function":return V(),mt(function(){var t,e,n;for(it&&(n=at()),t=gt(),r.scope&&(rt(t,nt(t.name)),J());$(".");)ut(n),e=gt(),t=y(d.memberExpression(t,".",e));return $(":")&&(ut(n),e=gt(),t=y(d.memberExpression(t,":",e)),r.scope&&tt("self")),t}());case"while":return V(),function(t){var e=wt(t);Y("do"),r.scope&&J(),t.pushScope(!0);var n=pt(t);return t.popScope(),r.scope&&Q(),Y("end"),y(d.whileStatement(e,n))}(t);case"for":return V(),function(t){var e,n=gt();if(r.scope&&(J(),et(n)),$("=")){var i=wt(t);Y(",");var o=wt(t),a=$(",")?wt(t):null;return Y("do"),t.pushScope(!0),e=pt(t),t.popScope(),Y("end"),r.scope&&Q(),y(d.forNumericStatement(n,i,o,a,e))}for(var s=[n];$(",");)n=gt(),r.scope&&et(n),s.push(n);Y("in");var c=[];do{var u=wt(t);c.push(u)}while($(","));return Y("do"),t.pushScope(!0),e=pt(t),t.popScope(),Y("end"),r.scope&&Q(),y(d.forGenericStatement(s,c,e))}(t);case"repeat":return V(),function(t){r.scope&&J(),t.pushScope(!0);var e=pt(t);Y("until"),t.raiseDeferredErrors();var n=wt(t);return t.popScope(),r.scope&&Q(),y(d.repeatStatement(n,e))}(t);case"break":return V(),t.isInLoop()||M(w,p.noLoopToBreak,w.value),y(d.breakStatement());case"do":return V(),function(t){r.scope&&J(),t.pushScope();var e=pt(t);return t.popScope(),r.scope&&Q(),Y("end"),y(d.doStatement(e))}(t);case"goto":return V(),yt(t)}return i.contextualGoto&&8===w.type&&"goto"===w.value&&8===_.type&&"goto"!==_.value?(V(),yt(t)):(it&&ot.pop(),function(t){var e,n,i,o,a,s=[];for(it&&(n=at());;){if(it&&(e=at()),8===w.type)a=w.value,o=gt(),r.scope&&rt(o,nt(a)),i=!0;else{if("("!==w.value)return R(w);V(),o=wt(t),Y(")"),i=!1}t:for(;;){switch(2===w.type?'"':w.value){case".":case"[":i=!0;break;case":":case"(":case"{":case'"':i=null;break;default:break t}o=Et(o,e,t)}if(s.push(o),","!==w.value)break;if(!i)return R(w);V()}if(1===s.length&&null===i)return ut(e),y(d.callStatement(s[0]));if(!i)return R(w);Y("=");var c=[];do{c.push(wt(t))}while($(","));return ut(n),y(d.assignmentStatement(s,c))}(t))}it&&ot.pop()}function yt(t){var e=w.value,r=x,n=gt();return t.addGoto(e,r),y(d.gotoStatement(n))}function gt(){ct();var t=w.value;return 8!==w.type&&j("<name>",w),V(),y(d.identifier(t))}function mt(t,e){var n=ft();n.pushScope();var i=[];if(Y("("),!$(")"))for(;;){if(8===w.type){var o=gt();if(r.scope&&et(o),i.push(o),$(","))continue}else f===w.type?(n.allowVararg=!0,i.push(kt(n))):j("<name> or '...'",w);Y(")");break}var a=pt(n);return n.popScope(),Y("end"),r.scope&&Q(),e=e||!1,y(d.functionStatement(t,i,e,a))}function vt(t){for(var e,r,n=[];;){if(ct(),l===w.type&&$("["))e=wt(t),Y("]"),Y("="),r=wt(t),n.push(y(d.tableKey(e,r)));else if(8===w.type)"="===_.value?(e=gt(),V(),r=wt(t),n.push(y(d.tableKeyString(e,r)))):(r=wt(t),n.push(y(d.tableValue(r))));else{if(null==(r=bt(t))){ot.pop();break}n.push(y(d.tableValue(r)))}if(!(",;".indexOf(w.value)>=0))break;V()}return Y("}"),y(d.tableConstructorExpression(n))}function bt(t){return _t(0,t)}function wt(t){var e=bt(t);if(null!=e)return e;j("<expression>",w)}function xt(t){var e=t.charCodeAt(0),r=t.length;if(1===r)switch(e){case 94:return 12;case 42:case 47:case 37:return 10;case 43:case 45:return 9;case 38:return 6;case 126:return 5;case 124:return 4;case 60:case 62:return 3}else if(2===r)switch(e){case 47:return 10;case 46:return 8;case 60:case 62:return"<<"===t||">>"===t?7:3;case 61:case 126:return 3;case 111:return 1}else if(97===e&&"and"===t)return 2;return 0}function _t(t,e){var n,i,o,a=w.value;if(it&&(i=at()),function(t){return l===t.type?"#-~".indexOf(t.value)>=0:4===t.type&&"not"===t.value}(w)){ct(),V();var s=_t(10,e);null==s&&j("<expression>",w),n=y(d.unaryExpression(a,s))}if(null==n&&null==(n=kt(e))&&(n=function(t){var e,n,i;if(it&&(i=at()),8===w.type)n=w.value,e=gt(),r.scope&&rt(e,nt(n));else{if(!$("("))return null;e=wt(t),Y(")")}for(;;){var o=Et(e,i,t);if(null===o)break;e=o}return e}(e)),null==n)return null;for(;a=w.value,!(0===(o=l===w.type||4===w.type?xt(a):0)||o<=t);){"^"!==a&&".."!==a||--o,V();var c=_t(o,e);null==c&&j("<expression>",w),it&&ot.push(i),n=y(d.binaryExpression(a,n,c))}return n}function Et(t,e,r){var n,i;if(l===w.type)switch(w.value){case"[":return ut(e),V(),n=wt(r),Y("]"),y(d.indexExpression(t,n));case".":return ut(e),V(),i=gt(),y(d.memberExpression(t,".",i));case":":return ut(e),V(),i=gt(),t=y(d.memberExpression(t,":",i)),ut(e),At(t,r);case"(":case"{":return ut(e),At(t,r)}else if(2===w.type)return ut(e),At(t,r);return null}function At(t,e){if(l===w.type)switch(w.value){case"(":i.emptyStatement||w.line!==x.line&&M(null,p.ambiguousSyntax,w.value),V();var r=[],n=bt(e);for(null!=n&&r.push(n);$(",");)n=wt(e),r.push(n);return Y(")"),y(d.callExpression(t,r));case"{":ct(),V();var o=vt(e);return y(d.tableCallExpression(t,o))}else if(2===w.type)return y(d.stringCallExpression(t,kt(e)));j("function arguments",w)}function kt(t){var n,i=w.value,o=w.type;if(it&&(n=at()),o!==f||t.allowVararg||M(w,p.cannotUseVararg,w.value),466&o){ut(n);var a=e.slice(w.range[0],w.range[1]);return V(),y(d.literal(o,i,a))}return 4===o&&"function"===i?(ut(n),V(),r.scope&&J(),mt(null)):$("{")?(ut(n),vt(t)):void 0}st.prototype.complete=function(){r.locations&&(this.loc.end.line=x.lastLine||x.line,this.loc.end.column=x.range[1]-(x.lastLineStart||x.lineStart)),r.ranges&&(this.range[1]=x.range[1])},st.prototype.bless=function(t){if(this.loc){var e=this.loc;t.loc={start:{line:e.start.line,column:e.start.column},end:{line:e.end.line,column:e.end.column}}}this.range&&(t.range=[this.range[0],this.range[1]])},lt.prototype.isInLoop=function(){for(var t=this.scopes.length;t-- >0;)if(this.scopes[t].isLoop)return!0;return!1},lt.prototype.pushScope=function(t){var e={labels:{},locals:[],deferredGotos:[],isLoop:!!t};this.scopes.push(e)},lt.prototype.popScope=function(){for(var t=0;t<this.pendingGotos.length;++t){var e=this.pendingGotos[t];e.maxDepth>=this.scopes.length&&--e.maxDepth<=0&&M(e.token,p.labelNotVisible,e.target)}this.scopes.pop()},lt.prototype.addGoto=function(t,e){for(var r=[],n=0;n<this.scopes.length;++n){var i=this.scopes[n];if(r.push(i.locals.length),Object.prototype.hasOwnProperty.call(i.labels,t))return}this.pendingGotos.push({maxDepth:this.scopes.length,target:t,token:e,localCounts:r})},lt.prototype.addLabel=function(t,e){var r=this.currentScope();if(Object.prototype.hasOwnProperty.call(r.labels,t))M(e,p.labelAlreadyDefined,t,r.labels[t].line);else{for(var n=[],i=0;i<this.pendingGotos.length;++i){var o=this.pendingGotos[i];o.maxDepth>=this.scopes.length&&o.target===t?o.localCounts[this.scopes.length-1]<r.locals.length&&r.deferredGotos.push(o):n.push(o)}this.pendingGotos=n}r.labels[t]={localCount:r.locals.length,line:e.line}},lt.prototype.addLocal=function(t,e){this.currentScope().locals.push({name:t,token:e})},lt.prototype.currentScope=function(){return this.scopes[this.scopes.length-1]},lt.prototype.raiseDeferredErrors=function(){for(var t=this.currentScope(),e=t.deferredGotos,r=0;r<e.length;++r){var n=e[r];M(n.token,p.gotoJumpInLocalScope,n.target,t.locals[n.localCounts[this.scopes.length-1]].name)}},ht.prototype.isInLoop=function(){return!!this.loopLevels.length},ht.prototype.pushScope=function(t){++this.level,t&&this.loopLevels.push(this.level)},ht.prototype.popScope=function(){var t=this.loopLevels,e=t.length;e&&t[e-1]===this.level&&t.pop(),--this.level},ht.prototype.addGoto=ht.prototype.addLabel=function(){throw new Error("This should never happen")},ht.prototype.addLocal=ht.prototype.raiseDeferredErrors=function(){},t.parse=function(s,c){if(void 0===c&&"object"==typeof s&&(c=s,s=void 0),c||(c={}),e=s||"",r=C({},a,c),b=0,k=1,S=0,n=e.length,T=[[]],L=0,O=[],ot=[],!Object.prototype.hasOwnProperty.call(St,r.luaVersion))throw new Error(v("Lua version '%1' not supported",r.luaVersion));if(i=C({},St[r.luaVersion]),void 0!==r.extendedIdentifiers&&(i.extendedIdentifiers=!!r.extendedIdentifiers),!Object.prototype.hasOwnProperty.call(u,r.encodingMode))throw new Error(v("Encoding mode '%1' not supported",r.encodingMode));return o=u[r.encodingMode],r.comments&&(E=[]),r.wait?t:Lt()};var St={5.1:{},5.2:{labels:!0,emptyStatement:!0,hexEscapes:!0,skipWhitespaceEscape:!0,strictEscapes:!0,relaxedBreak:!0},5.3:{labels:!0,emptyStatement:!0,hexEscapes:!0,skipWhitespaceEscape:!0,strictEscapes:!0,unicodeEscapes:!0,bitwiseOperators:!0,integerDivision:!0,relaxedBreak:!0},LuaJIT:{labels:!0,contextualGoto:!0,hexEscapes:!0,skipWhitespaceEscape:!0,strictEscapes:!0,unicodeEscapes:!0,imaginaryNumbers:!0,integerSuffixes:!0}};function Tt(r){return e+=String(r),n=e.length,t}function Lt(t){void 0!==t&&Tt(t),e&&"#!"===e.substr(0,2)&&(e=e.replace(/^.*/,(function(t){return t.replace(/./g," ")}))),n=e.length,it=r.locations||r.ranges,_=N();var i=function(){V(),ct(),r.scope&&J();var t=ft();t.allowVararg=!0,t.pushScope();var e=pt(t);return t.popScope(),r.scope&&Q(),1!==w.type&&R(w),it&&!e.length&&(x=w),y(d.chunk(e))}();if(r.comments&&(i.comments=E),r.scope&&(i.globals=O),ot.length>0)throw new Error("Location tracking failed. This is most likely a bug in luaparse");return i}t.write=Tt,t.end=Lt}))},7066:(t,e,r)=>{"use strict";var n=r(6464);t.exports=function(t,e,r){return n(r=void 0!==r?r+"":" ",e)+t}},2703:(t,e,r)=>{"use strict";var n=r(414);function i(){}function o(){}o.resetWarningCache=i,t.exports=function(){function t(t,e,r,i,o,a){if(a!==n){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function e(){return t}t.isRequired=t;var r={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:o,resetWarningCache:i};return r.PropTypes=r,r}},5697:(t,e,r)=>{t.exports=r(2703)()},414:t=>{"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},9921:(t,e)=>{"use strict";var r="function"==typeof Symbol&&Symbol.for,n=r?Symbol.for("react.element"):60103,i=r?Symbol.for("react.portal"):60106,o=r?Symbol.for("react.fragment"):60107,a=r?Symbol.for("react.strict_mode"):60108,s=r?Symbol.for("react.profiler"):60114,c=r?Symbol.for("react.provider"):60109,u=r?Symbol.for("react.context"):60110,l=r?Symbol.for("react.async_mode"):60111,h=r?Symbol.for("react.concurrent_mode"):60111,f=r?Symbol.for("react.forward_ref"):60112,p=r?Symbol.for("react.suspense"):60113,d=r?Symbol.for("react.suspense_list"):60120,y=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116,m=r?Symbol.for("react.block"):60121,v=r?Symbol.for("react.fundamental"):60117,b=r?Symbol.for("react.responder"):60118,w=r?Symbol.for("react.scope"):60119;function x(t){if("object"==typeof t&&null!==t){var e=t.$$typeof;switch(e){case n:switch(t=t.type){case l:case h:case o:case s:case a:case p:return t;default:switch(t=t&&t.$$typeof){case u:case f:case g:case y:case c:return t;default:return e}}case i:return e}}}function _(t){return x(t)===h}e.AsyncMode=l,e.ConcurrentMode=h,e.ContextConsumer=u,e.ContextProvider=c,e.Element=n,e.ForwardRef=f,e.Fragment=o,e.Lazy=g,e.Memo=y,e.Portal=i,e.Profiler=s,e.StrictMode=a,e.Suspense=p,e.isAsyncMode=function(t){return _(t)||x(t)===l},e.isConcurrentMode=_,e.isContextConsumer=function(t){return x(t)===u},e.isContextProvider=function(t){return x(t)===c},e.isElement=function(t){return"object"==typeof t&&null!==t&&t.$$typeof===n},e.isForwardRef=function(t){return x(t)===f},e.isFragment=function(t){return x(t)===o},e.isLazy=function(t){return x(t)===g},e.isMemo=function(t){return x(t)===y},e.isPortal=function(t){return x(t)===i},e.isProfiler=function(t){return x(t)===s},e.isStrictMode=function(t){return x(t)===a},e.isSuspense=function(t){return x(t)===p},e.isValidElementType=function(t){return"string"==typeof t||"function"==typeof t||t===o||t===h||t===s||t===a||t===p||t===d||"object"==typeof t&&null!==t&&(t.$$typeof===g||t.$$typeof===y||t.$$typeof===c||t.$$typeof===u||t.$$typeof===f||t.$$typeof===v||t.$$typeof===b||t.$$typeof===w||t.$$typeof===m)},e.typeOf=x},9864:(t,e,r)=>{"use strict";t.exports=r(9921)},6626:(t,e,r)=>{"use strict";r.d(e,{collect:()=>X,store:()=>J});const n={currentComponent:null,isBatchUpdating:!1,isInBrowser:"undefined"!=typeof window,listeners:new Map,manualListeners:[],nextVersionMap:new WeakMap,proxyIsMuted:!1,redirectToNext:!0,store:{}},i=Symbol("PATH"),o=Symbol("ORIGINAL"),a="RR_DEBUG",s=t=>!!t&&"object"==typeof t&&t.constructor===Object,c=t=>Array.isArray(t),u=t=>t instanceof Map,l=t=>t instanceof Set,h=t=>s(t)||c(t)||u(t)||l(t),f=t=>t===i||"constructor"===t||"toJSON"===t||"@@toStringTag"===t||t===Symbol.toStringTag,p=t=>"function"==typeof t,d=t=>s(t)?Object.assign({},t):c(t)?t.slice():u(t)?new Map(t):l(t)?new Set(t):t,y=(t,e)=>u(t)?t.get(e):l(t)?e:(c(t),t[e]),g=(t,e,r)=>{if(s(t))t[e]=r;else if(c(t))t[e]=r;else if(u(t))t.set(e,r);else{if(!l(t))throw Error("Unexpected type");t.add(r)}},m=t=>{if(s(t))return Object.keys(t).length;if(c(t))return t.length;if(u(t)||l(t))return t.size;throw Error("Unexpected type")},v=(t,e)=>{const r=[],n=t=>{const i=e(t,r.slice()),o=void 0!==i?i:t,a=(t,e)=>{r.push(t);const i=n(e);r.pop(),g(o,t,i)};if(s(o))Object.entries(o).forEach((([t,e])=>{a(t,e)}));else if(c(o)||u(o))o.forEach(((t,e)=>{a(e,t)}));else if(l(o)){const t=Array.from(o);o.clear(),t.forEach((t=>{a(t,t)}))}return o};return n(t)},b=t=>{n.proxyIsMuted=!0;const e=t();return n.proxyIsMuted=!1,e},w=(t,e)=>t.map((t=>t.toString())).join(e),x=t=>w(t,"."),_=t=>w(t,"~~~"),E=(t,e)=>{const r=t[i]||[];return void 0===e?r:r.concat(e)},A=(t,e)=>x(E(t,e)),k=(t,e)=>{t&&Object.defineProperty(t,i,{value:e,writable:!0})},S=t=>t[i]||[],T="undefined"!=typeof window&&!!window.localStorage,L=(t,e)=>{if(T)try{const r="string"==typeof e?e:JSON.stringify(e);return localStorage.setItem(t,r)}catch(t){return}},O="on",C="off";let P=(t=>{if(!T)return;const e=localStorage.getItem(t);if(!e)return e;try{return JSON.parse(e)}catch(t){return e}})(a)||C;P===O&&console.info("Recollect debugging is enabled. Type __RR__.debugOff() to turn it off.");const M=t=>{P===O&&t()},I=(t,e,r)=>{M((()=>{console.groupCollapsed(`GET: ${A(t,e)}`),console.info(`Component: <${n.currentComponent._name}>`),void 0!==r&&console.info("Value:",r),console.groupEnd()}))},j=(t,e,r)=>{M((()=>{console.groupCollapsed(`SET: ${A(t,e)}`),console.info("From:",y(t,e)),console.info("To:  ",r),console.groupEnd()}))},R={},N=t=>R.UpdateNextStore(t),B=t=>{if(!n.currentComponent)return;const e=_(t),r=n.listeners.get(e)||new Set;r.add(n.currentComponent),n.listeners.set(e,r)},D=t=>{return new Proxy(t,u(e=t)||l(e)?{get(t,e){if(e===o)return t;let r=Reflect.get(t,e);if(p(r)&&(r=r.bind(t)),n.proxyIsMuted||f(e))return r;if(!n.currentComponent&&n.redirectToNext){const r=n.nextVersionMap.get(t);if(r)return Reflect.get(r,e)}return"set"===e?new Proxy(r,{apply:(r,n,[i,o])=>n.get(i)===o||N({target:n,prop:i,value:o,updater:(r,n)=>(j(t,e,n),Reflect.apply(r[e],r,[i,n]))})}):"add"===e?new Proxy(r,{apply:(r,n,[i])=>!!n.has(i)||N({target:n,notifyTarget:!0,value:i,updater:(r,n)=>(j(t,e,n),Reflect.apply(r[e],r,[n]))})}):"clear"===e||"delete"===e?new Proxy(r,{apply:(r,n,[i])=>!(!n.size||"delete"===e&&!n.has(i))&&N({target:n,notifyTarget:!0,updater:r=>(j(t,e),Reflect.apply(r[e],r,[i]))})}):n.currentComponent&&u(t)&&"get"===e?new Proxy(r,{apply:(e,r,n)=>(B(E(t,n[0])),Reflect.apply(e,r,n))}):r}}:{get(t,e){if(e===o)return t;const r=Reflect.get(t,e);if(n.proxyIsMuted||f(e))return r;if(((t,e)=>c(t)&&["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"].includes(e))(t,e))return new Proxy(r,{apply:(r,n,i)=>N({target:n,notifyTarget:!0,value:i,updater:(r,n)=>{j(t,e,n);const i=Reflect.apply(r[e],r,n),o=S(t);return v(r,((t,e)=>{h(t)&&k(t,[...o,...e])})),i}})});if(p(t[e]))return r;if(n.currentComponent)c(t)&&"length"===e||(I(t,e,r),B(E(t,e)));else if(n.redirectToNext){const r=n.nextVersionMap.get(t);if(r)return Reflect.get(r,e)}return r},has(t,e){const r=Reflect.has(t,e);if(n.proxyIsMuted||f(e))return r;if(n.currentComponent)c(t)||(I(t,e),B(E(t,e)));else{const r=n.nextVersionMap.get(t);if(r)return Reflect.has(r,e)}return r},ownKeys(t){const e=Reflect.ownKeys(t);if(n.proxyIsMuted)return e;if(n.currentComponent)I(t),B(S(t));else{const e=n.nextVersionMap.get(t);if(e)return Reflect.ownKeys(e)}return e},set:(t,e,r)=>n.proxyIsMuted?Reflect.set(t,e,r):t[e]===r||N({target:t,prop:e,value:r,updater:(r,n)=>(j(t,e,n),Reflect.set(r,e,n))}),deleteProperty:(t,e)=>n.proxyIsMuted?Reflect.deleteProperty(t,e):N({target:t,prop:e,notifyTarget:!0,updater:r=>(((t,e)=>{M((()=>{console.groupCollapsed(`DELETE: ${A(t,e)}`),console.info("Property: ",A(t,e)),console.groupEnd()}))})(t,e),Reflect.deleteProperty(r,e))})});var e},F=require("react-dom"),U=r.n(F)().unstable_batchedUpdates||(t=>{t()}),z={components:new Map,changedPaths:new Set};var G;n.store=D({}),G=({target:t,prop:e,value:r,notifyTarget:i=!1,updater:a})=>b((()=>{let s;const c=S(t),u=E(t,e);let l=!1;const f=m(t);let p=r;return h(p)&&(p=v(r,((t,e)=>{if(!h(t))return t;const r=d(t);return k(r,[...u,...e]),D(r)}))),c.length?c.reduce(((e,r,i)=>{const u=y(e,r);let h=d(u);return k(h,S(u)),h=D(h),g(e,r,h),i===c.length-1&&(s=a(h,p),l=m(h)!==f,n.nextVersionMap.set(t[o]||t,h)),h}),n.store):(s=a(n.store,p),l=m(n.store)!==f),(t=>{const e=_(t),r=x(t);z.changedPaths.add(r),n.listeners.forEach(((t,n)=>{""!==e&&e!==n||t.forEach((t=>{const e=z.components.get(t)||new Set;e.add(r),z.components.set(t,e)}))})),n.isBatchUpdating||(U((()=>{z.components.forEach(((t,e)=>{((t,e)=>{M((()=>{console.groupCollapsed(`UPDATE:  <${t._name}>`),console.info("Changed properties:",e),console.groupEnd()}))})(e,Array.from(t)),e.update()}))})),n.manualListeners.forEach((t=>t({changedProps:Array.from(z.changedPaths),renderedComponents:Array.from(z.components.keys()),store:n.store}))),z.components.clear(),z.changedPaths.clear())})(i||l?c:u),s})),R.UpdateNextStore=G;var W=r(1974),V=r.n(W),$=r(8679),Y=r.n($);const K=[],H=()=>{n.isInBrowser&&(M((()=>{console.groupEnd()})),K.pop(),n.currentComponent=K[K.length-1]||null)},Z=()=>b((()=>{const t=Object.assign({},n.store);return n.nextVersionMap.set(t,n.store),D(t)})),X=t=>{const e=t.displayName||t.name||"NamelessComponent";class r extends V().PureComponent{constructor(){super(...arguments),this.state={store:Z()},this._isMounted=!1,this._isMounting=!0,this._isRendering=!1,this._name=e}componentDidMount(){this._isMounted=!0,this._isMounting=!1,H(),this._isRendering=!1}componentDidUpdate(){H(),this._isRendering=!1}componentWillUnmount(){var t;t=this,n.listeners.forEach(((e,r)=>{const i=Array.from(e).filter((e=>e!==t));i.length?n.listeners.set(r,new Set(i)):n.listeners.delete(r)})),this._isMounted=!1}update(){(this._isMounted||this._isMounting)&&this.setState({store:Z()})}render(){var e;this._isRendering||(e=this,n.isInBrowser&&(M((()=>{console.groupCollapsed(`RENDER: <${e._name}>`)})),n.currentComponent=e,K.push(n.currentComponent)),this._isRendering=!0);const r=Object.assign(Object.assign({},this.props),{store:this.state.store});return V().createElement(t,Object.assign({},r))}}return r.displayName=`Collected(${e})`,Y()(r,t)};let q;q=r(5697);const{store:J}=n;"undefined"!=typeof window&&("Proxy"in window?window.__RR__={debugOn:()=>{P=O,L(a,O)},debugOff:()=>{P=C,L(a,C)},internals:n}:console.warn("This browser doesn't support the Proxy object, which react-recollect needs. See https://caniuse.com/#search=proxy to find out which browsers do support it"))},5565:(t,e,r)=>{t.exports=r(6626)},6464:t=>{"use strict";var e,r="";t.exports=function(t,n){if("string"!=typeof t)throw new TypeError("expected a string");if(1===n)return t;if(2===n)return t+t;var i=t.length*n;if(e!==t||void 0===e)e=t,r="";else if(r.length>=i)return r.substr(0,i);for(;i>r.length&&n>1;)1&n&&(r+=t),n>>=1,t+=t;return r=(r+=t).substr(0,i)}},8975:(t,e,r)=>{var n;!function(){"use strict";var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function o(t){return function(t,e){var r,n,a,s,c,u,l,h,f,p=1,d=t.length,y="";for(n=0;n<d;n++)if("string"==typeof t[n])y+=t[n];else if("object"==typeof t[n]){if((s=t[n]).keys)for(r=e[p],a=0;a<s.keys.length;a++){if(null==r)throw new Error(o('[sprintf] Cannot access property "%s" of undefined value "%s"',s.keys[a],s.keys[a-1]));r=r[s.keys[a]]}else r=s.param_no?e[s.param_no]:e[p++];if(i.not_type.test(s.type)&&i.not_primitive.test(s.type)&&r instanceof Function&&(r=r()),i.numeric_arg.test(s.type)&&"number"!=typeof r&&isNaN(r))throw new TypeError(o("[sprintf] expecting number but found %T",r));switch(i.number.test(s.type)&&(h=r>=0),s.type){case"b":r=parseInt(r,10).toString(2);break;case"c":r=String.fromCharCode(parseInt(r,10));break;case"d":case"i":r=parseInt(r,10);break;case"j":r=JSON.stringify(r,null,s.width?parseInt(s.width):0);break;case"e":r=s.precision?parseFloat(r).toExponential(s.precision):parseFloat(r).toExponential();break;case"f":r=s.precision?parseFloat(r).toFixed(s.precision):parseFloat(r);break;case"g":r=s.precision?String(Number(r.toPrecision(s.precision))):parseFloat(r);break;case"o":r=(parseInt(r,10)>>>0).toString(8);break;case"s":r=String(r),r=s.precision?r.substring(0,s.precision):r;break;case"t":r=String(!!r),r=s.precision?r.substring(0,s.precision):r;break;case"T":r=Object.prototype.toString.call(r).slice(8,-1).toLowerCase(),r=s.precision?r.substring(0,s.precision):r;break;case"u":r=parseInt(r,10)>>>0;break;case"v":r=r.valueOf(),r=s.precision?r.substring(0,s.precision):r;break;case"x":r=(parseInt(r,10)>>>0).toString(16);break;case"X":r=(parseInt(r,10)>>>0).toString(16).toUpperCase()}i.json.test(s.type)?y+=r:(!i.number.test(s.type)||h&&!s.sign?f="":(f=h?"+":"-",r=r.toString().replace(i.sign,"")),u=s.pad_char?"0"===s.pad_char?"0":s.pad_char.charAt(1):" ",l=s.width-(f+r).length,c=s.width&&l>0?u.repeat(l):"",y+=s.align?f+r+c:"0"===u?f+c+r:c+f+r)}return y}(function(t){if(s[t])return s[t];for(var e,r=t,n=[],o=0;r;){if(null!==(e=i.text.exec(r)))n.push(e[0]);else if(null!==(e=i.modulo.exec(r)))n.push("%");else{if(null===(e=i.placeholder.exec(r)))throw new SyntaxError("[sprintf] unexpected placeholder");if(e[2]){o|=1;var a=[],c=e[2],u=[];if(null===(u=i.key.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(a.push(u[1]);""!==(c=c.substring(u[0].length));)if(null!==(u=i.key_access.exec(c)))a.push(u[1]);else{if(null===(u=i.index_access.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");a.push(u[1])}e[2]=a}else o|=2;if(3===o)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");n.push({placeholder:e[0],param_no:e[1],keys:e[2],sign:e[3],pad_char:e[4],align:e[5],width:e[6],precision:e[7],type:e[8]})}r=r.substring(e[0].length)}return s[t]=n}(t),arguments)}function a(t,e){return o.apply(null,[t].concat(e||[]))}var s=Object.create(null);e.sprintf=o,e.vsprintf=a,"undefined"!=typeof window&&(window.sprintf=o,window.vsprintf=a,void 0===(n=function(){return{sprintf:o,vsprintf:a}}.call(e,r,e,t))||(t.exports=n))}()},3379:t=>{"use strict";var e=[];function r(t){for(var r=-1,n=0;n<e.length;n++)if(e[n].identifier===t){r=n;break}return r}function n(t,n){for(var o={},a=[],s=0;s<t.length;s++){var c=t[s],u=n.base?c[0]+n.base:c[0],l=o[u]||0,h="".concat(u," ").concat(l);o[u]=l+1;var f=r(h),p={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==f)e[f].references++,e[f].updater(p);else{var d=i(p,n);n.byIndex=s,e.splice(s,0,{identifier:h,updater:d,references:1})}a.push(h)}return a}function i(t,e){var r=e.domAPI(e);return r.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;r.update(t=e)}else r.remove()}}t.exports=function(t,i){var o=n(t=t||[],i=i||{});return function(t){t=t||[];for(var a=0;a<o.length;a++){var s=r(o[a]);e[s].references--}for(var c=n(t,i),u=0;u<o.length;u++){var l=r(o[u]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}o=c}}},569:t=>{"use strict";var e={};t.exports=function(t,r){var n=function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},9216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},3565:(t,e,r)=>{"use strict";t.exports=function(t){var e=r.nc;e&&t.setAttribute("nonce",e)}},7795:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(r){!function(t,e,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var i=void 0!==r.layer;i&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,i&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var o=r.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,r)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},4589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},3755:(t,e,r)=>{var n=r(5748);t.exports=function(){var t={};return function(e){if(("object"!=typeof e||null===e)&&"function"!=typeof e)throw new Error("Weakmap-shim: Key must be object");var r=e.valueOf(t);return r&&r.identity===t?r:n(e,t)}}},5748:t=>{t.exports=function(t,e){var r={identity:e},n=t.valueOf;return Object.defineProperty(t,"valueOf",{value:function(t){return t!==e?n.apply(this,arguments):r},writable:!0}),r}},7501:(t,e,r)=>{var n=r(3755);t.exports=function(){var t=n();return{get:function(e,r){var n=t(e);return n.hasOwnProperty("value")?n.value:r},set:function(e,r){return t(e).value=r,this},has:function(e){return"value"in t(e)},delete:function(e){return delete t(e).value}}}},3333:(t,e,r)=>{var n={"./animate.jsx":5061,"./changezone.jsx":1183,"./chat.jsx":5317,"./dance.jsx":8304,"./dialogue.jsx":2282,"./face.jsx":2813,"./greeting.jsx":1162,"./interact.jsx":5544,"./move.jsx":2897,"./patrol.jsx":2704,"./prompt.jsx":3382,"./script.jsx":5744};function i(t){var e=o(t);return r(e)}function o(t){if(!r.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}i.keys=function(){return Object.keys(n)},i.resolve=o,t.exports=i,i.id=3333},4472:(t,e,r)=>{var n={"./camera.jsx":9469,"./chat.jsx":5830,"./menu.jsx":4726};function i(t){var e=o(t);return r(e)}function o(t){if(!r.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}i.keys=function(){return Object.keys(n)},i.resolve=o,t.exports=i,i.id=4472},2903:(t,e,r)=>{"use strict";e.NQ=void 0;var n=r(9100);n.default;var i=r(2534);i.Material,i.MaterialLibrary;var o=r(9933);o.Layout,o.TYPES,o.DuplicateAttributeException,o.Attribute;var a=r(8352);a.downloadModelsFromZip,a.downloadModels,a.downloadMeshes,a.initMeshBuffers,a.deleteMeshBuffers;e.NQ={Attribute:o.Attribute,DuplicateAttributeException:o.DuplicateAttributeException,Layout:o.Layout,Material:i.Material,MaterialLibrary:i.MaterialLibrary,Mesh:n.default,TYPES:o.TYPES,downloadModelsFromZip:a.downloadModelsFromZip,downloadModels:a.downloadModels,downloadMeshes:a.downloadMeshes,initMeshBuffers:a.initMeshBuffers,deleteMeshBuffers:a.deleteMeshBuffers,version:"2.0.3"}},9933:function(t,e){"use strict";var r,n,i=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};e.__esModule=!0,e.Layout=e.Attribute=e.DuplicateAttributeException=e.TYPES=void 0,function(t){t.BYTE="BYTE",t.UNSIGNED_BYTE="UNSIGNED_BYTE",t.SHORT="SHORT",t.UNSIGNED_SHORT="UNSIGNED_SHORT",t.FLOAT="FLOAT"}(n=e.TYPES||(e.TYPES={}));var a=function(t){function e(e){return t.call(this,"found duplicate attribute: ".concat(e.key))||this}return i(e,t),e}(Error);e.DuplicateAttributeException=a;var s=function(t,e,r,n){switch(void 0===n&&(n=!1),this.key=t,this.size=e,this.type=r,this.normalized=n,r){case"BYTE":case"UNSIGNED_BYTE":this.sizeOfType=1;break;case"SHORT":case"UNSIGNED_SHORT":this.sizeOfType=2;break;case"FLOAT":this.sizeOfType=4;break;default:throw new Error("Unknown gl type: ".concat(r))}this.sizeInBytes=this.sizeOfType*e};e.Attribute=s;var c=function(){function t(){for(var t,e,r,n,i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];this.attributes=i,this.attributeMap={};var c=0,u=0;try{for(var l=o(i),h=l.next();!h.done;h=l.next()){var f=h.value;if(this.attributeMap[f.key])throw new a(f);c%f.sizeOfType!=0&&(c+=f.sizeOfType-c%f.sizeOfType,console.warn("Layout requires padding before "+f.key+" attribute")),this.attributeMap[f.key]={attribute:f,size:f.size,type:f.type,normalized:f.normalized,offset:c},c+=f.sizeInBytes,u=Math.max(u,f.sizeOfType)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}c%u!=0&&(c+=u-c%u,console.warn("Layout requires padding at the back")),this.stride=c;try{for(var p=o(i),d=p.next();!d.done;d=p.next())f=d.value,this.attributeMap[f.key].stride=this.stride}catch(t){r={error:t}}finally{try{d&&!d.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}}return t.POSITION=new s("position",3,n.FLOAT),t.NORMAL=new s("normal",3,n.FLOAT),t.TANGENT=new s("tangent",3,n.FLOAT),t.BITANGENT=new s("bitangent",3,n.FLOAT),t.UV=new s("uv",2,n.FLOAT),t.MATERIAL_INDEX=new s("materialIndex",1,n.SHORT),t.MATERIAL_ENABLED=new s("materialEnabled",1,n.UNSIGNED_SHORT),t.AMBIENT=new s("ambient",3,n.FLOAT),t.DIFFUSE=new s("diffuse",3,n.FLOAT),t.SPECULAR=new s("specular",3,n.FLOAT),t.SPECULAR_EXPONENT=new s("specularExponent",3,n.FLOAT),t.EMISSIVE=new s("emissive",3,n.FLOAT),t.TRANSMISSION_FILTER=new s("transmissionFilter",3,n.FLOAT),t.DISSOLVE=new s("dissolve",1,n.FLOAT),t.ILLUMINATION=new s("illumination",1,n.UNSIGNED_SHORT),t.REFRACTION_INDEX=new s("refractionIndex",1,n.FLOAT),t.SHARPNESS=new s("sharpness",1,n.FLOAT),t.MAP_DIFFUSE=new s("mapDiffuse",1,n.SHORT),t.MAP_AMBIENT=new s("mapAmbient",1,n.SHORT),t.MAP_SPECULAR=new s("mapSpecular",1,n.SHORT),t.MAP_SPECULAR_EXPONENT=new s("mapSpecularExponent",1,n.SHORT),t.MAP_DISSOLVE=new s("mapDissolve",1,n.SHORT),t.ANTI_ALIASING=new s("antiAliasing",1,n.UNSIGNED_SHORT),t.MAP_BUMP=new s("mapBump",1,n.SHORT),t.MAP_DISPLACEMENT=new s("mapDisplacement",1,n.SHORT),t.MAP_DECAL=new s("mapDecal",1,n.SHORT),t.MAP_EMISSIVE=new s("mapEmissive",1,n.SHORT),t}();e.Layout=c},2534:function(t,e){"use strict";var r=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},n=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};e.__esModule=!0,e.MaterialLibrary=e.Material=void 0;var i=function(t){this.name=t,this.ambient=[0,0,0],this.diffuse=[0,0,0],this.specular=[0,0,0],this.emissive=[0,0,0],this.transmissionFilter=[0,0,0],this.dissolve=0,this.specularExponent=0,this.transparency=0,this.illumination=0,this.refractionIndex=1,this.sharpness=0,this.mapDiffuse={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapAmbient={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapSpecular={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapSpecularExponent={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapDissolve={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.antiAliasing=!1,this.mapBump={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapDisplacement={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapDecal={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapEmissive={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapReflections=[]};e.Material=i;var o=new i("sentinel"),a=function(){function t(t){this.data=t,this.currentMaterial=o,this.materials={},this.parse()}return t.prototype.parse_newmtl=function(t){var e=t[0];this.currentMaterial=new i(e),this.materials[e]=this.currentMaterial},t.prototype.parseColor=function(t){if("spectral"==t[0])throw new Error("The MTL parser does not support spectral curve files. You will need to convert the MTL colors to either RGB or CIEXYZ.");if("xyz"==t[0])throw new Error("The MTL parser does not currently support XYZ colors. Either convert the XYZ values to RGB or create an issue to add support for XYZ");if(3==t.length){var e=r(t,3),n=e[0],i=e[1],o=e[2];return[parseFloat(n),parseFloat(i),parseFloat(o)]}var a=parseFloat(t[0]);return[a,a,a]},t.prototype.parse_Ka=function(t){this.currentMaterial.ambient=this.parseColor(t)},t.prototype.parse_Kd=function(t){this.currentMaterial.diffuse=this.parseColor(t)},t.prototype.parse_Ks=function(t){this.currentMaterial.specular=this.parseColor(t)},t.prototype.parse_Ke=function(t){this.currentMaterial.emissive=this.parseColor(t)},t.prototype.parse_Tf=function(t){this.currentMaterial.transmissionFilter=this.parseColor(t)},t.prototype.parse_d=function(t){this.currentMaterial.dissolve=parseFloat(t.pop()||"0")},t.prototype.parse_illum=function(t){this.currentMaterial.illumination=parseInt(t[0])},t.prototype.parse_Ni=function(t){this.currentMaterial.refractionIndex=parseFloat(t[0])},t.prototype.parse_Ns=function(t){this.currentMaterial.specularExponent=parseInt(t[0])},t.prototype.parse_sharpness=function(t){this.currentMaterial.sharpness=parseInt(t[0])},t.prototype.parse_cc=function(t,e){e.colorCorrection="on"==t[0]},t.prototype.parse_blendu=function(t,e){e.horizontalBlending="on"==t[0]},t.prototype.parse_blendv=function(t,e){e.verticalBlending="on"==t[0]},t.prototype.parse_boost=function(t,e){e.boostMipMapSharpness=parseFloat(t[0])},t.prototype.parse_mm=function(t,e){e.modifyTextureMap.brightness=parseFloat(t[0]),e.modifyTextureMap.contrast=parseFloat(t[1])},t.prototype.parse_ost=function(t,e,r){for(;t.length<3;)t.push(r.toString());e.u=parseFloat(t[0]),e.v=parseFloat(t[1]),e.w=parseFloat(t[2])},t.prototype.parse_o=function(t,e){this.parse_ost(t,e.offset,0)},t.prototype.parse_s=function(t,e){this.parse_ost(t,e.scale,1)},t.prototype.parse_t=function(t,e){this.parse_ost(t,e.turbulence,0)},t.prototype.parse_texres=function(t,e){e.textureResolution=parseFloat(t[0])},t.prototype.parse_clamp=function(t,e){e.clamp="on"==t[0]},t.prototype.parse_bm=function(t,e){e.bumpMultiplier=parseFloat(t[0])},t.prototype.parse_imfchan=function(t,e){e.imfChan=t[0]},t.prototype.parse_type=function(t,e){e.reflectionType=t[0]},t.prototype.parseOptions=function(t){var e,r,n={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},i={};for(t.reverse();t.length;){var o=t.pop();o.startsWith("-")?i[e=o.substr(1)]=[]:e&&i[e].push(o)}for(e in i)if(i.hasOwnProperty(e)){r=i[e];var a=this["parse_".concat(e)];a&&a.bind(this)(r,n)}return n},t.prototype.parseMap=function(t){var e,n,i="";t[0].startsWith("-")?(i=t.pop(),n=t):(i=(e=r(t))[0],n=e.slice(1));var o=this.parseOptions(n);return o.filename=i.replace(/\\/g,"/"),o},t.prototype.parse_map_Ka=function(t){this.currentMaterial.mapAmbient=this.parseMap(t)},t.prototype.parse_map_Kd=function(t){this.currentMaterial.mapDiffuse=this.parseMap(t)},t.prototype.parse_map_Ks=function(t){this.currentMaterial.mapSpecular=this.parseMap(t)},t.prototype.parse_map_Ke=function(t){this.currentMaterial.mapEmissive=this.parseMap(t)},t.prototype.parse_map_Ns=function(t){this.currentMaterial.mapSpecularExponent=this.parseMap(t)},t.prototype.parse_map_d=function(t){this.currentMaterial.mapDissolve=this.parseMap(t)},t.prototype.parse_map_aat=function(t){this.currentMaterial.antiAliasing="on"==t[0]},t.prototype.parse_map_bump=function(t){this.currentMaterial.mapBump=this.parseMap(t)},t.prototype.parse_bump=function(t){this.parse_map_bump(t)},t.prototype.parse_disp=function(t){this.currentMaterial.mapDisplacement=this.parseMap(t)},t.prototype.parse_decal=function(t){this.currentMaterial.mapDecal=this.parseMap(t)},t.prototype.parse_refl=function(t){this.currentMaterial.mapReflections.push(this.parseMap(t))},t.prototype.parse=function(){var t,e,i=this.data.split(/\r?\n/);try{for(var a=n(i),s=a.next();!s.done;s=a.next()){var c=s.value;if((c=c.trim())&&!c.startsWith("#")){var u=r(c.split(/\s/)),l=u[0],h=u.slice(1),f=this["parse_".concat(l)];f?f.bind(this)(h):console.warn("Don't know how to parse the directive: \"".concat(l,'"'))}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}delete this.data,this.currentMaterial=o},t}();e.MaterialLibrary=a},9100:function(t,e,r){"use strict";var n=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},i=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},a=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};e.__esModule=!0;var s=r(9933),c=function(){function t(t,e){var r,n,s,c;this.name="",this.indicesPerMaterial=[],this.materialsByIndex={},this.tangents=[],this.bitangents=[],(e=e||{}).materials=e.materials||{},e.enableWTextureCoord=!!e.enableWTextureCoord,this.vertexNormals=[],this.textures=[],this.indices=[],this.textureStride=e.enableWTextureCoord?3:2;var l=[],h=[],f=[],p=[],d={},y=-1,g=0,m={verts:[],norms:[],textures:[],hashindices:{},indices:[[]],materialIndices:[],index:0},v=/^v\s/,b=/^vn\s/,w=/^vt\s/,x=/^f\s/,_=/\s+/,E=/^usemtl/,A=t.split("\n");try{for(var k=i(A),S=k.next();!S.done;S=k.next()){var T=S.value;if((T=T.trim())&&!T.startsWith("#")){var L=T.split(_);if(L.shift(),v.test(T))l.push.apply(l,a([],o(L),!1));else if(b.test(T))h.push.apply(h,a([],o(L),!1));else if(w.test(T)){var O=L;L.length>2&&!e.enableWTextureCoord?O=L.slice(0,2):2===L.length&&e.enableWTextureCoord&&O.push("0"),f.push.apply(f,a([],o(O),!1))}else if(E.test(T)){var C=L[0];C in d||(p.push(C),d[C]=p.length-1,d[C]>0&&m.indices.push([])),g=y=d[C]}else if(x.test(T)){var P=u(L);try{for(var M=(s=void 0,i(P)),I=M.next();!I.done;I=M.next())for(var j=I.value,R=0,N=j.length;R<N;R++){var B=j[R]+","+y;if(B in m.hashindices)m.indices[g].push(m.hashindices[B]);else{var D=j[R].split("/"),F=D.length-1;if(m.verts.push(+l[3*(+D[0]-1)+0]),m.verts.push(+l[3*(+D[0]-1)+1]),m.verts.push(+l[3*(+D[0]-1)+2]),f.length){var U=e.enableWTextureCoord?3:2;m.textures.push(+f[(+D[1]-1)*U+0]),m.textures.push(+f[(+D[1]-1)*U+1]),e.enableWTextureCoord&&m.textures.push(+f[(+D[1]-1)*U+2])}m.norms.push(+h[3*(+D[F]-1)+0]),m.norms.push(+h[3*(+D[F]-1)+1]),m.norms.push(+h[3*(+D[F]-1)+2]),m.materialIndices.push(y),m.hashindices[B]=m.index,m.indices[g].push(m.hashindices[B]),m.index+=1}}}catch(t){s={error:t}}finally{try{I&&!I.done&&(c=M.return)&&c.call(M)}finally{if(s)throw s.error}}}}}}catch(t){r={error:t}}finally{try{S&&!S.done&&(n=k.return)&&n.call(k)}finally{if(r)throw r.error}}this.vertices=m.verts,this.vertexNormals=m.norms,this.textures=m.textures,this.vertexMaterialIndices=m.materialIndices,this.indices=m.indices[g],this.indicesPerMaterial=m.indices,this.materialNames=p,this.materialIndices=d,this.materialsByIndex={},e.calcTangentsAndBitangents&&this.calculateTangentsAndBitangents()}return t.prototype.calculateTangentsAndBitangents=function(){console.assert(!!(this.vertices&&this.vertices.length&&this.vertexNormals&&this.vertexNormals.length&&this.textures&&this.textures.length),"Missing attributes for calculating tangents and bitangents");for(var t={tangents:a([],o(new Array(this.vertices.length)),!1).map((function(t){return 0})),bitangents:a([],o(new Array(this.vertices.length)),!1).map((function(t){return 0}))},e=this.indices,r=this.vertices,n=this.vertexNormals,i=this.textures,s=0;s<e.length;s+=3){var c=e[s+0],u=e[s+1],l=e[s+2],h=r[3*c+0],f=r[3*c+1],p=r[3*c+2],d=i[2*c+0],y=i[2*c+1],g=r[3*u+0],m=r[3*u+1],v=r[3*u+2],b=i[2*u+0],w=i[2*u+1],x=g-h,_=m-f,E=v-p,A=r[3*l+0]-h,k=r[3*l+1]-f,S=r[3*l+2]-p,T=b-d,L=w-y,O=i[2*l+0]-d,C=i[2*l+1]-y,P=T*C-L*O,M=1/Math.abs(P<1e-4?1:P),I=(x*C-A*L)*M,j=(_*C-k*L)*M,R=(E*C-S*L)*M,N=(A*T-x*O)*M,B=(k*T-_*O)*M,D=(S*T-E*O)*M,F=n[3*c+0],U=n[3*c+1],z=n[3*c+2],G=n[3*u+0],W=n[3*u+1],V=n[3*u+2],$=n[3*l+0],Y=n[3*l+1],K=n[3*l+2],H=I*F+j*U+R*z,Z=I*G+j*W+R*V,X=I*$+j*Y+R*K,q=I-F*H,J=j-U*H,Q=R-z*H,tt=I-G*Z,et=j-W*Z,rt=R-V*Z,nt=I-$*X,it=j-Y*X,ot=R-K*X,at=Math.sqrt(q*q+J*J+Q*Q),st=Math.sqrt(tt*tt+et*et+rt*rt),ct=Math.sqrt(nt*nt+it*it+ot*ot),ut=N*F+B*U+D*z,lt=N*G+B*W+D*V,ht=N*$+B*Y+D*K,ft=N-F*ut,pt=B-U*ut,dt=D-z*ut,yt=N-G*lt,gt=B-W*lt,mt=D-V*lt,vt=N-$*ht,bt=B-Y*ht,wt=D-K*ht,xt=Math.sqrt(ft*ft+pt*pt+dt*dt),_t=Math.sqrt(yt*yt+gt*gt+mt*mt),Et=Math.sqrt(vt*vt+bt*bt+wt*wt);t.tangents[3*c+0]+=q/at,t.tangents[3*c+1]+=J/at,t.tangents[3*c+2]+=Q/at,t.tangents[3*u+0]+=tt/st,t.tangents[3*u+1]+=et/st,t.tangents[3*u+2]+=rt/st,t.tangents[3*l+0]+=nt/ct,t.tangents[3*l+1]+=it/ct,t.tangents[3*l+2]+=ot/ct,t.bitangents[3*c+0]+=ft/xt,t.bitangents[3*c+1]+=pt/xt,t.bitangents[3*c+2]+=dt/xt,t.bitangents[3*u+0]+=yt/_t,t.bitangents[3*u+1]+=gt/_t,t.bitangents[3*u+2]+=mt/_t,t.bitangents[3*l+0]+=vt/Et,t.bitangents[3*l+1]+=bt/Et,t.bitangents[3*l+2]+=wt/Et}this.tangents=t.tangents,this.bitangents=t.bitangents},t.prototype.makeBufferData=function(t){var e,r,n=this.vertices.length/3,o=new ArrayBuffer(t.stride*n);o.numItems=n;for(var a=new DataView(o),c=0,u=0;c<n;c++){u=c*t.stride;try{for(var l=(e=void 0,i(t.attributes)),h=l.next();!h.done;h=l.next()){var f=h.value,p=u+t.attributeMap[f.key].offset;switch(f.key){case s.Layout.POSITION.key:a.setFloat32(p,this.vertices[3*c],!0),a.setFloat32(p+4,this.vertices[3*c+1],!0),a.setFloat32(p+8,this.vertices[3*c+2],!0);break;case s.Layout.UV.key:a.setFloat32(p,this.textures[2*c],!0),a.setFloat32(p+4,this.textures[2*c+1],!0);break;case s.Layout.NORMAL.key:a.setFloat32(p,this.vertexNormals[3*c],!0),a.setFloat32(p+4,this.vertexNormals[3*c+1],!0),a.setFloat32(p+8,this.vertexNormals[3*c+2],!0);break;case s.Layout.MATERIAL_INDEX.key:a.setInt16(p,this.vertexMaterialIndices[c],!0);break;case s.Layout.AMBIENT.key:var d=this.vertexMaterialIndices[c];if(!(y=this.materialsByIndex[d])){console.warn('Material "'+this.materialNames[d]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}a.setFloat32(p,y.ambient[0],!0),a.setFloat32(p+4,y.ambient[1],!0),a.setFloat32(p+8,y.ambient[2],!0);break;case s.Layout.DIFFUSE.key:if(d=this.vertexMaterialIndices[c],!(y=this.materialsByIndex[d])){console.warn('Material "'+this.materialNames[d]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}a.setFloat32(p,y.diffuse[0],!0),a.setFloat32(p+4,y.diffuse[1],!0),a.setFloat32(p+8,y.diffuse[2],!0);break;case s.Layout.SPECULAR.key:if(d=this.vertexMaterialIndices[c],!(y=this.materialsByIndex[d])){console.warn('Material "'+this.materialNames[d]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}a.setFloat32(p,y.specular[0],!0),a.setFloat32(p+4,y.specular[1],!0),a.setFloat32(p+8,y.specular[2],!0);break;case s.Layout.SPECULAR_EXPONENT.key:if(d=this.vertexMaterialIndices[c],!(y=this.materialsByIndex[d])){console.warn('Material "'+this.materialNames[d]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}a.setFloat32(p,y.specularExponent,!0);break;case s.Layout.EMISSIVE.key:if(d=this.vertexMaterialIndices[c],!(y=this.materialsByIndex[d])){console.warn('Material "'+this.materialNames[d]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}a.setFloat32(p,y.emissive[0],!0),a.setFloat32(p+4,y.emissive[1],!0),a.setFloat32(p+8,y.emissive[2],!0);break;case s.Layout.TRANSMISSION_FILTER.key:if(d=this.vertexMaterialIndices[c],!(y=this.materialsByIndex[d])){console.warn('Material "'+this.materialNames[d]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}a.setFloat32(p,y.transmissionFilter[0],!0),a.setFloat32(p+4,y.transmissionFilter[1],!0),a.setFloat32(p+8,y.transmissionFilter[2],!0);break;case s.Layout.DISSOLVE.key:if(d=this.vertexMaterialIndices[c],!(y=this.materialsByIndex[d])){console.warn('Material "'+this.materialNames[d]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}a.setFloat32(p,y.dissolve,!0);break;case s.Layout.ILLUMINATION.key:if(d=this.vertexMaterialIndices[c],!(y=this.materialsByIndex[d])){console.warn('Material "'+this.materialNames[d]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}a.setInt16(p,y.illumination,!0);break;case s.Layout.REFRACTION_INDEX.key:if(d=this.vertexMaterialIndices[c],!(y=this.materialsByIndex[d])){console.warn('Material "'+this.materialNames[d]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}a.setFloat32(p,y.refractionIndex,!0);break;case s.Layout.SHARPNESS.key:if(d=this.vertexMaterialIndices[c],!(y=this.materialsByIndex[d])){console.warn('Material "'+this.materialNames[d]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}a.setFloat32(p,y.sharpness,!0);break;case s.Layout.ANTI_ALIASING.key:var y;if(d=this.vertexMaterialIndices[c],!(y=this.materialsByIndex[d])){console.warn('Material "'+this.materialNames[d]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}a.setInt16(p,y.antiAliasing?1:0,!0)}}}catch(t){e={error:t}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}}return o},t.prototype.makeIndexBufferData=function(){var t=new Uint16Array(this.indices);return t.numItems=this.indices.length,t},t.prototype.makeIndexBufferDataForMaterials=function(){for(var t,e=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=(t=new Array).concat.apply(t,a([],o(r.map((function(t){return e.indicesPerMaterial[t]}))),!1)),s=new Uint16Array(i);return s.numItems=i.length,s},t.prototype.addMaterialLibrary=function(t){for(var e in t.materials)if(e in this.materialIndices){var r=t.materials[e],n=this.materialIndices[r.name];this.materialsByIndex[n]=r}},t}();function u(t){var e;return n(this,(function(r){switch(r.label){case 0:return t.length<=3?[4,t]:[3,2];case 1:return r.sent(),[3,9];case 2:return 4!==t.length?[3,5]:[4,[t[0],t[1],t[2]]];case 3:return r.sent(),[4,[t[2],t[3],t[0]]];case 4:return r.sent(),[3,9];case 5:e=1,r.label=6;case 6:return e<t.length-1?[4,[t[0],t[e],t[e+1]]]:[3,9];case 7:r.sent(),r.label=8;case 8:return e++,[3,6];case 9:return[2]}}))}e.default=c},8352:function(t,e,r){"use strict";var n=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a};e.__esModule=!0,e.deleteMeshBuffers=e.initMeshBuffers=e._buildBuffer=e.downloadMeshes=e.downloadModels=e.downloadModelsFromZip=void 0;var o=r(9100),a=r(2534);function s(t,e){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(e)),r}function c(t,e,r){var i,o,a=["mapDiffuse","mapAmbient","mapSpecular","mapDissolve","mapBump","mapDisplacement","mapDecal","mapEmissive"];r.endsWith("/")||(r+="/");var c=[];for(var u in e.materials)if(e.materials.hasOwnProperty(u)){var l=e.materials[u],h=function(e){var n=l[e];if(!n||!n.filename)return"continue";var i=r+n.filename;c.push(fetch(i).then((function(t){if(!t.ok)throw new Error;return t.blob()})).then((function(e){var r=new Image;r.src=URL.createObjectURL(e),n.texture=r;var i=s(t,[128,192,86,255]);return n.glTexture=i,t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,n.glTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n.texture),r.onload=function(){t.bindTexture(t.TEXTURE_2D,n.glTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n.texture)},new Promise((function(t){return r.onload=function(){return t(n)}}))})).catch((function(){console.error("Unable to download texture: ".concat(i))})))};try{for(var f=(i=void 0,n(a)),p=f.next();!p.done;p=f.next())h(p.value)}catch(t){i={error:t}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}}return Promise.all(c)}function u(t,e,r,i){var o,a,c=["mapDiffuse","mapAmbient","mapSpecular","mapDissolve","mapBump","mapDisplacement","mapDecal","mapEmissive"];r.endsWith("/")||(r+="/");var u=[];for(var l in e.materials)if(e.materials.hasOwnProperty(l)){var h=e.materials[l],f=function(e){var n=h[e];if(!n||!n.filename)return"continue";var o=r+n.filename;u.push(i.file(o).async("arrayBuffer").then((function(t){let e=new Uint8Array(t);return new Blob([e.buffer])})).then((function(e){var r=new Image;r.src=URL.createObjectURL(e),n.texture=r;var i=s(t,[128,192,86,255]);return n.glTexture=i,t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,n.glTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n.texture),r.onload=function(){t.bindTexture(t.TEXTURE_2D,n.glTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n.texture)},new Promise((function(t){return r.onload=function(){return t(n)}}))})).catch((function(){console.error("Unable to download texture from zip: ".concat(o))})))};try{for(var p=(o=void 0,n(c)),d=p.next();!d.done;d=p.next())f(d.value)}catch(t){o={error:t}}finally{try{d&&!d.done&&(a=p.return)&&a.call(p)}finally{if(o)throw o.error}}}return Promise.all(u)}function l(t){return"string"!=typeof t.mtl?t.obj.replace(/\.obj$/,".mtl"):t.mtl}function h(t,e,r,n){var i=t.createBuffer(),o=e===t.ARRAY_BUFFER?Float32Array:Uint16Array;return t.bindBuffer(e,i),t.bufferData(e,new o(r),t.STATIC_DRAW),i.itemSize=n,i.numItems=r.length/n,i}e.downloadModelsFromZip=function(t,e,r){var s,c,h=[],f=function(e){if(!e.obj)throw new Error('"obj" attribute of model object not set. The .obj file is required to be set in order to use downloadModels()');var n={indicesPerMaterial:!!e.indicesPerMaterial,calcTangentsAndBitangents:!!e.calcTangentsAndBitangents},i=e.obj.split("/"),s=i[i.length-1].replace(".obj",""),c=Promise.resolve(s),f=r.file(`models/${s}.obj`).async("string").then((function(t){return new o.default(t,n)})),p=void 0;if(e.mtl){var d=l(e);p=r.file(`models/${s}.mtl`).async("string").then((function(n){var i=new a.MaterialLibrary(n);if(!1!==e.downloadMtlTextures){var o=e.mtlTextureRoot;return o||(o=d.substr(0,d.lastIndexOf("/"))),Promise.all([Promise.resolve(i),u(t,i,o,r)])}return Promise.all([Promise.resolve(i),void 0])})).then((function(t){return t}))}var y=[c,f,p];h.push(Promise.all(y))};try{for(var p=n(e),d=p.next();!d.done;d=p.next())f(d.value)}catch(t){s={error:t}}finally{try{d&&!d.done&&(c=p.return)&&c.call(p)}finally{if(s)throw s.error}}return Promise.all(h).then((function(t){var e,r,o={};try{for(var a=n(t),s=a.next();!s.done;s=a.next()){var c=s.value,u=i(c,3),l=u[0],h=u[1],f=u[2];h.name=l,f&&h.addMaterialLibrary(f[0]),o[l]=h}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return o}))},e.downloadModels=function(t,e){var r,s,u=[],h=function(e){if(!e.obj)throw new Error('"obj" attribute of model object not set. The .obj file is required to be set in order to use downloadModels()');var r={indicesPerMaterial:!!e.indicesPerMaterial,calcTangentsAndBitangents:!!e.calcTangentsAndBitangents},n=e.name;if(!n){var i=e.obj.split("/");n=i[i.length-1].replace(".obj","")}var s=Promise.resolve(n),h=fetch(e.obj).then((function(t){return t.text()})).then((function(t){return new o.default(t,r)})),f=void 0;if(e.mtl){var p=l(e);f=fetch(p).then((function(t){return t.text()})).then((function(r){var n=new a.MaterialLibrary(r);if(!1!==e.downloadMtlTextures){var i=e.mtlTextureRoot;return i||(i=p.substr(0,p.lastIndexOf("/"))),Promise.all([Promise.resolve(n),c(t,n,i)])}return Promise.all([Promise.resolve(n),void 0])})).then((function(t){return t}))}var d=[s,h,f];u.push(Promise.all(d))};try{for(var f=n(e),p=f.next();!p.done;p=f.next())h(p.value)}catch(t){r={error:t}}finally{try{p&&!p.done&&(s=f.return)&&s.call(f)}finally{if(r)throw r.error}}return Promise.all(u).then((function(t){var e,r,o={};try{for(var a=n(t),s=a.next();!s.done;s=a.next()){var c=s.value,u=i(c,3),l=u[0],h=u[1],f=u[2];h.name=l,f&&h.addMaterialLibrary(f[0]),o[l]=h}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return o}))},e.downloadMeshes=function(t,e,r){void 0===r&&(r={});var a=[],s=function(e){if(!t.hasOwnProperty(e))return"continue";var r=t[e];a.push(fetch(r).then((function(t){return t.text()})).then((function(t){return[e,new o.default(t)]})))};for(var c in t)s(c);Promise.all(a).then((function(t){var o,a;try{for(var s=n(t),c=s.next();!c.done;c=s.next()){var u=i(c.value,2),l=u[0],h=u[1];r[l]=h}}catch(t){o={error:t}}finally{try{c&&!c.done&&(a=s.return)&&a.call(s)}finally{if(o)throw o.error}}return e(r)}))},e._buildBuffer=h,e.initMeshBuffers=function(t,e){return e.normalBuffer=h(t,t.ARRAY_BUFFER,e.vertexNormals,3),e.textureBuffer=h(t,t.ARRAY_BUFFER,e.textures,e.textureStride),e.vertexBuffer=h(t,t.ARRAY_BUFFER,e.vertices,3),e.indexBuffer=h(t,t.ELEMENT_ARRAY_BUFFER,e.indices,1),e},e.deleteMeshBuffers=function(t,e){t.deleteBuffer(e.normalBuffer),t.deleteBuffer(e.textureBuffer),t.deleteBuffer(e.vertexBuffer),t.deleteBuffer(e.indexBuffer)}},7640:t=>{function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=7640,t.exports=e},1974:t=>{"use strict";t.exports=require("react")}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),r.nc=void 0;var n={};(()=>{"use strict";r.r(n),r.d(n,{default:()=>fa});var t=r(1974),e=r.n(t),i=r(5565),o=r(5697),a=r.n(o),s=r(8348);const c={Vector:s.OW,Vector4:s.Lt};function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=function(){function t(e,r,n,i,o,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.gamepad=a,this.width=e.canvas.width,this.height=e.canvas.height,this.layout=r,this.touches=n,this.radius=o,this.x=0,this.y=0,this.dx=0,this.dy=0,this.gamepad.map["x-dir"]=0,this.gamepad.map["y-dir"]=0,this.gamepad.map["x-axis"]=0,this.gamepad.map["y-axis"]=0,this.colours=i,this.init=this.init.bind(this),this.draw=this.draw.bind(this)}var e,r;return e=t,r=[{key:"init",value:function(){var t=this.layout,e=this.width;this.x=e-t.x,this.y=t.y+3*this.radius/8,this.dx=this.x,this.dy=this.y,this.gamepad.map["x-dir"]=0,this.gamepad.map["y-dir"]=0,this.gamepad.map["x-axis"]=0,this.gamepad.map["y-axis"]=0}},{key:"draw",value:function(){var t=this.ctx;t.fillStyle=this.colours.joystick.base,t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),t.fill(),t.closePath(),t.fillStyle=this.colours.joystick.dust,t.beginPath(),t.arc(this.x,this.y,this.radius-5,0,2*Math.PI,!1),t.fill(),t.closePath(),t.fillStyle=this.colours.joystick.stick,t.beginPath(),t.arc(this.x,this.y,10,0,2*Math.PI,!1),t.fill(),t.closePath(),t.fillStyle=this.colours.joystick.ball,t.beginPath(),t.arc(this.dx,this.dy,this.radius-10,0,2*Math.PI,!1),t.fill(),t.closePath()}},{key:"state",value:function(t,e){var r=this.gamepad,n=r.touches,i=r.map,o=r.checkInput,a=n[t].x,s=n[t].y,c=parseInt(a-this.x),u=parseInt(s-this.y),l=parseInt(Math.sqrt(c*c+u*u));l<1.2*this.radius&&(e?"mousedown"===e&&(n[t].id="stick"):n[t].id="stick"),l<2.5*this.radius&&(e?"stick"==n[t].id&&"mouseup"===e&&(delete n[t].id,this.reset()):n[t].id="stick"),"stick"==n[t].id&&(Math.abs(parseInt(c))<this.radius/2&&(this.dx=this.x+c),Math.abs(parseInt(u))<this.radius/2&&(this.dy=this.y+u),i["x-axis"]=(this.dx-this.x)/(this.radius/2),i["y-axis"]=(this.dy-this.y)/(this.radius/2),i["x-dir"]=Math.round(i["x-axis"]),i["y-dir"]=Math.round(i["y-axis"]),l>2.5*this.radius&&(this.reset(),delete n[t].id),"function"==typeof o&&this.gamepad.checkInput())}},{key:"reset",value:function(){var t=this.gamepad.map;this.dx=this.x,this.dy=this.y,t["x-dir"]=0,t["y-dir"]=0,t["x-axis"]=0,t["y-axis"]=0}}],r&&u(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function h(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}CanvasRenderingContext2D.prototype.roundRect=function(t,e,r,n,i){return r<2*i&&(i=r/2),n<2*i&&(i=n/2),this.beginPath(),this.moveTo(t+i,e),this.arcTo(t+r,e,t+r,e+n,i),this.arcTo(t+r,e+n,t,e+n,i),this.arcTo(t,e+n,t,e,i),this.arcTo(t,e,t+r,e,i),this.closePath(),this};var f=function(){function t(e,r,n,i,o,a,s,c){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.gamepad=c,this.layout=r,this.radius=s,this.touches=n,this.start=i,this.select=o,this.colours=a}var e,r;return e=t,r=[{key:"init",value:function(){for(var t=this.layout,e=this.ctx,r=this.gamepad.buttons_layout,n=e.canvas.width,i=0;i<r.length;i++){var o=r[i],a=t.x-o.x,s=t.y-o.y;if(o.r){var c=o.r;r[i].hit={x:[a-c,a+2*c],y:[s-c,s+2*c],active:!1}}else{if(o.x=n/3-o.w,this.start&&this.select)switch(o.name){case"select":o.x=n/2-o.w-2*o.h;break;case"start":o.x=n/2}a=o.x,s=t.y-o.y,r[i].hit={x:[a,a+o.w],y:[s,s+o.h],active:!1}}this.gamepad.map[o.name]=0}}},{key:"draw",value:function(){for(var t=this.ctx,e=this.layout,r=0;r<this.gamepad.buttons_layout.length;r++){var n=this.gamepad.buttons_layout[r],i=n.color,o=e.x-n.x,a=e.y-n.y;if(n.dx=o,n.dy=a,n.r){var s=n.r;n.hit&&n.hit.active&&(t.fillStyle=i,t.beginPath(),t.arc(o,a,s+5,0,2*Math.PI,!1),t.fill(),t.closePath()),t.fillStyle=i,t.beginPath(),t.arc(o,a,s,0,2*Math.PI,!1),t.fill(),t.closePath(),t.strokeStyle=i,t.lineWidth=2,t.stroke(),t.fillStyle="rgba(255,255,255,1)",t.textAlign="center",t.textBaseline="middle",t.font="minecraftia 12px",t.fillText(n.name,o,a)}else{var c=n.w,u=n.h;o=isNaN(n.x)?t.canvas.width/2:n.x,s=10,t.fillStyle=i,n.hit&&n.hit.active&&t.roundRect(o-5,a-5,c+10,u+10,2*s).fill(),t.roundRect(o,a,c,u,s).fill(),t.strokeStyle=i,t.lineWidth=2,t.stroke(),t.fillStyle="rgba(0,0,0,0.5)",t.textAlign="center",t.textBaseline="middle",t.font="minecraftia 12px",t.fillText(n.name,o+c/2,a+2*u)}n.key&&(t.fillStyle="rgba(0,0,0,0.25)",t.textAlign="center",t.textBaseline="middle",t.font="minecraftia 12px","start"!=n.name&&"select"!=n.name||(o+=c/2),t.fillText(n.key,o,a-1.5*s))}}},{key:"state",value:function(t,e,r){var n=this.gamepad,i=n.touches,o=n.checkInput,a=n.width;if("stick"!=i[t].id){var s={x:i[t].x,y:i[t].y},c=this.gamepad.buttons_layout[e],u=c.name,l=parseInt(s.x-c.dx),h=parseInt(s.y-c.dy),f=a;if(c.r?f=parseInt(Math.sqrt(l*l+h*h)):s.x>c.hit.x[0]&&s.x<c.hit.x[1]&&s.y>c.hit.y[0]&&s.y<c.hit.y[1]&&(f=0),f<this.radius&&"stick"!=i[t].id)if(r)switch(r){case"mousedown":i[t].id=u;break;case"mouseup":delete i[t].id,this.reset(e)}else i[t].id=u;i[t].id==u&&(this.gamepad.map[u]=1,c.hit.active=!0,f>this.radius&&(c.hit.active=!1,this.gamepad.map[u]=0,delete i[t].id),"function"==typeof o&&this.gamepad.checkInput())}}},{key:"reset",value:function(t){this.gamepad.buttons_layout[t].hit.active=!1,this.gamepad.map[this.gamepad.buttons_layout[t].name]=0}}],r&&h(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function p(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var d=function(){function t(e,r,n,i,o,a,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.gamepad=s,this.width=e.canvas.width,this.height=e.canvas.height,this.radius=e.canvas.width/10,this.touches=n,this.start=i,this.select=o,this.button_offset=r,this.colours=a,this.layout={x:this.width-this.button_offset.x,y:this.height-this.button_offset.y},this.stick=new l(this.ctx,this.layout,this.touches,this.colours,this.radius,this.gamepad),this.buttons=new f(this.ctx,this.layout,this.touches,this.start,this.select,this.colours,this.radius,this.gamepad)}var e,r;return e=t,(r=[{key:"init",value:function(){this.stick.init(),this.buttons.init()}},{key:"draw",value:function(){this.stick.draw(),this.buttons.draw()}}])&&p(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var g=function(){function t(e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),t._instance||(this.engine=e,this.dirty=!0,this.showTrace=!0,this.showDebug=!0,this.opacity=.4,this.font="minecraftia",this.start=!1,this.select=!1,this.touches={},this.lastKey=(new Date).getTime(),this.listeners=[],this.map={},this.colours={red:"rgba(255,0,0,".concat(this.opacity,")"),green:"rgba(5,220,30,".concat(this.opacity,")"),blue:"rgba(5,30,220,".concat(this.opacity,")"),purple:"rgba(240,5,240,".concat(this.opacity,")"),yellow:"rgba(240,240,5,".concat(this.opacity,")"),cyan:"rgba(5,240,240,".concat(this.opacity,")"),black:"rgba(5,5,5,".concat(this.opacity,")"),white:"rgba(250,250,250,".concat(this.opacity,")"),joystick:{base:"rgba(0,0,0,".concat(this.opacity,")"),dust:"rgba(0,0,0,".concat(this.opacity,")"),stick:"rgba(214,214,214,1)",ball:"rgba(245,245,245,1)"}},t._instance=this),t._instance}var e,r;return e=t,r=[{key:"init",value:function(){this.fontSize=this.engine.gp.canvas.width/12,this.radius=this.engine.gp.canvas.width/12,this.button_offset={x:2.5*this.radius,y:105};var t=[{x:-this.radius-this.radius/2+this.radius/4,y:-this.radius/4,r:3/4*this.radius,color:this.colours.red,name:"b"},{x:this.radius-this.radius/2,y:-(this.radius+this.radius/2),r:3/4*this.radius,color:this.colours.green,name:"a"},{x:this.radius-this.radius/2,y:this.radius,r:3/4*this.radius,color:this.colours.blue,name:"x"},{x:3*this.radius-this.radius/2-this.radius/4,y:0-this.radius/4,r:3/4*this.radius,color:this.colours.yellow,name:"y"}];this.start&&t.push({color:this.colours.black,y:-55,w:50,h:15,name:"start"}),this.select&&t.push({y:-55,w:50,h:15,color:this.colours.black,name:"select"}),this.buttons_layout=t,this.controller=new d(this.engine.gp,this.button_offset,this.touches,this.start,this.select,this.colours,this),this.initOptions()}},{key:"initOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setOptions(t),this.resize(),this.loadCanvas()}},{key:"attachListener",value:function(t){return this.listeners.push(t)}},{key:"removeListener",value:function(t){this.listeners.splice(t-1,1)}},{key:"checkInput",value:function(){return this.map}},{key:"resize",value:function(){this.width=this.engine.gp.canvas.width,this.height=this.engine.gp.canvas.height,this.controller.init()}},{key:"loadCanvas",value:function(){var t=this,e=this.controller,r=this.width,n=this.height;this.engine.gp.fillStyle="rgba(70,70,70,0.5)",this.engine.gp.textAlign="center",this.engine.gp.textBaseline="middle",this.engine.gp.font="minecraftia 14px",this.engine.gp.fillText("loading",r/2,n/2),e.stick.draw(),e.buttons.draw(),window.addEventListener("resize",(function(){return t.resize()})),setTimeout((function(){this.ready=!0}),250)}},{key:"setOptions",value:function(t){var e=this;Object.keys(this).forEach((function(r){void 0!==t[r]&&(e[r]=t[r],e.dirty=!0)}))}},{key:"debounce",value:function(){var t=this.controller,e=this.buttons_layout,r=this.lastKey;this.lastKey=(new Date).getTime()+100;for(var n=0;n<e.length;n++)t.buttons.reset(n);return r<this.lastKey}},{key:"keyPressed",value:function(t){return 1===this.map[t]&&this.debounce()}},{key:"listen",value:function(t){var e,r=this.touches,n=this.controller,i=this.buttons_layout;if(t.type){var o=t.type;-1!=t.type.indexOf("mouse")&&(t.identifier="desktop",t={touches:[t]});var a=this.getPosition(this.engine.gp.canvas);this.listeners.map((function(e){if(e[o])return e[o](t)}));for(var s=0;s<(t.touches.length>5?5:t.touches.length);s++)r[c=t.touches[s].identifier]?(r[c].x=t.touches[s].pageX-a.x,r[c].y=t.touches[s].pageY-a.y):r[c]={x:t.touches[s].pageX-a.x,y:t.touches[s].pageY-a.y,leftClick:!1,rightClick:!1};for(var c in r)switch(o){case"touchstart":case"touchmove":if(this.disableScroll(),n.stick.state(c),(new Date).getTime()>this.lastKey+150){for(s=0;s<i.length;s++)n.buttons.state(c,s);this.lastKey=(new Date).getTime()}break;case"touchend":for(s=0;s<i.length;s++)n.buttons.reset(s);break;case"mousemove":if(r[c].leftClick){var u=.01,l=[r[c].y*u,-r[c].x*u+r[c].y*u,-r[c].x*u-r[c].y*u];this.engine.renderManager.camera.changeAngle(l)}case"mousedown":t.touches&&null!==(e=t.touches[0])&&void 0!==e&&e.which?(r[c].leftClick=1===t.touches[0].which,r[c].rightClick=3===t.touches[0].which):"button"in t&&(r[c].leftClick=1==t.button,r[c].rightClick=2==t.button),n.stick.state(c,o);for(s=0;s<i.length;s++)n.buttons.state(c,s,o);break;case"mouseup":for(n.stick.state(c,o),s=0;s<i.length;s++)n.buttons.state(c,s,o);r[c].leftClick=0,r[c].rightClick=0}if("touchend"==t.type){for("stick"==r[c=t.changedTouches[0].identifier].id&&n.stick.reset(),s=0;s<i.length;s++)r[c].id==i[s].name&&n.buttons.reset(s);if(r[c]&&delete r[c],t.changedTouches.length>t.touches.length){var h=0,f=t.changedTouches.length-t.touches.length;for(var c in r)h>=f&&delete r[c],h++}if(0==t.touches.length){for(r={},s=0;s<i.length;s++)n.buttons.reset(s);n.stick.reset()}this.enableScroll()}}else{var p=t,d=0;for(var y in p){switch(y){case"%":p[y]&&(d+=1);break;case"&":p[y]&&(d+=2);break;case"'":p[y]&&(d+=4);break;case"(":p[y]&&(d+=8);break;default:if(p[y])for(s=0;s<i.length;s++)i[s].key&&i[s].key==y&&(r[i[s].name]={id:i[s].name,x:i[s].hit.x[0]+i[s].w/2,y:i[s].hit.y[0]+i[s].h/2},n.buttons.state(i[s].name,s,"mousedown"));else if(!p[y]){for(s=0;s<i.length;s++)i[s].key&&i[s].key==y&&(n.buttons.reset(s),delete r[i[s].name]);delete p[y]}}switch(n.stick.dx=n.stick.x,n.stick.dy=n.stick.y,d){case 1:n.stick.dx=n.stick.x-n.stick.radius/2;break;case 2:n.stick.dy=n.stick.y-n.stick.radius/2;break;case 3:n.stick.dx=n.stick.x-n.stick.radius/2,n.stick.dy=n.stick.y-n.stick.radius/2;break;case 4:n.stick.dx=n.stick.x+n.stick.radius/2;break;case 6:n.stick.dx=n.stick.x+n.stick.radius/2,n.stick.dy=n.stick.y-n.stick.radius/2;break;case 8:n.stick.dy=n.stick.y+n.stick.radius/2;break;case 9:n.stick.dx=n.stick.x-n.stick.radius/2,n.stick.dy=n.stick.y+n.stick.radius/2;break;case 12:n.stick.dx=n.stick.x+n.stick.radius/2,n.stick.dy=n.stick.y+n.stick.radius/2;break;default:n.stick.dx=n.stick.x,n.stick.dy=n.stick.y}0!=d?(r.stick={id:"stick"},n.stick.state("stick","mousemove")):(n.stick.reset(),delete r.stick)}}return this.map}},{key:"render",value:function(){this.engine.gp.clearRect(0,0,this.engine.gp.canvas.width,this.engine.gp.canvas.height),this.showDebug&&this.debug(),this.showTrace&&this.trace(),this.controller.stick.draw(),this.controller.buttons.draw()}},{key:"debug",value:function(){this.gp,this.map;var t=this.touches;for(var e in this.dy=30,this.engine.gp.fillStyle="rgba(70,70,70,0.5)",this.engine.gp.textAlign="left",this.engine.gp.textBaseline="middle",this.engine.gp.font="minecraftia 20px",this.engine.gp.fillText("debug",10,this.dy),this.engine.gp.font="minecraftia 14px",this.dy+=5,t){this.dy+=10;var r=e+" : "+JSON.stringify(t[e]).slice(1,-1);this.engine.gp.fillText(r,10,this.dy)}}},{key:"trace",value:function(){var t=this.map;for(var e in this.dy=30,this.engine.gp.fillStyle="rgba(70,70,70,0.5)",this.engine.gp.textAlign="right",this.engine.gp.textBaseline="middle",this.engine.gp.font="minecraftia 20px",this.engine.gp.fillText("trace",this.width-10,this.dy),this.engine.gp.font="minecraftia 14px",this.dy+=5,t){this.dy+=10;var r=e+" : "+t[e];this.engine.gp.fillText(r,this.width-10,this.dy)}}},{key:"getPosition",value:function(t){for(var e=0,r=0;t;)e+=t.offsetLeft-t.scrollLeft+t.clientLeft,r+=t.offsetTop-t.scrollTop+t.clientTop,t=t.offsetParent;return{x:e,y:r}}},{key:"enableScroll",value:function(){document.body.removeEventListener("touchmove",this.preventDefault)}},{key:"disableScroll",value:function(){document.body.addEventListener("touchmove",this.preventDefault,{passive:!1})}},{key:"preventDefault",value:function(t){t.preventDefault(),t.stopPropagation()}}],r&&y(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function m(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var v=function(){function t(e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),t._instance||(this.activeKeys=[],this.activeCodes=[],this.shift=!1,this.engine=e,t._instance=this),t._instance}var e,r;return e=t,r=[{key:"init",value:function(){}},{key:"onKeyDown",value:function(e){e.preventDefault();var r=String.fromCharCode(e.keyCode).toLowerCase();t._instance.activeKeys.indexOf(r)<0&&t._instance.activeKeys.push(r),t._instance.activeCodes.indexOf(e.key)<0&&t._instance.activeCodes.push(e.key),t._instance.shift=e.shiftKey}},{key:"onKeyUp",value:function(e){var r=String.fromCharCode(e.keyCode).toLowerCase(),n=t._instance.activeKeys.indexOf(r);t._instance.activeKeys.splice(n,1),t._instance.activeCodes.splice(n,1)}},{key:"lastPressed",value:function(e){for(var r=e.toLowerCase(),n=null,i=-1,o=0;o<e.length;o++){var a=r[o],s=t._instance.activeKeys.indexOf(a);s>i&&(n=a,i=s)}return n}},{key:"lastPressedCode",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=t._instance.activeCodes.pop(),n=e.toLowerCase(),i=0;i<n.length;i++)t._instance.activeKeys.indexOf(r)<0&&(r=t._instance.activeCodes.pop());return r}},{key:"lastPressedKey",value:function(){return t._instance.activeKeys[t._instance.activeKeys.length-1]}}],r&&m(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();const b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,w=Object.keys,x=Array.isArray;function _(t,e){return"object"!=typeof e||w(e).forEach((function(r){t[r]=e[r]})),t}"undefined"==typeof Promise||b.Promise||(b.Promise=Promise);const E=Object.getPrototypeOf,A={}.hasOwnProperty;function k(t,e){return A.call(t,e)}function S(t,e){"function"==typeof e&&(e=e(E(t))),("undefined"==typeof Reflect?w:Reflect.ownKeys)(e).forEach((r=>{L(t,r,e[r])}))}const T=Object.defineProperty;function L(t,e,r,n){T(t,e,_(r&&k(r,"get")&&"function"==typeof r.get?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function O(t){return{from:function(e){return t.prototype=Object.create(e.prototype),L(t.prototype,"constructor",t),{extend:S.bind(null,t.prototype)}}}}const C=Object.getOwnPropertyDescriptor;function P(t,e){let r;return C(t,e)||(r=E(t))&&P(r,e)}const M=[].slice;function I(t,e,r){return M.call(t,e,r)}function j(t,e){return e(t)}function R(t){if(!t)throw new Error("Assertion Failed")}function N(t){b.setImmediate?setImmediate(t):setTimeout(t,0)}function B(t,e){return t.reduce(((t,r,n)=>{var i=e(r,n);return i&&(t[i[0]]=i[1]),t}),{})}function D(t,e){if(k(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var r=[],n=0,i=e.length;n<i;++n){var o=D(t,e[n]);r.push(o)}return r}var a=e.indexOf(".");if(-1!==a){var s=t[e.substr(0,a)];return void 0===s?void 0:D(s,e.substr(a+1))}}function F(t,e,r){if(t&&void 0!==e&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){R("string"!=typeof r&&"length"in r);for(var n=0,i=e.length;n<i;++n)F(t,e[n],r[n])}else{var o=e.indexOf(".");if(-1!==o){var a=e.substr(0,o),s=e.substr(o+1);if(""===s)void 0===r?x(t)&&!isNaN(parseInt(a))?t.splice(a,1):delete t[a]:t[a]=r;else{var c=t[a];c||(c=t[a]={}),F(c,s,r)}}else void 0===r?x(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=r}}function U(t){var e={};for(var r in t)k(t,r)&&(e[r]=t[r]);return e}const z=[].concat;function G(t){return z.apply([],t)}const W="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(G([8,16,32,64].map((t=>["Int","Uint","Float"].map((e=>e+t+"Array")))))).filter((t=>b[t])),V=W.map((t=>b[t]));B(W,(t=>[t,!0]));let $=null;function Y(t){$="undefined"!=typeof WeakMap&&new WeakMap;const e=K(t);return $=null,e}function K(t){if(!t||"object"!=typeof t)return t;let e=$&&$.get(t);if(e)return e;if(x(t)){e=[],$&&$.set(t,e);for(var r=0,n=t.length;r<n;++r)e.push(K(t[r]))}else if(V.indexOf(t.constructor)>=0)e=t;else{const r=E(t);for(var i in e=r===Object.prototype?{}:Object.create(r),$&&$.set(t,e),t)k(t,i)&&(e[i]=K(t[i]))}return e}const{toString:H}={};function Z(t){return H.call(t).slice(8,-1)}const X="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",q="symbol"==typeof X?function(t){var e;return null!=t&&(e=t[X])&&e.apply(t)}:function(){return null},J={};function Q(t){var e,r,n,i;if(1===arguments.length){if(x(t))return t.slice();if(this===J&&"string"==typeof t)return[t];if(i=q(t)){for(r=[];!(n=i.next()).done;)r.push(n.value);return r}if(null==t)return[t];if("number"==typeof(e=t.length)){for(r=new Array(e);e--;)r[e]=t[e];return r}return[t]}for(e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r}const tt="undefined"!=typeof Symbol?t=>"AsyncFunction"===t[Symbol.toStringTag]:()=>!1;var et="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function rt(t,e){et=t,nt=e}var nt=()=>!0;const it=!new Error("").stack;function ot(){if(it)try{throw ot.arguments,new Error}catch(t){return t}return new Error}function at(t,e){var r=t.stack;return r?(e=e||0,0===r.indexOf(t.name)&&(e+=(t.name+t.message).split("\n").length),r.split("\n").slice(e).filter(nt).map((t=>"\n"+t)).join("")):""}var st=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ct=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(st),ut={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function lt(t,e){this._e=ot(),this.name=t,this.message=e}function ht(t,e){return t+". Errors: "+Object.keys(e).map((t=>e[t].toString())).filter(((t,e,r)=>r.indexOf(t)===e)).join("\n")}function ft(t,e,r,n){this._e=ot(),this.failures=e,this.failedKeys=n,this.successCount=r,this.message=ht(t,e)}function pt(t,e){this._e=ot(),this.name="BulkError",this.failures=Object.keys(e).map((t=>e[t])),this.failuresByPos=e,this.message=ht(t,e)}O(lt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+at(this._e,2))}},toString:function(){return this.name+": "+this.message}}),O(ft).from(lt),O(pt).from(lt);var dt=ct.reduce(((t,e)=>(t[e]=e+"Error",t)),{});const yt=lt;var gt=ct.reduce(((t,e)=>{var r=e+"Error";function n(t,n){this._e=ot(),this.name=r,t?"string"==typeof t?(this.message=`${t}${n?"\n "+n:""}`,this.inner=n||null):"object"==typeof t&&(this.message=`${t.name} ${t.message}`,this.inner=t):(this.message=ut[e]||r,this.inner=null)}return O(n).from(yt),t[e]=n,t}),{});gt.Syntax=SyntaxError,gt.Type=TypeError,gt.Range=RangeError;var mt=st.reduce(((t,e)=>(t[e+"Error"]=gt[e],t)),{}),vt=ct.reduce(((t,e)=>(-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=gt[e]),t)),{});function bt(){}function wt(t){return t}function xt(t,e){return null==t||t===wt?e:function(r){return e(t(r))}}function _t(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Et(t,e){return t===bt?e:function(){var r=t.apply(this,arguments);void 0!==r&&(arguments[0]=r);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?_t(n,this.onsuccess):n),i&&(this.onerror=this.onerror?_t(i,this.onerror):i),void 0!==o?o:r}}function At(t,e){return t===bt?e:function(){t.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?_t(r,this.onsuccess):r),n&&(this.onerror=this.onerror?_t(n,this.onerror):n)}}function kt(t,e){return t===bt?e:function(r){var n=t.apply(this,arguments);_(r,n);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?_t(i,this.onsuccess):i),o&&(this.onerror=this.onerror?_t(o,this.onerror):o),void 0===n?void 0===a?void 0:a:_(n,a)}}function St(t,e){return t===bt?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function Tt(t,e){return t===bt?e:function(){var r=t.apply(this,arguments);if(r&&"function"==typeof r.then){for(var n=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return r.then((function(){return e.apply(n,o)}))}return e.apply(this,arguments)}}vt.ModifyError=ft,vt.DexieError=lt,vt.BulkError=pt;var Lt={};const[Ot,Ct,Pt]="undefined"==typeof Promise?[]:(()=>{let t=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[t,E(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,E(e),t]})(),Mt=Ct&&Ct.then,It=Ot&&Ot.constructor,jt=!!Pt;var Rt=!1,Nt=Pt?()=>{Pt.then(oe)}:b.setImmediate?setImmediate.bind(null,oe):b.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver((()=>{oe(),t=null})).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(oe,0)},Bt=function(t,e){Yt.push([t,e]),Ft&&(Nt(),Ft=!1)},Dt=!0,Ft=!0,Ut=[],zt=[],Gt=null,Wt=wt,Vt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ce,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((t=>{try{Ce(t[0],t[1])}catch(t){}}))}},$t=Vt,Yt=[],Kt=0,Ht=[];function Zt(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=bt,this._lib=!1;var e=this._PSD=$t;if(et&&(this._stackHolder=ot(),this._prev=null,this._numPrev=0),"function"!=typeof t){if(t!==Lt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Qt(this,this._value))}this._state=null,this._value=null,++e.ref,Jt(this,t)}const Xt={get:function(){var t=$t,e=ye;function r(r,n){var i=!t.global&&(t!==$t||e!==ye);const o=i&&!be();var a=new Zt(((e,a)=>{ee(this,new qt(Te(r,t,i,o),Te(n,t,i,o),e,a,t))}));return et&&ie(a,this),a}return r.prototype=Lt,r},set:function(t){L(this,"then",t&&t.prototype===Lt?Xt:{get:function(){return t},set:Xt.set})}};function qt(t,e,r,n,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=r,this.reject=n,this.psd=i}function Jt(t,e){try{e((e=>{if(null===t._state){if(e===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&ae();e&&"function"==typeof e.then?Jt(t,((t,r)=>{e instanceof Zt?e._then(t,r):e.then(t,r)})):(t._state=!0,t._value=e,te(t)),r&&se()}}),Qt.bind(null,t))}catch(e){Qt(t,e)}}function Qt(t,e){if(zt.push(e),null===t._state){var r=t._lib&&ae();e=Wt(e),t._state=!1,t._value=e,et&&null!==e&&"object"==typeof e&&!e._promise&&function(){try{(()=>{var r=P(e,"stack");e._promise=t,L(e,"stack",{get:()=>Rt?r&&(r.get?r.get.apply(e):r.value):t.stack})}).apply(null,void 0)}catch(t){}}(),function(t){Ut.some((e=>e._value===t._value))||Ut.push(t)}(t),te(t),r&&se()}}function te(t){var e=t._listeners;t._listeners=[];for(var r=0,n=e.length;r<n;++r)ee(t,e[r]);var i=t._PSD;--i.ref||i.finalize(),0===Kt&&(++Kt,Bt((()=>{0==--Kt&&ce()}),[]))}function ee(t,e){if(null!==t._state){var r=t._state?e.onFulfilled:e.onRejected;if(null===r)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Kt,Bt(re,[r,t,e])}else t._listeners.push(e)}function re(t,e,r){try{Gt=e;var n,i=e._value;e._state?n=t(i):(zt.length&&(zt=[]),n=t(i),-1===zt.indexOf(i)&&function(t){for(var e=Ut.length;e;)if(Ut[--e]._value===t._value)return void Ut.splice(e,1)}(e)),r.resolve(n)}catch(t){r.reject(t)}finally{Gt=null,0==--Kt&&ce(),--r.psd.ref||r.psd.finalize()}}function ne(t,e,r){if(e.length===r)return e;var n="";if(!1===t._state){var i,o,a=t._value;null!=a?(i=a.name||"Error",o=a.message||a,n=at(a,0)):(i=a,o=""),e.push(i+(o?": "+o:"")+n)}return et&&((n=at(t._stackHolder,2))&&-1===e.indexOf(n)&&e.push(n),t._prev&&ne(t._prev,e,r)),e}function ie(t,e){var r=e?e._numPrev+1:0;r<100&&(t._prev=e,t._numPrev=r)}function oe(){ae()&&se()}function ae(){var t=Dt;return Dt=!1,Ft=!1,t}function se(){var t,e,r;do{for(;Yt.length>0;)for(t=Yt,Yt=[],r=t.length,e=0;e<r;++e){var n=t[e];n[0].apply(null,n[1])}}while(Yt.length>0);Dt=!0,Ft=!0}function ce(){var t=Ut;Ut=[],t.forEach((t=>{t._PSD.onunhandled.call(null,t._value,t)}));for(var e=Ht.slice(0),r=e.length;r;)e[--r]()}function ue(t){return new Zt(Lt,!1,t)}function le(t,e){var r=$t;return function(){var n=ae(),i=$t;try{return Ee(r,!0),t.apply(this,arguments)}catch(t){e&&e(t)}finally{Ee(i,!1),n&&se()}}}S(Zt.prototype,{then:Xt,_then:function(t,e){ee(this,new qt(null,null,t,e,$t))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=arguments[0],r=arguments[1];return"function"==typeof e?this.then(null,(t=>t instanceof e?r(t):ue(t))):this.then(null,(t=>t&&t.name===e?r(t):ue(t)))},finally:function(t){return this.then((e=>(t(),e)),(e=>(t(),ue(e))))},stack:{get:function(){if(this._stack)return this._stack;try{Rt=!0;var t=ne(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{Rt=!1}}},timeout:function(t,e){return t<1/0?new Zt(((r,n)=>{var i=setTimeout((()=>n(new gt.Timeout(e))),t);this.then(r,n).finally(clearTimeout.bind(null,i))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&L(Zt.prototype,Symbol.toStringTag,"Dexie.Promise"),Vt.env=Ae(),S(Zt,{all:function(){var t=Q.apply(null,arguments).map(we);return new Zt((function(e,r){0===t.length&&e([]);var n=t.length;t.forEach(((i,o)=>Zt.resolve(i).then((r=>{t[o]=r,--n||e(t)}),r)))}))},resolve:t=>{if(t instanceof Zt)return t;if(t&&"function"==typeof t.then)return new Zt(((e,r)=>{t.then(e,r)}));var e=new Zt(Lt,!0,t);return ie(e,Gt),e},reject:ue,race:function(){var t=Q.apply(null,arguments).map(we);return new Zt(((e,r)=>{t.map((t=>Zt.resolve(t).then(e,r)))}))},PSD:{get:()=>$t,set:t=>$t=t},totalEchoes:{get:()=>ye},newPSD:me,usePSD:ke,scheduler:{get:()=>Bt,set:t=>{Bt=t}},rejectionMapper:{get:()=>Wt,set:t=>{Wt=t}},follow:(t,e)=>new Zt(((r,n)=>me(((e,r)=>{var n=$t;n.unhandleds=[],n.onunhandled=r,n.finalize=_t((function(){!function(t){Ht.push((function e(){t(),Ht.splice(Ht.indexOf(e),1)})),++Kt,Bt((()=>{0==--Kt&&ce()}),[])}((()=>{0===this.unhandleds.length?e():r(this.unhandleds[0])}))}),n.finalize),t()}),e,r,n)))}),It&&(It.allSettled&&L(Zt,"allSettled",(function(){const t=Q.apply(null,arguments).map(we);return new Zt((e=>{0===t.length&&e([]);let r=t.length;const n=new Array(r);t.forEach(((t,i)=>Zt.resolve(t).then((t=>n[i]={status:"fulfilled",value:t}),(t=>n[i]={status:"rejected",reason:t})).then((()=>--r||e(n)))))}))})),It.any&&"undefined"!=typeof AggregateError&&L(Zt,"any",(function(){const t=Q.apply(null,arguments).map(we);return new Zt(((e,r)=>{0===t.length&&r(new AggregateError([]));let n=t.length;const i=new Array(n);t.forEach(((t,o)=>Zt.resolve(t).then((t=>e(t)),(t=>{i[o]=t,--n||r(new AggregateError(i))}))))}))})));const he={awaits:0,echoes:0,id:0};var fe=0,pe=[],de=0,ye=0,ge=0;function me(t,e,r,n){var i=$t,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++ge;var a=Vt.env;o.env=jt?{Promise:Zt,PromiseProp:{value:Zt,configurable:!0,writable:!0},all:Zt.all,race:Zt.race,allSettled:Zt.allSettled,any:Zt.any,resolve:Zt.resolve,reject:Zt.reject,nthen:Le(a.nthen,o),gthen:Le(a.gthen,o)}:{},e&&_(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=ke(o,t,r,n);return 0===o.ref&&o.finalize(),s}function ve(){return he.id||(he.id=++fe),++he.awaits,he.echoes+=100,he.id}function be(){return!!he.awaits&&(0==--he.awaits&&(he.id=0),he.echoes=100*he.awaits,!0)}function we(t){return he.echoes&&t&&t.constructor===It?(ve(),t.then((t=>(be(),t)),(t=>(be(),Pe(t))))):t}function xe(t){++ye,he.echoes&&0!=--he.echoes||(he.echoes=he.id=0),pe.push($t),Ee(t,!0)}function _e(){var t=pe[pe.length-1];pe.pop(),Ee(t,!1)}function Ee(t,e){var r=$t;if((e?!he.echoes||de++&&t===$t:!de||--de&&t===$t)||Se(e?xe.bind(null,t):_e),t!==$t&&($t=t,r===Vt&&(Vt.env=Ae()),jt)){var n=Vt.env.Promise,i=t.env;Ct.then=i.nthen,n.prototype.then=i.gthen,(r.global||t.global)&&(Object.defineProperty(b,"Promise",i.PromiseProp),n.all=i.all,n.race=i.race,n.resolve=i.resolve,n.reject=i.reject,i.allSettled&&(n.allSettled=i.allSettled),i.any&&(n.any=i.any))}}function Ae(){var t=b.Promise;return jt?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(b,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:Ct.then,gthen:t.prototype.then}:{}}function ke(t,e,r,n,i){var o=$t;try{return Ee(t,!0),e(r,n,i)}finally{Ee(o,!1)}}function Se(t){Mt.call(Ot,t)}function Te(t,e,r,n){return"function"!=typeof t?t:function(){var i=$t;r&&ve(),Ee(e,!0);try{return t.apply(this,arguments)}finally{Ee(i,!1),n&&Se(be)}}}function Le(t,e){return function(r,n){return t.call(this,Te(r,e),Te(n,e))}}-1===(""+Mt).indexOf("[native code]")&&(ve=be=bt);const Oe="unhandledrejection";function Ce(t,e){var r;try{r=e.onuncatched(t)}catch(t){}if(!1!==r)try{var n,i={promise:e,reason:t};if(b.document&&document.createEvent?((n=document.createEvent("Event")).initEvent(Oe,!0,!0),_(n,i)):b.CustomEvent&&_(n=new CustomEvent(Oe,{detail:i}),i),n&&b.dispatchEvent&&(dispatchEvent(n),!b.PromiseRejectionEvent&&b.onunhandledrejection))try{b.onunhandledrejection(n)}catch(t){}et&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch(t){}}var Pe=Zt.reject;function Me(t,e,r,n){if(t.idbdb&&(t._state.openComplete||$t.letThrough||t._vip)){var i=t._createTransaction(e,r,t._dbSchema);try{i.create()}catch(t){return Pe(t)}return i._promise(e,((t,e)=>me((()=>($t.trans=i,n(t,e,i)))))).then((t=>i._completion.then((()=>t))))}if(t._state.openComplete)return Pe(new gt.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return Pe(new gt.DatabaseClosed);t.open().catch(bt)}return t._state.dbReadyPromise.then((()=>Me(t,e,r,n)))}const Ie="3.2.0",je=String.fromCharCode(65535),Re=-1/0,Ne="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Be="String expected.",De=[],Fe="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ue=Fe,ze=Fe,Ge=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),We="__dbnames",Ve="readonly",$e="readwrite";function Ye(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const Ke={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function He(t){return"string"!=typeof t||/\./.test(t)?t=>t:e=>(void 0===e[t]&&t in e&&delete(e=Y(e))[t],e)}class Ze{_trans(t,e,r){const n=this._tx||$t.trans,i=this.name;function o(t,r,n){if(!n.schema[i])throw new gt.NotFound("Table "+i+" not part of transaction");return e(n.idbtrans,n)}const a=ae();try{return n&&n.db===this.db?n===$t.trans?n._promise(t,o,r):me((()=>n._promise(t,o,r)),{trans:n,transless:$t.transless||$t}):Me(this.db,t,[this.name],o)}finally{a&&se()}}get(t,e){return t&&t.constructor===Object?this.where(t).first(e):this._trans("readonly",(e=>this.core.get({trans:e,key:t}).then((t=>this.hook.reading.fire(t))))).then(e)}where(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if(x(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const e=w(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter((t=>t.compound&&e.every((e=>t.keyPath.indexOf(e)>=0))&&t.keyPath.every((t=>e.indexOf(t)>=0))))[0];if(r&&this.db._maxKey!==je)return this.where(r.name).equals(r.keyPath.map((e=>t[e])));!r&&et&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${e.join("+")}]`);const{idxByName:n}=this.schema,i=this.db._deps.indexedDB;function o(t,e){try{return 0===i.cmp(t,e)}catch(t){return!1}}const[a,s]=e.reduce((([e,r],i)=>{const a=n[i],s=t[i];return[e||a,e||!a?Ye(r,a&&a.multi?t=>{const e=D(t,i);return x(e)&&e.some((t=>o(s,t)))}:t=>o(s,D(t,i))):r]}),[null,null]);return a?this.where(a.name).equals(t[a.keyPath]).filter(s):r?this.filter(s):this.where(e).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,x(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const e=e=>{if(!e)return e;const r=Object.create(t.prototype);for(var n in e)if(k(e,n))try{r[n]=e[n]}catch(t){}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),t}defineClass(){return this.mapToClass((function(t){_(this,t)}))}add(t,e){const{auto:r,keyPath:n}=this.schema.primKey;let i=t;return n&&r&&(i=He(n)(t)),this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"add",keys:null!=e?[e]:null,values:[i]}))).then((t=>t.numFailures?Zt.reject(t.failures[0]):t.lastResult)).then((e=>{if(n)try{F(t,n,e)}catch(t){}return e}))}update(t,e){if("object"!=typeof t||x(t))return this.where(":id").equals(t).modify(e);{const r=D(t,this.schema.primKey.keyPath);if(void 0===r)return Pe(new gt.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof e?w(e).forEach((r=>{F(t,r,e[r])})):e(t,{value:t,primKey:r})}catch(t){}return this.where(":id").equals(r).modify(e)}}put(t,e){const{auto:r,keyPath:n}=this.schema.primKey;let i=t;return n&&r&&(i=He(n)(t)),this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"put",values:[i],keys:null!=e?[e]:null}))).then((t=>t.numFailures?Zt.reject(t.failures[0]):t.lastResult)).then((e=>{if(n)try{F(t,n,e)}catch(t){}return e}))}delete(t){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"delete",keys:[t]}))).then((t=>t.numFailures?Zt.reject(t.failures[0]):void 0))}clear(){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"deleteRange",range:Ke}))).then((t=>t.numFailures?Zt.reject(t.failures[0]):void 0))}bulkGet(t){return this._trans("readonly",(e=>this.core.getMany({keys:t,trans:e}).then((t=>t.map((t=>this.hook.reading.fire(t)))))))}bulkAdd(t,e,r){const n=Array.isArray(e)?e:void 0,i=(r=r||(n?void 0:e))?r.allKeys:void 0;return this._trans("readwrite",(e=>{const{auto:r,keyPath:o}=this.schema.primKey;if(o&&n)throw new gt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(n&&n.length!==t.length)throw new gt.InvalidArgument("Arguments objects and keys must have the same length");const a=t.length;let s=o&&r?t.map(He(o)):t;return this.core.mutate({trans:e,type:"add",keys:n,values:s,wantResults:i}).then((({numFailures:t,results:e,lastResult:r,failures:n})=>{if(0===t)return i?e:r;throw new pt(`${this.name}.bulkAdd(): ${t} of ${a} operations failed`,n)}))}))}bulkPut(t,e,r){const n=Array.isArray(e)?e:void 0,i=(r=r||(n?void 0:e))?r.allKeys:void 0;return this._trans("readwrite",(e=>{const{auto:r,keyPath:o}=this.schema.primKey;if(o&&n)throw new gt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(n&&n.length!==t.length)throw new gt.InvalidArgument("Arguments objects and keys must have the same length");const a=t.length;let s=o&&r?t.map(He(o)):t;return this.core.mutate({trans:e,type:"put",keys:n,values:s,wantResults:i}).then((({numFailures:t,results:e,lastResult:r,failures:n})=>{if(0===t)return i?e:r;throw new pt(`${this.name}.bulkPut(): ${t} of ${a} operations failed`,n)}))}))}bulkDelete(t){const e=t.length;return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"delete",keys:t}))).then((({numFailures:t,lastResult:r,failures:n})=>{if(0===t)return r;throw new pt(`${this.name}.bulkDelete(): ${t} of ${e} operations failed`,n)}))}}function Xe(t){var e={},r=function(r,n){if(n){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return e[r].subscribe.apply(null,o),t}if("string"==typeof r)return e[r]};r.addEventType=o;for(var n=1,i=arguments.length;n<i;++n)o(arguments[n]);return r;function o(t,n,i){if("object"!=typeof t){var a;n||(n=St),i||(i=bt);var s={subscribers:[],fire:i,subscribe:function(t){-1===s.subscribers.indexOf(t)&&(s.subscribers.push(t),s.fire=n(s.fire,t))},unsubscribe:function(t){s.subscribers=s.subscribers.filter((function(e){return e!==t})),s.fire=s.subscribers.reduce(n,i)}};return e[t]=r[t]=s,s}w(a=t).forEach((function(t){var e=a[t];if(x(e))o(t,a[t][0],a[t][1]);else{if("asap"!==e)throw new gt.InvalidArgument("Invalid event config");var r=o(t,wt,(function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];r.subscribers.forEach((function(t){N((function(){t.apply(null,e)}))}))}))}}))}}function qe(t,e){return O(e).from({prototype:t}),e}function Je(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Qe(t,e){t.filter=Ye(t.filter,e)}function tr(t,e,r){var n=t.replayFilter;t.replayFilter=n?()=>Ye(n(),e()):e,t.justLimit=r&&!n}function er(t,e){if(t.isPrimKey)return e.primaryKey;const r=e.getIndexByKeyPath(t.index);if(!r)throw new gt.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return r}function rr(t,e,r){const n=er(t,e.schema);return e.openCursor({trans:r,values:!t.keysOnly,reverse:"prev"===t.dir,unique:!!t.unique,query:{index:n,range:t.range}})}function nr(t,e,r,n){const i=t.replayFilter?Ye(t.filter,t.replayFilter()):t.filter;if(t.or){const o={},a=(t,r,n)=>{if(!i||i(r,n,(t=>r.stop(t)),(t=>r.fail(t)))){var a=r.primaryKey,s=""+a;"[object ArrayBuffer]"===s&&(s=""+new Uint8Array(a)),k(o,s)||(o[s]=!0,e(t,r,n))}};return Promise.all([t.or._iterate(a,r),ir(rr(t,n,r),t.algorithm,a,!t.keysOnly&&t.valueMapper)])}return ir(rr(t,n,r),Ye(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function ir(t,e,r,n){var i=le(n?(t,e,i)=>r(n(t),e,i):r);return t.then((t=>{if(t)return t.start((()=>{var r=()=>t.continue();e&&!e(t,(t=>r=t),(e=>{t.stop(e),r=bt}),(e=>{t.fail(e),r=bt}))||i(t.value,t,(t=>r=t)),r()}))}))}function or(t,e){try{const r=ar(t),n=ar(e);if(r!==n)return"Array"===r?1:"Array"===n?-1:"binary"===r?1:"binary"===n?-1:"string"===r?1:"string"===n?-1:"Date"===r?1:"Date"!==n?NaN:-1;switch(r){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(t,e){const r=t.length,n=e.length,i=r<n?r:n;for(let r=0;r<i;++r)if(t[r]!==e[r])return t[r]<e[r]?-1:1;return r===n?0:r<n?-1:1}(sr(t),sr(e));case"Array":return function(t,e){const r=t.length,n=e.length,i=r<n?r:n;for(let r=0;r<i;++r){const n=or(t[r],e[r]);if(0!==n)return n}return r===n?0:r<n?-1:1}(t,e)}}catch(t){}return NaN}function ar(t){const e=typeof t;if("object"!==e)return e;if(ArrayBuffer.isView(t))return"binary";const r=Z(t);return"ArrayBuffer"===r?"binary":r}function sr(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class cr{_read(t,e){var r=this._ctx;return r.error?r.table._trans(null,Pe.bind(null,r.error)):r.table._trans("readonly",t).then(e)}_write(t){var e=this._ctx;return e.error?e.table._trans(null,Pe.bind(null,e.error)):e.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var e=this._ctx;e.algorithm=Ye(e.algorithm,t)}_iterate(t,e){return nr(this._ctx,t,e,this._ctx.table.core)}clone(t){var e=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&_(r,t),e._ctx=r,e}raw(){return this._ctx.valueMapper=null,this}each(t){var e=this._ctx;return this._read((r=>nr(e,t,r,e.table.core)))}count(t){return this._read((t=>{const e=this._ctx,r=e.table.core;if(Je(e,!0))return r.count({trans:t,query:{index:er(e,r.schema),range:e.range}}).then((t=>Math.min(t,e.limit)));var n=0;return nr(e,(()=>(++n,!1)),t,r).then((()=>n))})).then(t)}sortBy(t,e){const r=t.split(".").reverse(),n=r[0],i=r.length-1;function o(t,e){return e?o(t[r[e]],e-1):t[n]}var a="next"===this._ctx.dir?1:-1;function s(t,e){var r=o(t,i),n=o(e,i);return r<n?-a:r>n?a:0}return this.toArray((function(t){return t.sort(s)})).then(e)}toArray(t){return this._read((t=>{var e=this._ctx;if("next"===e.dir&&Je(e,!0)&&e.limit>0){const{valueMapper:r}=e,n=er(e,e.table.core.schema);return e.table.core.query({trans:t,limit:e.limit,values:!0,query:{index:n,range:e.range}}).then((({result:t})=>r?t.map(r):t))}{const r=[];return nr(e,(t=>r.push(t)),t,e.table.core).then((()=>r))}}),t)}offset(t){var e=this._ctx;return t<=0||(e.offset+=t,Je(e)?tr(e,(()=>{var e=t;return(t,r)=>0===e||(1===e?(--e,!1):(r((()=>{t.advance(e),e=0})),!1))})):tr(e,(()=>{var e=t;return()=>--e<0}))),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),tr(this._ctx,(()=>{var e=t;return function(t,r,n){return--e<=0&&r(n),e>=0}}),!0),this}until(t,e){return Qe(this._ctx,(function(r,n,i){return!t(r.value)||(n(i),e)})),this}first(t){return this.limit(1).toArray((function(t){return t[0]})).then(t)}last(t){return this.reverse().first(t)}filter(t){var e,r;return Qe(this._ctx,(function(e){return t(e.value)})),e=this._ctx,r=t,e.isMatch=Ye(e.isMatch,r),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,r){t(r.key,r)}))}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,r){t(r.primaryKey,r)}))}keys(t){var e=this._ctx;e.keysOnly=!e.isMatch;var r=[];return this.each((function(t,e){r.push(e.key)})).then((function(){return r})).then(t)}primaryKeys(t){var e=this._ctx;if("next"===e.dir&&Je(e,!0)&&e.limit>0)return this._read((t=>{var r=er(e,e.table.core.schema);return e.table.core.query({trans:t,values:!1,limit:e.limit,query:{index:r,range:e.range}})})).then((({result:t})=>t)).then(t);e.keysOnly=!e.isMatch;var r=[];return this.each((function(t,e){r.push(e.primaryKey)})).then((function(){return r})).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys((function(t){return t[0]})).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,e=t.index&&t.table.schema.idxByName[t.index];if(!e||!e.multi)return this;var r={};return Qe(this._ctx,(function(t){var e=t.primaryKey.toString(),n=k(r,e);return r[e]=!0,!n})),this}modify(t){var e=this._ctx;return this._write((r=>{var n;if("function"==typeof t)n=t;else{var i=w(t),o=i.length;n=function(e){for(var r=!1,n=0;n<o;++n){var a=i[n],s=t[a];D(e,a)!==s&&(F(e,a,s),r=!0)}return r}}const a=e.table.core,{outbound:s,extractKey:c}=a.schema.primaryKey,u=this.db._options.modifyChunkSize||200,l=[];let h=0;const f=[],p=(t,e)=>{const{failures:r,numFailures:n}=e;h+=t-n;for(let t of w(r))l.push(r[t])};return this.clone().primaryKeys().then((i=>{const o=l=>{const h=Math.min(u,i.length-l);return a.getMany({trans:r,keys:i.slice(l,l+h),cache:"immutable"}).then((f=>{const d=[],y=[],g=s?[]:null,m=[];for(let t=0;t<h;++t){const e=f[t],r={value:Y(e),primKey:i[l+t]};!1!==n.call(r,r.value,r)&&(null==r.value?m.push(i[l+t]):s||0===or(c(e),c(r.value))?(y.push(r.value),s&&g.push(i[l+t])):(m.push(i[l+t]),d.push(r.value)))}const v=Je(e)&&e.limit===1/0&&("function"!=typeof t||t===ur)&&{index:e.index,range:e.range};return Promise.resolve(d.length>0&&a.mutate({trans:r,type:"add",values:d}).then((t=>{for(let e in t.failures)m.splice(parseInt(e),1);p(d.length,t)}))).then((()=>(y.length>0||v&&"object"==typeof t)&&a.mutate({trans:r,type:"put",keys:g,values:y,criteria:v,changeSpec:"function"!=typeof t&&t}).then((t=>p(y.length,t))))).then((()=>(m.length>0||v&&t===ur)&&a.mutate({trans:r,type:"delete",keys:m,criteria:v}).then((t=>p(m.length,t))))).then((()=>i.length>l+h&&o(l+u)))}))};return o(0).then((()=>{if(l.length>0)throw new ft("Error modifying one or more objects",l,h,f);return i.length}))}))}))}delete(){var t=this._ctx,e=t.range;return Je(t)&&(t.isPrimKey&&!ze||3===e.type)?this._write((r=>{const{primaryKey:n}=t.table.core.schema,i=e;return t.table.core.count({trans:r,query:{index:n,range:i}}).then((e=>t.table.core.mutate({trans:r,type:"deleteRange",range:i}).then((({failures:t,lastResult:r,results:n,numFailures:i})=>{if(i)throw new ft("Could not delete some values",Object.keys(t).map((e=>t[e])),e-i);return e-i}))))})):this.modify(ur)}}const ur=(t,e)=>e.value=null;function lr(t,e){return t<e?-1:t===e?0:1}function hr(t,e){return t>e?-1:t===e?0:1}function fr(t,e,r){var n=t instanceof vr?new t.Collection(t):t;return n._ctx.error=r?new r(e):new TypeError(e),n}function pr(t){return new t.Collection(t,(()=>mr(""))).limit(0)}function dr(t,e,r,n,i,o){for(var a=Math.min(t.length,n.length),s=-1,c=0;c<a;++c){var u=e[c];if(u!==n[c])return i(t[c],r[c])<0?t.substr(0,c)+r[c]+r.substr(c+1):i(t[c],n[c])<0?t.substr(0,c)+n[c]+r.substr(c+1):s>=0?t.substr(0,s)+e[s]+r.substr(s+1):null;i(t[c],u)<0&&(s=c)}return a<n.length&&"next"===o?t+r.substr(t.length):a<t.length&&"prev"===o?t.substr(0,r.length):s<0?null:t.substr(0,s)+n[s]+r.substr(s+1)}function yr(t,e,r,n){var i,o,a,s,c,u,l,h=r.length;if(!r.every((t=>"string"==typeof t)))return fr(t,Be);function f(t){i=function(t){return"next"===t?t=>t.toUpperCase():t=>t.toLowerCase()}(t),o=function(t){return"next"===t?t=>t.toLowerCase():t=>t.toUpperCase()}(t),a="next"===t?lr:hr;var e=r.map((function(t){return{lower:o(t),upper:i(t)}})).sort((function(t,e){return a(t.lower,e.lower)}));s=e.map((function(t){return t.upper})),c=e.map((function(t){return t.lower})),u=t,l="next"===t?"":n}f("next");var p=new t.Collection(t,(()=>gr(s[0],c[h-1]+n)));p._ondirectionchange=function(t){f(t)};var d=0;return p._addAlgorithm((function(t,r,n){var i=t.key;if("string"!=typeof i)return!1;var f=o(i);if(e(f,c,d))return!0;for(var p=null,y=d;y<h;++y){var g=dr(i,f,s[y],c[y],a,u);null===g&&null===p?d=y+1:(null===p||a(p,g)>0)&&(p=g)}return r(null!==p?function(){t.continue(p+l)}:n),!1})),p}function gr(t,e,r,n){return{type:2,lower:t,upper:e,lowerOpen:r,upperOpen:n}}function mr(t){return{type:1,lower:t,upper:t}}class vr{get Collection(){return this._ctx.table.db.Collection}between(t,e,r,n){r=!1!==r,n=!0===n;try{return this._cmp(t,e)>0||0===this._cmp(t,e)&&(r||n)&&(!r||!n)?pr(this):new this.Collection(this,(()=>gr(t,e,!r,!n)))}catch(t){return fr(this,Ne)}}equals(t){return null==t?fr(this,Ne):new this.Collection(this,(()=>mr(t)))}above(t){return null==t?fr(this,Ne):new this.Collection(this,(()=>gr(t,void 0,!0)))}aboveOrEqual(t){return null==t?fr(this,Ne):new this.Collection(this,(()=>gr(t,void 0,!1)))}below(t){return null==t?fr(this,Ne):new this.Collection(this,(()=>gr(void 0,t,!1,!0)))}belowOrEqual(t){return null==t?fr(this,Ne):new this.Collection(this,(()=>gr(void 0,t)))}startsWith(t){return"string"!=typeof t?fr(this,Be):this.between(t,t+je,!0,!0)}startsWithIgnoreCase(t){return""===t?this.startsWith(t):yr(this,((t,e)=>0===t.indexOf(e[0])),[t],je)}equalsIgnoreCase(t){return yr(this,((t,e)=>t===e[0]),[t],"")}anyOfIgnoreCase(){var t=Q.apply(J,arguments);return 0===t.length?pr(this):yr(this,((t,e)=>-1!==e.indexOf(t)),t,"")}startsWithAnyOfIgnoreCase(){var t=Q.apply(J,arguments);return 0===t.length?pr(this):yr(this,((t,e)=>e.some((e=>0===t.indexOf(e)))),t,je)}anyOf(){const t=Q.apply(J,arguments);let e=this._cmp;try{t.sort(e)}catch(t){return fr(this,Ne)}if(0===t.length)return pr(this);const r=new this.Collection(this,(()=>gr(t[0],t[t.length-1])));r._ondirectionchange=r=>{e="next"===r?this._ascending:this._descending,t.sort(e)};let n=0;return r._addAlgorithm(((r,i,o)=>{const a=r.key;for(;e(a,t[n])>0;)if(++n,n===t.length)return i(o),!1;return 0===e(a,t[n])||(i((()=>{r.continue(t[n])})),!1)})),r}notEqual(t){return this.inAnyRange([[Re,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=Q.apply(J,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this._ascending)}catch(t){return fr(this,Ne)}const e=t.reduce(((t,e)=>t?t.concat([[t[t.length-1][1],e]]):[[Re,e]]),null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,e){const r=this._cmp,n=this._ascending,i=this._descending,o=this._min,a=this._max;if(0===t.length)return pr(this);if(!t.every((t=>void 0!==t[0]&&void 0!==t[1]&&n(t[0],t[1])<=0)))return fr(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",gt.InvalidArgument);const s=!e||!1!==e.includeLowers,c=e&&!0===e.includeUppers;let u,l=n;function h(t,e){return l(t[0],e[0])}try{u=t.reduce((function(t,e){let n=0,i=t.length;for(;n<i;++n){const i=t[n];if(r(e[0],i[1])<0&&r(e[1],i[0])>0){i[0]=o(i[0],e[0]),i[1]=a(i[1],e[1]);break}}return n===i&&t.push(e),t}),[]),u.sort(h)}catch(t){return fr(this,Ne)}let f=0;const p=c?t=>n(t,u[f][1])>0:t=>n(t,u[f][1])>=0,d=s?t=>i(t,u[f][0])>0:t=>i(t,u[f][0])>=0;let y=p;const g=new this.Collection(this,(()=>gr(u[0][0],u[u.length-1][1],!s,!c)));return g._ondirectionchange=t=>{"next"===t?(y=p,l=n):(y=d,l=i),u.sort(h)},g._addAlgorithm(((t,e,r)=>{for(var i=t.key;y(i);)if(++f,f===u.length)return e(r),!1;return!!function(t){return!p(t)&&!d(t)}(i)||(0===this._cmp(i,u[f][1])||0===this._cmp(i,u[f][0])||e((()=>{l===n?t.continue(u[f][0]):t.continue(u[f][1])})),!1)})),g}startsWithAnyOf(){const t=Q.apply(J,arguments);return t.every((t=>"string"==typeof t))?0===t.length?pr(this):this.inAnyRange(t.map((t=>[t,t+je]))):fr(this,"startsWithAnyOf() only works with strings")}}function br(t){return le((function(e){return wr(e),t(e.target.error),!1}))}function wr(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const xr="storagemutated",_r="x-storagemutated-1",Er=Xe(null,xr);class Ar{_lock(){return R(!$t.global),++this._reculock,1!==this._reculock||$t.global||($t.lockOwnerFor=this),this}_unlock(){if(R(!$t.global),0==--this._reculock)for($t.global||($t.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{ke(t[1],t[0])}catch(t){}}return this}_locked(){return this._reculock&&$t.lockOwnerFor!==this}create(t){if(!this.mode)return this;const e=this.db.idbdb,r=this.db._state.dbOpenError;if(R(!this.idbtrans),!t&&!e)switch(r&&r.name){case"DatabaseClosedError":throw new gt.DatabaseClosed(r);case"MissingAPIError":throw new gt.MissingAPI(r.message,r);default:throw new gt.OpenFailed(r)}if(!this.active)throw new gt.TransactionInactive;return R(null===this._completion._state),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):e.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=le((e=>{wr(e),this._reject(t.error)})),t.onabort=le((e=>{wr(e),this.active&&this._reject(new gt.Abort(t.error)),this.active=!1,this.on("abort").fire(e)})),t.oncomplete=le((()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&Er.storagemutated.fire(t.mutatedParts)})),this}_promise(t,e,r){if("readwrite"===t&&"readwrite"!==this.mode)return Pe(new gt.ReadOnly("Transaction is readonly"));if(!this.active)return Pe(new gt.TransactionInactive);if(this._locked())return new Zt(((n,i)=>{this._blockedFuncs.push([()=>{this._promise(t,e,r).then(n,i)},$t])}));if(r)return me((()=>{var t=new Zt(((t,r)=>{this._lock();const n=e(t,r,this);n&&n.then&&n.then(t,r)}));return t.finally((()=>this._unlock())),t._lib=!0,t}));var n=new Zt(((t,r)=>{var n=e(t,r,this);n&&n.then&&n.then(t,r)}));return n._lib=!0,n}_root(){return this.parent?this.parent._root():this}waitFor(t){var e=this._root();const r=Zt.resolve(t);if(e._waitingFor)e._waitingFor=e._waitingFor.then((()=>r));else{e._waitingFor=r,e._waitingQueue=[];var n=e.idbtrans.objectStore(e.storeNames[0]);!function t(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(n.get(-1/0).onsuccess=t)}()}var i=e._waitingFor;return new Zt(((t,n)=>{r.then((r=>e._waitingQueue.push(le(t.bind(null,r)))),(t=>e._waitingQueue.push(le(n.bind(null,t))))).finally((()=>{e._waitingFor===i&&(e._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new gt.Abort))}table(t){const e=this._memoizedTables||(this._memoizedTables={});if(k(e,t))return e[t];const r=this.schema[t];if(!r)throw new gt.NotFound("Table "+t+" not part of transaction");const n=new this.db.Table(t,r,this);return n.core=this.db.core.table(t),e[t]=n,n}}function kr(t,e,r,n,i,o,a){return{name:t,keyPath:e,unique:r,multi:n,auto:i,compound:o,src:(r&&!a?"&":"")+(n?"*":"")+(i?"++":"")+Sr(e)}}function Sr(t){return"string"==typeof t?t:t?"["+[].join.call(t,"+")+"]":""}function Tr(t,e,r){return{name:t,primKey:e,indexes:r,mappedClass:null,idxByName:B(r,(t=>[t.name,t]))}}let Lr=t=>{try{return t.only([[]]),Lr=()=>[[]],[[]]}catch(t){return Lr=()=>je,je}};function Or(t){return null==t?()=>{}:"string"==typeof t?function(t){return 1===t.split(".").length?e=>e[t]:e=>D(e,t)}(t):e=>D(e,t)}function Cr(t){return[].slice.call(t)}let Pr=0;function Mr(t){return null==t?":id":"string"==typeof t?t:`[${t.join("+")}]`}function Ir({_novip:t},e){const r=e.db,n=function(t,e,{IDBKeyRange:r,indexedDB:n},i){const o=function(t,e){return e.reduce(((t,{create:e})=>({...t,...e(t)})),t)}(function(t,e,r){function n(t){if(3===t.type)return null;if(4===t.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:r,upper:n,lowerOpen:i,upperOpen:o}=t;return void 0===r?void 0===n?null:e.upperBound(n,!!o):void 0===n?e.lowerBound(r,!!i):e.bound(r,n,!!i,!!o)}const{schema:i,hasGetAll:o}=function(t,e){const r=Cr(t.objectStoreNames);return{schema:{name:t.name,tables:r.map((t=>e.objectStore(t))).map((t=>{const{keyPath:e,autoIncrement:r}=t,n=x(e),i=null==e,o={},a={name:t.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:n,keyPath:e,autoIncrement:r,unique:!0,extractKey:Or(e)},indexes:Cr(t.indexNames).map((e=>t.index(e))).map((t=>{const{name:e,unique:r,multiEntry:n,keyPath:i}=t,a={name:e,compound:x(i),keyPath:i,unique:r,multiEntry:n,extractKey:Or(i)};return o[Mr(i)]=a,a})),getIndexByKeyPath:t=>o[Mr(t)]};return o[":id"]=a.primaryKey,null!=e&&(o[Mr(e)]=a.primaryKey),a}))},hasGetAll:r.length>0&&"getAll"in e.objectStore(r[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,r),a=i.tables.map((t=>function(t){const e=t.name;return{name:e,schema:t,mutate:function({trans:t,type:r,keys:i,values:o,range:a}){return new Promise(((s,c)=>{s=le(s);const u=t.objectStore(e),l=null==u.keyPath,h="put"===r||"add"===r;if(!h&&"delete"!==r&&"deleteRange"!==r)throw new Error("Invalid operation type: "+r);const{length:f}=i||o||{length:1};if(i&&o&&i.length!==o.length)throw new Error("Given keys array must have same length as given values array.");if(0===f)return s({numFailures:0,failures:{},results:[],lastResult:void 0});let p;const d=[],y=[];let g=0;const m=t=>{++g,wr(t)};if("deleteRange"===r){if(4===a.type)return s({numFailures:g,failures:y,results:[],lastResult:void 0});3===a.type?d.push(p=u.clear()):d.push(p=u.delete(n(a)))}else{const[t,e]=h?l?[o,i]:[o,null]:[i,null];if(h)for(let n=0;n<f;++n)d.push(p=e&&void 0!==e[n]?u[r](t[n],e[n]):u[r](t[n])),p.onerror=m;else for(let e=0;e<f;++e)d.push(p=u[r](t[e])),p.onerror=m}const v=t=>{const e=t.target.result;d.forEach(((t,e)=>null!=t.error&&(y[e]=t.error))),s({numFailures:g,failures:y,results:"delete"===r?i:d.map((t=>t.result)),lastResult:e})};p.onerror=t=>{m(t),v(t)},p.onsuccess=v}))},getMany:({trans:t,keys:r})=>new Promise(((n,i)=>{n=le(n);const o=t.objectStore(e),a=r.length,s=new Array(a);let c,u=0,l=0;const h=t=>{const e=t.target;s[e._pos]=e.result,++l===u&&n(s)},f=br(i);for(let t=0;t<a;++t)null!=r[t]&&(c=o.get(r[t]),c._pos=t,c.onsuccess=h,c.onerror=f,++u);0===u&&n(s)})),get:({trans:t,key:r})=>new Promise(((n,i)=>{n=le(n);const o=t.objectStore(e).get(r);o.onsuccess=t=>n(t.target.result),o.onerror=br(i)})),query:function(t){return r=>new Promise(((i,o)=>{i=le(i);const{trans:a,values:s,limit:c,query:u}=r,l=c===1/0?void 0:c,{index:h,range:f}=u,p=a.objectStore(e),d=h.isPrimaryKey?p:p.index(h.name),y=n(f);if(0===c)return i({result:[]});if(t){const t=s?d.getAll(y,l):d.getAllKeys(y,l);t.onsuccess=t=>i({result:t.target.result}),t.onerror=br(o)}else{let t=0;const e=s||!("openKeyCursor"in d)?d.openCursor(y):d.openKeyCursor(y),r=[];e.onsuccess=n=>{const o=e.result;return o?(r.push(s?o.value:o.primaryKey),++t===c?i({result:r}):void o.continue()):i({result:r})},e.onerror=br(o)}}))}(o),openCursor:function({trans:t,values:r,query:i,reverse:o,unique:a}){return new Promise(((s,c)=>{s=le(s);const{index:u,range:l}=i,h=t.objectStore(e),f=u.isPrimaryKey?h:h.index(u.name),p=o?a?"prevunique":"prev":a?"nextunique":"next",d=r||!("openKeyCursor"in f)?f.openCursor(n(l),p):f.openKeyCursor(n(l),p);d.onerror=br(c),d.onsuccess=le((e=>{const r=d.result;if(!r)return void s(null);r.___id=++Pr,r.done=!1;const n=r.continue.bind(r);let i=r.continuePrimaryKey;i&&(i=i.bind(r));const o=r.advance.bind(r),a=()=>{throw new Error("Cursor not stopped")};r.trans=t,r.stop=r.continue=r.continuePrimaryKey=r.advance=()=>{throw new Error("Cursor not started")},r.fail=le(c),r.next=function(){let t=1;return this.start((()=>t--?this.continue():this.stop())).then((()=>this))},r.start=t=>{const e=new Promise(((t,e)=>{t=le(t),d.onerror=br(e),r.fail=e,r.stop=e=>{r.stop=r.continue=r.continuePrimaryKey=r.advance=a,t(e)}})),s=()=>{if(d.result)try{t()}catch(t){r.fail(t)}else r.done=!0,r.start=()=>{throw new Error("Cursor behind last entry")},r.stop()};return d.onsuccess=le((t=>{d.onsuccess=s,s()})),r.continue=n,r.continuePrimaryKey=i,r.advance=o,s(),e},s(r)}),c)}))},count({query:t,trans:r}){const{index:i,range:o}=t;return new Promise(((t,a)=>{const s=r.objectStore(e),c=i.isPrimaryKey?s:s.index(i.name),u=n(o),l=u?c.count(u):c.count();l.onsuccess=le((e=>t(e.target.result))),l.onerror=br(a)}))}}}(t))),s={};return a.forEach((t=>s[t.name]=t)),{stack:"dbcore",transaction:t.transaction.bind(t),table(t){if(!s[t])throw new Error(`Table '${t}' not found`);return s[t]},MIN_KEY:-1/0,MAX_KEY:Lr(e),schema:i}}(e,r,i),t.dbcore);return{dbcore:o}}(t._middlewares,r,t._deps,e);t.core=n.dbcore,t.tables.forEach((e=>{const r=e.name;t.core.schema.tables.some((t=>t.name===r))&&(e.core=t.core.table(r),t[r]instanceof t.Table&&(t[r].core=e.core))}))}function jr({_novip:t},e,r,n){r.forEach((r=>{const i=n[r];e.forEach((e=>{const n=P(e,r);(!n||"value"in n&&void 0===n.value)&&(e===t.Transaction.prototype||e instanceof t.Transaction?L(e,r,{get(){return this.table(r)},set(t){T(this,r,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):e[r]=new t.Table(r,i))}))}))}function Rr({_novip:t},e){e.forEach((e=>{for(let r in e)e[r]instanceof t.Table&&delete e[r]}))}function Nr(t,e){return t._cfg.version-e._cfg.version}function Br(t,e){const r={del:[],add:[],change:[]};let n;for(n in t)e[n]||r.del.push(n);for(n in e){const i=t[n],o=e[n];if(i){const t={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!Fe)t.recreate=!0,r.change.push(t);else{const e=i.idxByName,n=o.idxByName;let a;for(a in e)n[a]||t.del.push(a);for(a in n){const r=e[a],i=n[a];r?r.src!==i.src&&t.change.push(i):t.add.push(i)}(t.del.length>0||t.add.length>0||t.change.length>0)&&r.change.push(t)}}else r.add.push([n,o])}return r}function Dr(t,e,r,n){const i=t.db.createObjectStore(e,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach((t=>Fr(i,t))),i}function Fr(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Ur(t,e,r){const n={};return I(e.objectStoreNames,0).forEach((t=>{const e=r.objectStore(t);let i=e.keyPath;const o=kr(Sr(i),i||"",!1,!1,!!e.autoIncrement,i&&"string"!=typeof i,!0),a=[];for(let t=0;t<e.indexNames.length;++t){const r=e.index(e.indexNames[t]);i=r.keyPath;var s=kr(r.name,i,!!r.unique,!!r.multiEntry,!1,i&&"string"!=typeof i,!1);a.push(s)}n[t]=Tr(t,o,a)})),n}function zr({_novip:t},e,r){const n=r.db.objectStoreNames;for(let i=0;i<n.length;++i){const o=n[i],a=r.objectStore(o);t._hasGetAll="getAll"in a;for(let t=0;t<a.indexNames.length;++t){const r=a.indexNames[t],n=a.index(r).keyPath,i="string"==typeof n?n:"["+I(n).join("+")+"]";if(e[o]){const t=e[o].idxByName[i];t&&(t.name=r,delete e[o].idxByName[i],e[o].idxByName[r]=t)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&b.WorkerGlobalScope&&b instanceof b.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class Gr{_parseStoresSpec(t,e){w(t).forEach((r=>{if(null!==t[r]){var n=t[r].split(",").map(((t,e)=>{const r=(t=t.trim()).replace(/([&*]|\+\+)/g,""),n=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return kr(r,n||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),x(n),0===e)})),i=n.shift();if(i.multi)throw new gt.Schema("Primary key cannot be multi-valued");n.forEach((t=>{if(t.auto)throw new gt.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new gt.Schema("Index must have a name and cannot be an empty string")})),e[r]=Tr(r,i,n)}}))}stores(t){const e=this.db;this._cfg.storesSource=this._cfg.storesSource?_(this._cfg.storesSource,t):t;const r=e._versions,n={};let i={};return r.forEach((t=>{_(n,t._cfg.storesSource),i=t._cfg.dbschema={},t._parseStoresSpec(n,i)})),e._dbSchema=i,Rr(e,[e._allTables,e,e.Transaction.prototype]),jr(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],w(i),i),e._storeNames=w(i),this}upgrade(t){return this._cfg.contentUpgrade=Tt(this._cfg.contentUpgrade||bt,t),this}}function Wr(t,e){let r=t._dbNamesDB;return r||(r=t._dbNamesDB=new fn(We,{addons:[],indexedDB:t,IDBKeyRange:e}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function Vr(t){return t&&"function"==typeof t.databases}function $r(t){return me((function(){return $t.letThrough=!0,t()}))}function Yr(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(e){var r=function(){return indexedDB.databases().finally(e)};t=setInterval(r,100),r()})).finally((function(){return clearInterval(t)})):Promise.resolve()}function Kr(t){const e=t._state,{indexedDB:r}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then((()=>e.dbOpenError?Pe(e.dbOpenError):t));et&&(e.openCanceller._stackHolder=ot()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const n=e.openCanceller;function i(){if(e.openCanceller!==n)throw new gt.DatabaseClosed("db.open() was cancelled")}let o=e.dbReadyResolve,a=null,s=!1;return Zt.race([n,("undefined"==typeof navigator?Zt.resolve():Yr()).then((()=>new Zt(((n,o)=>{if(i(),!r)throw new gt.MissingAPI;const c=t.name,u=e.autoSchema?r.open(c):r.open(c,Math.round(10*t.verno));if(!u)throw new gt.MissingAPI;u.onerror=br(o),u.onblocked=le(t._fireOnBlocked),u.onupgradeneeded=le((n=>{if(a=u.transaction,e.autoSchema&&!t._options.allowEmptyDB){u.onerror=wr,a.abort(),u.result.close();const t=r.deleteDatabase(c);t.onsuccess=t.onerror=le((()=>{o(new gt.NoSuchDatabase(`Database ${c} doesnt exist`))}))}else{a.onerror=br(o);var i=n.oldVersion>Math.pow(2,62)?0:n.oldVersion;s=i<1,t._novip.idbdb=u.result,function(t,e,r,n){const i=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,i);o.create(r),o._completion.catch(n);const a=o._reject.bind(o),s=$t.transless||$t;me((()=>{$t.trans=o,$t.transless=s,0===e?(w(i).forEach((t=>{Dr(r,t,i[t].primKey,i[t].indexes)})),Ir(t,r),Zt.follow((()=>t.on.populate.fire(o))).catch(a)):function({_novip:t},e,r,n){const i=[],o=t._versions;let a=t._dbSchema=Ur(0,t.idbdb,n),s=!1;return o.filter((t=>t._cfg.version>=e)).forEach((o=>{i.push((()=>{const i=a,c=o._cfg.dbschema;zr(t,i,n),zr(t,c,n),a=t._dbSchema=c;const u=Br(i,c);u.add.forEach((t=>{Dr(n,t[0],t[1].primKey,t[1].indexes)})),u.change.forEach((t=>{if(t.recreate)throw new gt.Upgrade("Not yet support for changing primary key");{const e=n.objectStore(t.name);t.add.forEach((t=>Fr(e,t))),t.change.forEach((t=>{e.deleteIndex(t.name),Fr(e,t)})),t.del.forEach((t=>e.deleteIndex(t)))}}));const l=o._cfg.contentUpgrade;if(l&&o._cfg.version>e){Ir(t,n),r._memoizedTables={},s=!0;let e=U(c);u.del.forEach((t=>{e[t]=i[t]})),Rr(t,[t.Transaction.prototype]),jr(t,[t.Transaction.prototype],w(e),e),r.schema=e;const o=tt(l);let a;o&&ve();const h=Zt.follow((()=>{if(a=l(r),a&&o){var t=be.bind(null,null);a.then(t,t)}}));return a&&"function"==typeof a.then?Zt.resolve(a):h.then((()=>a))}})),i.push((e=>{s&&Ue||function(t,e){[].slice.call(e.db.objectStoreNames).forEach((r=>null==t[r]&&e.db.deleteObjectStore(r)))}(o._cfg.dbschema,e),Rr(t,[t.Transaction.prototype]),jr(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),r.schema=t._dbSchema}))})),function t(){return i.length?Zt.resolve(i.shift()(r.idbtrans)).then(t):Zt.resolve()}().then((()=>{var t,e;e=n,w(t=a).forEach((r=>{e.db.objectStoreNames.contains(r)||Dr(e,r,t[r].primKey,t[r].indexes)}))}))}(t,e,o,r).catch(a)}))}(t,i/10,a,o)}}),o),u.onsuccess=le((()=>{a=null;const r=t._novip.idbdb=u.result,i=I(r.objectStoreNames);if(i.length>0)try{const n=r.transaction(1===(o=i).length?o[0]:o,"readonly");e.autoSchema?function({_novip:t},e,r){t.verno=e.version/10;const n=t._dbSchema=Ur(0,e,r);t._storeNames=I(e.objectStoreNames,0),jr(t,[t._allTables],w(n),n)}(t,r,n):(zr(t,t._dbSchema,n),function(t,e){const r=Br(Ur(0,t.idbdb,e),t._dbSchema);return!(r.add.length||r.change.some((t=>t.add.length||t.change.length)))}(t,n)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Ir(t,n)}catch(t){}var o;De.push(t),r.onversionchange=le((r=>{e.vcFired=!0,t.on("versionchange").fire(r)})),r.onclose=le((e=>{t.on("close").fire(e)})),s&&function({indexedDB:t,IDBKeyRange:e},r){!Vr(t)&&r!==We&&Wr(t,e).put({name:r}).catch(bt)}(t._deps,c),n()}),o)}))))]).then((()=>(i(),e.onReadyBeingFired=[],Zt.resolve($r((()=>t.on.ready.fire(t.vip)))).then((function r(){if(e.onReadyBeingFired.length>0){let n=e.onReadyBeingFired.reduce(Tt,bt);return e.onReadyBeingFired=[],Zt.resolve($r((()=>n(t.vip)))).then(r)}}))))).finally((()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1})).then((()=>t)).catch((r=>{e.dbOpenError=r;try{a&&a.abort()}catch(t){}return n===e.openCanceller&&t._close(),Pe(r)})).finally((()=>{e.openComplete=!0,o()}))}function Hr(t){var e=e=>t.next(e),r=i(e),n=i((e=>t.throw(e)));function i(t){return e=>{var i=t(e),o=i.value;return i.done?o:o&&"function"==typeof o.then?o.then(r,n):x(o)?Promise.all(o).then(r,n):r(o)}}return i(e)()}function Zr(t,e,r){var n=arguments.length;if(n<2)throw new gt.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];return r=i.pop(),[t,G(i),r]}function Xr(t,e,r,n,i){return Zt.resolve().then((()=>{const o=$t.transless||$t,a=t._createTransaction(e,r,t._dbSchema,n),s={trans:a,transless:o};n?a.idbtrans=n.idbtrans:a.create();const c=tt(i);let u;c&&ve();const l=Zt.follow((()=>{if(u=i.call(a,a),u)if(c){var t=be.bind(null,null);u.then(t,t)}else"function"==typeof u.next&&"function"==typeof u.throw&&(u=Hr(u))}),s);return(u&&"function"==typeof u.then?Zt.resolve(u).then((t=>a.active?t:Pe(new gt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):l.then((()=>u))).then((t=>(n&&a._resolve(),a._completion.then((()=>t))))).catch((t=>(a._reject(t),Pe(t))))}))}function qr(t,e,r){const n=x(t)?t.slice():[t];for(let t=0;t<r;++t)n.push(e);return n}const Jr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const r=t.table(e),{schema:n}=r,i={},o=[];function a(t,e,r){const n=Mr(t),s=i[n]=i[n]||[],c=null==t?0:"string"==typeof t?1:t.length,u=e>0,l={...r,isVirtual:u,keyTail:e,keyLength:c,extractKey:Or(t),unique:!u&&r.unique};return s.push(l),l.isPrimaryKey||o.push(l),c>1&&a(2===c?t[0]:t.slice(0,c-1),e+1,r),s.sort(((t,e)=>t.keyTail-e.keyTail)),l}const s=a(n.primaryKey.keyPath,0,n.primaryKey);i[":id"]=[s];for(const t of n.indexes)a(t.keyPath,0,t);function c(e){const r=e.query.index;return r.isVirtual?{...e,query:{index:r,range:(n=e.query.range,i=r.keyTail,{type:1===n.type?2:n.type,lower:qr(n.lower,n.lowerOpen?t.MAX_KEY:t.MIN_KEY,i),lowerOpen:!0,upper:qr(n.upper,n.upperOpen?t.MIN_KEY:t.MAX_KEY,i),upperOpen:!0})}}:e;var n,i}const u={...r,schema:{...n,primaryKey:s,indexes:o,getIndexByKeyPath:function(t){const e=i[Mr(t)];return e&&e[0]}},count:t=>r.count(c(t)),query:t=>r.query(c(t)),openCursor(e){const{keyTail:n,isVirtual:i,keyLength:o}=e.query.index;return i?r.openCursor(c(e)).then((r=>r&&function(r){const i=Object.create(r,{continue:{value:function(i){null!=i?r.continue(qr(i,e.reverse?t.MAX_KEY:t.MIN_KEY,n)):e.unique?r.continue(r.key.slice(0,o).concat(e.reverse?t.MIN_KEY:t.MAX_KEY,n)):r.continue()}},continuePrimaryKey:{value(e,i){r.continuePrimaryKey(qr(e,t.MAX_KEY,n),i)}},primaryKey:{get:()=>r.primaryKey},key:{get(){const t=r.key;return 1===o?t[0]:t.slice(0,o)}},value:{get:()=>r.value}});return i}(r))):r.openCursor(e)}};return u}}}};function Qr(t,e,r,n){return r=r||{},n=n||"",w(t).forEach((i=>{if(k(e,i)){var o=t[i],a=e[i];if("object"==typeof o&&"object"==typeof a&&o&&a){const t=Z(o);t!==Z(a)?r[n+i]=e[i]:"Object"===t?Qr(o,a,r,n+i+"."):o!==a&&(r[n+i]=e[i])}else o!==a&&(r[n+i]=e[i])}else r[n+i]=void 0})),w(e).forEach((i=>{k(t,i)||(r[n+i]=e[i])})),r}const tn={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const r=t.table(e),{primaryKey:n}=r.schema,i={...r,mutate(t){const i=$t.trans,{deleting:o,creating:a,updating:s}=i.table(e).hook;switch(t.type){case"add":if(a.fire===bt)break;return i._promise("readwrite",(()=>c(t)),!0);case"put":if(a.fire===bt&&s.fire===bt)break;return i._promise("readwrite",(()=>c(t)),!0);case"delete":if(o.fire===bt)break;return i._promise("readwrite",(()=>c(t)),!0);case"deleteRange":if(o.fire===bt)break;return i._promise("readwrite",(()=>function(t){return u(t.trans,t.range,1e4)}(t)),!0)}return r.mutate(t);function c(t){const e=$t.trans,i=t.keys||function(t,e){return"delete"===e.type?e.keys:e.keys||e.values.map(t.extractKey)}(n,t);if(!i)throw new Error("Keys missing");return"delete"!==(t="add"===t.type||"put"===t.type?{...t,keys:i}:{...t}).type&&(t.values=[...t.values]),t.keys&&(t.keys=[...t.keys]),function(t,e,r){return"add"===e.type?Promise.resolve([]):t.getMany({trans:e.trans,keys:r,cache:"immutable"})}(r,t,i).then((c=>{const u=i.map(((r,i)=>{const u=c[i],l={onerror:null,onsuccess:null};if("delete"===t.type)o.fire.call(l,r,u,e);else if("add"===t.type||void 0===u){const o=a.fire.call(l,r,t.values[i],e);null==r&&null!=o&&(r=o,t.keys[i]=r,n.outbound||F(t.values[i],n.keyPath,r))}else{const n=Qr(u,t.values[i]),o=s.fire.call(l,n,r,u,e);if(o){const e=t.values[i];Object.keys(o).forEach((t=>{k(e,t)?e[t]=o[t]:F(e,t,o[t])}))}}return l}));return r.mutate(t).then((({failures:e,results:r,numFailures:n,lastResult:o})=>{for(let n=0;n<i.length;++n){const o=r?r[n]:i[n],a=u[n];null==o?a.onerror&&a.onerror(e[n]):a.onsuccess&&a.onsuccess("put"===t.type&&c[n]?t.values[n]:o)}return{failures:e,results:r,numFailures:n,lastResult:o}})).catch((t=>(u.forEach((e=>e.onerror&&e.onerror(t))),Promise.reject(t))))}))}function u(t,e,i){return r.query({trans:t,values:!1,query:{index:n,range:e},limit:i}).then((({result:r})=>c({type:"delete",keys:r,trans:t}).then((n=>n.numFailures>0?Promise.reject(n.failures[0]):r.length<i?{failures:[],numFailures:0,lastResult:void 0}:u(t,{...e,lower:r[r.length-1],lowerOpen:!0},i)))))}}};return i}})};function en(t,e,r){try{if(!e)return null;if(e.keys.length<t.length)return null;const n=[];for(let i=0,o=0;i<e.keys.length&&o<t.length;++i)0===or(e.keys[i],t[o])&&(n.push(r?Y(e.values[i]):e.values[i]),++o);return n.length===t.length?n:null}catch(t){return null}}const rn={stack:"dbcore",level:-1,create:t=>({table:e=>{const r=t.table(e);return{...r,getMany:t=>{if(!t.cache)return r.getMany(t);const e=en(t.keys,t.trans._cache,"clone"===t.cache);return e?Zt.resolve(e):r.getMany(t).then((e=>(t.trans._cache={keys:t.keys,values:"clone"===t.cache?Y(e):e},e)))},mutate:t=>("add"!==t.type&&(t.trans._cache=null),r.mutate(t))}}})};function nn(t){return!("from"in t)}const on=function(t,e){if(!this){const e=new on;return t&&"d"in t&&_(e,t),e}_(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function an(t,e,r){const n=or(e,r);if(isNaN(n))return;if(n>0)throw RangeError();if(nn(t))return _(t,{from:e,to:r,d:1});const i=t.l,o=t.r;if(or(r,t.from)<0)return i?an(i,e,r):t.l={from:e,to:r,d:1,l:null,r:null},un(t);if(or(e,t.to)>0)return o?an(o,e,r):t.r={from:e,to:r,d:1,l:null,r:null},un(t);or(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),or(r,t.to)>0&&(t.to=r,t.r=null,t.d=t.l?t.l.d+1:1);const a=!t.r;i&&!t.l&&sn(t,i),o&&a&&sn(t,o)}function sn(t,e){nn(e)||function t(e,{from:r,to:n,l:i,r:o}){an(e,r,n),i&&t(e,i),o&&t(e,o)}(t,e)}function cn(t){let e=nn(t)?null:{s:0,n:t};return{next(t){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&or(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||or(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function un(t){var e,r;const n=((null===(e=t.r)||void 0===e?void 0:e.d)||0)-((null===(r=t.l)||void 0===r?void 0:r.d)||0),i=n>1?"r":n<-1?"l":"";if(i){const e="r"===i?"l":"r",r={...t},n=t[i];t.from=n.from,t.to=n.to,t[i]=n[i],r[i]=n[e],t[e]=r,r.d=ln(r)}t.d=ln(t)}function ln({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}S(on.prototype,{add(t){return sn(this,t),this},addKey(t){return an(this,t,t),this},addKeys(t){return t.forEach((t=>an(this,t,t))),this},[X](){return cn(this)}});const hn={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,r=new on(t.MIN_KEY,t.MAX_KEY);return{...t,table:n=>{const i=t.table(n),{schema:o}=i,{primaryKey:a}=o,{extractKey:s,outbound:c}=a,u={...i,mutate:t=>{const a=t.trans,s=a.mutatedParts||(a.mutatedParts={}),c=t=>{const r=`idb://${e}/${n}/${t}`;return s[r]||(s[r]=new on)},u=c(""),l=c(":dels"),{type:h}=t;let[f,p]="deleteRange"===t.type?[t.range]:"delete"===t.type?[t.keys]:t.values.length<50?[[],t.values]:[];const d=t.trans._cache;return i.mutate(t).then((t=>{if(x(f)){"delete"!==h&&(f=t.results),u.addKeys(f);const e=en(f,d);e||"add"===h||l.addKeys(f),(e||p)&&function(t,e,r,n){e.indexes.forEach((function(e){const i=t(e.name||"");function o(t){return null!=t?e.extractKey(t):null}const a=t=>e.multiEntry&&x(t)?t.forEach((t=>i.addKey(t))):i.addKey(t);(r||n).forEach(((t,e)=>{const i=r&&o(r[e]),s=n&&o(n[e]);0!==or(i,s)&&(null!=i&&a(i),null!=s&&a(s))}))}))}(c,o,e,p)}else if(f){const t={from:f.lower,to:f.upper};l.add(t),u.add(t)}else u.add(r),l.add(r),o.indexes.forEach((t=>c(t.name).add(r)));return t}))}},l=({query:{index:e,range:r}})=>{var n,i;return[e,new on(null!==(n=r.lower)&&void 0!==n?n:t.MIN_KEY,null!==(i=r.upper)&&void 0!==i?i:t.MAX_KEY)]},h={get:t=>[a,new on(t.key)],getMany:t=>[a,(new on).addKeys(t.keys)],count:l,query:l,openCursor:l};return w(h).forEach((t=>{u[t]=function(o){const{subscr:a}=$t;if(a){const u=t=>{const r=`idb://${e}/${n}/${t}`;return a[r]||(a[r]=new on)},l=u(""),f=u(":dels"),[p,d]=h[t](o);if(u(p.name||"").add(d),!p.isPrimaryKey){if("count"!==t){const e="query"===t&&c&&o.values&&i.query({...o,values:!1});return i[t].apply(this,arguments).then((r=>{if("query"===t){if(c&&o.values)return e.then((({result:t})=>(l.addKeys(t),r)));const t=o.values?r.result.map(s):r.result;o.values?l.addKeys(t):f.addKeys(t)}else if("openCursor"===t){const t=r,e=o.values;return t&&Object.create(t,{key:{get:()=>(f.addKey(t.primaryKey),t.key)},primaryKey:{get(){const e=t.primaryKey;return f.addKey(e),e}},value:{get:()=>(e&&l.addKey(t.primaryKey),t.value)}})}return r}))}f.add(r)}}return i[t].apply(this,arguments)}})),u}}}};class fn{constructor(t,e){this._middlewares={},this.verno=0;const r=fn.dependencies;this._options=e={addons:fn.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...e},this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange};const{addons:n}=e;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:bt,dbReadyPromise:null,cancelOpen:bt,openCanceller:null,autoSchema:!0};var o;i.dbReadyPromise=new Zt((t=>{i.dbReadyResolve=t})),i.openCanceller=new Zt(((t,e)=>{i.cancelOpen=e})),this._state=i,this.name=t,this.on=Xe(this,"populate","blocked","versionchange","close",{ready:[Tt,bt]}),this.on.ready.subscribe=j(this.on.ready.subscribe,(t=>(e,r)=>{fn.vip((()=>{const n=this._state;if(n.openComplete)n.dbOpenError||Zt.resolve().then(e),r&&t(e);else if(n.onReadyBeingFired)n.onReadyBeingFired.push(e),r&&t(e);else{t(e);const n=this;r||t((function t(){n.on.ready.unsubscribe(e),n.on.ready.unsubscribe(t)}))}}))})),this.Collection=(o=this,qe(cr.prototype,(function(t,e){this.db=o;let r=Ke,n=null;if(e)try{r=e()}catch(t){n=t}const i=t._ctx,a=i.table,s=a.hook.reading.fire;this._ctx={table:a,index:i.index,isPrimKey:!i.index||a.schema.primKey.keyPath&&i.index===a.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:n,or:i.or,valueMapper:s!==wt?s:null}}))),this.Table=function(t){return qe(Ze.prototype,(function(e,r,n){this.db=t,this._tx=n,this.name=e,this.schema=r,this.hook=t._allTables[e]?t._allTables[e].hook:Xe(null,{creating:[Et,bt],reading:[xt,wt],updating:[kt,bt],deleting:[At,bt]})}))}(this),this.Transaction=function(t){return qe(Ar.prototype,(function(e,r,n,i,o){this.db=t,this.mode=e,this.storeNames=r,this.schema=n,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Xe(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Zt(((t,e)=>{this._resolve=t,this._reject=e})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(t=>{var e=this.active;return this.active=!1,this.on.error.fire(t),this.parent?this.parent._reject(t):e&&this.idbtrans&&this.idbtrans.abort(),Pe(t)}))}))}(this),this.Version=function(t){return qe(Gr.prototype,(function(e){this.db=t,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(t){return qe(vr.prototype,(function(e,r,n){this.db=t,this._ctx={table:e,index:":id"===r?null:r,or:n};const i=t._deps.indexedDB;if(!i)throw new gt.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=(t,e)=>i.cmp(e,t),this._max=(t,e)=>i.cmp(t,e)>0?t:e,this._min=(t,e)=>i.cmp(t,e)<0?t:e,this._IDBKeyRange=t._deps.IDBKeyRange}))}(this),this.on("versionchange",(t=>{t.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(t=>{!t.newVersion||t.newVersion<t.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${t.oldVersion/10}`)})),this._maxKey=Lr(e.IDBKeyRange),this._createTransaction=(t,e,r,n)=>new this.Transaction(t,e,r,this._options.chromeTransactionDurability,n),this._fireOnBlocked=t=>{this.on("blocked").fire(t),De.filter((t=>t.name===this.name&&t!==this&&!t._state.vcFired)).map((e=>e.on("versionchange").fire(t)))},this.use(Jr),this.use(tn),this.use(hn),this.use(rn),this.vip=Object.create(this,{_vip:{value:!0}}),n.forEach((t=>t(this)))}version(t){if(isNaN(t)||t<.1)throw new gt.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new gt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const e=this._versions;var r=e.filter((e=>e._cfg.version===t))[0];return r||(r=new this.Version(t),e.push(r),e.sort(Nr),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(t){return this.idbdb&&(this._state.openComplete||$t.letThrough||this._vip)?t():new Zt(((t,e)=>{if(this._state.openComplete)return e(new gt.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void e(new gt.DatabaseClosed);this.open().catch(bt)}this._state.dbReadyPromise.then(t,e)})).then(t)}use({stack:t,create:e,level:r,name:n}){n&&this.unuse({stack:t,name:n});const i=this._middlewares[t]||(this._middlewares[t]=[]);return i.push({stack:t,create:e,level:null==r?10:r,name:n}),i.sort(((t,e)=>t.level-e.level)),this}unuse({stack:t,name:e,create:r}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter((t=>r?t.create!==r:!!e&&t.name!==e))),this}open(){return Kr(this)}_close(){const t=this._state,e=De.indexOf(this);if(e>=0&&De.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(t){}this._novip.idbdb=null}t.dbReadyPromise=new Zt((e=>{t.dbReadyResolve=e})),t.openCanceller=new Zt(((e,r)=>{t.cancelOpen=r}))}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new gt.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,e=this._state;return new Zt(((r,n)=>{const i=()=>{this.close();var t=this._deps.indexedDB.deleteDatabase(this.name);t.onsuccess=le((()=>{!function({indexedDB:t,IDBKeyRange:e},r){!Vr(t)&&r!==We&&Wr(t,e).delete(r).catch(bt)}(this._deps,this.name),r()})),t.onerror=br(n),t.onblocked=this._fireOnBlocked};if(t)throw new gt.InvalidArgument("Arguments not allowed in db.delete()");e.isBeingOpened?e.dbReadyPromise.then(i):i()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const t=this._state.dbOpenError;return t&&"DatabaseClosed"===t.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return w(this._allTables).map((t=>this._allTables[t]))}transaction(){const t=Zr.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,e,r){let n=$t.trans;n&&n.db===this&&-1===t.indexOf("!")||(n=null);const i=-1!==t.indexOf("?");let o,a;t=t.replace("!","").replace("?","");try{if(a=e.map((t=>{var e=t instanceof this.Table?t.name:t;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e})),"r"==t||t===Ve)o=Ve;else{if("rw"!=t&&t!=$e)throw new gt.InvalidArgument("Invalid transaction mode: "+t);o=$e}if(n){if(n.mode===Ve&&o===$e){if(!i)throw new gt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");n=null}n&&a.forEach((t=>{if(n&&-1===n.storeNames.indexOf(t)){if(!i)throw new gt.SubTransaction("Table "+t+" not included in parent transaction.");n=null}})),i&&n&&!n.active&&(n=null)}}catch(t){return n?n._promise(null,((e,r)=>{r(t)})):Pe(t)}const s=Xr.bind(null,this,o,a,n,r);return n?n._promise(o,s,"lock"):$t.trans?ke($t.transless,(()=>this._whenReady(s))):this._whenReady(s)}table(t){if(!k(this._allTables,t))throw new gt.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const pn="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class dn{constructor(t){this._subscribe=t}subscribe(t,e,r){return this._subscribe(t&&"function"!=typeof t?t:{next:t,error:e,complete:r})}[pn](){return this}}function yn(t,e){return w(e).forEach((r=>{sn(t[r]||(t[r]=new on),e[r])})),t}let gn;try{gn={indexedDB:b.indexedDB||b.mozIndexedDB||b.webkitIndexedDB||b.msIndexedDB,IDBKeyRange:b.IDBKeyRange||b.webkitIDBKeyRange}}catch(t){gn={indexedDB:null,IDBKeyRange:null}}const mn=fn;function vn(t){let e=bn;try{bn=!0,Er.storagemutated.fire(t)}finally{bn=e}}S(mn,{...vt,delete:t=>new mn(t,{addons:[]}).delete(),exists:t=>new mn(t,{addons:[]}).open().then((t=>(t.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(t){try{return function({indexedDB:t,IDBKeyRange:e}){return Vr(t)?Promise.resolve(t.databases()).then((t=>t.map((t=>t.name)).filter((t=>t!==We)))):Wr(t,e).toCollection().primaryKeys()}(mn.dependencies).then(t)}catch(t){return Pe(new gt.MissingAPI)}},defineClass:()=>function(t){_(this,t)},ignoreTransaction:t=>$t.trans?ke($t.transless,t):t(),vip:$r,async:function(t){return function(){try{var e=Hr(t.apply(this,arguments));return e&&"function"==typeof e.then?e:Zt.resolve(e)}catch(t){return Pe(t)}}},spawn:function(t,e,r){try{var n=Hr(t.apply(r,e||[]));return n&&"function"==typeof n.then?n:Zt.resolve(n)}catch(t){return Pe(t)}},currentTransaction:{get:()=>$t.trans||null},waitFor:function(t,e){const r=Zt.resolve("function"==typeof t?mn.ignoreTransaction(t):t).timeout(e||6e4);return $t.trans?$t.trans.waitFor(r):r},Promise:Zt,debug:{get:()=>et,set:t=>{rt(t,"dexie"===t?()=>!0:Ge)}},derive:O,extend:_,props:S,override:j,Events:Xe,on:Er,liveQuery:function(t){return new dn((e=>{const r=tt(t);let n=!1,i={},o={};const a={get closed(){return n},unsubscribe:()=>{n=!0,Er.storagemutated.unsubscribe(l)}};e.start&&e.start(a);let s=!1,c=!1;function u(){return w(o).some((t=>i[t]&&function(t,e){const r=cn(e);let n=r.next();if(n.done)return!1;let i=n.value;const o=cn(t);let a=o.next(i.from),s=a.value;for(;!n.done&&!a.done;){if(or(s.from,i.to)<=0&&or(s.to,i.from)>=0)return!0;or(i.from,s.from)<0?i=(n=r.next(s.from)).value:s=(a=o.next(i.from)).value}return!1}(i[t],o[t])))}const l=t=>{yn(i,t),u()&&h()},h=()=>{if(s||n)return;i={};const f={},p=function(e){r&&ve();const n=()=>me(t,{subscr:e,trans:null}),i=$t.trans?ke($t.transless,n):n();return r&&i.then(be,be),i}(f);c||(Er(xr,l),c=!0),s=!0,Promise.resolve(p).then((t=>{s=!1,n||(u()?h():(i={},o=f,e.next&&e.next(t)))}),(t=>{s=!1,e.error&&e.error(t),a.unsubscribe()}))};return h(),a}))},extendObservabilitySet:yn,getByKeyPath:D,setByKeyPath:F,delByKeyPath:function(t,e){"string"==typeof e?F(t,e,void 0):"length"in e&&[].map.call(e,(function(e){F(t,e,void 0)}))},shallowClone:U,deepClone:Y,getObjectDiff:Qr,cmp:or,asap:N,minKey:Re,addons:[],connections:De,errnames:dt,dependencies:gn,semVer:Ie,version:Ie.split(".").map((t=>parseInt(t))).reduce(((t,e,r)=>t+e/Math.pow(10,2*r)))}),mn.maxKey=Lr(mn.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(Er(xr,(t=>{if(!bn){let e;Fe?(e=document.createEvent("CustomEvent"),e.initCustomEvent(_r,!0,!0,t)):e=new CustomEvent(_r,{detail:t}),bn=!0,dispatchEvent(e),bn=!1}})),addEventListener(_r,(({detail:t})=>{bn||vn(t)})));let bn=!1;if("undefined"!=typeof BroadcastChannel){const t=new BroadcastChannel(_r);Er(xr,(e=>{bn||t.postMessage(e)})),t.onmessage=t=>{t.data&&vn(t.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){Er(xr,(t=>{try{bn||("undefined"!=typeof localStorage&&localStorage.setItem(_r,JSON.stringify({trig:Math.random(),changedParts:t})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((e=>e.postMessage({type:_r,changedParts:t}))))}catch(t){}})),addEventListener("storage",(t=>{if(t.key===_r){const e=JSON.parse(t.newValue);e&&vn(e.changedParts)}}));const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",(function({data:t}){t&&t.type===_r&&vn(t.changedParts)}))}function wn(t){return wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wn(t)}function xn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _n(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?xn(Object(r),!0).forEach((function(e){En(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):xn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function En(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function An(){An=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==wn(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function kn(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function Sn(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){kn(o,n,i,a,s,"next",t)}function s(t){kn(o,n,i,a,s,"throw",t)}a(void 0)}))}}function Tn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Zt.rejectionMapper=function(t,e){if(!t||t instanceof lt||t instanceof TypeError||t instanceof SyntaxError||!t.name||!mt[t.name])return t;var r=new mt[t.name](e||t.message,t);return"stack"in t&&L(r,"stack",{get:function(){return this.inner.stack}}),r},rt(et,Ge);var Ln=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.db=new fn("hyperspace"),this.db.version(1).stores({tileset:"++id, name, creator, type, checksum, signature, timestamp",inventory:"++id, name, creator, type, checksum, signature, timestamp",spirits:"++id, name, creator, type, checksum, signature, timestamp",abilities:"++id, name, creator, type checksum, signature, timestamp",models:"++id, name, creator, type, checksum, signature, timestamp",accounts:"++id, name, type, checksum, signature, timestamp",dht:"++id, name, type, ip, checksum, signature, timestamp",msg:"++id, name, type, ip, checksum, signature, timestamp",tmp:"++id, key, value, timestamp"}),this.dbAdd=this.dbAdd.bind(this),this.dbGet=this.dbGet.bind(this),this.dbRemove=this.dbRemove.bind(this),this.dbUpdate=this.dbUpdate.bind(this)}var e,r,n,i,o,a;return e=t,r=[{key:"dbGet",value:(a=Sn(An().mark((function t(e,r){return An().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.db[e].get(r);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t,e){return a.apply(this,arguments)})},{key:"dbAdd",value:(o=Sn(An().mark((function t(e,r){return An().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.db[e].add(_n({},r));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"dbUpdate",value:(i=Sn(An().mark((function t(e,r,n){return An().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.db[e].update(r,_n({},n));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return i.apply(this,arguments)})},{key:"dbRemove",value:(n=Sn(An().mark((function t(e,r){return An().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.db[e].delete(r);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})}],r&&Tn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function On(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Cn(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?On(Object(r),!0).forEach((function(e){Pn(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):On(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Pn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Mn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var In=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i.store.pixos={},this.store=i.store.pixos,this.fetchStore=this.fetchStore.bind(this),this.addStore=this.addStore.bind(this),this.delStore=this.delStore.bind(this),this.updateStore=this.updateStore.bind(this)}var e,r;return e=t,(r=[{key:"fetchStore",value:function(t){return this.store[t]}},{key:"addStore",value:function(t,e){return this.store[t]=Cn({},e)}},{key:"updateStore",value:function(t,e){return this.store[t]=Cn({},e)}},{key:"delStore",value:function(t){return this.store[t]=null}}])&&Mn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function jn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Rn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Nn(t,e,r){return e&&Rn(t.prototype,e),r&&Rn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var Bn=new FontFace("minecraftia","url(/pixos/font/minecraftia.ttf)"),Dn=function(){function t(e){return jn(this,t),t._instance||(this.engine=e,t._instance=this),t._instance}return Nn(t,[{key:"init",value:function(){this.ctx=this.engine.ctx}},{key:"drawButton",value:function(t,e,r,n,i,o){this.ctx;var a=i/2;this.engine.ctx.save(),this.engine.ctx.fillStyle=o.background,this.engine.ctx.beginPath(),this.engine.ctx.rect(e,r,n,i),this.engine.ctx.rect(e,r,n,i),this.engine.ctx.fill(),this.engine.ctx.clip();var s=this.engine.ctx.createLinearGradient(e,r,e,r+a);s.addColorStop(0,"rgb(221,181,155)"),s.addColorStop(1,"rgb(22,13,8)"),this.engine.ctx.fillStyle=s,this.engine.ctx.globalAlpha=.5,this.engine.ctx.fillRect(e,r,n,i),this.engine.ctx.fillStyle=o.top;for(var c=0;c<i;c+=a){this.engine.ctx.fillStyle=0===c?o.top:o.bottom;for(var u=0;u<50;u++){var l=e+Math.random()*n,h=r+c+Math.random()*a,f=10*Math.random(),p=10*Math.random(),d=360*Math.random(),y=Math.random();this.engine.ctx.save(),this.engine.ctx.translate(l,h),this.engine.ctx.rotate(d*Math.PI/180),this.engine.ctx.translate(-l,-h),this.engine.ctx.globalAlpha=y,this.engine.ctx.fillRect(l,h,f,p),this.engine.ctx.restore()}}this.engine.ctx.font="20px invasion2000",this.engine.ctx.textAlign="center",this.engine.ctx.textBaseline="middle",this.engine.ctx.fillStyle="white",this.engine.ctx.fillText(t,e+n/2,r+i/2,n),this.engine.ctx.restore()}},{key:"clearHud",value:function(){this.engine.ctx.clearRect(0,0,this.engine.ctx.canvas.width,this.engine.ctx.canvas.height)}},{key:"writeText",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.engine.ctx.save(),this.engine.ctx.font="20px invasion2000",this.engine.ctx.textAlign="center",this.engine.ctx.textBaseline="middle",this.engine.ctx.fillStyle="white",n?(this.engine.ctx.fillText(t,null!=e?e:this.engine.ctx.canvas.clientWidth/2+76,null!=r?r:this.engine.ctx.canvas.clientHeight/2),this.engine.ctx.drawImage(n,null!=e?e:this.engine.ctx.canvas.clientWidth/2,null!=r?r:this.engine.ctx.canvas.clientHeight/2,76,76)):this.engine.ctx.fillText(t,null!=e?e:this.engine.ctx.canvas.clientWidth/2,null!=r?r:this.engine.ctx.canvas.clientHeight/2),this.engine.ctx.restore()}},{key:"scrollText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=new Fn(this.engine.ctx);return n.init(t,10,2*this.engine.ctx.canvas.height/3,this.engine.ctx.canvas.width-20,this.engine.ctx.canvas.height/3-20,r),n.setOptions(r),e&&n.scroll((Math.sin((new Date).getTime()/3e3)+1)*n.maxScroll*.5),n.render(),n}}]),t}(),Fn=function(){function t(e){jn(this,t),this.ctx=e,this.dirty=!0,this.scrollY=0,this.fontSize=24,this.font="minecraftia",this.align="left",this.background="#999",this.border={lineWidth:4,style:"white",corner:"round"},this.scrollBox={width:5,background:"#568",color:"#78a"},this.fontStyle="white",this.lines=[],this.x=0,this.y=0}return Nn(t,[{key:"init",value:function(t,e,r,n,i){var o,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.text=t,this.x=e,this.y=r,this.width=n,this.height=i,this.portrait=null!==(o=a.portrait)&&void 0!==o?o:null,this.setOptions(a),this.cleanit()}},{key:"cleanit",value:function(t){this.dirty&&(this.setFont(),this.getTextPos(),this.dirty=!1,t||this.fitText())}},{key:"setOptions",value:function(t){var e=this;Object.keys(this).forEach((function(r){void 0!==t[r]&&(e[r]=t[r],e.dirty=!0)}))}},{key:"setFont",value:function(){this.fontStr=this.fontSize+"px "+this.font,this.textHeight=this.fontSize+Math.ceil(.05*this.fontSize)}},{key:"getTextPos",value:function(){"left"===this.align?this.textPos=2:"right"===this.align?this.textPos=Math.floor(this.width-this.scrollBox.width-this.fontSize/4):this.textPos=Math.floor((this.width- -this.scrollBox.width)/2)}},{key:"fitText",value:function(){var t=this.ctx;this.cleanit(!0),t.font=this.fontStr,t.textAlign=this.align,t.textBaseline="top";var e=this.text.split(" ");this.lines.length=0;for(var r="",n="";e.length>0;){var i=e.shift();t.measureText(r+n+i).width<this.width-this.scrollBox.width-this.scrollBox.width-(this.portrait?84:0)?(r+=n+i,n=" "):(""===n?r+=i:e.unshift(i),this.lines.push(r),n="",r="")}""!==r&&this.lines.push(r),this.maxScroll=(this.lines.length+.5)*this.textHeight-this.height}},{key:"drawBorder",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.ctx,r=this.border.lineWidth/2;e.lineJoin=this.border.corner,e.lineWidth=this.border.lineWidth,e.strokeStyle=this.border.style,t?e.strokeRect(this.x-r+84,this.y-r,this.width+2*r-84,this.height+2*r):e.strokeRect(this.x-r,this.y-r,this.width+2*r,this.height+2*r)}},{key:"drawScrollBox",value:function(){var t=this.ctx,e=this.height/(this.lines.length*this.textHeight);t.fillStyle=this.scrollBox.background,t.fillRect(this.x+this.width-this.scrollBox.width,this.y,this.scrollBox.width,this.height),t.fillStyle=this.scrollBox.color;var r=this.height*e;r>this.height&&(r=this.height),t.fillRect(this.x+this.width-this.scrollBox.width,this.y-this.scrollY*e,this.scrollBox.width,r)}},{key:"drawPortrait",value:function(){this.ctx.drawImage(this.portrait.image,this.x,this.y+38,76,76)}},{key:"scroll",value:function(t){this.cleanit(),this.scrollY=-t,this.scrollY>0?this.scrollY=0:this.scrollY<-this.maxScroll&&(this.scrollY=-this.maxScroll)}},{key:"scrollLines",value:function(t){this.cleanit(),this.scrollY=-this.textHeight*t,this.scrollY>0?this.scrollY=0:this.scrollY<-this.maxScroll&&(this.scrollY=-this.maxScroll)}},{key:"render",value:function(){var t=this.ctx;this.cleanit(),t.font=this.fontStr,t.textAlign=this.align,this.portrait?(this.drawBorder(!0),this.drawPortrait(),t.save(),t.fillStyle=this.background,t.fillRect(this.x+84,this.y,this.width-84,this.height)):(this.drawBorder(),t.save(),t.fillStyle=this.background,t.fillRect(this.x,this.y,this.width,this.height)),this.drawScrollBox(),this.portrait?(t.beginPath(),t.rect(this.x+84,this.y,this.width-this.scrollBox.width-84,this.height),t.clip(),t.setTransform(1,0,0,1,this.x+84,Math.floor(this.y+this.scrollY))):(t.beginPath(),t.rect(this.x,this.y,this.width-this.scrollBox.width,this.height),t.clip(),t.setTransform(1,0,0,1,this.x,Math.floor(this.y+this.scrollY))),t.fillStyle=this.fontStyle;for(var e=0;e<this.lines.length;e++)t.fillText(this.lines[e],this.textPos,Math.floor(e*this.textHeight)+2);t.restore()}}]),t}(),Un=(r(1010),r(9175)),zn=r(2903);function Gn(t){return function(t){if(Array.isArray(t))return Wn(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Wn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Wn(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Vn(t,e,r){return Vn=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&$n(i,r.prototype),i},Vn.apply(null,arguments)}function $n(t,e){return $n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},$n(t,e)}function Yn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Kn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Hn(t,e,r){return e&&Kn(t.prototype,e),r&&Kn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var Zn=function(){function t(e){Yn(this,t),Number.prototype.clamp=function(t,e){return this<t?t:this>e?e:this},this.renderingManager=e,this.uViewMat=(0,Un.Ue)(),this.fov=45,this.thetaLimits=Vn(s.OW,[1.5*Math.PI,1.8*Math.PI,0]),this.cameraAngle=45,this.cameraVector=Vn(s.OW,[1,0,0]),this.cameraDir="N",this.cameraPosition=new s.OW(8,8,-1),this.cameraOffset=new s.OW(0,0,0),this.setCamera=this.setCamera.bind(this),this.lookAt=this.lookAt.bind(this),this.panCCW=this.panCCW.bind(this),this.panCW=this.panCW.bind(this),this.tiltCCW=this.tiltCCW.bind(this),this.tiltCW=this.tiltCW.bind(this),this.pitchCCW=this.pitchCCW.bind(this),this.pitchCW=this.pitchCW.bind(this),this.changeAngle=this.changeAngle.bind(this)}return Hn(t,[{key:"setCamera",value:function(){(0,Un.Iu)(this.uViewMat,this.uViewMat,[0,0,-15]),(0,Un.U1)(this.uViewMat,this.uViewMat,(0,s.Id)(this.cameraAngle*this.cameraVector.x),[1,0,0]),(0,Un.U1)(this.uViewMat,this.uViewMat,(0,s.Id)(this.cameraAngle*this.cameraVector.y),[0,1,0]),(0,Un.U1)(this.uViewMat,this.uViewMat,(0,s.Id)(this.cameraAngle*this.cameraVector.z),[0,0,1]),(0,s.tk)(this.cameraPosition,this.cameraOffset),(0,Un.Iu)(this.uViewMat,this.uViewMat,this.cameraOffset.toArray())}},{key:"changeAngle",value:function(t){this.lookAt(this.cameraPosition.toArray(),this.cameraOffset.toArray(),t)}},{key:"lookAt",value:function(t,e,r){var n=this.uViewMat;this.cameraPosition=Vn(s.OW,Gn(t)),this.cameraOffset=Vn(s.OW,Gn(e)),this.cameraVector=Vn(s.OW,Gn(r));var i=Vn(s.OW,Gn((0,Un.Fv)((0,Un.fk)(t,e)))),o=Vn(s.OW,Gn(r)).cross(i),a=i.cross(o),c=[o.x,o.y,o.z,0].concat([a.x,a.y,a.z,0],[i.x,i.y,i.z,0],[t.x,t.y,t.z,1]);this.uViewMat=(0,Un.t8)(c,n)}},{key:"panCW",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.PI/4;this.cameraVector.z-=Math.cos(t)}},{key:"panCCW",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.PI/4;this.cameraVector.z+=Math.cos(t)}},{key:"pitchCW",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.PI/4;this.cameraVector.x-=Math.cos(t)}},{key:"pitchCCW",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.PI/4;this.cameraVector.x+=Math.sin(t)}},{key:"tiltCW",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.PI/4;this.cameraVector.y-=Math.cos(t)}},{key:"tiltCCW",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.PI/4;this.cameraVector.z+=Math.sin(t)}}]),t}(),Xn=function(){function t(){Yn(this,t),this.camera=null}return Hn(t,[{key:"createCamera",value:function(t){return this.camera||(this.camera=new Zn(t)),this.camera}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}();function qn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Qn(t,e,r){return e&&Jn(t.prototype,e),r&&Jn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var ti=function(){function t(){qn(this,t),this.lights={},this.addLight=this.addLight.bind(this),this.removeLight=this.removeLight.bind(this),this.tick=this.tick.bind(this),this.render=this.render.bind(this),this.setMatrixUniforms=this.setMatrixUniforms.bind(this)}return Qn(t,[{key:"createLightManager",value:function(e){return this.renderManager||(this.renderManager=e,this.engine=e.engine),t.instance}},{key:"addLight",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[.8,.8,.8],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1,1],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[1,1,1],s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=this.renderManager.shaderProgram;if(!(this.lights.length>=c.maxLights)){var u=new ei(this.renderManager.engine,t,r,e,n,i,o,a,s);return this.lights[t]=u,t}}},{key:"updateLight",value:function(t,e,r,n,i,o,a,s){var c=this.lights[t];c&&(e&&(c.pos=e),r&&(c.color=r),n&&(c.attenuation=n),i&&(c.direction=i),o&&(c.density=o),a&&(c.scatteringCoefficients=a),s&&(c.enabled=s),this.lights[t]=c)}},{key:"removeLight",value:function(t){delete this.lights[t]}},{key:"tick",value:function(){for(var t=Object.keys(this.lights),e=0;e<t.length;e++)this.lights[t[e]].tick()}},{key:"render",value:function(){var t=this.renderManager.shaderProgram,e=t.uLights;if(e)for(var r=0;r<t.maxLights;r++){var n=Object.keys(this.lights);this.lights[n[r]]&&this.lights[n[r]].enabled&&this.lights[n[r]].draw(e[r])}}},{key:"setMatrixUniforms",value:function(){this.tick(),this.render()}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}(),ei=function(){function t(e,r,n,i,o,a,s,c,u){qn(this,t),this.engine=e,this.id=null!=r?r:"light",this.color=null!=n?n:[1,1,1],this.pos=null!=i?i:[0,0,0],this.attenuation=null!=o?o:[.5,.1,0],this.density=null!=s?s:.8,this.scatteringCoefficients=null!=c?c:[.5,.5,.5],this.direction=null!=a?a:[1,1,1],this.enabled=null==u||u,this.frame=0,this.draw=this.draw.bind(this),this.tick=this.tick.bind(this)}return Qn(t,[{key:"tick",value:function(){this.frame++}},{key:"draw",value:function(t){var e=this.engine.gl;e.uniform1f(t.enabled,this.enabled),e.uniform3fv(t.position,this.pos),e.uniform3fv(t.color,this.color),e.uniform3fv(t.attenuation,this.attenuation),e.uniform3fv(t.direction,this.direction),e.uniform3fv(t.scatteringCoefficients,this.scatteringCoefficients),e.uniform1f(t.density,this.density)}}]),t}();function ri(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ni(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ii(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var oi=function(){function t(e){var r=this;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ii(this,"initShaderProgram",(function(t){var e=t.vs,n=t.fs,i=r.engine.gl,o=r,a=r.loadShader(i.VERTEX_SHADER,e),s=r.loadShader(i.FRAGMENT_SHADER,n),c=i.createProgram();if(i.attachShader(c,a),i.attachShader(c,s),i.linkProgram(c),!i.getProgramParameter(c,i.LINK_STATUS))throw new Error("WebGL unable to initialize the shader program: ".concat(c));i.useProgram(c),c.aVertexNormal=i.getAttribLocation(c,"aVertexNormal"),i.enableVertexAttribArray(c.aVertexNormal),c.aVertexPosition=i.getAttribLocation(c,"aVertexPosition"),i.enableVertexAttribArray(c.aVertexPosition),c.aTextureCoord=i.getAttribLocation(c,"aTextureCoord"),i.enableVertexAttribArray(c.aTextureCoord),c.uDiffuse=i.getUniformLocation(c,"uDiffuse"),c.uSpecular=i.getUniformLocation(c,"uSpecular"),c.uSpecularExponent=i.getUniformLocation(c,"uSpecularExponent"),c.pMatrixUniform=i.getUniformLocation(c,"uProjectionMatrix"),c.mMatrixUniform=i.getUniformLocation(c,"uModelMatrix"),c.vMatrixUniform=i.getUniformLocation(c,"uViewMatrix"),c.nMatrixUniform=i.getUniformLocation(c,"uNormalMatrix"),c.samplerUniform=i.getUniformLocation(c,"uSampler"),c.diffuseMapUniform=i.getUniformLocation(c,"uDiffuseMap"),c.cameraPosition=i.getUniformLocation(c,"uCameraPosition"),c.runTransition=i.getUniformLocation(c,"runTransition"),c.useSampler=i.getUniformLocation(c,"useSampler"),c.useDiffuse=i.getUniformLocation(c,"useDiffuse"),c.scale=i.getUniformLocation(c,"u_scale"),c.maxLights=32,c.uLights=[];for(var u=0;u<c.maxLights;u++)c.uLights[u]={enabled:i.getUniformLocation(c,"uLights[".concat(u,"].enabled")),color:i.getUniformLocation(c,"uLights[".concat(u,"].color")),position:i.getUniformLocation(c,"uLights[".concat(u,"].position")),attenuation:i.getUniformLocation(c,"uLights[".concat(u,"].attenuation")),direction:i.getUniformLocation(c,"uLights[".concat(u,"].direction")),scatteringCoefficients:i.getUniformLocation(c,"uLights[".concat(u,"].scatteringCoefficients")),density:i.getUniformLocation(c,"uLights[".concat(u,"].density"))};c.setMatrixUniforms=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;i.uniformMatrix4fv(this.pMatrixUniform,!1,o.uProjMat),i.uniformMatrix4fv(this.mMatrixUniform,!1,o.uModelMat),i.uniformMatrix4fv(this.vMatrixUniform,!1,o.camera.uViewMat),o.normalMat=(0,Un.Ez)(),(0,Un.XL)(o.normalMat,o.uModelMat),i.uniformMatrix3fv(this.nMatrixUniform,!1,o.normalMat),i.uniform3fv(this.scale,t?t.toArray():o.scale.toArray()),i.uniform1f(this.useSampler,e),i.uniform1f(this.runTransition,o.isTransitioning?1:0),i.uniform3fv(this.cameraPosition,o.camera.cameraPosition.toArray()),o.lightManager.setMatrixUniforms()};var l={aVertexPosition:zn.NQ.Layout.POSITION.key,aVertexNormal:zn.NQ.Layout.NORMAL.key,aTextureCoord:zn.NQ.Layout.UV.key};return c.applyAttributePointers=function(t){var e=t.vertexBuffer.layout;for(var r in l)if(l.hasOwnProperty(r)&&-1!=c[r]){var n=l[r];if(-1!=c[r]){var o=e.attributeMap[n];i.vertexAttribPointer(c[r],o.size,i[o.type],o.normalized,o.stride,o.offset)}}},i.disableVertexAttribArray(c.aVertexNormal),r.shaderProgram=c,c})),ii(this,"activateShaderProgram",(function(){r.engine.gl.useProgram(r.shaderProgram)})),ii(this,"activateShaderEffectProgram",(function(t){r.engine.gl.useProgram(r.effects[t])})),ii(this,"initShaderEffects",(function(t){var e=t.vs,n=t.fs,i=t.id,o=t.init,a=r.engine.gl,s=r,c=r.loadShader(a.VERTEX_SHADER,e),u=r.loadShader(a.FRAGMENT_SHADER,n),l=a.createProgram();if(a.attachShader(l,c),a.attachShader(l,u),a.linkProgram(l),!a.getProgramParameter(l,a.LINK_STATUS))throw new Error("WebGL unable to initialize the shader effect program: ".concat(l));return r.effects[i]=o.call(s,l),r.effects[i]})),t._instance||(this.engine=e,this.fullscreen=e.fullscreen,this.uProjMat=(0,Un.Ue)(),this.uModelMat=(0,Un.Ue)(),this.normalMat=(0,Un.Ez)(),this.modelViewMatrixStack=[],this.scale=new s.OW(1,1,1),this.initializedWebGl=!1,this.effects=[],this.isTransitioning=!1,this.transition=null,this.transitionParams={},this.transitionTexture=null,this.transitionDuration=0,this.transitionTime=(new Date).getMilliseconds(),this.camera=Xn.getInstance().createCamera(this),this.lightManager=ti.getInstance().createLightManager(this),this.initShaderProgram=this.initShaderProgram.bind(this),this.initShaderEffects=this.initShaderEffects.bind(this),this.activateShaderProgram=this.activateShaderProgram.bind(this),this.activateShaderEffectProgram=this.activateShaderEffectProgram.bind(this)),t._instance}var e,r;return e=t,r=[{key:"init",value:function(){var t=this.engine,e=t.spritz,r=t.gl;if(r.clearColor(0,1,0,1),r.clearDepth(1),r.enable(r.DEPTH_TEST),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enable(r.BLEND),this.initShaderProgram(e.shaders),e.effects)for(var n in e.effects);this.initProjection(),this.initializedWebGl=!0}},{key:"loadShader",value:function(t,e){var r=this.engine.gl,n=r.createShader(t);if(r.shaderSource(n,e),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS)){var i=r.getShaderInfoLog(n);throw r.deleteShader(n),new Error("An error occurred compiling the shaders: ".concat(i))}return n}},{key:"initProjection",value:function(){var t=this.engine.gl,e=(0,s.Id)(this.camera.fov),r=t.canvas.clientWidth/t.canvas.clientHeight;this.uProjMat=(0,Un.G3)(e,r,.1,100),this.camera.uViewMat=(0,Un.Ue)(),this.uProjMat[5]*=-1}},{key:"clearScreen",value:function(){var t=this.engine.gl;t.viewport(0,0,t.canvas.clientWidth,t.canvas.clientHeight),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),(0,Un.G3)((0,s.Id)(this.camera.fov),t.canvas.clientWidth/t.canvas.clientHeight,.1,100,this.uProjMat),this.camera.uViewMat=(0,Un.Ue)()}},{key:"toggleFullscreen",value:function(){if(this.fullscreen){try{document.exitFullscreen()}catch(t){}this.fullscreen=!1}else try{this.engine.gamepadcanvas.parentElement.requestFullscreen(),this.fullscreen=!0}catch(t){}}},{key:"mvPushMatrix",value:function(){var t=(0,Un.Ue)();(0,Un.t8)(this.uModelMat,t);var e=(0,Un.Ue)();(0,Un.t8)(this.camera.uViewMat,e),this.modelViewMatrixStack.push([t,e])}},{key:"mvPopMatrix",value:function(){if(0==this.modelViewMatrixStack.length)throw"Invalid popMatrix!";var t,e,r=(t=this.modelViewMatrixStack.pop(),e=2,function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o=[],a=!0,s=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return ri(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ri(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());this.uModelMat=r[0],this.camera.uViewMat=r[1]}},{key:"transition",value:function(){var t=(new Date).getMilliseconds();this.transition.draw((this.transitionTime-t)/this.transitionDuration%1,this.transitionTexture,this.transitionTexture,this.engine.gl.canvas.width,this.engine.gl.canvas.height,this.transitionParams),t>=this.transitionTime&&(this.isTransitioning=!1)}},{key:"createBuffer",value:function(t,e,r){var n=this.engine.gl,i=n.createBuffer();return i.itemSize=r,i.numItems=t.length/r,n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t),e),n.bindBuffer(n.ARRAY_BUFFER,null),i}},{key:"updateBuffer",value:function(t,e){var r=this.engine.gl;r.bindBuffer(r.ARRAY_BUFFER,t),r.bufferSubData(r.ARRAY_BUFFER,0,new Float32Array(e)),r.bindBuffer(r.ARRAY_BUFFER,null)}},{key:"bindBuffer",value:function(t,e){var r=this.engine.gl;r.bindBuffer(r.ARRAY_BUFFER,t),r.vertexAttribPointer(e,t.itemSize,r.FLOAT,!1,0,0)}},{key:"startTransition",value:function(t){var e=t.duration||1e3,r=(new Date).getMilliseconds();for(this.isTransitioning=!0;r+e>(new Date).getMilliseconds(););this.isTransitioning=!1}}],r&&ni(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),ai=r(2846),si=r(7720),ci=r(5875);function ui(t){return ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ui(t)}function li(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function hi(t,e){return hi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},hi(t,e)}function fi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=di(t);if(e){var i=di(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===ui(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return pi(t)}(this,r)}}function pi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function di(t){return di=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},di(t)}var yi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hi(t,e)}(o,t);var e,r,n,i=fi(o);function o(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this)).engine=e,r.src=t,r.glTexture=e.gl.createTexture(),r.image=new Image,r.image.onload=r.onImageLoaded.bind(pi(r)),r.image.src=t,r.loaded=!1,r.onLoadActions=new si.Z,r}return e=o,(r=[{key:"onImageLoaded",value:function(){var t=this.engine.gl;t.bindTexture(t.TEXTURE_2D,this.glTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.image),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,null),this.loaded=!0,this.onLoadActions.run()}},{key:"attach",value:function(){var t=this.engine.gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.glTexture),t.uniform1i(this.engine.renderManager.shaderProgram.samplerUniform,0)}}])&&li(e.prototype,r),n&&li(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(ci.Z);function gi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var mi=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=n,this.engine=r,this.canvas=e,this.ctx=e.getContext("2d"),this.glTexture=r.gl.createTexture(),this.loaded=!1,this.onLoadActions=new si.Z,this.loadImage()}var e,r;return e=t,r=[{key:"runWhenLoaded",value:function(t){this.loaded?t():this.onLoadActions.add(t)}},{key:"loadImage",value:function(){var t=this.engine.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,this.glTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.canvas),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),this.loaded=!0,this.onLoadActions.run()}},{key:"attach",value:function(){var t=this.engine.gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.glTexture),t.uniform1i(this.engine.renderManager.shaderProgram.samplerUniform,0)}},{key:"clearHud",value:function(){var t=this.ctx;t.clearRect(0,0,t.canvas.width,t.canvas.height),this.loadImage()}},{key:"writeText",value:function(t,e,r){var n=this.ctx;n.save(),n.font="32px minecraftia",n.textAlign="center",n.textBaseline="middle",n.fillStyle="white",n.fillText(t,null!=e?e:n.canvas.width/2,null!=r?r:n.canvas.height/2),n.restore()}},{key:"scrollText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=new Fn(this.ctx);return r.portrait?n.init(t,10,10,this.canvas.width-20-84,2*this.canvas.height/3-20,r):n.init(t,10,10,this.canvas.width-20,2*this.canvas.height/3-20,r),n.setOptions(r),e&&n.scroll((Math.sin((new Date).getTime()/3e3)+1)*n.maxScroll*.5),n.render(),n}}],r&&gi(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function vi(t){return vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vi(t)}function bi(){bi=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==vi(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function wi(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function xi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var _i=function(){function t(e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),t._instance||(this.engine=e,this.objLoader=zn.NQ,this.audioLoader=new ai.m(this),this.textures=[],this.speeches=[],this.loadSpeech=this.loadSpeech.bind(this),this.loadTexture=this.loadTexture.bind(this),this.loadTextureFromZip=this.loadTextureFromZip.bind(this)),t._instance}var e,r,n,i;return e=t,r=[{key:"loadTexture",value:function(t){return this.textures[t]||(this.textures[t]=new yi(t,this.engine)),this.textures[t]}},{key:"loadTextureFromZip",value:(n=bi().mark((function t(e,r){var n,i,o,a;return bi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.textures[e]){t.next=2;break}return t.abrupt("return",this.textures[e]);case 2:return t.next=4,r.file("textures/".concat(e)).async("arrayBuffer");case 4:return n=t.sent,i=new Uint8Array(n),o=new Blob([i.buffer]),a=URL.createObjectURL(o),this.textures[e]=new yi(a,this.engine),t.abrupt("return",this.textures[e]);case 10:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,e=arguments;return new Promise((function(r,i){var o=n.apply(t,e);function a(t){wi(o,r,i,a,s,"next",t)}function s(t){wi(o,r,i,a,s,"throw",t)}a(void 0)}))},function(t,e){return i.apply(this,arguments)})},{key:"loadSpeech",value:function(t,e){return this.speeches[t]||(this.speeches[t]=new mi(e,this.engine,t)),this.speeches[t]}}],r&&xi(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ei(t){return Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ei(t)}function Ai(){Ai=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==Ei(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function ki(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function Si(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ti=function(){function t(e,r,n,i,o,a,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=e,this.hudcanvas=r,this.gamepadcanvas=i,this.mipmap=n,this.fileUpload=o,this.width=a,this.height=s,this.utils=c,this.resourceManager=new _i(this),this.renderManager=new oi(this),this.hud=new Dn(this),this.keyboard=new v(this),this.gamepad=new g(this),this.voice=new SpeechSynthesisUtterance,this.database=new Ln,this.store=new In,this.screenSize=this.screenSize.bind(this),this.render=this.render.bind(this),this.init=this.init.bind(this),this.close=this.close.bind(this)}var e,r,n,i;return e=t,r=[{key:"init",value:(n=Ai().mark((function t(e){var r,n,i;return Ai().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.hudcanvas.getContext("2d"),n=this.canvas.getContext("webgl2"),i=this.gamepadcanvas.getContext("2d"),n){t.next=5;break}throw new Error("WebGL : unable to initialize");case 5:if(r){t.next=7;break}throw new Error("Canvas : unable to initialize HUD");case 7:if(i){t.next=9;break}throw new Error("Gamepad : unable to initialize Mobile Canvas");case 9:return r.canvas.width=n.canvas.clientWidth,r.canvas.height=n.canvas.clientHeight,this.gl=n,this.ctx=r,this.gp=i,this.spritz=e,this.fullscreen=!1,this.time=(new Date).getTime(),this.keyboard.init(),this.hud.init(),this.renderManager.init(),this.gamepad.init(),this.touch=this.gamepad.listen.bind(this.gamepad),t.next=24,e.init(this);case 24:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,e=arguments;return new Promise((function(r,i){var o=n.apply(t,e);function a(t){ki(o,r,i,a,s,"next",t)}function s(t){ki(o,r,i,a,s,"throw",t)}a(void 0)}))},function(t){return i.apply(this,arguments)})},{key:"render",value:function(){this.requestId=requestAnimationFrame(this.render),this.hud.clearHud(),this.renderManager.clearScreen(),this.renderManager.activateShaderProgram(),this.gamepad.render(),this.spritz.render(this,(new Date).getTime()),this.isTransitioning&&this.renderManager.transition()}},{key:"close",value:function(){cancelAnimationFrame(this.requestId)}},{key:"setGreeting",value:function(t){console.log("setting GREETING"),this.globalStore.greeting=t}},{key:"speechSynthesis",value:function(t){var e,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"en",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=this.voice,s=null!==(e=window.speechSynthesis.getVoices())&&void 0!==e?e:[];a.voice=s[0],n&&(a.rate=n),i&&(a.volume=i),o&&(a.pitch=o),a.text=t,a.lang=r,window.speechSynthesis.speak(a)}},{key:"streamToVideo",value:function(t,e){var r=document.createElement("video");return e&&(r=e.current),r.srcObject=t,r.style.width=t.width,r.style.height=t.height,r.play(),r}},{key:"streamToImage",value:function(t,e){var r=document.createElement("video");return e&&(r=e.current),r.srcObject=t,r.style.width=t.width,r.style.height=t.height,r.play(),r}},{key:"streamToTexture",value:function(t,e){var r=document.createElement("video");return e&&(r=e.current),r.srcObject=t,r.style.width=t.width,r.style.height=t.height,r.play(),r}},{key:"screenSize",value:function(){return{width:this.canvas.clientWidth,height:this.canvas.clientHeight}}}],r&&Si(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Li(t){return Li="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Li(t)}function Oi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ci(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Oi(Object(r),!0).forEach((function(e){Pi(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Oi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Pi(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Mi(){Mi=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==Li(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Ii(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function ji(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){Ii(o,n,i,a,s,"next",t)}function s(t){Ii(o,n,i,a,s,"throw",t)}a(void 0)}))}}function Ri(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o=[],a=!0,s=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ni(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ni(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ni(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Bi=function(r){var n=r.width,i=r.height,o=r.SpritzProvider,a=r.class,s=r.zipData,c=(0,t.useRef)(),u=(0,t.useRef)(),l=(0,t.useRef)(),h=(0,t.useRef)(),f=(0,t.useRef)(),p=(0,t.useRef)(),d=(0,t.useRef)(),y=(0,t.useRef)(),g=(0,t.useRef)(),m=(0,t.useRef)(),v=(0,t.useRef)(),b=o.onKeyEvent,w=o.onTouchEvent,x=null,_=[],E=Ri((0,t.useState)(!1),2),A=E[0],k=E[1],S=Ri((0,t.useState)(!1),2),T=S[0],L=S[1],O=Ri((0,t.useState)(),2),C=O[0],P=O[1],M=Ri((0,t.useState)(),2),I=M[0],j=M[1],R=Ri((0,t.useState)({dynamicWidth:window.innerWidth,dynamicHeight:window.innerHeight}),2),N=R[0],B=R[1],D=function(){B({dynamicWidth:window.innerWidth,dynamicHeight:window.innerHeight})};function F(){return U.apply(this,arguments)}function U(){return(U=ji(Mi().mark((function t(){return Mi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Bn.load();case 2:document.fonts.add(Bn);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function z(t){document.body.addEventListener("touchstart",(function(e){e.target==t&&e.preventDefault()}),{passive:!1}),document.body.addEventListener("touchend",(function(e){e.target==t&&e.preventDefault()}),{passive:!1}),document.body.addEventListener("touchmove",(function(e){e.target==t&&e.preventDefault()}),{passive:!1})}function G(t,e,r,n,i,o){n=i.captureStream(),x.streamToVideo(n,m),new MediaRecorder(n);var a=x.streamToVideo(t.captureStream()),s=x.streamToVideo(e.captureStream());!function t(){o.drawImage(a,0,0,i.width,i.height),o.drawImage(s,0,0,i.width,i.height),requestAnimationFrame(t)}()}(0,t.useEffect)(ji(Mi().mark((function t(){var e,r,a,s,p,d,y;return Mi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return window.addEventListener("resize",D),e=c.current,r=u.current,a=f.current,s=l.current,p=h.current,d=g.current,y=d.getContext("2d"),x=new Ti(e,r,a,s,p,n,i),G(e,r,0,I,d,y),t.next=12,F();case 12:return t.next=14,x.init(o);case 14:return x.render(),t.abrupt("return",(function(){z(e),z(s),z(r),window.removeEventListener("resize",D),x.close()}));case 16:case"end":return t.stop()}}),t)}))),[o]);var W=3*N.dynamicWidth/4>1080?1080:N.dynamicHeight,V=3*N.dynamicWidth/4>1080?W:W-200,$=N.dynamicWidth>1920?1920:N.dynamicWidth,Y=N.dynamicWidth<=900,K={display:A?"none":"block",position:"absolute",top:0,left:0,zIndex:100,height:"2.5rem",padding:"0.5rem",opacity:.8},H={display:T?"none":"block",position:"absolute",top:0,right:0,zIndex:100,height:"2.5rem",padding:"0.5rem",opacity:.8};return e().createElement("div",{style:{marginLeft:"auto",marginRight:"auto"}},e().createElement("div",{style:{position:"relative",padding:"none",background:"slategrey",height:V+"px",width:$+"px"},onKeyDownCapture:function(t){return b(t.nativeEvent)},onKeyUpCapture:function(t){return b(t.nativeEvent)},tabIndex:0},e().createElement("div",{style:{display:T?"block":"none"},ref:v},e().createElement("video",{style:{display:A?"block":"none"},width:$/2,height:V/2,ref:m}),e().createElement("video",{style:{display:A?"none":"block"},width:$/2,height:V/2,ref:y})),e().createElement("div",{style:{display:T?"none":"block"}},e().createElement("canvas",{style:{position:"absolute",zIndex:1,top:0,left:0,maxHeight:"100vh"},ref:c,width:$,height:V,className:a}),e().createElement("canvas",{style:{position:"absolute",zIndex:2,top:0,left:0,background:"none",maxHeight:"100vh"},ref:u,width:$,height:V,className:a,onMouseUp:Y?null:function(t){return w(t.nativeEvent)},onMouseDown:Y?null:function(t){return w(t.nativeEvent)},onMouseMove:Y?null:function(t){return w(t.nativeEvent)}}),e().createElement("canvas",{style:{position:"relative",zIndex:5,top:0,left:0,background:"none",display:Y?"block":"none",maxHeight:"100vh"},ref:l,hidden:!Y,width:$,height:W,className:a,onMouseUp:function(t){return w(t.nativeEvent)},onMouseDown:function(t){return w(t.nativeEvent)},onMouseMove:function(t){return w(t.nativeEvent)},onTouchMoveCapture:function(t){return w(t.nativeEvent)},onTouchCancelCapture:function(t){return w(t.nativeEvent)},onTouchStartCapture:function(t){return w(t.nativeEvent)},onTouchEndCapture:function(t){return w(t.nativeEvent)}}),e().createElement("canvas",{style:{display:"none"},ref:f,width:256,height:256}),e().createElement("canvas",{width:$,height:V,ref:g,style:{display:"none"}}))),e().createElement("div",null,e().createElement("input",{type:"file",ref:h,src:null!=s?s:null,hidden:!0}),e().createElement("button",{style:K,ref:p,onClick:function(){return function(t,e){P(e),j(t),e.start(),e.onstart=function(){k(!0)},e.ondataavailable=function(t){t.data.size&&_.push(t.data)},e.onstop=function(t){if(_.length){k(!1);var e=new Blob(_),r=URL.createObjectURL(e),n=y.current;n.controls=!0,n.src=r,n.onend=function(){URL.revokeObjectURL(r)},_=[]}}}(I,C)}},"Record Gameplay"),e().createElement("button",{style:Ci(Ci({},K),{},{display:A?"block":"none"}),ref:p,onClick:function(){return function(t){y.current.pause(),null==t||t.stop()}(C)}},"Stop Recording"),e().createElement("button",{style:Ci({},H),ref:d,onClick:function(){L(!0)}},"Show Recording"),e().createElement("button",{style:Ci(Ci({},H),{},{display:T?"block":"none"}),ref:d,onClick:function(){L(!1)}},"Show Game")))};Bi.propTypes={width:a().number.isRequired,height:a().number.isRequired,SpritzProvider:a().object.isRequired,class:a().string.isRequired};const Di=Bi;var Fi=r(3162),Ui=r(5733),zi=r.n(Ui);function Gi(t){var e=this.gl;return console.log({msg:"made it"}),t.hblurBuffer=e.createFramebuffer(),t.dofUniformBuffer=e.createBuffer(),t.texelOffsetLocation=e.getUniformLocation(t,"uTexelOffset"),t.textureLocation=e.getUniformLocation(t,"uColor"),t.depthLocation=e.getUniformLocation(t,"uDepth"),t.quadArray=e.createVertexArray(),e.bindVertexArray(t.quadArray),t.quadPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t.quadPositionBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,1,-1,-1,1,-1,-1,1,1,-1,1,1]),e.STATIC_DRAW),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(0),t.depthTarget=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t.depthTarget),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texStorage2D(e.TEXTURE_2D,1,e.DEPTH_COMPONENT16,e.drawingBufferWidth,e.drawingBufferHeight),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,t.depthTarget,0),e.bindFramebuffer(e.FRAMEBUFFER,t.hblurBuffer),t.hblurTarget=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t.hblurTarget),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8,e.drawingBufferWidth,e.drawingBufferHeight),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.hblurTarget,0),e.bindFramebuffer(e.FRAMEBUFFER,null),t.draw=function(){e.uniform1i(t.depthLocation,2),e.bindFramebuffer(e.FRAMEBUFFER,t.hblurBuffer),e.bindVertexArray(t.quadArray),e.bindBufferBase(e.UNIFORM_BUFFER,2,t.dofUniformBuffer),e.bindBuffer(e.UNIFORM_BUFFER,t.dofUniformBuffer),e.uniform1i(t.textureLocation,1),e.uniform2fv(t.texelOffsetLocation,[1,0]),e.drawArrays(e.TRIANGLES,0,6),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindVertexArray(t.quadArray),e.uniform1i(t.textureLocation,3),e.uniform2fv(t.texelOffsetLocation,[0,1]),e.drawArrays(e.TRIANGLES,0,6)},t}var Wi=r(4180),Vi=r(6185),$i=r(1937);function Yi(t){return Yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yi(t)}function Ki(){Ki=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==Yi(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Hi(t,e,r){return Hi=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&Zi(i,r.prototype),i},Hi.apply(null,arguments)}function Zi(t,e){return Zi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Zi(t,e)}function Xi(t){return function(t){if(Array.isArray(t))return qi(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return qi(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qi(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qi(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ji(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function Qi(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){Ji(o,n,i,a,s,"next",t)}function s(t){Ji(o,n,i,a,s,"throw",t)}a(void 0)}))}}function to(t,e,r){return eo.apply(this,arguments)}function eo(){return eo=Qi(Ki().mark((function t(e,r,n){var i,o,a,c,u=this;return Ki().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("loading map...."),i="string"==typeof e.sprites?e.sprites:e.sprites.map((function(t){var e;return{id:t.id,type:t.type,pos:Hi(s.OW,Xi(t.pos)),facing:Wi.Nm[t.facing],zones:null!==(e=t.zones)&&void 0!==e?e:null}})),console.log("loading map...."),o=e.scenes.map((function(t){return{id:t.id,actions:t.actions.map((function(t){return t.trigger?{trigger:t.trigger,scope:u}:{sprite:t.sprite,action:t.action,args:t.args,scope:u}})),scope:u}})),console.log("loading map...."),t.next=7,Promise.all(e.scripts.map(function(){var t=Qi(Ki().mark((function t(e){var r,i,o;return Ki().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.file("triggers/".concat(e.trigger,".js")).async("string");case 3:return r=t.sent.replace(/\};/,"}"),i="\n        ((_this)=>{return{\n          id: '"+e.id+"',\n          trigger: "+r+",\n        }})\n      ",o=eval.call(u,i).call(u,u),t.abrupt("return",o);case 9:t.prev=9,t.t0=t.catch(0),console.error(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(e){return t.apply(this,arguments)}}()));case 7:return a=t.sent,c=e.objects.map((function(t){return{id:t.id,type:t.type,mtl:t.mtl,useScale:t.useScale?Hi(s.OW,Xi(t.useScale)):null,pos:t.pos?Hi(s.OW,Xi(t.pos)):null,rotation:t.rotation?Hi(s.OW,Xi(t.rotation)):null}})),console.log("loading map...."),t.abrupt("return",{bounds:e.bounds,tileset:e.tileset,cells:r,sprites:i,scenes:o,scripts:a,objects:c,lights:e.lights});case 11:case"end":return t.stop()}}),t)}))),eo.apply(this,arguments)}function ro(t,e){if("string"==typeof t)return t;var r=[];return t.forEach((function(t,n){var i=t.length;t.forEach((function(t,o){r[n*i+o]=e[t]}))})),r}function no(t){return no="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},no(t)}function io(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function oo(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?io(Object(r),!0).forEach((function(e){ao(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):io(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ao(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function so(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function co(t,e,r){return co=go()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&po(i,r.prototype),i},co.apply(null,arguments)}function uo(){uo=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==no(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function lo(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function ho(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){lo(o,n,i,a,s,"next",t)}function s(t){lo(o,n,i,a,s,"throw",t)}a(void 0)}))}}function fo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function po(t,e){return po=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},po(t,e)}function yo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function go(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function mo(t){return mo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},mo(t)}var vo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&po(t,e)}(x,t);var e,n,i,o,a,c,u,l,h,f,p,d,y,g,m,v,b,w=(v=x,b=go(),function(){var t,e=mo(v);if(b){var r=mo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===no(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return yo(t)}(this,t)});function x(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,x),(r=w.call(this)).spritzName=e.id,r.id=t,r.world=e,r.data={},r.spriteDict={},r.spriteList=[],r.objectDict={},r.objectList=[],r.lights=[],r.spritz=[],r.lastKey=Date.now(),r.engine=e.engine,r.onLoadActions=new si.Z,r.spriteLoader=new $i.jf(e.engine),r.objectLoader=new $i.Gq(e.engine),r.EventLoader=$i.q1,r.tsLoader=new $i.e5(e.engine),r.audio=null,r.onTilesetDefinitionLoaded=r.onTilesetDefinitionLoaded.bind(yo(r)),r.onTilesetOrSpriteLoaded=r.onTilesetOrSpriteLoaded.bind(yo(r)),r.loadObjectFromZip=r.loadObjectFromZip.bind(yo(r),yo(r)),r.loadSpriteFromZip=r.loadSpriteFromZip.bind(yo(r),yo(r)),r.loadSprite=r.loadSprite.bind(yo(r),yo(r)),r.loadObject=r.loadObject.bind(yo(r),yo(r)),r.checkInput=r.checkInput.bind(yo(r)),r}return e=x,n=[{key:"loadRemote",value:(m=ho(uo().mark((function t(){var e,r,n=this;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(Vi.Z.zoneRequestUrl(this.id));case 2:if(!(e=t.sent).ok){t.next=31;break}return t.prev=4,t.next=7,e.json();case 7:return r=t.sent,this.bounds=r.bounds,this.size=[r.bounds[2]-r.bounds[0],r.bounds[3]-r.bounds[1]],this.cells="function"==typeof r.cells?r.cells(this.bounds,this):r.cells,this.sprites="function"==typeof r.sprites?r.sprites(this.bounds,this):r.sprites,t.next=14,this.tsLoader.load(r.tileset,this.spritzName);case 14:if(this.tileset=t.sent,this.tileset.runWhenDefinitionLoaded(this.onTilesetDefinitionLoaded.bind(this)),this.tileset.runWhenLoaded(this.onTilesetOrSpriteLoaded.bind(this)),!r.sprites){t.next=20;break}return t.next=20,Promise.all(r.sprites.map(this.loadSprite.bind(this)));case 20:if(!r.objects){t.next=23;break}return t.next=23,Promise.all(r.objects.map(this.loadObject.bind(this)));case 23:this.spriteList.forEach((function(t){return t.runWhenLoaded(n.onTilesetOrSpriteLoaded.bind(n))})),this.objectList.forEach((function(t){return t.runWhenLoaded(n.onTilesetOrSpriteLoaded.bind(n))})),t.next=31;break;case 27:t.prev=27,t.t0=t.catch(4),console.error("Error parsing zone "+this.id),console.error(t.t0);case 31:case"end":return t.stop()}}),t,this,[[4,27]])}))),function(){return m.apply(this,arguments)})},{key:"load",value:(g=ho(uo().mark((function t(){var e,n;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e=r(7640)("./"+this.spritzName+"/maps/"+this.id+"/map.jsx").default,Object.assign(this,e),"function"==typeof this.cells&&(this.cells=this.cells(this.bounds,this)),this.audioSrc&&(this.audio=this.engine.resourceManager.audioLoader.load(this.audioSrc,!0)),this.size=[this.bounds[2]-this.bounds[0],this.bounds[3]-this.bounds[1]],t.next=8,this.tsLoader.load(this.tileset,this.spritzName);case 8:return this.tileset=t.sent,this.tileset.runWhenDefinitionLoaded(this.onTilesetDefinitionLoaded.bind(this)),this.tileset.runWhenLoaded(this.onTilesetOrSpriteLoaded.bind(this)),"function"==typeof this.sprites&&(this.sprites=this.sprites(this.bounds,this)),n=this,t.next=15,Promise.all(n.sprites.map(n.loadSprite));case 15:return t.next=17,Promise.all(n.objects.map(n.loadObject));case 17:n.spriteList.forEach((function(t){return t.runWhenLoaded(n.onTilesetOrSpriteLoaded)})),n.objectList.forEach((function(t){return t.runWhenLoaded(n.onTilesetOrSpriteLoaded)})),t.next=25;break;case 21:t.prev=21,t.t0=t.catch(0),console.error("Error parsing zone "+this.id),console.error(t.t0);case 25:case"end":return t.stop()}}),t,this,[[0,21]])}))),function(){return g.apply(this,arguments)})},{key:"loadTriggerFromZip",value:(y=ho(uo().mark((function t(e,r){var n;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.file("triggers/".concat(e,".js")).async("string");case 2:return n=t.sent,t.abrupt("return",eval.call(this,n));case 4:case"end":return t.stop()}}),t,this)}))),function(t,e){return y.apply(this,arguments)})},{key:"loadZoneFromZip",value:(d=ho(uo().mark((function t(e,r,n){var i,o,a,s,c,u,l,h,f,p=this,d=arguments;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=d.length>3&&void 0!==d[3]&&d[3],o=this,console.log("loading zip"),t.prev=3,!e.extends){t.next=13;break}return console.log("extendings"),a={},console.log({zoneJson:e,cellJson:r,zip:n}),t.next=10,Promise.all(e.extends.map(function(){var t=ho(uo().mark((function t(e){var r;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=JSON,t.next=3,n.file("maps/"+e+"/map.json").async("string");case 3:t.t1=t.sent,r=t.t0.parse.call(t.t0,t.t1),a=(0,Wi.Ee)(a,r),console.log(JSON.parse(JSON.stringify(a)));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 10:e.extends=null,Object.assign(a,e),e=a;case 13:if(console.log({zoneJson:e}),!r.extends){t.next=19;break}return s=[],t.next=18,Promise.all(r.extends.map(function(){var t=ho(uo().mark((function t(e){var r;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=JSON,t.next=3,n.file("maps/"+e+"/cells.json").async("string");case 3:t.t1=t.sent,r=t.t0.parse.call(t.t0,t.t1),s=r.cells?s.concat(r.cells):s.concat(r);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 18:r=s.concat(r.cells);case 19:if(console.log({cellJson:r}),!e.menu){t.next=26;break}return c={},t.next=24,Promise.all(Object.keys(e.menu).map(function(){var t=ho(uo().mark((function t(r){var i;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((i=e.menu[r]).id=r,!i.onOpen){t.next=6;break}return t.next=5,o.loadTriggerFromZip(i.onOpen,n);case 5:i.onOpen=t.sent.bind(o,o);case 6:if(!i.trigger){t.next=10;break}return t.next=9,o.loadTriggerFromZip(i.trigger,n);case 9:i.trigger=t.sent.bind(o,o);case 10:c[r]=i;case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 24:this.menus=c,this.world.startMenu(this.menus);case 26:return t.prev=26,t.next=29,this.tsLoader.loadFromZip(n,e.tileset,this.spritzName);case 29:return u=t.sent,console.log("tileset"),l=ro(r,u.tiles),console.log("cells"),t.next=35,to.call(this,e,l,n);case 35:h=t.sent,console.log("map"),Object.assign(this,h),console.log("map assign"),t.next=45;break;case 41:t.prev=41,t.t0=t.catch(26),console.log(this),console.error({msg:"error reading in zone & cell data",e:t.t0});case 45:try{"string"==typeof this.cells&&(this.cells=eval.call(this,this.cells).call(this,this.bounds,this))}catch(t){console.error({msg:"error loading cell function",e:t})}if(t.prev=46,console.log({msg:"audio....",src:e.audioSrc,scope:this}),!e.audioSrc){t.next=52;break}return t.next=51,this.engine.resourceManager.audioLoader.loadFromZip(n,e.audioSrc,!0);case 51:this.audio=t.sent;case 52:t.next=57;break;case 54:t.prev=54,t.t1=t.catch(46),console.error({msg:"error loading audio track",e:t.t1});case 57:try{this.lights=null!==(f=e.lights)&&void 0!==f?f:[],this.lights.forEach((function(t){return p.engine.renderManager.lightManager.addLight(t.id,t.pos,t.color,t.attenuation,t.direction,t.density,t.scatteringCoefficients,t.enabled)})),console.log({msg:"lights....",lm:this.engine.renderManager.lightManager})}catch(t){console.error({msg:"error loading lights",e:t})}try{this.tileset=u,console.log({msg:"tileset....",tileset:this.tileset}),this.size=[this.bounds[2]-this.bounds[0],this.bounds[3]-this.bounds[1]]}catch(t){console.error({msg:"error loading tileset",e:t})}try{"string"==typeof this.sprites&&(this.sprites=eval.call(o,o.sprites).call(o,o.bounds,o))}catch(t){console.error({msg:"error loading sprite function",e:t})}return t.prev=60,t.next=63,Promise.all(o.sprites.map(function(){var t=ho(uo().mark((function t(e){var r;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.loadSpriteFromZip(e,n,i);case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 63:t.next=68;break;case 65:t.prev=65,t.t2=t.catch(60),console.error({msg:"error loading sprites from map",e:t.t2});case 68:return t.prev=68,t.next=71,Promise.all(o.objects.map((function(t){return o.loadObjectFromZip(t,n)})));case 71:t.next=76;break;case 73:t.prev=73,t.t3=t.catch(68),console.error({msg:"error loading objects from map",e:t.t3});case 76:this.tileset.runWhenDefinitionLoaded(this.onTilesetDefinitionLoaded.bind(this)),this.tileset.runWhenLoaded(this.onTilesetOrSpriteLoaded.bind(this)),o.spriteList.forEach((function(t){return t.runWhenLoaded(o.onTilesetOrSpriteLoaded)})),o.objectList.forEach((function(t){return t.runWhenLoaded(o.onTilesetOrSpriteLoaded)})),t.next=86;break;case 82:t.prev=82,t.t4=t.catch(3),console.error("Error parsing json zone "+this.id),console.error(t.t4);case 86:case"end":return t.stop()}}),t,this,[[3,82],[26,41],[46,54],[60,65],[68,73]])}))),function(t,e,r){return d.apply(this,arguments)})},{key:"runWhenDeleted",value:function(){var t=this;this.lights.forEach((function(e){return t.engine.renderManager.lightManager.removeLight(e.id)}))}},{key:"onTilesetDefinitionLoaded",value:function(){this.vertexPosBuf=[],this.vertexTexBuf=[],this.walkability=[];for(var t=0,e=0;t<this.size[1];t++){for(var r=[],n=[],i=0;i<this.size[0];i++,e++){var o=this.cells[e];this.walkability[e]=Wi.Nm.All;for(var a=Math.floor(o.length/3),s=0;s<a;s++){var c=[this.bounds[0]+i,this.bounds[1]+t,o[3*s+2]];this.walkability[e]&=this.tileset.getWalkability(o[3*s]),r=r.concat(this.tileset.getTileVertices(o[3*s],c)),n=n.concat(this.tileset.getTileTexCoords(o[3*s],o[3*s+1]))}o.length==3*a+1&&(this.walkability[e]=o[3*a])}this.vertexPosBuf[t]=this.engine.renderManager.createBuffer(r,this.engine.gl.STATIC_DRAW,3),this.vertexTexBuf[t]=this.engine.renderManager.createBuffer(n,this.engine.gl.STATIC_DRAW,2)}}},{key:"onTilesetOrSpriteLoaded",value:function(){!this.loaded&&this.tileset.loaded&&this.spriteList.every((function(t){return t.loaded}))&&this.objectList.every((function(t){return t.loaded}))&&(this.loaded=!0,this.loadScripts(!0),this.onLoadActions.run())}},{key:"loadScripts",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.world.isPaused){var r=this;this.scripts.forEach((function(n){"load-spritz"===n.id&&e&&t.runWhenLoaded(n.trigger.bind(r))}))}}},{key:"loadObject",value:(p=ho(uo().mark((function t(e,r){var n;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.zone=e,this.objectDict[r.id]||e.objectDict[r.id]){t.next=7;break}return t.next=4,this.objectLoader.load(r,(function(t){return t.onLoad(t)}));case 4:n=t.sent,this.objectDict[r.id]=n,this.objectList.push(n);case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return p.apply(this,arguments)})},{key:"loadObjectFromZip",value:(f=ho(uo().mark((function t(e,r,n){var i;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.zone=e,this.objectDict[r.id]||e.objectDict[r.id]){t.next=7;break}return t.next=4,this.objectLoader.loadFromZip(n,r,function(){var t=ho(uo().mark((function t(e){return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.onLoadFromZip(e,n);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 4:i=t.sent,this.objectDict[r.id]=i,this.objectList.push(i);case 7:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return f.apply(this,arguments)})},{key:"loadSprite",value:(h=ho(uo().mark((function t(e,r){var n;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.zone=e,this.spriteDict[r.id]||e.spriteDict[r.id]){t.next=7;break}return t.next=4,this.spriteLoader.load(r.type,this.spritzName,(function(t){return t.onLoad(r)}));case 4:n=t.sent,this.spriteDict[r.id]=n,this.spriteList.push(n);case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return h.apply(this,arguments)})},{key:"loadSpriteFromZip",value:(l=ho(uo().mark((function t(e,r,n){var i;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.zone=e,this.spriteDict[r.id]||e.spriteDict[r.id]){t.next=7;break}return t.next=4,this.spriteLoader.loadFromZip(n,r.type,this.spritzName,function(){var t=ho(uo().mark((function t(e){return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.onLoadFromZip(r,n);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 4:i=t.sent,this.spriteDict[r.id]=i,this.spriteList.push(i);case 7:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return l.apply(this,arguments)})},{key:"addSprite",value:function(t){t.zone=this,this.spriteDict[t.id]=t,this.spriteList.push(t)}},{key:"removeSprite",value:function(t){this.spriteList=this.spriteList.filter((function(e){if(e.id!==t)return!0;e.removeAllActions()})),delete this.spriteDict[t]}},{key:"removeAllSprites",value:function(){this.spriteList=[],this.spriteDict={}}},{key:"getSpriteById",value:function(t){return this.spriteDict[t]}},{key:"addPortal",value:function(t,e,r){if(this.portals.length>0&&0===this.getHeight(e,r)){var n=this.portals.pop();n.pos=co(s.OW,[e,r,this.getHeight(e,r)]),t.push(n)}else if(this.portals.length>0&&e*r%Math.abs(3)&&0===this.getHeight(e,r)){var i=this.portals.shift();i.pos=co(s.OW,[e,r,this.getHeight(e,r)]),t.push(i)}return t}},{key:"getHeight",value:function(t,e){if(!this.isInZone(t,e))return console.error("Requesting height for ["+t+", "+e+"] outside zone bounds"),0;for(var r=Math.floor(t),n=Math.floor(e),i=[t-r,e-n],o=function(t,e){var r=[t[1][0]-t[0][0],t[1][1]-t[0][1]],n=[t[2][0]-t[0][0],t[2][1]-t[0][1]],i=1/(r[0]*n[1]-r[1]*n[0]),o=[i*n[1],-i*n[0],-i*r[1],i*r[0]];return[r=(e[0]-t[0][0])*o[0]+(e[1]-t[0][1])*o[1],n=(e[0]-t[0][0])*o[2]+(e[1]-t[0][1])*o[3]]},a=this.cells[(n-this.bounds[1])*this.size[0]+r-this.bounds[0]],s=Math.floor(a.length/3),c=0;c<s;c++){var u=this.tileset.getTileWalkPoly(a[3*c]);if(u)for(var l=0;l<u.length;l++){var h=o(u[l],i),f=h[0]+h[1];if(f<=1)return a[3*c+2]+(1-f)*u[l][0][2]+h[0]*u[l][1][2]+h[1]*u[l][2][2]}}return a[2]}},{key:"drawRow",value:function(t){this.engine.renderManager.bindBuffer(this.vertexPosBuf[t],this.engine.renderManager.shaderProgram.aVertexPosition),this.engine.renderManager.bindBuffer(this.vertexTexBuf[t],this.engine.renderManager.shaderProgram.aTextureCoord),this.tileset.texture.attach(),this.engine.renderManager.shaderProgram.setMatrixUniforms(),this.engine.gl.drawArrays(this.engine.gl.TRIANGLES,0,this.vertexPosBuf[t].numItems)}},{key:"draw",value:function(){var t,e;if(this.loaded){null===(t=this.spriteList)||void 0===t||t.sort((function(t,e){return t.pos.y-e.pos.y})),null===(e=this.objectList)||void 0===e||e.sort((function(t,e){return t.pos.y-e.pos.y})),this.engine.renderManager.mvPushMatrix(),this.engine.renderManager.camera.setCamera();var r=0,n=0;switch(this.engine.renderManager.camera.cameraDir){case"N":case"NE":case"NW":case"E":for(var i=0;i<this.size[1];i++){for(this.drawRow(i);n<this.objectList.length&&this.objectList[n].pos.y-this.bounds[1]<=i;)this.objectList[n++].draw();for(;r<this.spriteList.length&&this.spriteList[r].pos.y-this.bounds[1]<=i;)this.spriteList[r++].draw(this.engine)}break;case"W":case"S":case"SW":case"SE":for(var o=this.size[1]-1;o>=0;o--){for(this.drawRow(o);n<this.objectList.length&&this.bounds[1]-this.objectList[n].pos.y<=o;)this.objectList[n++].draw();for(;r<this.spriteList.length&&this.bounds[1]-this.spriteList[r].pos.y<=o;)this.spriteList[r++].draw(this.engine)}}for(;n<this.objectList.length;)this.objectList[n++].draw();for(;r<this.spriteList.length;)this.spriteList[r++].draw(this.engine);this.engine.renderManager.mvPopMatrix()}}},{key:"tick",value:function(t,e){this.loaded&&!e&&(this.checkInput(t),this.spriteList.forEach(function(){var e=ho(uo().mark((function e(r){return uo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.tickOuter(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}},{key:"checkInput",value:(u=ho(uo().mark((function t(e){return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e>this.lastKey+100)){t.next=10;break}this.engine.gamepad.checkInput(),this.lastKey=e,t.t0=this.engine.keyboard.lastPressedKey("o"),t.next="o"===t.t0?6:10;break;case 6:return t.next=8,this.moveSprite("monster",[7,7,this.getHeight(7,7)],!1);case 8:return this.audio&&(console.log(this.audio),this.audio.playAudio()),t.abrupt("break",10);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"isInZone",value:function(t,e){return t>=this.bounds[0]&&e>=this.bounds[1]&&t<this.bounds[2]&&e<this.bounds[3]}},{key:"isWalkable",value:function(t,e,r){if(!this.isInZone(t,e))return null;for(var n in this.spriteDict){if(!this.spriteDict[n].walkable&&this.spriteDict[n].pos.x===t&&this.spriteDict[n].pos.y===e&&!this.spriteDict[n].blocking&&this.spriteDict[n].override)return!0;if(!this.spriteDict[n].walkable&&this.spriteDict[n].pos.x===t&&this.spriteDict[n].pos.y===e&&this.spriteDict[n].blocking)return!1}for(var i in this.objectDict){if(!this.objectDict[i].walkable&&this.within(t,this.objectDict[i].pos.x-this.objectDict[i].scale.x*(this.objectDict[i].size.x/2),this.objectDict[i].pos.x)&&this.within(e,this.objectDict[i].pos.y-this.objectDict[i].scale.y*(this.objectDict[i].size.y/2),this.objectDict[i].pos.y)&&!this.objectDict[i].blocking&&this.objectDict[i].override)return!0;if(!this.objectDict[i].walkable&&(this.objectDict[i].pos.x===t&&this.objectDict[i].pos.y===e||this.within(t,this.objectDict[i].pos.x-this.objectDict[i].scale.x*(this.objectDict[i].size.x/2),this.objectDict[i].pos.x,!0)&&this.within(e,this.objectDict[i].pos.y-this.objectDict[i].scale.y*(this.objectDict[i].size.y/2),this.objectDict[i].pos.y,!0))&&this.objectDict[i].blocking)return!1}return!!(this.walkability[(e-this.bounds[1])*this.size[0]+t-this.bounds[0]]&r)}},{key:"within",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return!!(n&&t>=e&&t<=r)||!n&&t>e&&t<r}},{key:"triggerScript",value:function(t){var e=this;this.scripts.forEach((function(r){r.id===t&&e.runWhenLoaded(r.trigger.bind(e))}))}},{key:"moveSprite",value:(c=ho(uo().mark((function t(e,r){var n,i=this,o=arguments;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>2&&void 0!==o[2]&&o[2],t.abrupt("return",new Promise(function(){var t=ho(uo().mark((function t(o,a){var s;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=i.getSpriteById(e),t.next=3,s.addAction(new $i.aW(i.engine,"patrol",[s.pos.toArray(),r,n?200:600,i],s,o));case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()));case 2:case"end":return t.stop()}}),t)}))),function(t,e){return c.apply(this,arguments)})},{key:"spriteDialogue",value:(a=ho(uo().mark((function t(e,r){var n,i=this,o=arguments;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>2&&void 0!==o[2]?o[2]:{autoclose:!0},t.abrupt("return",new Promise(function(){var t=ho(uo().mark((function t(o,a){var s;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=i.getSpriteById(e),t.next=3,s.addAction(new $i.aW(i.engine,"dialogue",[r,!1,n],s,o));case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()));case 2:case"end":return t.stop()}}),t)}))),function(t,e){return a.apply(this,arguments)})},{key:"runActions",value:(o=ho(uo().mark((function t(e){var r;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this,t.next=3,e.reduce(function(){var t=ho(uo().mark((function t(e,n){return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.then(ho(uo().mark((function t(){return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=ho(uo().mark((function t(e,i){var o,a,s,c;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n||e(),t.prev=1,n.scope||(n.scope=r),!n.sprite){t.next=10;break}if(!(o=n.scope.getSpriteById(n.sprite))||!n.action){t.next=10;break}return a=n.args,s=a.pop(),t.next=10,o.addAction(new $i.aW(r.engine,n.action,[].concat(function(t){if(Array.isArray(t))return so(t)}(u=a)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(u)||function(t,e){if(t){if("string"==typeof t)return so(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?so(t,e):void 0}}(u)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[oo({},s)]),o,(function(){return e(r)})));case 10:if(!n.trigger){t.next=15;break}if(!(c=n.scope.getSpriteById("avatar"))||!n.trigger){t.next=15;break}return t.next=15,c.addAction(new $i.aW(r.engine,"script",[n.trigger,n.scope,function(){return e(r)}],c));case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(1),i(t.t0);case 20:case"end":return t.stop()}var u}),t,null,[[1,17]])})));return function(e,r){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})))).catch((function(t){console.warn("err",t.message)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),Promise.resolve());case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"playCutScen",value:(i=ho(uo().mark((function t(e){var r,n,i=arguments;return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this,(r=i.length>1&&void 0!==i[1]?i[1]:null)||(r=n.spritz),r.forEach(function(){var t=ho(uo().mark((function t(i){return uo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,i.currentStep||(i.currentStep=0),!(i.currentStep>r.length)){t.next=4;break}return t.abrupt("return");case 4:if(i.id!==e){t.next=7;break}return t.next=7,n.runActions(i.actions);case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.error(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(e){return t.apply(this,arguments)}}());case 4:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})}],n&&fo(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),x}(ci.Z);function bo(t){return bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bo(t)}function wo(t){return function(t){if(Array.isArray(t))return xo(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return xo(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?xo(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xo(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _o(){_o=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==bo(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Eo(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function Ao(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){Eo(o,n,i,a,s,"next",t)}function s(t){Eo(o,n,i,a,s,"throw",t)}a(void 0)}))}}function ko(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var So=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=r,this.engine=e,this.zoneDict={},this.zoneList=[],this.spriteDict={},this.spriteList=[],this.objectDict={},this.objectList=[],this.tilesetDict={},this.tilesetList=[],this.eventList=[],this.eventDict={},this.lastKey=(new Date).getTime(),this.isPaused=!0,this.afterTickActions=new si.Z,this.sortZones=this.sortZones.bind(this),this.canWalk=this.canWalk.bind(this),this.pathFind=this.pathFind.bind(this),this.menuConfig={start:{onOpen:function(t){t.completed=!0}}}}var e,r,n,i;return e=t,r=[{key:"runAfterTick",value:function(t){this.afterTickActions.add(t)}},{key:"sortZones",value:function(){this.zoneList.sort((function(t,e){return t.bounds[1]-e.bounds[1]}))}},{key:"loadZoneFromZip",value:(i=Ao(_o().mark((function t(e,r){var n,i,o,a=arguments;return _o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.length>2&&void 0!==a[2]&&a[2]||!this.zoneDict[e]){t.next=3;break}return t.abrupt("return",this.zoneDict[e]);case 3:return console.log("Loading Zone from Zip:",e),t.t0=JSON,t.next=7,r.file("maps/"+e+"/map.json").async("string");case 7:return t.t1=t.sent,n=t.t0.parse.call(t.t0,t.t1),t.t2=JSON,t.next=12,r.file("maps/"+e+"/cells.json").async("string");case 12:return t.t3=t.sent,i=t.t2.parse.call(t.t2,t.t3),o=new vo(e,this),t.next=17,o.loadZoneFromZip(n,i,r);case 17:return this.zoneList.map((function(t){t.audio&&t.audio.pauseAudio()})),o.audio&&(console.log(o.audio),o.audio.playAudio()),this.zoneDict[e]=o,this.zoneList.push(o),o.runWhenLoaded(this.sortZones),t.abrupt("return",o);case 23:case"end":return t.stop()}}),t,this)}))),function(t,e){return i.apply(this,arguments)})},{key:"loadZone",value:(n=Ao(_o().mark((function t(e){var r,n,i=arguments;return _o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=i.length>1&&void 0!==i[1]&&i[1],i.length>2&&void 0!==i[2]&&i[2]||!this.zoneDict[e]){t.next=4;break}return t.abrupt("return",this.zoneDict[e]);case 4:if(n=new vo(e,this),!r){t.next=10;break}return t.next=8,n.loadRemote();case 8:t.next=12;break;case 10:return t.next=12,n.load();case 12:return this.zoneList.map((function(t){t.audio&&t.audio.pauseAudio()})),n.audio&&(console.log(n.audio),n.audio.playAudio()),this.zoneDict[e]=n,this.zoneList.push(n),n.runWhenLoaded(this.sortZones),t.abrupt("return",n);case 18:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"removeZone",value:function(t){this.zoneList=this.zoneList.filter((function(e){if(e.id!==t)return!0;e.audio&&e.audio.pauseAudio(),e.removeAllSprites(),e.runWhenDeleted()})),delete this.zoneDict[t]}},{key:"removeAllZones",value:function(){this.zoneList.map((function(t){t.audio&&t.audio.pauseAudio(),t.removeAllSprites(),t.runWhenDeleted()})),this.zoneList=[],this.zoneDict={}}},{key:"tick",value:function(t){for(var e in this.zoneDict){var r;null===(r=this.zoneDict[e])||void 0===r||r.tick(t,this.isPaused)}this.afterTickActions.run(t)}},{key:"checkInput",value:function(t){if(t>this.lastKey+200){var e=this.engine.gamepad.checkInput();this.lastKey=t,this.engine.gamepad.keyPressed("start")&&(e.start=0),this.engine.gamepad.keyPressed("select")&&(e.select=0,this.engine.toggleFullscreen())}}},{key:"startMenu",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["start"];this.addEvent(new $i.q1(this.engine,"menu",[null!=t?t:this.menuConfig,e,!1,{autoclose:!1,closeOnEnter:!0}],this))}},{key:"addEvent",value:function(t){this.eventDict[t.id]&&this.removeAction(t.id),this.eventDict[t.id]=t,this.eventList.push(t)}},{key:"removeAction",value:function(t){this.eventList=this.eventList.filter((function(e){return e.id!==t})),delete this.eventDict[t]}},{key:"removeAllActions",value:function(){this.eventList=[],this.eventDict={}}},{key:"tickOuter",value:function(t){var e=this;this.checkInput(t),this.eventList.sort((function(t,e){var r=t.startTime-e.startTime;return r?t.id>e.id?1:-1:r}));var r=[];this.eventList.forEach((function(n){!n.loaded||n.startTime>t||n.pausable&&e.isPaused||n.tick(t)&&(r.push(n),n.onComplete())})),r.forEach((function(t){return e.removeAction(t.id)})),this.tick&&!this.isPaused&&this.tick(t)}},{key:"draw",value:function(){for(var t in this.zoneDict)this.zoneDict[t].draw(this.engine)}},{key:"zoneContaining",value:function(t,e){for(var r in this.zoneDict){var n=this.zoneDict[r];if(n.loaded&&n.isInZone(t,e))return n}return null}},{key:"pathFind",value:function(t,e){var r=[],n=!1,i=this,o=t[0],a=t[1];function s(t,o){var a=JSON.stringify([t[0],t[1]]);return!n&&(t[0]==e[0]&&t[1]==e[1]?(n=!0,i.canWalk(t,a,r)?[n,[].concat(wo(o),[e])]:[n,wo(o)]):!!i.canWalk(t,a,r)&&(r.push(a),i.getNeighbours.apply(i,wo(t)).sort((function(t,r){return Math.min(Math.abs(e[0]-t[0])-Math.abs(e[0]-r[0]),Math.abs(e[1]-t[1])-Math.abs(e[1]-r[1]))})).map((function(e){return s(e,[].concat(wo(o),[[t[0],t[1],600]]))})).filter((function(t){return t})).flat()))}return i.getNeighbours(o,a).sort((function(t,r){return Math.min(Math.abs(e[0]-t[0])-Math.abs(e[0]-r[0]),Math.abs(e[1]-t[1])-Math.abs(e[1]-r[1]))})).map((function(e){return s(e,[[t[0],t[1],600]])})).filter((function(t){return t[0]})).flat()}},{key:"getNeighbours",value:function(t,e){var r=[t,e+1,Wi.Nm.Up],n=[t,e-1,Wi.Nm.Down];return[r,[t-1,e,Wi.Nm.Left],[t+1,e,Wi.Nm.Right],n]}},{key:"canWalk",value:function(t,e,r){var n=this.zoneContaining.apply(this,wo(t));return!(r.indexOf(e)>=0||!n||!n.isWalkable.apply(n,wo(t))||!n.isWalkable(t[0],t[1],Wi.Nm.reverse(t[2])))}}],r&&ko(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function To(t){return To="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},To(t)}function Lo(){Lo=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==To(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Oo(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function Co(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){Oo(o,n,i,a,s,"next",t)}function s(t){Oo(o,n,i,a,s,"throw",t)}a(void 0)}))}}function Po(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mo(t,e,r){return e&&Po(t.prototype,e),r&&Po(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Io(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var jo=Mo((function t(){var e=this;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Io(this,"init",function(){var r=Co(Lo().mark((function r(n){var i;return Lo().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t._instance.engine=n,(i=t._instance.world=new So(n,"spritz")).zoneList.forEach((function(t){return t.runWhenLoaded((function(){return console.log("loading...done")}))})),i.startMenu({start:{text:"Start Game",prompt:"Please press the button to start...",x:n.screenSize().width/2-75,y:n.screenSize().height/2-50,w:150,h:75,quittable:!1,colours:{top:"#333",bottom:"#777",background:"#999"},onOpen:function(t){e.isPaused=!0},trigger:function(t){t.world.isPaused=!1,t.completed=!0}}});case 4:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}()),Io(this,"loadSpritzManifest",function(){var t=Co(Lo().mark((function t(e){return Lo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Io(this,"loadAvatar",function(){var t=Co(Lo().mark((function t(e,r){return Lo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()),Io(this,"exportAvatar",Co(Lo().mark((function t(){var e,r,n;return Lo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new Ui,r={},e.folder("pixos").file("avatar.json",JSON.stringify(r)),t.next=5,e.generateAsync({type:"blob"});case 5:n=t.sent,(0,Fi.saveAs)(n,"avatar.zip");case 7:case"end":return t.stop()}}),t)})))),Io(this,"render",(function(r,n){t._instance.world.tickOuter(n),t._instance.engine.renderManager.activateShaderProgram(),e.draw(r),Object.keys(e.effects).map((function(r){var n;t._instance.engine.renderManager.activateShaderEffectProgram(r),null===(n=e.effectPrograms[r])||void 0===n||n.draw()}))})),Io(this,"draw",(function(e){t._instance.world.draw(e)})),Io(this,"onKeyEvent",(function(e){"keydown"===e.type?t._instance.engine.keyboard.onKeyDown(e):t._instance.engine.keyboard.onKeyUp(e)})),Io(this,"onTouchEvent",(function(e){e.type,t._instance.engine.touch(e)})),this.shaders={fs:"\n  precision mediump int;\n  precision mediump float;\n\n  const float Near = 0.1;\n  const float Far = 50.0;\n\n  struct PointLight {\n    float enabled;\n    vec3 color;\n    vec3 position;\n    vec3 attenuation;\n    vec3 direction;\n    vec3 scatteringCoefficients;\n    float density;\n  };\n\n  float unpack(vec4 color) {\n    const vec4 bitShifts = vec4(1.0, 1.0 / 255.0, 1.0 / (255.0 * 255.0), 1.0 / (255.0 * 255.0 * 255.0));\n    return dot(color, bitShifts);\n  }\n\n  varying vec4 vWorldVertex;\n  varying vec3 vWorldNormal;\n  varying vec3 vTransformedNormal;\n  varying vec4 vPosition;\n  varying vec2 vTextureCoord;\n\n  varying vec3 vLighting;\n\n  uniform PointLight uLights[32];\n  uniform sampler2D uDepthMap;\n\n  uniform float runTransition;\n  uniform float useSampler;\n  uniform float useDiffuse;\n  uniform sampler2D uSampler;\n  uniform sampler2D uDiffuseMap;\n\n  uniform vec3 uDiffuse;\n  uniform vec3 uSpecular;\n  uniform float uSpecularExponent;\n\n  uniform vec3 uLightColor;\n  varying vec3 vFragPos;\n  varying vec3 vLightDir;\n  varying vec3 vViewDir;\n\n  float getAttenuation(PointLight light) {\n    float distance_from_light;\n    vec3 to_light;\n\n    to_light = light.position - vPosition.xyz;\n    distance_from_light = length(to_light);\n    \n    float attenuation = 1.0 / (\n        1.0 + light.attenuation.x\n        + light.attenuation.y * distance_from_light \n        + light.attenuation.z * pow(distance_from_light, 2.0)\n      );\n    return attenuation;\n  }\n\n  vec3 getReflectedLightColor(vec3 color) {\n    vec3 reflectedLightColor = vec3(0.0);\n  \n    for(int i = 0; i < 32; i++) {\n      if(uLights[i].enabled <= 0.5) continue;\n  \n      vec3 specular_color;\n      vec3 diffuse_color;\n      vec3 to_light;\n      vec3 reflection;\n      vec3 to_camera;\n      float cos_angle;\n      float attenuation;\n      vec3 normal;\n  \n      // Calculate a vector from the fragment location to the light source\n      to_light = normalize(uLights[i].position - vFragPos);\n      normal = normalize(vWorldNormal);\n  \n      // DIFFUSE calculations\n      if (useSampler == 1.0) {\n        cos_angle = 0.67; // billboard sprites\n        cos_angle += dot(to_camera, to_light);\n      } else {\n        cos_angle = dot(normal, to_light);\n        cos_angle = clamp(cos_angle, 0.0, 1.0);\n      }\n  \n      // Scale the color of this fragment based on its angle to the light.\n      diffuse_color = uLights[i].color * cos_angle;\n  \n      // SPECULAR calculations\n      reflection = 2.0 * dot(normal, to_light) * normal - to_light;\n      reflection = normalize(reflection);\n  \n      to_camera = normalize(vViewDir);\n  \n      cos_angle = dot(reflection, to_camera);\n      cos_angle = clamp(cos_angle, 0.0, 1.0);\n      specular_color = uLights[i].color * cos_angle;\n  \n      // ATTENUATION calculations\n      attenuation = getAttenuation(uLights[i]);\n  \n      // Combine and attenuate the colors from this light source\n      reflectedLightColor += attenuation * (diffuse_color + specular_color);\n    }\n  \n    return clamp(0.5 * color + reflectedLightColor, 0.0, 1.0);\n  }\n\n  // Diffuse Colour Calculation\n  vec3 calculateDiffuse() {\n    vec4 texelColors = texture2D(uDiffuseMap, vTextureCoord);\n    vec3 color = uDiffuse;\n    if(useDiffuse == 1.0) {\n      if(texelColors != vec4(0.0, 0.0, 0.0, 0.0)) {\n        color = texelColors.rgb + color;\n      }\n    }\n    return color;\n  }\n\n  // Sampler Texture Colour Calculation\n  vec3 calculateSampler(vec4 texelColors) {\n    vec3 color = texelColors.rgb;\n    if(texelColors.a < 0.1) discard;\n    return color;\n  }\n\n  // linearize depth\n  float LinearizeDepth(float depth) {\n    float z = depth * 2.0 - 1.0; // back to NDC \n    return (2.0 * Near * Far) / (Far + Near - z * (Far - Near));\n  }\n\n  // fog effect based on depth\n  vec4 fogEffect(vec4 color4) {\n    float depth = LinearizeDepth(gl_FragCoord.z) / Far;\n    vec4 depthVec4 = vec4(vec3(pow(depth, 1.4)), 1.0);\n    return (color4 * (1.0 - depth)) + depthVec4;\n  }\n\n  // Volumetric Calculation\n  vec4 volumetricCalculation(vec4 color4) {\n    vec3 finalColor;\n\n    for(int i = 0; i < 32; i++) {\n      if(uLights[i].enabled <= 0.5) continue;\n        \n      // Calculate the distance from the fragment to the light\n      float distance = length(uLights[i].position - vec3(vWorldVertex));\n\n      // directional lighting - not working atm\n      // if(length(uLights[i].direction) > 0.0){\n      //   // Calculate the angle between the light direction and the fragment\n      //   float cos_angle = dot(normalize(uLights[i].direction), normalize(vFragPos - uLights[i].position));\n      //   // If the fragment is not within the light cone, skip this light\n      //   if(cos_angle <= 0.0) continue;\n      // }\n\n      // Calculate the scattering effect\n      float scattering = exp(-uLights[i].density * distance);\n      vec3 scatteredLight = uLights[i].color * scattering * uLights[i].scatteringCoefficients;\n      // Combine the scattered light with the existing lighting\n      finalColor += scatteredLight;\n    }\n\n    return color4 * vec4(finalColor, 1.0);\n  }\n\n  void main(void) {\n    if(runTransition == 1.0) {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n      return;\n    }\n\n    if(useSampler == 1.0) { // sampler\n      vec4 texelColors = texture2D(uSampler, vTextureCoord);\n      vec3 color = calculateSampler(texelColors);\n      vec4 color4 = vec4(getReflectedLightColor(color), texelColors.a);\n      gl_FragColor = volumetricCalculation(vec4(color, texelColors.a)) * fogEffect(color4);\n    } else { // diffuse\n      vec3 color = calculateDiffuse();\n      vec4 color4 = vec4((getReflectedLightColor(color)), 1.0);\n      gl_FragColor = volumetricCalculation(vec4(color,1.0)) * fogEffect(color4);\n    }\n  }\n",vs:"\n  precision mediump float;\n\n  attribute vec3 aVertexPosition;\n  attribute vec3 aVertexNormal;\n  attribute vec2 aTextureCoord;\n  \n  uniform mat4 uModelMatrix;\n  uniform mat4 uViewMatrix;\n  uniform mat4 uProjectionMatrix;\n  uniform mat3 uNormalMatrix;\n  uniform mat3 uCamPos;\n\n  uniform vec3 uLightDirection;\n  uniform vec3 uCameraPosition;\n  varying vec3 vFragPos;\n  varying vec3 vLightDir;\n  varying vec3 vViewDir;\n\n  varying vec4 vWorldVertex;\n  varying vec3 vWorldNormal;\n  varying vec3 vTransformedNormal;\n  varying vec4 vPosition;\n  varying vec2 vTextureCoord;\n\n  uniform vec3 u_scale;\n\n  void main(void) {\n    vec3 scaledPosition = aVertexPosition * u_scale;\n\n    vWorldVertex = uModelMatrix * vec4(aVertexPosition, 1.0);\n    vPosition = uModelMatrix * vec4(scaledPosition, 1.0);\n    vTextureCoord = aTextureCoord;\n    vTransformedNormal = uNormalMatrix * aVertexNormal;\n    vWorldNormal = normalize(mat3(uModelMatrix) * aVertexNormal);\n\n    // Pass fragment position to fragment shader\n    vFragPos = vec3(uModelMatrix * vec4(scaledPosition, 1.0));\n    \n    // Calculate view direction and pass to fragment shader\n    vViewDir = normalize(uCameraPosition - vFragPos);\n\n    gl_Position = uProjectionMatrix * uViewMatrix * vPosition;\n  }\n"},this.effects={blur:{id:"blur",fs:"\n  precision highp float;\n  \n  const float MAX_BLUR = 20.0;\n  const float NEAR = 0.1;\n  const float FAR = 10.0;\n  const float FOCAL_LENGTH = 1.0;\n  const float FOCUS_DISTANCE = 2.0;\n  const float MAGNIFICATION = FOCAL_LENGTH / abs(FOCUS_DISTANCE - FOCAL_LENGTH);\n  const float FSTOP = 2.8;\n  const float BLUR_COEFFICIENT = (FOCAL_LENGTH * MAGNIFICATION) / FSTOP;\n  const float PPM = sqrt(480.0 * 480.0 + 600.0 * 600.0) / 35.0;\n  const vec2 DEPTH_RANGE = vec2(NEAR, FAR);\n  \n  uniform vec2 uResolution;\n  uniform vec2 uTexelOffset;\n  \n  uniform sampler2D uColor;\n  uniform sampler2D uDepth;\n  \n  void main() {\n      vec2 fragCoord = gl_FragCoord.xy;\n      vec2 resolution = uResolution - vec2(1.0);\n  \n      // Convert to linear depth\n      float ndc = 2.0 * texture2D(uDepth, fragCoord / resolution).r - 1.0;\n      float depth = -(2.0 * 0.5 * DEPTH_RANGE.y * DEPTH_RANGE.x) / (ndc * (DEPTH_RANGE.y - DEPTH_RANGE.x) - DEPTH_RANGE.y - DEPTH_RANGE.x);\n      float deltaDepth = abs(FOCUS_DISTANCE - depth);\n  \n      // Blur more quickly in the foreground.\n      float xdd = depth < FOCUS_DISTANCE ? abs(FOCUS_DISTANCE - deltaDepth) : abs(FOCUS_DISTANCE + deltaDepth);\n      float blurRadius = min(floor(BLUR_COEFFICIENT * (deltaDepth / xdd) * PPM), MAX_BLUR);\n  \n      vec4 color = vec4(0.0);\n      if (blurRadius > 1.0) {\n          float halfBlur = blurRadius * 0.5;\n  \n          float count = 0.0;\n  \n          for (float i = 0.0; i <= MAX_BLUR; ++i) {\n              if (i > blurRadius) {\n                  break;\n              }\n  \n              // Clamp sample coordinates\n              vec2 sampleCoord = clamp(fragCoord + ((i - halfBlur) * uTexelOffset), vec2(0.0), resolution);\n              color += texture2D(uColor, sampleCoord / resolution);\n  \n              ++count;\n          }\n  \n          color /= count;\n      } else {\n          color = texture2D(uColor, fragCoord / resolution);\n      }\n  \n      gl_FragColor = color;\n  }\n",vs:"\n  attribute vec4 aVertexPosition;\n  \n  void main() {\n      gl_Position = aVertexPosition;\n  }  \n",init:Gi}},this.effectPrograms={},t._instance||(t._instance=this),t._instance}));function Ro(t){return Ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ro(t)}function No(){No=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(A([])));g&&g!==e&&r.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==Ro(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function A(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},v(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},v(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:A(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Bo(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function Do(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){Bo(o,n,i,a,s,"next",t)}function s(t){Bo(o,n,i,a,s,"throw",t)}a(void 0)}))}}function Fo(t,e){return Fo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Fo(t,e)}function Uo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function zo(t){return zo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},zo(t)}var Go=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fo(t,e)}(o,t);var e,r,n,i=(r=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=zo(r);if(n){var i=zo(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ro(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Uo(t)}(this,t)});function o(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(Uo(t=i.call.apply(i,[this].concat(r))),"init",function(){var e=Do(No().mark((function e(r){var n,i,o,a;return No().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=function(t){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||0===r.fileUpload.files.length)return r.fileUpload.click(),void(r.fileUpload.onchange=function(e){return i(t)});i(null)},o=function(){return(o=Do(No().mark((function t(e){var i,o,a;return No().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i=r.fileUpload.files[0],t.next=4,zi().loadAsync(i);case 4:return o=t.sent,t.t0=JSON,t.next=8,o.file("manifest.json").async("string");case 8:t.t1=t.sent,a=t.t0.parse.call(t.t0,t.t1),console.log(a),a.initialZones.forEach((function(t){n.loadZoneFromZip(t,o,!0)})),e.world.isPaused=!1,e.completed=!0,t.next=20;break;case 16:return t.prev=16,t.t2=t.catch(0),console.error(t.t2),t.abrupt("return");case 20:case"end":return t.stop()}}),t,null,[[0,16]])})))).apply(this,arguments)},i=function(t){return o.apply(this,arguments)},jo._instance.engine=r,(n=jo._instance.world=new So(r,"dynamic")).startMenu({start:{pausable:!1,text:"Load Game File",prompt:"Please select a file to load...",x:r.screenSize().width/2-75,y:r.screenSize().height/2-50,w:150,h:75,quittable:!1,colours:{top:"#333",bottom:"#777",background:"#999"},onEnter:!0,onOpen:function(e){t.isPaused=!0},trigger:function(){var t=Do(No().mark((function t(e){return No().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a(e);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t}return e=o,Object.defineProperty(e,"prototype",{writable:!1}),e}(jo);function Wo(t){return Wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wo(t)}function Vo(t,e){return Vo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Vo(t,e)}function $o(t){return $o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},$o(t)}var Yo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vo(t,e)}(o,t);var e,r,n,i=(r=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$o(r);if(n){var i=$o(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Wo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),i.apply(this,arguments)}return e=o,Object.defineProperty(e,"prototype",{writable:!1}),e}(Go),Ko=r(3379),Ho=r.n(Ko),Zo=r(7795),Xo=r.n(Zo),qo=r(569),Jo=r.n(qo),Qo=r(3565),ta=r.n(Qo),ea=r(9216),ra=r.n(ea),na=r(4589),ia=r.n(na),oa=r(480),aa={};function sa(t){return sa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sa(t)}function ca(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ua(t,e){return ua=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ua(t,e)}function la(t){return la=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},la(t)}aa.styleTagTransform=ia(),aa.setAttributes=ta(),aa.insert=Jo().bind(null,"head"),aa.domAPI=Xo(),aa.insertStyleElement=ra(),Ho()(oa.Z,aa),oa.Z&&oa.Z.locals&&oa.Z.locals;var ha=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ua(t,e)}(s,t);var r,n,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=la(i);if(o){var r=la(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===sa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=a.call(this,t)).state={spritz:new Yo,updated:Date.now(),zipData:t.zipData},e}return r=s,(n=[{key:"componentWillReceiveProps",value:function(t){JSON.stringify(this.props.networkString)!=JSON.stringify(t.networkString)&&this.setState({networkString:t.networkString,updated:Date.now()})}},{key:"render",value:function(){var t=this.state,r=t.updated,n=t.spritz,i=t.zipData;return e().createElement("div",{style:{margin:0,minHeight:"480px",maxHeight:"1080px"}},e().createElement(Di,{class:"pixos",key:"pixos-".concat(r),width:"480px",height:"640px",SpritzProvider:n,zipData:null!=i?i:""}))}}])&&ca(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(t.Component);const fa=(0,i.collect)(ha)})(),module.exports["calliope-pixos"]=n})();
//# sourceMappingURL=bundle.js.map